if ((typeof(h5Gz8kAhgljIMpoVjaduMAf$3university$0university$1)) == "undefined") {h5Gz8kAhgljIMpoVjaduMAf$3university$0university$1 = {};
};
(function(){h5Gz8kAhgljIMpoVjaduMAf$3university$0university$1.eq_kind$1664 = function(v$3579,v$3580){return v$3579 == v$3580;
};
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<html><head>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<title>Canvas example</title>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<style>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("div#minimapcontainer { position : absolute; width : 100%; }\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161((("canvas#minimap { position : absolute; width : " + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(1000))) + "px; }") + "\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161((("canvas#minimapobjects { position : absolute; width : " + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(1000))) + "px; }") + "\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("div#floor { position : absolute; width : 100%; height : 100%; background-color : rgb(128,128,128); z-index : -10000000; }\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("div#ceiling { position : absolute; width : 100%; height : 50%; background-color : rgb(96,96,96); z-index : -10000000; }\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161((((("#screen { position : relative; width : " + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(1000))) + "px; height : ") + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(500))) + "px; border : 1px solid black; overflow : hidden; }") + "\n");
var t$3742 = EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161;
var t$3741;
var t$3740;
var t$3739;
var t$3738;
var t$3737;
var t$3736 = "div#overlay { position : absolute; display : block; width : ";
var t$3735;
var i$1717 = SmlPrims.chk_ovf_i32(1000 - 10);
t$3735 = ((i$1717 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$1717))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$1717)));
t$3737 = (t$3736 + t$3735);
t$3738 = (t$3737 + "px; height : ");
var t$3734;
var i$1719 = SmlPrims.chk_ovf_i32(500 - 10);
t$3734 = ((i$1719 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$1719))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$1719)));
t$3739 = (t$3738 + t$3734);
t$3740 = (t$3739 + "px; padding : 5px; color : white; font-family : lucida console, courier new; font-size : 20px; z-index : 1; }");
t$3741 = (t$3740 + "\n");
t$3742(t$3741);
var t$3750 = EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161;
var t$3749;
var t$3748;
var t$3747;
var t$3746;
var t$3745;
var t$3744 = "div#score { position : relative; display : block; width : ";
var t$3743;
var i$1727 = SmlPrims.chk_ovf_i32(1000 - 10);
t$3743 = ((i$1727 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$1727))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$1727)));
t$3745 = (t$3744 + t$3743);
t$3746 = (t$3745 + "px; height : ");
t$3747 = (t$3746 + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(30)));
t$3748 = (t$3747 + "px; padding : 5px; color : blue; font-family : lucida console, courier new; font-size : 20px; z-index : 1; }");
t$3749 = (t$3748 + "\n");
t$3750(t$3749);
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("</style>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("</head><body><center>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<h2>The PLTC Hallway!</h2>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='screen'>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='floor'></div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='ceiling'></div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='overlay'></div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("</div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='score'> </div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='minimapcontainer'>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<canvas id='minimap'></canvas>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<canvas id='minimapobjects'></canvas>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("</div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='log'></div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("</center></body></html>\n");
var Smap$102 = ["*********************************H*H***H*H*%%%%%%%%%%%%%%%%%%HHHHHH%%%%%%%%HHHHHHHH%%%%%%HHHHHHH%%%%%%HHHHHHH**",["*         T   T              L *                   %                         %              %                 *",["*  %%%%                        **           L   O  %    P  P                 %              %                 *",["*  %  %  **O*****O***O*        M*                  %                                                A  A      *",["*  %  H                        N*          %%%%%%%%%    P  P                                                  *",["*     %             P          **                  %                                                A  A      *",["*     %    *****          %**********              *    P  P                    L                             *",["*  %  %                        *                   *                       L         L              A  A      *",["*  %  H                     L     L       **       *                                                          *",["*  %  %       A                *                   *                     L      A      L            A  A      *",["*  %%%%              P    %*****                   *                                                          *",["*                              *                   *                       L         L                        *",["*        %%%  %%%              O    L  L  L  L  L  *%%%%                        L                             *",["*        %%%  %%%              *                   *                                                       %%%*",["*    L   %%%  %%%         m***** P                 *                                                          *",["*        %%%  %%%              *        H%H        *                                                          *",["*  H  HO OOOOOOOO OHH  H   P   *                   %                                                          *",["*  H  H             H  H       *         L         %                                                T         *",["*  H  H          T  H  H       *    A              %HH*                                       T           T   *",["*  H  H             H  H       *                   %                                                T         *",["*  H%%HOOOOOOOOOOOOOH%%H       **********                                L                    T           T   *",["*       L                      *           T  A                                                     T         *",["*                           P  *                   %                                                          *",["********************************%%%%%%%%%%%%NM%%%%%%%%%%%%%%%HHHHHH%%%%%%%%HHHHHHHH%%%%%%HHHHHHH%%%%%%HHHHHHH**",null]]]]]]]]]]]]]]]]]]]]]]]];
var Map$151 = Y5y0a7l58ITwhpccCWLDEa$3basis$0Array2$1.fromList$58(dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.map$330(function(s$1785){var e$1793 = null;
var fix$3751 = {};
fix$3751.$rl = function(v$3581,v$3582){lab$rl: while (true) {if (v$3581 >= 0) {var t$3755 = SmlPrims.chk_ovf_i32(v$3581 - 1);
var t$3752;
var v$3026 = s$1785.charCodeAt(v$3581);
var t$3754;
var t$3753;
switch (v$3026) { case 32: {t$3753 = 0;
 break; }case 42: {t$3753 = 1;
 break; }case 61: {t$3753 = 2;
 break; }case 119: {t$3753 = 2;
 break; }case 79: {t$3753 = 2;
 break; }case 109: {t$3753 = 3;
 break; }case 37: {t$3753 = 3;
 break; }case 72: {t$3753 = 4;
 break; }case 77: {t$3753 = 5;
 break; }case 78: {t$3753 = 6;
 break; }case 84: {t$3753 = 100;
 break; }case 65: {t$3753 = 101;
 break; }case 80: {t$3753 = 102;
 break; }case 76: {t$3753 = 103;
 break; }case 66: {t$3753 = 104;
 break; }case 67: {t$3753 = 105;
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,("unknown character '" + (h8UYb53cympluUQFSuaSASi$3basis$0Char$1.toString$275(v$3026))) + "'"];
} };
t$3754 = [t$3753,v$3582];
t$3752 = t$3754;
var t$3756 = t$3755;
var t$3757 = t$3752;
var v$3581 = t$3756;
var v$3582 = t$3757;
continue lab$rl;
} else {return v$3582;
};
};
};
var rl$1795 = fix$3751.$rl;
return rl$1795(SmlPrims.chk_ovf_i32(s$1785.length - 1),e$1793);
},Smap$102));
var init$253 = function(items$256){var screen$257;
var v$1828 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"screen");
switch (v$1828[0]) { case 0: {screen$257 = v$1828[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'screen' in DOM"];
} };
Map$151[0][0];
var v$3538 = Map$151[0][1];
var v$3539 = Map$151[0][2];
if ((0 <= v$3538)?(v$3538 <= 123456789):false) {0;
} else {throw CompilerInitial.exn$Size$51;
};
var spriteMap$261;
var v$3038 = [1];
var t$3765;
var t$3758;
var t$1838 = Array(v$3538);
var fix$3759 = {};
fix$3759.$init = function(v$3585,v$3586){lab$init: while (true) {if (v$3586 >= v$3538) {return 0;
} else {var t$3762 = v$3585;
var t$3761 = v$3586;
var t$3760;
if ((0 <= v$3539)?(v$3539 <= 123456789):false) {0;
} else {throw CompilerInitial.exn$Size$51;
};
t$3760 = (SmlPrims.wordTableInit(v$3539,v$3038));
(t$3762[t$3761] = t$3760,0);
var t$3763 = v$3585;
var t$3764 = SmlPrims.chk_ovf_i32(v$3586 + 1);
var v$3585 = t$3763;
var v$3586 = t$3764;
continue lab$init;
};
};
};
var init$1839 = fix$3759.$init;
init$1839(t$1838,0);
t$3758 = t$1838;
t$3765 = [t$3758,v$3538,v$3539];
spriteMap$261 = [t$3765];
var fix$3766 = {};
fix$3766.$app = function(v$1857){lab$app: while (true) {if (v$1857 == null) {return 0;
} else {var v$1858 = v$1857;
var v$1859 = v$1858[0];
var v$1860 = v$1858[1];
var v$1894 = v$1859[0];
var v$1895 = v$1859[1];
var v$1896 = v$1859[2];
var s$1897;
var pos$1899 = [v$1895,v$1896];
var e$1900 = document.createElement("img");
var t$3769 = e$1900;
var t$3768 = "src";
var t$3767;
switch (v$1894) { case 0: {t$3767 = "tablechairs.png";
 break; }case 1: {t$3767 = (("professor" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32((SmlPrims.mod_i32(SmlPrims.chk_ovf_i32(pos$1899[0] + pos$1899[1]),4,CompilerInitial.exn$Div$45)) + 1)))) + ".gif");
 break; }case 2: {t$3767 = "plantgreen.png";
 break; }case 3: {t$3767 = "lamp.png";
 break; }case 4: {t$3767 = "score.png";
 break; }default: {t$3767 = "time.png";
} };
(function(fp,s,v){fp[s] = v;})(t$3769,t$3768,t$3767);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(e$1900,"style"),"display","none");
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(e$1900,"style"),"position","absolute");
var v$1903;
switch (v$1894) { case 0: {v$1903 = true;
 break; }case 1: {v$1903 = true;
 break; }case 2: {v$1903 = true;
 break; }case 3: {v$1903 = false;
 break; }case 4: {v$1903 = false;
 break; }default: {v$1903 = false;
} };
var v$1904 = [false];
s$1897 = [v$1903,[true],e$1900,pos$1899,v$1904];
var v$3046 = [0,s$1897];
var v$1907 = spriteMap$261[0][0];
spriteMap$261[0][1];
spriteMap$261[0][2];
var v$1909 = v$1907.length;
if ((0 <= v$1896)?(v$1896 < v$1909):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$1912 = v$1907[v$1896];
var v$1913 = v$1912.length;
if ((0 <= v$1895)?(v$1895 < v$1913):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
(v$1912[v$1895] = v$3046,0);
(function(e,a){return e.appendChild(a);})(screen$257,s$1897[2]);
var t$3770 = v$1860;
var v$1857 = t$3770;
continue lab$app;
};
};
};
var app$1856 = fix$3766.$app;
app$1856(items$256);
return spriteMap$261;
};
var MaxRotSpeed$312 = (3.0 * 3.14159265358979323846) / 360.0;
var player$313;
var v$314 = [16.0];
var v$315 = [10.0];
var v$316 = [0.0];
var v$317 = [0.0];
var v$318 = [0.0];
player$313 = [0.10,v$316,[0.0],v$318,v$317,v$314,v$315];
Map$151[0][0];
Map$151[0][1];
var mapWidth$321 = Map$151[0][2];
var mapWidthR$322 = mapWidth$321;
Map$151[0][0];
var mapHeight$323;
var v$1922 = Map$151[0][1];
Map$151[0][2];
mapHeight$323 = v$1922;
var mapHeightR$324 = mapHeight$323;
var miniMapScaleR$326 = 8;
var screenWidthR$327 = 1000;
var screenHeightR$328 = 500;
var stripWidthR$330 = 1;
var fov$331 = (60.0 * 3.14159265358979323846) / 180.0;
var numRays$332 = SmlPrims.chk_ovf_i32(Math.ceil(screenWidthR$327 / stripWidthR$330));
var fovHalf$333 = fov$331 / 2.0;
var viewDist$334 = (screenWidthR$327 / 2.0) / ((Math.sin(fovHalf$333)) / (Math.cos(fovHalf$333)));
var twoPI$335 = 3.14159265358979323846 * 2.0;
var checkCollision$496 = function(spriteMap$499,v$3589,v$3590,v$3591,v$3592,v$3593){if ((v$3592 < 0.0)?true:((v$3592 >= mapHeightR$324)?true:((v$3591 < 0.0)?true:(v$3591 >= mapWidthR$322)))) {return [v$3589,v$3590];
} else {var blockX$511 = SmlPrims.chk_ovf_i32(Math.floor(v$3591));
var blockY$512 = SmlPrims.chk_ovf_i32(Math.floor(v$3592));
var t$3771;
if ((blockY$512 < 0.0)?true:((blockY$512 >= mapHeightR$324)?true:((blockX$511 < 0.0)?true:(blockX$511 >= mapWidthR$322)))) {t$3771 = true;
} else {var Y$3358 = SmlPrims.chk_ovf_i32(Math.floor(blockY$512));
var X$3359 = SmlPrims.chk_ovf_i32(Math.floor(blockX$511));
var wt$3360;
var v$3361 = Map$151[0][0];
Map$151[0][1];
Map$151[0][2];
var v$3362 = v$3361.length;
if ((0 <= Y$3358)?(Y$3358 < v$3362):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3363 = v$3361[Y$3358];
var v$3364 = v$3363.length;
if ((0 <= X$3359)?(X$3359 < v$3364):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$3360 = v$3363[X$3359];
if ((wt$3360 > 0)?((wt$3360 >= 100)?false:true):false) {t$3771 = true;
} else {var v$3365;
var v$3366 = spriteMap$499[0][0];
spriteMap$499[0][1];
spriteMap$499[0][2];
var v$3367 = v$3366.length;
if ((0 <= Y$3358)?(Y$3358 < v$3367):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3368 = v$3366[Y$3358];
var v$3369 = v$3368.length;
if ((0 <= X$3359)?(X$3359 < v$3369):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$3365 = v$3368[X$3359];
switch (v$3365[0]) { case 0: {t$3771 = v$3365[1][0];
 break; }default: {t$3771 = false;
} };
};
};
if (t$3771) {return [v$3589,v$3590];
} else {var blockTop$518;
var v$3531 = blockY$512 - 1.0;
if ((v$3531 < 0.0)?true:((v$3531 >= mapHeightR$324)?true:((blockX$511 < 0.0)?true:(blockX$511 >= mapWidthR$322)))) {blockTop$518 = true;
} else {var Y$3373 = SmlPrims.chk_ovf_i32(Math.floor(v$3531));
var X$3374 = SmlPrims.chk_ovf_i32(Math.floor(blockX$511));
var wt$3375;
var v$3376 = Map$151[0][0];
Map$151[0][1];
Map$151[0][2];
var v$3377 = v$3376.length;
if ((0 <= Y$3373)?(Y$3373 < v$3377):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3378 = v$3376[Y$3373];
var v$3379 = v$3378.length;
if ((0 <= X$3374)?(X$3374 < v$3379):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$3375 = v$3378[X$3374];
if ((wt$3375 > 0)?((wt$3375 >= 100)?false:true):false) {blockTop$518 = true;
} else {var v$3380;
var v$3381 = spriteMap$499[0][0];
spriteMap$499[0][1];
spriteMap$499[0][2];
var v$3382 = v$3381.length;
if ((0 <= Y$3373)?(Y$3373 < v$3382):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3383 = v$3381[Y$3373];
var v$3384 = v$3383.length;
if ((0 <= X$3374)?(X$3374 < v$3384):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$3380 = v$3383[X$3374];
switch (v$3380[0]) { case 0: {blockTop$518 = v$3380[1][0];
 break; }default: {blockTop$518 = false;
} };
};
};
var blockBottom$519;
var v$3533 = blockY$512 + 1.0;
if ((v$3533 < 0.0)?true:((v$3533 >= mapHeightR$324)?true:((blockX$511 < 0.0)?true:(blockX$511 >= mapWidthR$322)))) {blockBottom$519 = true;
} else {var Y$3388 = SmlPrims.chk_ovf_i32(Math.floor(v$3533));
var X$3389 = SmlPrims.chk_ovf_i32(Math.floor(blockX$511));
var wt$3390;
var v$3391 = Map$151[0][0];
Map$151[0][1];
Map$151[0][2];
var v$3392 = v$3391.length;
if ((0 <= Y$3388)?(Y$3388 < v$3392):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3393 = v$3391[Y$3388];
var v$3394 = v$3393.length;
if ((0 <= X$3389)?(X$3389 < v$3394):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$3390 = v$3393[X$3389];
if ((wt$3390 > 0)?((wt$3390 >= 100)?false:true):false) {blockBottom$519 = true;
} else {var v$3395;
var v$3396 = spriteMap$499[0][0];
spriteMap$499[0][1];
spriteMap$499[0][2];
var v$3397 = v$3396.length;
if ((0 <= Y$3388)?(Y$3388 < v$3397):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3398 = v$3396[Y$3388];
var v$3399 = v$3398.length;
if ((0 <= X$3389)?(X$3389 < v$3399):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$3395 = v$3398[X$3389];
switch (v$3395[0]) { case 0: {blockBottom$519 = v$3395[1][0];
 break; }default: {blockBottom$519 = false;
} };
};
};
var blockLeft$520;
var v$3534 = blockX$511 - 1.0;
if ((blockY$512 < 0.0)?true:((blockY$512 >= mapHeightR$324)?true:((v$3534 < 0.0)?true:(v$3534 >= mapWidthR$322)))) {blockLeft$520 = true;
} else {var Y$3403 = SmlPrims.chk_ovf_i32(Math.floor(blockY$512));
var X$3404 = SmlPrims.chk_ovf_i32(Math.floor(v$3534));
var wt$3405;
var v$3406 = Map$151[0][0];
Map$151[0][1];
Map$151[0][2];
var v$3407 = v$3406.length;
if ((0 <= Y$3403)?(Y$3403 < v$3407):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3408 = v$3406[Y$3403];
var v$3409 = v$3408.length;
if ((0 <= X$3404)?(X$3404 < v$3409):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$3405 = v$3408[X$3404];
if ((wt$3405 > 0)?((wt$3405 >= 100)?false:true):false) {blockLeft$520 = true;
} else {var v$3410;
var v$3411 = spriteMap$499[0][0];
spriteMap$499[0][1];
spriteMap$499[0][2];
var v$3412 = v$3411.length;
if ((0 <= Y$3403)?(Y$3403 < v$3412):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3413 = v$3411[Y$3403];
var v$3414 = v$3413.length;
if ((0 <= X$3404)?(X$3404 < v$3414):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$3410 = v$3413[X$3404];
switch (v$3410[0]) { case 0: {blockLeft$520 = v$3410[1][0];
 break; }default: {blockLeft$520 = false;
} };
};
};
var blockRight$521;
var v$3536 = blockX$511 + 1.0;
if ((blockY$512 < 0.0)?true:((blockY$512 >= mapHeightR$324)?true:((v$3536 < 0.0)?true:(v$3536 >= mapWidthR$322)))) {blockRight$521 = true;
} else {var Y$3418 = SmlPrims.chk_ovf_i32(Math.floor(blockY$512));
var X$3419 = SmlPrims.chk_ovf_i32(Math.floor(v$3536));
var wt$3420;
var v$3421 = Map$151[0][0];
Map$151[0][1];
Map$151[0][2];
var v$3422 = v$3421.length;
if ((0 <= Y$3418)?(Y$3418 < v$3422):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3423 = v$3421[Y$3418];
var v$3424 = v$3423.length;
if ((0 <= X$3419)?(X$3419 < v$3424):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$3420 = v$3423[X$3419];
if ((wt$3420 > 0)?((wt$3420 >= 100)?false:true):false) {blockRight$521 = true;
} else {var v$3425;
var v$3426 = spriteMap$499[0][0];
spriteMap$499[0][1];
spriteMap$499[0][2];
var v$3427 = v$3426.length;
if ((0 <= Y$3418)?(Y$3418 < v$3427):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3428 = v$3426[Y$3418];
var v$3429 = v$3428.length;
if ((0 <= X$3419)?(X$3419 < v$3429):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$3425 = v$3428[X$3419];
switch (v$3425[0]) { case 0: {blockRight$521 = v$3425[1][0];
 break; }default: {blockRight$521 = false;
} };
};
};
var toY$522 = (blockTop$518?((v$3592 - blockY$512) < v$3593):false)?(blockY$512 + v$3593):((blockBottom$519?(((blockY$512 + 1.0) - v$3592) < v$3593):false)?((blockY$512 + 1.0) - v$3593):v$3592);
return [(blockLeft$520?((v$3591 - blockX$511) < v$3593):false)?(blockX$511 + v$3593):((blockRight$521?(((blockX$511 + 1.0) - v$3591) < v$3593):false)?((blockX$511 + 1.0) - v$3593):v$3591),toY$522];
};
};
};
var drawMiniMap$790 = function(){var miniMap$797;
var v$2149 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimap");
switch (v$2149[0]) { case 0: {miniMap$797 = v$2149[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimap' in DOM"];
} };
var miniMapCtr$798;
var v$2155 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimapcontainer");
switch (v$2155[0]) { case 0: {miniMapCtr$798 = v$2155[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimapcontainer' in DOM"];
} };
var miniMapObjects$799;
var v$2161 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimapobjects");
switch (v$2161[0]) { case 0: {miniMapObjects$799 = v$2161[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimapobjects' in DOM"];
} };
var w$800 = SmlPrims.chk_ovf_i32(mapWidth$321 * 8);
var h$801 = SmlPrims.chk_ovf_i32(mapHeight$323 * 8);
(function(fp,s,v){fp[s] = v;})(miniMap$797,"width",w$800);
(function(fp,s,v){fp[s] = v;})(miniMap$797,"height",h$801);
(function(fp,s,v){fp[s] = v;})(miniMapObjects$799,"width",w$800);
(function(fp,s,v){fp[s] = v;})(miniMapObjects$799,"height",h$801);
(function(fp,s,v){fp[s] = v;})(miniMapCtr$798,"width",w$800);
(function(fp,s,v){fp[s] = v;})(miniMapCtr$798,"height",h$801);
var w_s$808 = ((w$800 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(w$800))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(w$800))) + "px";
var h_s$809 = ((h$801 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(h$801))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(h$801))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMap$797,"style"),"width",w_s$808);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMapObjects$799,"style"),"width",w_s$808);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMapCtr$798,"style"),"width",w_s$808);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMap$797,"style"),"height",h_s$809);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMapObjects$799,"style"),"height",h_s$809);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMapCtr$798,"style"),"height",h_s$809);
var c$816 = (function(e,s){return e.getContext(s);})(miniMap$797,"2d");
var entireMap$817 = function(v$3733){return [Map$151,0,[1],[1],0];
};
Y5y0a7l58ITwhpccCWLDEa$3basis$0Array2$1.appi$512(0,function(v$3655){var v$3656 = v$3655[0];
var v$3657 = v$3655[1];
var v$3658 = v$3655[2];
if ((v$3658 > 0)?((v$3658 >= 100)?false:true):false) {(function(c,s){c.fillStyle = s;})(c$816,"rgb(200,200,200)");
return (function(c,a1,a2,a3,a4){c.fillRect(a1,a2,a3,a4);})(c$816,SmlPrims.chk_ovf_i32(v$3657 * 8),SmlPrims.chk_ovf_i32(v$3656 * 8),8,8);
} else {return 0;
};
},(entireMap$817(0))[0],(entireMap$817(0))[4],(entireMap$817(0))[1],(entireMap$817(0))[3],(entireMap$817(0))[2]);
var miniMap$3431;
var v$3432 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimap");
switch (v$3432[0]) { case 0: {miniMap$3431 = v$3432[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimap' in DOM"];
} };
var miniMapObjects$3433;
var v$3434 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimapobjects");
switch (v$3434[0]) { case 0: {miniMapObjects$3433 = v$3434[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimapobjects' in DOM"];
} };
var height$3435 = (function(fp,s){return fp[s];})(miniMap$3431,"height");
var width$3436 = (function(fp,s){return fp[s];})(miniMap$3431,"width");
var c$3437 = (function(e,s){return e.getContext(s);})(miniMapObjects$3433,"2d");
(function(c,a1,a2,a3,a4){c.clearRect(a1,a2,a3,a4);})(c$3437,0,0,width$3436,height$3435);
(function(c,a1,a2,a3,a4){c.fillRect(a1,a2,a3,a4);})(c$3437,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$313[5][0] * miniMapScaleR$326) - 2.0),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$313[6][0] * miniMapScaleR$326) - 2.0),4,4);
(function(c){c.beginPath();})(c$3437);
(function(c,a1,a2){c.moveTo(a1,a2);})(c$3437,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(player$313[5][0] * miniMapScaleR$326),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(player$313[6][0] * miniMapScaleR$326));
(function(c,a1,a2){c.lineTo(a1,a2);})(c$3437,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$313[5][0] + (Math.cos(player$313[1][0]))) * miniMapScaleR$326),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$313[6][0] + (Math.sin(player$313[1][0]))) * miniMapScaleR$326));
(function(c){c.closePath();})(c$3437);
return (function(c){c.stroke();})(c$3437);
};
var castSingleRay$970;
var fix$3772 = {};
fix$3772.$RealMod = function(v$3594,v$3595){lab$RealMod: while (true) {if (v$3594 < v$3595) {return v$3594;
} else {var t$3773 = v$3594 - v$3595;
var t$3774 = v$3595;
var v$3594 = t$3773;
var v$3595 = t$3774;
continue lab$RealMod;
};
};
};
var RealMod$852 = fix$3772.$RealMod;
castSingleRay$970 = (function(screenStrips$973){return function(spriteMap$976){return function(v$981){var v$1382 = v$981[0];
var v$1383 = v$981[1];
var v$1384 = v$981[2];
var rayAngle$982 = RealMod$852(v$1382,twoPI$335);
var rayAngle$983 = (rayAngle$982 < 0.0)?(rayAngle$982 + twoPI$335):rayAngle$982;
var right$988 = (rayAngle$983 > (twoPI$335 * 0.75))?true:(rayAngle$983 < (twoPI$335 * 0.25));
var up$993 = (rayAngle$983 < 0.0)?true:(rayAngle$983 > 3.14159265358979323846);
var angleSin$998 = Math.sin(rayAngle$983);
var angleCos$999 = Math.cos(rayAngle$983);
var slope$1000 = angleSin$998 / angleCos$999;
var dXVer$1001 = right$988?1.0:(-1.0);
var dYVer$1006 = dXVer$1001 * slope$1000;
var x$1007 = right$988?(SmlPrims.chk_ovf_i32(Math.ceil(player$313[5][0]))):(SmlPrims.chk_ovf_i32(Math.floor(player$313[5][0])));
var x$1020 = x$1007;
var y$1021 = player$313[6][0] + ((x$1020 - player$313[5][0]) * slope$1000);
var v$1372;
var fix$3775 = {};
fix$3775.$loop = function(v$3598,v$3599,visibleSprites$1037){lab$loop: while (true) {if ((v$3598 < 0.0)?true:((v$3598 >= mapWidthR$322)?true:((v$3599 < 0.0)?true:(v$3599 >= mapHeightR$324)))) {return [[0.0,0.0,0,0.0,0,0.0,0],visibleSprites$1037];
} else {var wallX$1049 = SmlPrims.chk_ovf_i32(Math.floor(right$988?v$3598:(v$3598 - 1.0)));
var wallY$1054 = SmlPrims.chk_ovf_i32(Math.floor(v$3599));
var wt$1055;
var v$2381 = Map$151[0][0];
Map$151[0][1];
Map$151[0][2];
var v$2383 = v$2381.length;
if ((0 <= wallY$1054)?(wallY$1054 < v$2383):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$2385 = v$2381[wallY$1054];
var v$2386 = v$2385.length;
if ((0 <= wallX$1049)?(wallX$1049 < v$2386):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$1055 = v$2385[wallX$1049];
if ((wt$1055 > 0)?((wt$1055 >= 100)?false:true):false) {var distX$1060 = v$3598 - player$313[5][0];
var distY$1065 = v$3599 - player$313[6][0];
var dist$1070 = (distX$1060 * distX$1060) + (distY$1065 * distY$1065);
var textureX$1071 = v$3599 - (SmlPrims.chk_ovf_i32(Math.floor(v$3599)));
return [[dist$1070,(right$988?false:true)?(1.0 - textureX$1071):textureX$1071,wt$1055,v$3598,wallX$1049,v$3599,wallY$1054],visibleSprites$1037];
} else {var t$3778 = v$3598 + dXVer$1001;
var t$3777 = v$3599 + dYVer$1006;
var t$3776;
var v$1088;
var v$2395 = spriteMap$976[0][0];
spriteMap$976[0][1];
spriteMap$976[0][2];
var v$2397 = v$2395.length;
if ((0 <= wallY$1054)?(wallY$1054 < v$2397):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$2399 = v$2395[wallY$1054];
var v$2400 = v$2399.length;
if ((0 <= wallX$1049)?(wallX$1049 < v$2400):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$1088 = v$2399[wallX$1049];
switch (v$1088[0]) { case 1: {t$3776 = visibleSprites$1037;
 break; }default: {var v$1103 = v$1088[1];
if (v$1103[4][0]) {t$3776 = visibleSprites$1037;
} else {(v$1103[4][0] = true,0);
t$3776 = [v$1103,visibleSprites$1037];
};
} };
var t$3779 = t$3778;
var t$3780 = t$3777;
var t$3781 = t$3776;
var v$3598 = t$3779;
var v$3599 = t$3780;
var visibleSprites$1037 = t$3781;
continue lab$loop;
};
};
};
};
var loop$1030 = fix$3775.$loop;
v$1372 = (loop$1030(x$1020,y$1021,v$1384));
var v$1373 = v$1372[0];
var v$1374 = v$1373[3];
var v$1375 = v$1373[5];
var v$1376 = v$1373[0];
var v$1377 = v$1373[1];
var v$1378 = v$1373[4];
var v$1379 = v$1373[6];
var v$1380 = v$1373[2];
var v$1381 = v$1372[1];
var slope$1127 = angleCos$999 / angleSin$998;
var dYHor$1128 = up$993?(-1.0):1.0;
var dXHor$1133 = dYHor$1128 * slope$1127;
var y$1134 = up$993?(SmlPrims.chk_ovf_i32(Math.floor(player$313[6][0]))):(SmlPrims.chk_ovf_i32(Math.ceil(player$313[6][0])));
var x$1147 = player$313[5][0] + ((y$1134 - player$313[6][0]) * slope$1127);
var v$1362;
var fix$3782 = {};
fix$3782.$loop = function(v$3602,v$3603,visibleSprites$1163){lab$loop: while (true) {if ((v$3602 < 0.0)?true:((v$3602 >= mapWidthR$322)?true:((v$3603 < 0.0)?true:((v$3603 >= mapHeightR$324)?true:(slope$1127 > 10000.0))))) {return [[v$1376,v$1377,v$1380,v$1374,v$1378,v$1375,v$1379],visibleSprites$1163];
} else {var wallY$1175 = SmlPrims.chk_ovf_i32(Math.floor(up$993?(v$3603 - 1.0):v$3603));
var wallX$1180 = SmlPrims.chk_ovf_i32(Math.floor(v$3602));
var wt$1181;
try {var v$2415 = Map$151[0][0];
Map$151[0][1];
Map$151[0][2];
var v$2417 = v$2415.length;
if ((0 <= wallY$1175)?(wallY$1175 < v$2417):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$2419 = v$2415[wallY$1175];
var v$2420 = v$2419.length;
if ((0 <= wallX$1180)?(wallX$1180 < v$2420):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$1181 = v$2419[wallX$1180];
} catch(v$3783) {wt$1181 = (((function(env$3788){return function(s$m$1184){var v$3784 = env$3788[0];
var v$3785 = env$3788[1];
var v$3786 = env$3788[2];
var v$3787 = env$3788[3];
var s$2421 = (("wallX = " + ((v$3787 < 0)?("-" + (v$3786(SmlPrims.chk_ovf_i32(-(v$3787))))):(v$3786(v$3787)))) + "; wallY = ") + ((v$3785 < 0)?("-" + (v$3786(SmlPrims.chk_ovf_i32(-(v$3785))))):(v$3786(v$3785)));
var log$2422;
var v$2424 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(v$3784,"log");
switch (v$2424[0]) { case 0: {log$2422 = v$2424[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'log' in DOM"];
} };
(function(e,a){return e.appendChild(a);})(log$2422,document.createTextNode(s$2421));
(function(e,a){return e.appendChild(a);})(log$2422,document.createElement("br"));
throw s$m$1184;
};
})([z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,wallY$1175,abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456,wallX$1180]))(v$3783));
};
if ((wt$1181 > 0)?((wt$1181 >= 100)?false:true):false) {var distX$1191 = v$3602 - player$313[5][0];
var distY$1196 = v$3603 - player$313[6][0];
var blockDist$1201 = (distX$1191 * distX$1191) + (distY$1196 * distY$1196);
if (((v$1376 > 0.0)?false:true)?true:(blockDist$1201 < v$1376)) {var textureX$1206 = v$3602 - (SmlPrims.chk_ovf_i32(Math.floor(v$3602)));
return [[blockDist$1201,1.0 - (up$993?(1.0 - textureX$1206):textureX$1206),wt$1181,v$3602,wallX$1180,v$3603,wallY$1175],visibleSprites$1163];
} else {return [[v$1376,v$1377,v$1380,v$1374,v$1378,v$1375,v$1379],visibleSprites$1163];
};
} else {var t$3791 = v$3602 + dXHor$1133;
var t$3790 = v$3603 + dYHor$1128;
var t$3789;
var v$1235;
var v$2446 = spriteMap$976[0][0];
spriteMap$976[0][1];
spriteMap$976[0][2];
var v$2448 = v$2446.length;
if ((0 <= wallY$1175)?(wallY$1175 < v$2448):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$2450 = v$2446[wallY$1175];
var v$2451 = v$2450.length;
if ((0 <= wallX$1180)?(wallX$1180 < v$2451):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$1235 = v$2450[wallX$1180];
switch (v$1235[0]) { case 1: {t$3789 = visibleSprites$1163;
 break; }default: {var v$1250 = v$1235[1];
if (v$1250[4][0]) {t$3789 = visibleSprites$1163;
} else {(v$1250[4][0] = true,0);
t$3789 = [v$1250,visibleSprites$1163];
};
} };
var t$3792 = t$3791;
var t$3793 = t$3790;
var t$3794 = t$3789;
var v$3602 = t$3792;
var v$3603 = t$3793;
var visibleSprites$1163 = t$3794;
continue lab$loop;
};
};
};
};
var loop$1156 = fix$3782.$loop;
v$1362 = (loop$1156(x$1147,y$1134,v$1381));
var v$1363 = v$1362[0];
var v$1364 = v$1363[0];
var v$1365 = v$1363[3];
var v$1366 = v$1363[5];
var v$1367 = v$1363[4];
var v$1368 = v$1363[6];
var v$1369 = v$1363[2];
var v$1370 = v$1363[1];
var v$1371 = v$1362[1];
if (v$1364 <= 0.0) {return v$1371;
} else {var miniMapObjects$2457;
var v$2459 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimapobjects");
switch (v$2459[0]) { case 0: {miniMapObjects$2457 = v$2459[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimapobjects' in DOM"];
} };
var c$2462 = (function(e,s){return e.getContext(s);})(miniMapObjects$2457,"2d");
(function(c,s){c.strokeStyle = s;})(c$2462,"rgba(0,100,0,0.3)");
(function(c,s){c.lineWidth = s;})(c$2462,"0.5");
(function(c){c.beginPath();})(c$2462);
(function(c,a1,a2){c.moveTo(a1,a2);})(c$2462,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(player$313[5][0] * miniMapScaleR$326),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(player$313[6][0] * miniMapScaleR$326));
(function(c,a1,a2){c.lineTo(a1,a2);})(c$2462,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(v$1365 * miniMapScaleR$326),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(v$1366 * miniMapScaleR$326));
(function(c){c.closePath();})(c$2462);
(function(c){c.stroke();})(c$2462);
var dist$1283 = Math.sqrt(v$1364);
var dist$1284 = dist$1283 * (Math.cos(player$313[1][0] - rayAngle$983));
var height$1289 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(viewDist$334 / dist$1284);
var width$1290 = SmlPrims.chk_ovf_i32(height$1289 * 1);
var widthR$1291 = width$1290;
var heightR$1292 = height$1289;
var top$1293 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((screenHeightR$328 - heightR$1292) / 2.0);
var texX$1294 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(v$1370 * widthR$1291);
var texX$1295 = (texX$1294 > (SmlPrims.chk_ovf_i32(width$1290 - 1)))?(SmlPrims.chk_ovf_i32(width$1290 - 1)):texX$1294;
var v$2485 = screenStrips$973.length;
if ((0 <= v$1383)?(v$1383 < v$2485):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var stripdata$1300 = screenStrips$973[v$1383];
var f169$1301 = (9.0 / 16.0) * 2.0;
var v$1341;
if (v$1369 == 5) {var v$2488 = stripdata$1300[0];
var v$2489 = stripdata$1300[1];
var r$2491 = v$2489[3];
if (r$2491[0] == "datoek-000.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2488,"src","datoek-000.png");
(r$2491[0] = "datoek-000.png",0);
};
v$1341 = [1,1,0,texX$1295,f169$1301];
} else {if (v$1369 == 6) {var v$2501 = stripdata$1300[0];
var v$2502 = stripdata$1300[1];
var r$2504 = v$2502[3];
if (r$2504[0] == "datoek-000.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2501,"src","datoek-000.png");
(r$2504[0] = "datoek-000.png",0);
};
v$1341 = [1,1,1,SmlPrims.chk_ovf_i32(texX$1295 + width$1290),f169$1301];
} else {var v$2514 = stripdata$1300[0];
var v$2515 = stripdata$1300[1];
var r$2517 = v$2515[3];
if (r$2517[0] == "walls.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2514,"src","walls.png");
(r$2517[0] = "walls.png",0);
};
v$1341 = [4,v$1369,0,texX$1295,1.0];
};
};
var v$1342 = v$1341[0];
var v$1343 = v$1341[1];
var v$1345 = v$1341[3];
var v$1346 = v$1341[4];
var v$3449 = stripdata$1300[0];
var v$3450 = stripdata$1300[1];
var r$3452 = v$3450[1];
if (r$3452[0] == height$1289) {0;
} else {var v$3453 = ((height$1289 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(height$1289))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(height$1289))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3449,"style"),"height",v$3453);
(r$3452[0] = height$1289,0);
};
var v$3456 = stripdata$1300[0];
var v$3457 = stripdata$1300[1];
var r$3459 = v$3457[4];
if (r$3459[0] == top$1293) {0;
} else {var v$3460 = ((top$1293 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(top$1293))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(top$1293))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3456,"style"),"top",v$3460);
(r$3459[0] = top$1293,0);
};
var imgTop$1310 = SmlPrims.chk_ovf_i32(Math.floor(heightR$1292 * (SmlPrims.chk_ovf_i32(v$1343 - 1))));
var styleHeight$1311 = SmlPrims.chk_ovf_i32(Math.floor(heightR$1292 * v$1342));
var v$3463 = stripdata$1300[0];
var v$3464 = stripdata$1300[1];
var r$3466 = v$3464[1];
if (r$3466[0] == styleHeight$1311) {0;
} else {var v$3467 = ((styleHeight$1311 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(styleHeight$1311))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(styleHeight$1311))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3463,"style"),"height",v$3467);
(r$3466[0] = styleHeight$1311,0);
};
var styleWidth$1313 = SmlPrims.chk_ovf_i32(Math.floor((widthR$1291 * 2.0) * v$1346));
var v$3470 = stripdata$1300[0];
var v$3471 = stripdata$1300[1];
var r$3473 = v$3471[5];
if (r$3473[0] == styleWidth$1313) {0;
} else {var v$3474 = ((styleWidth$1313 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(styleWidth$1313))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(styleWidth$1313))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3470,"style"),"width",v$3474);
(r$3473[0] = styleWidth$1313,0);
};
var styleTop$1315 = SmlPrims.chk_ovf_i32(top$1293 - imgTop$1310);
var v$3477 = stripdata$1300[0];
var v$3478 = stripdata$1300[1];
var r$3480 = v$3478[4];
if (r$3480[0] == styleTop$1315) {0;
} else {var v$3481 = ((styleTop$1315 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(styleTop$1315))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(styleTop$1315))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3477,"style"),"top",v$3481);
(r$3480[0] = styleTop$1315,0);
};
var styleLeft$1317 = SmlPrims.chk_ovf_i32((SmlPrims.chk_ovf_i32(v$1383 * 1)) - v$1345);
var v$3484 = stripdata$1300[0];
var v$3485 = stripdata$1300[1];
var r$3487 = v$3485[2];
if (r$3487[0] == styleLeft$1317) {0;
} else {var v$3488 = ((styleLeft$1317 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(styleLeft$1317))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(styleLeft$1317))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3484,"style"),"left",v$3488);
(r$3487[0] = styleLeft$1317,0);
};
var styleClip$1319;
var t$3802;
var t$3801;
var t$3800;
var t$3799;
var t$3798;
var t$3797 = ("rect(" + ((imgTop$1310 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(imgTop$1310))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(imgTop$1310)))) + ",";
var t$3796;
var i$2541 = SmlPrims.chk_ovf_i32(v$1345 + 1);
t$3796 = ((i$2541 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$2541))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$2541)));
t$3798 = (t$3797 + t$3796);
t$3799 = (t$3798 + ",");
var t$3795;
var i$2543 = SmlPrims.chk_ovf_i32(imgTop$1310 + height$1289);
t$3795 = ((i$2543 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$2543))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$2543)));
t$3800 = (t$3799 + t$3795);
t$3801 = (t$3800 + ",");
t$3802 = (t$3801 + ((v$1345 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(v$1345))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(v$1345))));
styleClip$1319 = (t$3802 + ")");
var v$2548 = stripdata$1300[0];
var v$2549 = stripdata$1300[1];
var r$2551 = v$2549[0];
if (r$2551[0] == styleClip$1319) {0;
} else {(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$2548,"style"),"clip",styleClip$1319);
(r$2551[0] = styleClip$1319,0);
};
var dwx$1321 = v$1367 - player$313[5][0];
var dwy$1326 = v$1368 - player$313[6][0];
var wallDist$1331 = (dwx$1321 * dwx$1321) + (dwy$1326 * dwy$1326);
var v$3491 = stripdata$1300[0];
var v$3492 = stripdata$1300[1];
var n$3493 = SmlPrims.chk_ovf_i32(-(SmlPrims.chk_ovf_i32(Math.floor(wallDist$1331 * 1000.0))));
var r$3494 = v$3492[6];
if (r$3494[0] == n$3493) {0;
} else {var v$3495 = (n$3493 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(n$3493))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(n$3493));
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3491,"style"),"zIndex",v$3495);
(r$3494[0] = n$3493,0);
};
return v$1371;
};
};
};
});
var zero$1411 = SmlPrims.getrealtime();
var gameCycle$1416 = function(spriteMap$1419){var gameCycleDelay$1420 = TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.div$1394([0,[[1000,null],false]],[0,[[30,null],false]]);
var fix$3803 = {};
fix$3803.$cycle = function(lastGameCycleTime$1424){lab$cycle: while (true) {var n$1427;
var v$3547;
var v$3677 = SmlPrims.getrealtime();
v$3547 = (g14hFoVCUPM3ZC3WsORS6h$3basis$0Time$1.s$g$309(v$3677[0],v$3677[1],zero$1411[0],zero$1411[1]));
n$1427 = (g14hFoVCUPM3ZC3WsORS6h$3basis$0Time$1.toMilliseconds$97(v$3547[0],v$3547[1]));
var timeDelta$1428 = TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(lastGameCycleTime$1424,n$1427);
var mul$2579 = (xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.toInt$1823(timeDelta$1428)) / (xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.toInt$1823(gameCycleDelay$1420));
var moveStep$2581 = (mul$2579 * player$313[4][0]) * player$313[0];
var t$3805 = player$313[3];
var t$3804;
var a$2583 = player$313[3][0] + player$313[2][0];
t$3804 = ((a$2583 > 0.0)?((a$2583 > 2.0)?2.0:a$2583):((a$2583 < (-(2.0)))?(-(2.0)):a$2583));
(t$3805[0] = t$3804,0);
var drot$2585 = (mul$2579 * player$313[3][0]) * MaxRotSpeed$312;
var v$3243 = player$313[1];
(v$3243[0] = (v$3243[0] + drot$2585),0);
var dx$2590 = (Math.cos(player$313[1][0])) * moveStep$2581;
var dy$2591 = (Math.sin(player$313[1][0])) * moveStep$2581;
var fromX$2592 = player$313[5][0];
var fromY$2593 = player$313[6][0];
var v$2594 = checkCollision$496(spriteMap$1419,fromX$2592,fromY$2593,fromX$2592 + dx$2590,fromY$2593 + dy$2591,0.35);
var v$2595 = v$2594[0];
var v$2596 = v$2594[1];
(player$313[5][0] = v$2595,0);
(player$313[6][0] = v$2596,0);
var cycleDelay$1429 = (TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$l$1462(timeDelta$1428,gameCycleDelay$1420))?(xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.max$2267([0,[[1,null],false]],TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(gameCycleDelay$1420,timeDelta$1428),gameCycleDelay$1420))):gameCycleDelay$1420;
(function(i,f){return setTimeout(f,i);})(xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.toInt$1823(cycleDelay$1429),(function(env$3808){return function(v$3554){var v$3806 = env$3808[0];
var v$3807 = env$3808[1];
return v$3807(v$3806);
};
})([n$1427,fix$3803.$cycle]));
return 0;
};
};
var cycle$1421 = fix$3803.$cycle;
return cycle$1421([0,[null,false]]);
};
var updateOverlay$1455;
var old$2615 = [""];
updateOverlay$1455 = (function(v$2616){var s$2617 = "FPS: " + ((y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.fmt$169([2,[0,0]]))(v$2616));
if (old$2615[0] == s$2617) {return 0;
} else {var e$2621;
var v$2623 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"overlay");
switch (v$2623[0]) { case 0: {e$2621 = v$2623[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'overlay' in DOM"];
} };
(function(e,s){e.innerHTML = s;})(e$2621,s$2617);
return (old$2615[0] = s$2617,0);
};
});
var updateScore$1459;
var old$2633 = [""];
updateScore$1459 = (function(v$2634){var s$2635 = "SCORE: " + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(v$2634));
if (old$2633[0] == s$2635) {return 0;
} else {var e$2639;
var v$2641 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"score");
switch (v$2641[0]) { case 0: {e$2639 = v$2641[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'score' in DOM"];
} };
(function(e,s){e.innerHTML = s;})(e$2639,s$2635);
return (old$2633[0] = s$2635,0);
};
});
var renderSprites$1463 = function(oldSprites$1466,sprites$1469){var v$2649 = function(v$3607,v$3727,v$3728){var dx$2660 = (v$3727 + 0.5) - player$313[5][0];
var dy$2664 = (v$3728 + 0.5) - player$313[6][0];
var dist$2668 = Math.sqrt((dx$2660 * dx$2660) + (dy$2664 * dy$2664));
var spriteAngle$2669 = (Math.atan2(dy$2664,dx$2660)) - player$313[1][0];
var size$2673 = viewDist$334 / ((Math.cos(spriteAngle$2669)) * dist$2668);
if (size$2673 <= 0.0) {return 0;
} else {(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3607,"style"),"display","block");
var screen_x$2680 = ((Math.sin(spriteAngle$2669)) / (Math.cos(spriteAngle$2669))) * viewDist$334;
var left$2681 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(((screenWidthR$327 / 2.0) + screen_x$2680) - (size$2673 / 2.0));
var top$2682 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((screenHeightR$328 - size$2673) / 2.0);
var v$3288 = ((left$2681 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(left$2681))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(left$2681))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3607,"style"),"left",v$3288);
var v$3294 = ((top$2682 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(top$2682))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(top$2682))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3607,"style"),"top",v$3294);
var dbx$2685 = v$3727 - player$313[5][0];
var dby$2689 = v$3728 - player$313[6][0];
var sz$2693;
var t$3809;
var i$2740 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(size$2673);
t$3809 = ((i$2740 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$2740))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$2740)));
sz$2693 = (t$3809 + "px");
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3607,"style"),"width",sz$2693);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3607,"style"),"height",sz$2693);
var blockDist$2696 = (dbx$2685 * dbx$2685) + (dby$2689 * dby$2689);
var zIndex$2697 = SmlPrims.chk_ovf_i32(-(SmlPrims.chk_ovf_i32(Math.floor(blockDist$2696 * 1000.0))));
var v$3308 = (zIndex$2697 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(zIndex$2697))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(zIndex$2697));
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3607,"style"),"zIndex",v$3308);
return 0;
};
};
var fix$3810 = {};
fix$3810.$app = function(v$2700){lab$app: while (true) {if (v$2700 == null) {return 0;
} else {var v$2701 = v$2700;
var v$2702 = v$2701[0];
var v$2703 = v$2701[1];
var v$3730 = v$2702[3];
v$2649(v$2702[2],v$3730[0],v$3730[1]);
var t$3811 = v$2703;
var v$2700 = t$3811;
continue lab$app;
};
};
};
var app$2699 = fix$3810.$app;
app$2699(sprites$1469);
var fix$3812 = {};
fix$3812.$app = function(v$2768){lab$app: while (true) {if (v$2768 == null) {return 0;
} else {var v$2769 = v$2768;
var v$2770 = v$2769[0];
var v$2771 = v$2769[1];
(v$2770[4][0]?false:true)?((function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$2770[2],"style"),"display","none")):0;
var t$3813 = v$2771;
var v$2768 = t$3813;
continue lab$app;
};
};
};
var app$2767 = fix$3812.$app;
return app$2767(oldSprites$1466);
};
var score$1565 = [0];
var renderCycle$1566 = function(screenStrips$1569,spriteMap$1572){var renderCycleDelay$1573 = TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.div$1394([0,[[1000,null],false]],[0,[[30,null],false]]);
var fix$3814 = {};
fix$3814.$cycle = function(v$3608,v$3609){lab$cycle: while (true) {var miniMap$3500;
var v$3501 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimap");
switch (v$3501[0]) { case 0: {miniMap$3500 = v$3501[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimap' in DOM"];
} };
var miniMapObjects$3502;
var v$3503 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimapobjects");
switch (v$3503[0]) { case 0: {miniMapObjects$3502 = v$3503[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimapobjects' in DOM"];
} };
var height$3504 = (function(fp,s){return fp[s];})(miniMap$3500,"height");
var width$3505 = (function(fp,s){return fp[s];})(miniMap$3500,"width");
var c$3506 = (function(e,s){return e.getContext(s);})(miniMapObjects$3502,"2d");
(function(c,a1,a2,a3,a4){c.clearRect(a1,a2,a3,a4);})(c$3506,0,0,width$3505,height$3504);
(function(c,a1,a2,a3,a4){c.fillRect(a1,a2,a3,a4);})(c$3506,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$313[5][0] * miniMapScaleR$326) - 2.0),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$313[6][0] * miniMapScaleR$326) - 2.0),4,4);
(function(c){c.beginPath();})(c$3506);
(function(c,a1,a2){c.moveTo(a1,a2);})(c$3506,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(player$313[5][0] * miniMapScaleR$326),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(player$313[6][0] * miniMapScaleR$326));
(function(c,a1,a2){c.lineTo(a1,a2);})(c$3506,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$313[5][0] + (Math.cos(player$313[1][0]))) * miniMapScaleR$326),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$313[6][0] + (Math.sin(player$313[1][0]))) * miniMapScaleR$326));
(function(c){c.closePath();})(c$3506);
(function(c){c.stroke();})(c$3506);
var fix$3815 = {};
fix$3815.$app = function(v$2799){lab$app: while (true) {if (v$2799 == null) {return 0;
} else {var v$2800 = v$2799;
var v$2801 = v$2800[0];
var v$2802 = v$2800[1];
(v$2801[4][0] = false,0);
var t$3816 = v$2802;
var v$2799 = t$3816;
continue lab$app;
};
};
};
var app$2798 = fix$3815.$app;
app$2798(v$3609);
var sprites$1583;
var fix$3817 = {};
fix$3817.$loop = function(i$2808,acc$2809){lab$loop: while (true) {if (i$2808 >= numRays$332) {return acc$2809;
} else {var rayScreenPos$2810 = (((-(numRays$332)) / 2.0) + i$2808) * stripWidthR$330;
var rayViewDist$2812 = Math.sqrt((rayScreenPos$2810 * rayScreenPos$2810) + (viewDist$334 * viewDist$334));
var rayAngle$2813 = Math.asin(rayScreenPos$2810 / rayViewDist$2812);
var acc$2815 = ((castSingleRay$970(screenStrips$1569))(spriteMap$1572))([player$313[1][0] + rayAngle$2813,i$2808,acc$2809]);
var t$3818 = SmlPrims.chk_ovf_i32(i$2808 + 1);
var t$3819 = acc$2815;
var i$2808 = t$3818;
var acc$2809 = t$3819;
continue lab$loop;
};
};
};
var loop$2807 = fix$3817.$loop;
sprites$1583 = (loop$2807(0,null));
renderSprites$1463(v$3609,sprites$1583);
var n$1585;
var v$3565;
var v$3696 = SmlPrims.getrealtime();
v$3565 = (g14hFoVCUPM3ZC3WsORS6h$3basis$0Time$1.s$g$309(v$3696[0],v$3696[1],zero$1411[0],zero$1411[1]));
n$1585 = (g14hFoVCUPM3ZC3WsORS6h$3basis$0Time$1.toMilliseconds$97(v$3565[0],v$3565[1]));
var timeDelta$1586 = TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(v$3608,n$1585);
var cycleDelay$1587 = (TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$l$1462(timeDelta$1586,renderCycleDelay$1573))?(xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.max$2267([0,[[1,null],false]],TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(renderCycleDelay$1573,timeDelta$1586),renderCycleDelay$1573))):renderCycleDelay$1573;
var cycleDelay$1592 = xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.toInt$1823(cycleDelay$1587);
(function(i,f){return setTimeout(f,i);})(cycleDelay$1592,(function(env$3823){return function(v$3725){var v$3820 = env$3823[0];
var v$3821 = env$3823[1];
var v$3822 = env$3823[2];
return v$3822(v$3821,v$3820);
};
})([sprites$1583,n$1585,fix$3814.$cycle]));
var fps$1593 = 1000.0 / (xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.toInt$1823(timeDelta$1586));
updateOverlay$1455(fps$1593);
return updateScore$1459(score$1565[0]);
};
};
var cycle$1574 = fix$3814.$cycle;
return cycle$1574([0,[null,false]],null);
};
var init$1627 = function(){(function(f){document.onkeydown = function(e) { e = e || window.event; f(e.keyCode); };})(function(v$2856){switch (v$2856) { case 38: {return (player$313[4][0] = 1.0,0);
 break; }case 40: {return (player$313[4][0] = (-1.0),0);
 break; }case 37: {var rotAcc$2859 = player$313[2];
return (rotAcc$2859[0] > (-0.5))?(rotAcc$2859[0] = (rotAcc$2859[0] - 0.1),0):0;
 break; }case 39: {var rotAcc$2861 = player$313[2];
return (rotAcc$2861[0] < 0.5)?(rotAcc$2861[0] = (rotAcc$2861[0] + 0.1),0):0;
 break; }default: {return 0;
} };
});
(function(f){document.onkeyup = function(e) { e = e || window.event; f(e.keyCode); };})(function(v$2865){switch (v$2865) { case 38: {return (player$313[4][0] = 0.0,0);
 break; }case 40: {return (player$313[4][0] = 0.0,0);
 break; }case 37: {(player$313[3][0] = 0.0,0);
return (player$313[2][0] = 0.0,0);
 break; }case 39: {(player$313[3][0] = 0.0,0);
return (player$313[2][0] = 0.0,0);
 break; }default: {return 0;
} };
});
var v$2889 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"screen");
switch (v$2889[0]) { case 0: {v$2889[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'screen' in DOM"];
} };
var screenStrips$1631;
var xs$2872;
var fix$3824 = {};
fix$3824.$loop = function(i$2893){if (i$2893 >= 1000) {return null;
} else {var strip$2894 = document.createElement("img");
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(strip$2894,"style"),"position","absolute");
(function(fp,s,v){fp[s] = v;})(strip$2894,"src","walls.png");
var stripdata$2903;
var t$3826 = strip$2894;
var t$3825;
var v$2904 = [-1];
var v$2905 = [-1];
var v$2906 = [-1];
var v$2907 = [-1];
var v$2908 = [""];
var v$2909 = [-1];
t$3825 = [v$2908,v$2905,v$2906,["walls.png"],v$2907,v$2904,v$2909];
stripdata$2903 = [t$3826,t$3825];
var v$3509 = stripdata$2903[1];
var r$3511 = v$3509[1];
if (r$3511[0] == 0) {0;
} else {var v$3512 = (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(0)) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(strip$2894,"style"),"height",v$3512);
(r$3511[0] = 0,0);
};
var v$3516 = stripdata$2903[1];
var r$3518 = v$3516[2];
if (r$3518[0] == 0) {0;
} else {var v$3519 = (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(0)) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(strip$2894,"style"),"left",v$3519);
(r$3518[0] = 0,0);
};
var v$3523 = stripdata$2903[1];
var r$3525 = v$3523[4];
if (r$3525[0] == 0) {0;
} else {var v$3526 = (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(0)) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(strip$2894,"style"),"top",v$3526);
(r$3525[0] = 0,0);
};
var t$3827;
var v$2912 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"screen");
switch (v$2912[0]) { case 0: {t$3827 = v$2912[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'screen' in DOM"];
} };
(function(e,a){return e.appendChild(a);})(t$3827,strip$2894);
return [stripdata$2903,fix$3824.$loop(SmlPrims.chk_ovf_i32(i$2893 + 1))];
};
};
var loop$2892 = fix$3824.$loop;
xs$2872 = (loop$2892(0));
var fix$3828 = {};
fix$3828.$init = function(v$3612,v$3613,v$3614){lab$init: while (true) {if (v$3612 == null) {return v$3613;
} else {var v$2877 = v$3612;
var v$2878 = v$2877[0];
var v$2879 = v$2877[1];
(v$3613[v$3614] = v$2878,0);
var t$3829 = v$2879;
var t$3830 = v$3613;
var t$3831 = SmlPrims.chk_ovf_i32(v$3614 + 1);
var v$3612 = t$3829;
var v$3613 = t$3830;
var v$3614 = t$3831;
continue lab$init;
};
};
};
var init$2873 = fix$3828.$init;
var t$3837 = init$2873;
var t$3836 = xs$2872;
var t$3835;
var n$2881;
var fix$3832 = {};
fix$3832.$acc = function(v$2883,v$2884){lab$acc: while (true) {if (v$2883 == null) {return v$2884;
} else {var t$3833 = v$2883[1];
var t$3834 = SmlPrims.chk_ovf_i32(v$2884 + 1);
var v$2883 = t$3833;
var v$2884 = t$3834;
continue lab$acc;
};
};
};
var acc$2882 = fix$3832.$acc;
n$2881 = (acc$2882(xs$2872,0));
if ((0 <= n$2881)?(n$2881 <= 123456789):false) {0;
} else {throw CompilerInitial.exn$Size$51;
};
t$3835 = (Array(n$2881));
screenStrips$1631 = (t$3837(t$3836,t$3835,0));
var spriteMap$1632 = init$253(Y5y0a7l58ITwhpccCWLDEa$3basis$0Array2$1.foldi$383(0,function(v$3659){var v$3660 = v$3659[0];
var v$3661 = v$3659[1];
var v$3662 = v$3659[2];
var v$3663 = v$3659[3];
var v$3664 = ((v$3662 >= 100)?false:true)?[1]:((v$3662 == 100)?[0,0]:((v$3662 == 101)?[0,1]:((v$3662 == 102)?[0,2]:((v$3662 == 103)?[0,3]:((v$3662 == 105)?[0,4]:((v$3662 == 104)?[0,5]:[1]))))));
switch (v$3664[0]) { case 0: {return [[v$3664[1],v$3661,v$3660],v$3663];
 break; }default: {return v$3663;
} };
},null,Map$151,0,0,[1],[1]));
drawMiniMap$790();
gameCycle$1416(spriteMap$1632);
return renderCycle$1566(screenStrips$1631,spriteMap$1632);
};
(function(i,f){return setTimeout(f,i);})(1,function(v$3578){return init$1627();
});
return 0;
})();
