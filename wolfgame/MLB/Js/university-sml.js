if ((typeof(h5Gz8kAhgljIMpoVjaduMAf$3university$0university$1)) == "undefined") {h5Gz8kAhgljIMpoVjaduMAf$3university$0university$1 = {};
};
(function(){h5Gz8kAhgljIMpoVjaduMAf$3university$0university$1.eq_sprite$1719 = function(v$3786,v$3787){return v$3786 == v$3787;
};
h5Gz8kAhgljIMpoVjaduMAf$3university$0university$1.eq_obj$1723 = function(v$3788,v$3789){if (v$3788 == v$3789) {return true;
} else {switch (v$3788[0]) { case 8: {switch (v$3789[0]) { case 8: {return v$3788[1] == v$3789[1];
 break; }default: {return false;
} };
 break; }case 0: {switch (v$3789[0]) { case 0: {return true;
 break; }default: {return false;
} };
 break; }case 1: {switch (v$3789[0]) { case 1: {return true;
 break; }default: {return false;
} };
 break; }case 2: {switch (v$3789[0]) { case 2: {return true;
 break; }default: {return false;
} };
 break; }case 3: {switch (v$3789[0]) { case 3: {return true;
 break; }default: {return false;
} };
 break; }case 4: {switch (v$3789[0]) { case 4: {return true;
 break; }default: {return false;
} };
 break; }case 5: {switch (v$3789[0]) { case 5: {return true;
 break; }default: {return false;
} };
 break; }case 6: {switch (v$3789[0]) { case 6: {return true;
 break; }default: {return false;
} };
 break; }case 7: {switch (v$3789[0]) { case 7: {return true;
 break; }default: {return false;
} };
 break; }case 9: {switch (v$3789[0]) { case 9: {return true;
 break; }default: {return false;
} };
 break; }case 10: {switch (v$3789[0]) { case 10: {return true;
 break; }default: {return false;
} };
 break; }case 11: {switch (v$3789[0]) { case 11: {return true;
 break; }default: {return false;
} };
 break; }case 12: {switch (v$3789[0]) { case 12: {return true;
 break; }default: {return false;
} };
 break; }case 13: {switch (v$3789[0]) { case 13: {return true;
 break; }default: {return false;
} };
 break; }case 14: {switch (v$3789[0]) { case 14: {return true;
 break; }default: {return false;
} };
 break; } };
};
};
var screenWidth$56 = SmlPrims.div_i32(1600,2,CompilerInitial.exn$Div$45);
var screenHeight$57 = SmlPrims.div_i32(900,2,CompilerInitial.exn$Div$45);
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<html><head>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<title>Canvas example</title>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<link rel='shortcut icon' type='image/x-icon' href='favicon.ico' />\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<style>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("div#minimapcontainer { position : absolute; width : 100%; }\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161((("canvas#minimap { position : absolute; width : " + ((screenWidth$56 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(screenWidth$56))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(screenWidth$56)))) + "px; }") + "\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161((("canvas#minimapobjects { position : absolute; width : " + ((screenWidth$56 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(screenWidth$56))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(screenWidth$56)))) + "px; }") + "\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("div#floor { position : absolute; width : 100%; height : 100%; background-color : rgb(128,128,128); z-index : -10000000; }\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("div#ceiling { position : absolute; width : 100%; height : 50%; background-color : rgb(96,96,96); z-index : -10000000; }\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161((((("#screen { position : relative; width : " + ((screenWidth$56 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(screenWidth$56))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(screenWidth$56)))) + "px; height : ") + ((screenHeight$57 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(screenHeight$57))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(screenHeight$57)))) + "px; border : 1px solid black; overflow : hidden; }") + "\n");
var t$3952 = EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161;
var t$3951;
var t$3950;
var t$3949;
var t$3948;
var t$3947;
var t$3946 = "div#overlay { position : absolute; display : block; width : ";
var t$3945;
var i$1781 = SmlPrims.chk_ovf_i32(screenWidth$56 - 10);
t$3945 = ((i$1781 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$1781))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$1781)));
t$3947 = (t$3946 + t$3945);
t$3948 = (t$3947 + "px; height : ");
var t$3944;
var i$1783 = SmlPrims.chk_ovf_i32(screenHeight$57 - 10);
t$3944 = ((i$1783 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$1783))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$1783)));
t$3949 = (t$3948 + t$3944);
t$3950 = (t$3949 + "px; padding : 5px; color : white; font-family : lucida console, courier new; font-size : 20px; z-index : 1; }");
t$3951 = (t$3950 + "\n");
t$3952(t$3951);
var t$3960 = EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161;
var t$3959;
var t$3958;
var t$3957;
var t$3956;
var t$3955;
var t$3954 = "div#score { position : relative; display : block; width : ";
var t$3953;
var i$1791 = SmlPrims.chk_ovf_i32(screenWidth$56 - 10);
t$3953 = ((i$1791 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$1791))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$1791)));
t$3955 = (t$3954 + t$3953);
t$3956 = (t$3955 + "px; height : ");
t$3957 = (t$3956 + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(30)));
t$3958 = (t$3957 + "px; padding : 5px; color : blue; font-family : lucida console, courier new; font-size : 20px; z-index : 1; }");
t$3959 = (t$3958 + "\n");
t$3960(t$3959);
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("</style>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("</head><body><center>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<h2>The PLTC Hallway!</h2>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='screen'>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='floor'></div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='ceiling'></div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='overlay'></div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("</div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='score'> </div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='minimapcontainer'>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<canvas id='minimap'></canvas>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<canvas id='minimapobjects'></canvas>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("</div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='log'></div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("</center></body></html>\n");
var Smap$90 = ["*abc*abc*abc*abc*abc*abc*abc*abc*abc*abc*abcabcabc*",["*D DKD  *  D*D  *D  K  D*   *T P*   * T *  L   L  *",["*   K   O   H   *   H   *   *   *   * T NL  TTT   O",["*DL H L * L * L N L H L * L * L * L * L ML  TTT  A*",["*   *T  I   *   M   O   *   *   *   *   *A L   L  *",["* L * L * L * L *PLT* L * L * L * L * LT*         *",["*D  ** *H   ** *** **   *   ** *** **  T**I* *  AT*",["*       *               *               *    ******",["******* *KKK**    A***********     *******   * P***",["*TTTTT* ******T L  NTT *     *T L  *******P L  T***",["*       I*****T    M  P*     *T    *******T  * T***",["******* **MN**    P** **** ***     *O*MN**   ******",["*  L  L   L L  L  L  L  L  L  L  L  L  LA L  L  L O",["*  L  L   L L  L  L  L  L  L  L  L  L  L  L  L  LAI",["****I** **** **** *I* *** *** *I* *** *** *** *MN**",["******* S*   *     H L * L * L * L * L * L * L ****",["******* S* * * TTA H  T*   *   *  T*   *  T*   ****",["*       S*** * TT  H   *   *   K   *   *   *   ****",["* ** ** **U  * TTA K  T*   *T TH  T*   *   *   ****",["*SU*SU*SU*S T*PTTAPH  A* AT*   H  A* TA*   *   ****",["**********cba*cbaca*cba*cba*cba*cba*cba*cba*cba****",null]]]]]]]]]]]]]]]]]]]]];
var Map$180 = Y5y0a7l58ITwhpccCWLDEa$3basis$0Array2$1.fromList$58(dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.map$330(function(s$1849){var e$1857 = null;
var fix$3961 = {};
fix$3961.$rl = function(v$3790,v$3791){lab$rl: while (true) {if (v$3790 >= 0) {var t$3965 = SmlPrims.chk_ovf_i32(v$3790 - 1);
var t$3962;
var v$3177 = s$1849.charCodeAt(v$3790);
var t$3964;
var t$3963;
switch (v$3177) { case 32: {t$3963 = [9];
 break; }case 119: {t$3963 = [6];
 break; }case 61: {t$3963 = [5];
 break; }case 37: {t$3963 = [4];
 break; }case 77: {t$3963 = [13];
 break; }case 78: {t$3963 = [12];
 break; }case 97: {t$3963 = [1];
 break; }case 98: {t$3963 = [2];
 break; }case 99: {t$3963 = [0];
 break; }case 42: {t$3963 = [7];
 break; }case 72: {t$3963 = [10];
 break; }case 75: {t$3963 = [11];
 break; }case 79: {t$3963 = [3];
 break; }case 73: {t$3963 = [14];
 break; }case 84: {t$3963 = [8,1];
 break; }case 65: {t$3963 = [8,6];
 break; }case 80: {t$3963 = [8,3];
 break; }case 76: {t$3963 = [8,4];
 break; }case 68: {t$3963 = [8,5];
 break; }case 83: {t$3963 = [8,2];
 break; }case 85: {t$3963 = [8,0];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,("unknown character '" + (h8UYb53cympluUQFSuaSASi$3basis$0Char$1.toString$275(v$3177))) + "'"];
} };
t$3964 = [t$3963,v$3791];
t$3962 = t$3964;
var t$3966 = t$3965;
var t$3967 = t$3962;
var v$3790 = t$3966;
var v$3791 = t$3967;
continue lab$rl;
} else {return v$3791;
};
};
};
var rl$1859 = fix$3961.$rl;
return rl$1859(SmlPrims.chk_ovf_i32(s$1849.length - 1),e$1857);
},Smap$90));
var init$259 = function(items$262){var screen$263;
var v$1890 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"screen");
switch (v$1890[0]) { case 0: {screen$263 = v$1890[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'screen' in DOM"];
} };
Map$180[0][0];
var v$3745 = Map$180[0][1];
var v$3746 = Map$180[0][2];
if ((0 <= v$3745)?(v$3745 <= 123456789):false) {0;
} else {throw CompilerInitial.exn$Size$51;
};
var spriteMap$267;
var v$3189 = [1];
var t$3975;
var t$3968;
var t$1900 = Array(v$3745);
var fix$3969 = {};
fix$3969.$init = function(v$3794,v$3795){lab$init: while (true) {if (v$3795 >= v$3745) {return 0;
} else {var t$3972 = v$3794;
var t$3971 = v$3795;
var t$3970;
if ((0 <= v$3746)?(v$3746 <= 123456789):false) {0;
} else {throw CompilerInitial.exn$Size$51;
};
t$3970 = (SmlPrims.wordTableInit(v$3746,v$3189));
(t$3972[t$3971] = t$3970,0);
var t$3973 = v$3794;
var t$3974 = SmlPrims.chk_ovf_i32(v$3795 + 1);
var v$3794 = t$3973;
var v$3795 = t$3974;
continue lab$init;
};
};
};
var init$1901 = fix$3969.$init;
init$1901(t$1900,0);
t$3968 = t$1900;
t$3975 = [t$3968,v$3745,v$3746];
spriteMap$267 = [t$3975];
var fix$3976 = {};
fix$3976.$app = function(v$1919){lab$app: while (true) {if (v$1919 == null) {return 0;
} else {var v$1920 = v$1919;
var v$1921 = v$1920[0];
var v$1922 = v$1920[1];
var v$1956 = v$1921[0];
var v$1957 = v$1921[1];
var v$1958 = v$1921[2];
var s$1959;
var pos$1961 = [v$1957,v$1958];
var e$1962 = document.createElement("img");
var t$3979 = e$1962;
var t$3978 = "src";
var t$3977;
switch (v$1956) { case 1: {t$3977 = "tablechairs.png";
 break; }case 6: {t$3977 = (("professor" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32((SmlPrims.mod_i32(SmlPrims.chk_ovf_i32(pos$1961[0] + pos$1961[1]),4,CompilerInitial.exn$Div$45)) + 1)))) + ".gif");
 break; }case 3: {t$3977 = "plantgreen.png";
 break; }case 4: {t$3977 = "lamp.png";
 break; }case 2: {t$3977 = "sink.png";
 break; }case 5: {t$3977 = "desk.png";
 break; }default: {t$3977 = "toilet.png";
} };
(function(fp,s,v){fp[s] = v;})(t$3979,t$3978,t$3977);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(e$1962,"style"),"display","none");
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(e$1962,"style"),"position","absolute");
var v$1965;
switch (v$1956) { case 1: {v$1965 = true;
 break; }case 6: {v$1965 = true;
 break; }case 3: {v$1965 = true;
 break; }case 4: {v$1965 = false;
 break; }case 2: {v$1965 = false;
 break; }case 5: {v$1965 = true;
 break; }default: {v$1965 = true;
} };
var v$1966 = [false];
s$1959 = [v$1965,[true],e$1962,pos$1961,v$1966];
var v$3197 = [0,s$1959];
var v$1969 = spriteMap$267[0][0];
spriteMap$267[0][1];
spriteMap$267[0][2];
var v$1971 = v$1969.length;
if ((0 <= v$1958)?(v$1958 < v$1971):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$1974 = v$1969[v$1958];
var v$1975 = v$1974.length;
if ((0 <= v$1957)?(v$1957 < v$1975):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
(v$1974[v$1957] = v$3197,0);
(function(e,a){return e.appendChild(a);})(screen$263,s$1959[2]);
var t$3980 = v$1922;
var v$1919 = t$3980;
continue lab$app;
};
};
};
var app$1918 = fix$3976.$app;
app$1918(items$262);
return spriteMap$267;
};
var MaxRotSpeed$318 = (3.0 * 3.14159265358979323846) / 360.0;
var player$319;
var v$320 = [16.0];
var v$321 = [10.0];
var v$322 = [0.0];
var v$323 = [0.0];
var v$324 = [0.0];
player$319 = [0.10,v$322,[0.0],v$324,v$323,v$320,v$321];
Map$180[0][0];
Map$180[0][1];
var mapWidth$327 = Map$180[0][2];
var mapWidthR$328 = mapWidth$327;
Map$180[0][0];
var mapHeight$329;
var v$1985 = Map$180[0][1];
Map$180[0][2];
mapHeight$329 = v$1985;
var mapHeightR$330 = mapHeight$329;
var miniMapScaleR$332 = 8;
var screenWidthR$333 = screenWidth$56;
var screenHeightR$334 = screenHeight$57;
var stripWidthR$336 = 1;
var fov$337 = (60.0 * 3.14159265358979323846) / 180.0;
var numRays$338 = SmlPrims.chk_ovf_i32(Math.ceil(screenWidthR$333 / stripWidthR$336));
var fovHalf$339 = fov$337 / 2.0;
var viewDist$340 = (screenWidthR$333 / 2.0) / ((Math.sin(fovHalf$339)) / (Math.cos(fovHalf$339)));
var twoPI$341 = 3.14159265358979323846 * 2.0;
var checkCollision$504 = function(spriteMap$507,v$3798,v$3799,v$3800,v$3801,v$3802){if ((v$3801 < 0.0)?true:((v$3801 >= mapHeightR$330)?true:((v$3800 < 0.0)?true:(v$3800 >= mapWidthR$328)))) {return [v$3798,v$3799];
} else {var blockX$519 = SmlPrims.chk_ovf_i32(Math.floor(v$3800));
var blockY$520 = SmlPrims.chk_ovf_i32(Math.floor(v$3801));
var t$3981;
if ((blockY$520 < 0.0)?true:((blockY$520 >= mapHeightR$330)?true:((blockX$519 < 0.0)?true:(blockX$519 >= mapWidthR$328)))) {t$3981 = true;
} else {var Y$3565 = SmlPrims.chk_ovf_i32(Math.floor(blockY$520));
var X$3566 = SmlPrims.chk_ovf_i32(Math.floor(blockX$519));
var wt$3567;
var v$3568 = Map$180[0][0];
Map$180[0][1];
Map$180[0][2];
var v$3569 = v$3568.length;
if ((0 <= Y$3565)?(Y$3565 < v$3569):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3570 = v$3568[Y$3565];
var v$3571 = v$3570.length;
if ((0 <= X$3566)?(X$3566 < v$3571):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$3567 = v$3570[X$3566];
var t$3982;
switch (wt$3567[0]) { case 9: {t$3982 = false;
 break; }case 8: {t$3982 = false;
 break; }default: {t$3982 = true;
} };
if (t$3982) {t$3981 = true;
} else {var v$3572;
var v$3573 = spriteMap$507[0][0];
spriteMap$507[0][1];
spriteMap$507[0][2];
var v$3574 = v$3573.length;
if ((0 <= Y$3565)?(Y$3565 < v$3574):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3575 = v$3573[Y$3565];
var v$3576 = v$3575.length;
if ((0 <= X$3566)?(X$3566 < v$3576):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$3572 = v$3575[X$3566];
switch (v$3572[0]) { case 0: {t$3981 = v$3572[1][0];
 break; }default: {t$3981 = false;
} };
};
};
if (t$3981) {return [v$3798,v$3799];
} else {var blockTop$526;
var v$3738 = blockY$520 - 1.0;
if ((v$3738 < 0.0)?true:((v$3738 >= mapHeightR$330)?true:((blockX$519 < 0.0)?true:(blockX$519 >= mapWidthR$328)))) {blockTop$526 = true;
} else {var Y$3580 = SmlPrims.chk_ovf_i32(Math.floor(v$3738));
var X$3581 = SmlPrims.chk_ovf_i32(Math.floor(blockX$519));
var wt$3582;
var v$3583 = Map$180[0][0];
Map$180[0][1];
Map$180[0][2];
var v$3584 = v$3583.length;
if ((0 <= Y$3580)?(Y$3580 < v$3584):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3585 = v$3583[Y$3580];
var v$3586 = v$3585.length;
if ((0 <= X$3581)?(X$3581 < v$3586):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$3582 = v$3585[X$3581];
var t$3983;
switch (wt$3582[0]) { case 9: {t$3983 = false;
 break; }case 8: {t$3983 = false;
 break; }default: {t$3983 = true;
} };
if (t$3983) {blockTop$526 = true;
} else {var v$3587;
var v$3588 = spriteMap$507[0][0];
spriteMap$507[0][1];
spriteMap$507[0][2];
var v$3589 = v$3588.length;
if ((0 <= Y$3580)?(Y$3580 < v$3589):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3590 = v$3588[Y$3580];
var v$3591 = v$3590.length;
if ((0 <= X$3581)?(X$3581 < v$3591):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$3587 = v$3590[X$3581];
switch (v$3587[0]) { case 0: {blockTop$526 = v$3587[1][0];
 break; }default: {blockTop$526 = false;
} };
};
};
var blockBottom$527;
var v$3740 = blockY$520 + 1.0;
if ((v$3740 < 0.0)?true:((v$3740 >= mapHeightR$330)?true:((blockX$519 < 0.0)?true:(blockX$519 >= mapWidthR$328)))) {blockBottom$527 = true;
} else {var Y$3595 = SmlPrims.chk_ovf_i32(Math.floor(v$3740));
var X$3596 = SmlPrims.chk_ovf_i32(Math.floor(blockX$519));
var wt$3597;
var v$3598 = Map$180[0][0];
Map$180[0][1];
Map$180[0][2];
var v$3599 = v$3598.length;
if ((0 <= Y$3595)?(Y$3595 < v$3599):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3600 = v$3598[Y$3595];
var v$3601 = v$3600.length;
if ((0 <= X$3596)?(X$3596 < v$3601):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$3597 = v$3600[X$3596];
var t$3984;
switch (wt$3597[0]) { case 9: {t$3984 = false;
 break; }case 8: {t$3984 = false;
 break; }default: {t$3984 = true;
} };
if (t$3984) {blockBottom$527 = true;
} else {var v$3602;
var v$3603 = spriteMap$507[0][0];
spriteMap$507[0][1];
spriteMap$507[0][2];
var v$3604 = v$3603.length;
if ((0 <= Y$3595)?(Y$3595 < v$3604):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3605 = v$3603[Y$3595];
var v$3606 = v$3605.length;
if ((0 <= X$3596)?(X$3596 < v$3606):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$3602 = v$3605[X$3596];
switch (v$3602[0]) { case 0: {blockBottom$527 = v$3602[1][0];
 break; }default: {blockBottom$527 = false;
} };
};
};
var blockLeft$528;
var v$3741 = blockX$519 - 1.0;
if ((blockY$520 < 0.0)?true:((blockY$520 >= mapHeightR$330)?true:((v$3741 < 0.0)?true:(v$3741 >= mapWidthR$328)))) {blockLeft$528 = true;
} else {var Y$3610 = SmlPrims.chk_ovf_i32(Math.floor(blockY$520));
var X$3611 = SmlPrims.chk_ovf_i32(Math.floor(v$3741));
var wt$3612;
var v$3613 = Map$180[0][0];
Map$180[0][1];
Map$180[0][2];
var v$3614 = v$3613.length;
if ((0 <= Y$3610)?(Y$3610 < v$3614):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3615 = v$3613[Y$3610];
var v$3616 = v$3615.length;
if ((0 <= X$3611)?(X$3611 < v$3616):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$3612 = v$3615[X$3611];
var t$3985;
switch (wt$3612[0]) { case 9: {t$3985 = false;
 break; }case 8: {t$3985 = false;
 break; }default: {t$3985 = true;
} };
if (t$3985) {blockLeft$528 = true;
} else {var v$3617;
var v$3618 = spriteMap$507[0][0];
spriteMap$507[0][1];
spriteMap$507[0][2];
var v$3619 = v$3618.length;
if ((0 <= Y$3610)?(Y$3610 < v$3619):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3620 = v$3618[Y$3610];
var v$3621 = v$3620.length;
if ((0 <= X$3611)?(X$3611 < v$3621):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$3617 = v$3620[X$3611];
switch (v$3617[0]) { case 0: {blockLeft$528 = v$3617[1][0];
 break; }default: {blockLeft$528 = false;
} };
};
};
var blockRight$529;
var v$3743 = blockX$519 + 1.0;
if ((blockY$520 < 0.0)?true:((blockY$520 >= mapHeightR$330)?true:((v$3743 < 0.0)?true:(v$3743 >= mapWidthR$328)))) {blockRight$529 = true;
} else {var Y$3625 = SmlPrims.chk_ovf_i32(Math.floor(blockY$520));
var X$3626 = SmlPrims.chk_ovf_i32(Math.floor(v$3743));
var wt$3627;
var v$3628 = Map$180[0][0];
Map$180[0][1];
Map$180[0][2];
var v$3629 = v$3628.length;
if ((0 <= Y$3625)?(Y$3625 < v$3629):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3630 = v$3628[Y$3625];
var v$3631 = v$3630.length;
if ((0 <= X$3626)?(X$3626 < v$3631):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$3627 = v$3630[X$3626];
var t$3986;
switch (wt$3627[0]) { case 9: {t$3986 = false;
 break; }case 8: {t$3986 = false;
 break; }default: {t$3986 = true;
} };
if (t$3986) {blockRight$529 = true;
} else {var v$3632;
var v$3633 = spriteMap$507[0][0];
spriteMap$507[0][1];
spriteMap$507[0][2];
var v$3634 = v$3633.length;
if ((0 <= Y$3625)?(Y$3625 < v$3634):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3635 = v$3633[Y$3625];
var v$3636 = v$3635.length;
if ((0 <= X$3626)?(X$3626 < v$3636):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$3632 = v$3635[X$3626];
switch (v$3632[0]) { case 0: {blockRight$529 = v$3632[1][0];
 break; }default: {blockRight$529 = false;
} };
};
};
var toY$530 = (blockTop$526?((v$3801 - blockY$520) < v$3802):false)?(blockY$520 + v$3802):((blockBottom$527?(((blockY$520 + 1.0) - v$3801) < v$3802):false)?((blockY$520 + 1.0) - v$3802):v$3801);
return [(blockLeft$528?((v$3800 - blockX$519) < v$3802):false)?(blockX$519 + v$3802):((blockRight$529?(((blockX$519 + 1.0) - v$3800) < v$3802):false)?((blockX$519 + 1.0) - v$3802):v$3800),toY$530];
};
};
};
var drawMiniMap$798 = function(){var miniMap$805;
var v$2186 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimap");
switch (v$2186[0]) { case 0: {miniMap$805 = v$2186[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimap' in DOM"];
} };
var miniMapCtr$806;
var v$2192 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimapcontainer");
switch (v$2192[0]) { case 0: {miniMapCtr$806 = v$2192[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimapcontainer' in DOM"];
} };
var miniMapObjects$807;
var v$2198 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimapobjects");
switch (v$2198[0]) { case 0: {miniMapObjects$807 = v$2198[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimapobjects' in DOM"];
} };
var w$808 = SmlPrims.chk_ovf_i32(mapWidth$327 * 8);
var h$809 = SmlPrims.chk_ovf_i32(mapHeight$329 * 8);
(function(fp,s,v){fp[s] = v;})(miniMap$805,"width",w$808);
(function(fp,s,v){fp[s] = v;})(miniMap$805,"height",h$809);
(function(fp,s,v){fp[s] = v;})(miniMapObjects$807,"width",w$808);
(function(fp,s,v){fp[s] = v;})(miniMapObjects$807,"height",h$809);
(function(fp,s,v){fp[s] = v;})(miniMapCtr$806,"width",w$808);
(function(fp,s,v){fp[s] = v;})(miniMapCtr$806,"height",h$809);
var w_s$816 = ((w$808 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(w$808))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(w$808))) + "px";
var h_s$817 = ((h$809 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(h$809))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(h$809))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMap$805,"style"),"width",w_s$816);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMapObjects$807,"style"),"width",w_s$816);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMapCtr$806,"style"),"width",w_s$816);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMap$805,"style"),"height",h_s$817);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMapObjects$807,"style"),"height",h_s$817);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMapCtr$806,"style"),"height",h_s$817);
var c$824 = (function(e,s){return e.getContext(s);})(miniMap$805,"2d");
var entireMap$825 = function(v$3943){return [Map$180,0,[1],[1],0];
};
Y5y0a7l58ITwhpccCWLDEa$3basis$0Array2$1.appi$512(0,function(v$3864){var v$3865 = v$3864[0];
var v$3866 = v$3864[1];
var v$3867 = v$3864[2];
var t$3987;
switch (v$3867[0]) { case 9: {t$3987 = false;
 break; }case 8: {t$3987 = false;
 break; }default: {t$3987 = true;
} };
if (t$3987) {(function(c,s){c.fillStyle = s;})(c$824,"rgb(200,200,200)");
return (function(c,a1,a2,a3,a4){c.fillRect(a1,a2,a3,a4);})(c$824,SmlPrims.chk_ovf_i32(v$3866 * 8),SmlPrims.chk_ovf_i32(v$3865 * 8),8,8);
} else {return 0;
};
},(entireMap$825(0))[0],(entireMap$825(0))[4],(entireMap$825(0))[1],(entireMap$825(0))[3],(entireMap$825(0))[2]);
var miniMap$3638;
var v$3639 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimap");
switch (v$3639[0]) { case 0: {miniMap$3638 = v$3639[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimap' in DOM"];
} };
var miniMapObjects$3640;
var v$3641 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimapobjects");
switch (v$3641[0]) { case 0: {miniMapObjects$3640 = v$3641[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimapobjects' in DOM"];
} };
var height$3642 = (function(fp,s){return fp[s];})(miniMap$3638,"height");
var width$3643 = (function(fp,s){return fp[s];})(miniMap$3638,"width");
var c$3644 = (function(e,s){return e.getContext(s);})(miniMapObjects$3640,"2d");
(function(c,a1,a2,a3,a4){c.clearRect(a1,a2,a3,a4);})(c$3644,0,0,width$3643,height$3642);
(function(c,a1,a2,a3,a4){c.fillRect(a1,a2,a3,a4);})(c$3644,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$319[5][0] * miniMapScaleR$332) - 2.0),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$319[6][0] * miniMapScaleR$332) - 2.0),4,4);
(function(c){c.beginPath();})(c$3644);
(function(c,a1,a2){c.moveTo(a1,a2);})(c$3644,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(player$319[5][0] * miniMapScaleR$332),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(player$319[6][0] * miniMapScaleR$332));
(function(c,a1,a2){c.lineTo(a1,a2);})(c$3644,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$319[5][0] + (Math.cos(player$319[1][0]))) * miniMapScaleR$332),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$319[6][0] + (Math.sin(player$319[1][0]))) * miniMapScaleR$332));
(function(c){c.closePath();})(c$3644);
return (function(c){c.stroke();})(c$3644);
};
var castSingleRay$978;
var fix$3988 = {};
fix$3988.$RealMod = function(v$3803,v$3804){lab$RealMod: while (true) {if (v$3803 < v$3804) {return v$3803;
} else {var t$3989 = v$3803 - v$3804;
var t$3990 = v$3804;
var v$3803 = t$3989;
var v$3804 = t$3990;
continue lab$RealMod;
};
};
};
var RealMod$860 = fix$3988.$RealMod;
castSingleRay$978 = (function(screenStrips$981){return function(spriteMap$984){return function(v$989){var v$1437 = v$989[0];
var v$1438 = v$989[1];
var v$1439 = v$989[2];
var rayAngle$990 = RealMod$860(v$1437,twoPI$341);
var rayAngle$991 = (rayAngle$990 < 0.0)?(rayAngle$990 + twoPI$341):rayAngle$990;
var right$996 = (rayAngle$991 > (twoPI$341 * 0.75))?true:(rayAngle$991 < (twoPI$341 * 0.25));
var up$1001 = (rayAngle$991 < 0.0)?true:(rayAngle$991 > 3.14159265358979323846);
var angleSin$1006 = Math.sin(rayAngle$991);
var angleCos$1007 = Math.cos(rayAngle$991);
var slope$1008 = angleSin$1006 / angleCos$1007;
var dXVer$1009 = right$996?1.0:(-1.0);
var dYVer$1014 = dXVer$1009 * slope$1008;
var x$1015 = right$996?(SmlPrims.chk_ovf_i32(Math.ceil(player$319[5][0]))):(SmlPrims.chk_ovf_i32(Math.floor(player$319[5][0])));
var x$1028 = x$1015;
var y$1029 = player$319[6][0] + ((x$1028 - player$319[5][0]) * slope$1008);
var emptyHit$1038 = [0.0,false,0.0,[9],0.0,0,0.0,0];
var v$1434;
var fix$3991 = {};
fix$3991.$loopV = function(v$3807,v$3808,visibleSprites$1054){lab$loopV: while (true) {if ((v$3807 < 0.0)?true:((v$3807 >= mapWidthR$328)?true:((v$3808 < 0.0)?true:(v$3808 >= mapHeightR$330)))) {return [emptyHit$1038,visibleSprites$1054];
} else {var wallX$1059 = SmlPrims.chk_ovf_i32(Math.floor(right$996?v$3807:(v$3807 - 1.0)));
var wallY$1064 = SmlPrims.chk_ovf_i32(Math.floor(v$3808));
var wt$1065;
var v$2417 = Map$180[0][0];
Map$180[0][1];
Map$180[0][2];
var v$2419 = v$2417.length;
if ((0 <= wallY$1064)?(wallY$1064 < v$2419):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$2421 = v$2417[wallY$1064];
var v$2422 = v$2421.length;
if ((0 <= wallX$1059)?(wallX$1059 < v$2422):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$1065 = v$2421[wallX$1059];
var t$3992;
switch (wt$1065[0]) { case 9: {t$3992 = false;
 break; }case 8: {t$3992 = false;
 break; }default: {t$3992 = true;
} };
if (t$3992) {var distX$1070 = v$3807 - player$319[5][0];
var distY$1075 = v$3808 - player$319[6][0];
var dist$1080 = (distX$1070 * distX$1070) + (distY$1075 * distY$1075);
var textureX$1081 = v$3808 - (SmlPrims.chk_ovf_i32(Math.floor(v$3808)));
var textureX$1082 = (right$996?false:true)?(1.0 - textureX$1081):textureX$1081;
return [[dist$1080,(rayAngle$991 < (3.14159265358979323846 / 2.0))?true:(rayAngle$991 > ((3.0 * 3.14159265358979323846) / 2.0)),textureX$1082,wt$1065,v$3807,wallX$1059,v$3808,wallY$1064],visibleSprites$1054];
} else {var t$3995 = v$3807 + dXVer$1009;
var t$3994 = v$3808 + dYVer$1014;
var t$3993;
var v$1104;
var v$2433 = spriteMap$984[0][0];
spriteMap$984[0][1];
spriteMap$984[0][2];
var v$2435 = v$2433.length;
if ((0 <= wallY$1064)?(wallY$1064 < v$2435):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$2437 = v$2433[wallY$1064];
var v$2438 = v$2437.length;
if ((0 <= wallX$1059)?(wallX$1059 < v$2438):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$1104 = v$2437[wallX$1059];
switch (v$1104[0]) { case 1: {t$3993 = visibleSprites$1054;
 break; }default: {var v$1119 = v$1104[1];
if (v$1119[4][0]) {t$3993 = visibleSprites$1054;
} else {(v$1119[4][0] = true,0);
t$3993 = [v$1119,visibleSprites$1054];
};
} };
var t$3996 = t$3995;
var t$3997 = t$3994;
var t$3998 = t$3993;
var v$3807 = t$3996;
var v$3808 = t$3997;
var visibleSprites$1054 = t$3998;
continue lab$loopV;
};
};
};
};
var loopV$1047 = fix$3991.$loopV;
v$1434 = (loopV$1047(x$1028,y$1029,v$1439));
var v$1435 = v$1434[0];
var v$1436 = v$1434[1];
var slope$1137 = angleCos$1007 / angleSin$1006;
var dYHor$1138 = up$1001?(-1.0):1.0;
var dXHor$1143 = dYHor$1138 * slope$1137;
var y$1144 = up$1001?(SmlPrims.chk_ovf_i32(Math.floor(player$319[6][0]))):(SmlPrims.chk_ovf_i32(Math.ceil(player$319[6][0])));
var x$1157 = player$319[5][0] + ((y$1144 - player$319[6][0]) * slope$1137);
var v$1423;
var fix$3999 = {};
fix$3999.$loopH = function(v$3811,v$3812,visibleSprites$1173){lab$loopH: while (true) {if ((v$3811 < 0.0)?true:((v$3811 >= mapWidthR$328)?true:((v$3812 < 0.0)?true:((v$3812 >= mapHeightR$330)?true:((slope$1137 > 10000.0)?true:(up$1001?((v$3812 - 1.0) < 0.0):false)))))) {return [v$1435,visibleSprites$1173];
} else {var wallY$1178 = SmlPrims.chk_ovf_i32(Math.floor(up$1001?(v$3812 - 1.0):v$3812));
var wallX$1183 = SmlPrims.chk_ovf_i32(Math.floor(v$3811));
var wt$1184;
try {var v$2453 = Map$180[0][0];
Map$180[0][1];
Map$180[0][2];
var v$2455 = v$2453.length;
if ((0 <= wallY$1178)?(wallY$1178 < v$2455):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$2457 = v$2453[wallY$1178];
var v$2458 = v$2457.length;
if ((0 <= wallX$1183)?(wallX$1183 < v$2458):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$1184 = v$2457[wallX$1183];
} catch(v$4000) {wt$1184 = (((function(env$4005){return function(s$m$1187){var v$4001 = env$4005[0];
var v$4002 = env$4005[1];
var v$4003 = env$4005[2];
var v$4004 = env$4005[3];
var s$2459 = (("wallX = " + ((v$4004 < 0)?("-" + (v$4003(SmlPrims.chk_ovf_i32(-(v$4004))))):(v$4003(v$4004)))) + "; wallY = ") + ((v$4002 < 0)?("-" + (v$4003(SmlPrims.chk_ovf_i32(-(v$4002))))):(v$4003(v$4002)));
var log$2460;
var v$2462 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(v$4001,"log");
switch (v$2462[0]) { case 0: {log$2460 = v$2462[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'log' in DOM"];
} };
(function(e,a){return e.appendChild(a);})(log$2460,document.createTextNode(s$2459));
(function(e,a){return e.appendChild(a);})(log$2460,document.createElement("br"));
throw s$m$1187;
};
})([z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,wallY$1178,abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456,wallX$1183]))(v$4000));
};
var t$4006;
switch (wt$1184[0]) { case 9: {t$4006 = false;
 break; }case 8: {t$4006 = false;
 break; }default: {t$4006 = true;
} };
if (t$4006) {var distX$1194 = v$3811 - player$319[5][0];
var distY$1199 = v$3812 - player$319[6][0];
var blockDist$1204 = (distX$1194 * distX$1194) + (distY$1199 * distY$1199);
if (((v$1435[0] > 0.0)?false:true)?true:(blockDist$1204 < v$1435[0])) {var textureX$1209 = v$3811 - (SmlPrims.chk_ovf_i32(Math.floor(v$3811)));
return [[blockDist$1204,rayAngle$991 < 3.14159265358979323846,1.0 - (up$1001?(1.0 - textureX$1209):textureX$1209),wt$1184,v$3811,wallX$1183,v$3812,wallY$1178],visibleSprites$1173];
} else {return [v$1435,visibleSprites$1173];
};
} else {var t$4009 = v$3811 + dXHor$1143;
var t$4008 = v$3812 + dYHor$1138;
var t$4007;
var v$1241;
var v$2484 = spriteMap$984[0][0];
spriteMap$984[0][1];
spriteMap$984[0][2];
var v$2486 = v$2484.length;
if ((0 <= wallY$1178)?(wallY$1178 < v$2486):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$2488 = v$2484[wallY$1178];
var v$2489 = v$2488.length;
if ((0 <= wallX$1183)?(wallX$1183 < v$2489):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$1241 = v$2488[wallX$1183];
switch (v$1241[0]) { case 1: {t$4007 = visibleSprites$1173;
 break; }default: {var v$1256 = v$1241[1];
if (v$1256[4][0]) {t$4007 = visibleSprites$1173;
} else {(v$1256[4][0] = true,0);
t$4007 = [v$1256,visibleSprites$1173];
};
} };
var t$4010 = t$4009;
var t$4011 = t$4008;
var t$4012 = t$4007;
var v$3811 = t$4010;
var v$3812 = t$4011;
var visibleSprites$1173 = t$4012;
continue lab$loopH;
};
};
};
};
var loopH$1166 = fix$3999.$loopH;
v$1423 = (loopH$1166(x$1157,y$1144,v$1436));
var v$1424 = v$1423[0];
var v$1425 = v$1424[0];
var v$1428 = v$1424[5];
var v$1429 = v$1424[7];
var v$1430 = v$1424[3];
var v$1431 = v$1424[2];
var v$1432 = v$1424[1];
var v$1433 = v$1423[1];
if (v$1425 <= 0.0) {return v$1433;
} else {var dist$1297 = Math.sqrt(v$1425);
var dist$1298 = dist$1297 * (Math.cos(player$319[1][0] - rayAngle$991));
var height$1303 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(viewDist$340 / dist$1298);
var width$1304 = SmlPrims.chk_ovf_i32(height$1303 * 1);
var widthR$1305 = width$1304;
var heightR$1306 = height$1303;
var top$1307 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((screenHeightR$334 - heightR$1306) / 2.0);
var texX$1308 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(v$1431 * widthR$1305);
var texX$1309 = (texX$1308 > (SmlPrims.chk_ovf_i32(width$1304 - 1)))?(SmlPrims.chk_ovf_i32(width$1304 - 1)):texX$1308;
var v$2502 = screenStrips$981.length;
if ((0 <= v$1438)?(v$1438 < v$2502):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var stripdata$1314 = screenStrips$981[v$1438];
var wallType$1315;
if (v$1432) {switch (v$1430[0]) { case 13: {wallType$1315 = [12];
 break; }case 12: {wallType$1315 = [13];
 break; }default: {wallType$1315 = v$1430;
} };
} else {wallType$1315 = v$1430;
};
var v$1364;
switch (wallType$1315[0]) { case 13: {var v$2504 = stripdata$1314[0];
var v$2505 = stripdata$1314[1];
var r$2507 = v$2505[3];
if (r$2507[0] == "datoek-000.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2504,"src","datoek-000.png");
(r$2507[0] = "datoek-000.png",0);
};
v$1364 = [1,0,texX$1309,2.0];
 break; }case 12: {var v$2517 = stripdata$1314[0];
var v$2518 = stripdata$1314[1];
var r$2520 = v$2518[3];
if (r$2520[0] == "datoek-000.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2517,"src","datoek-000.png");
(r$2520[0] = "datoek-000.png",0);
};
v$1364 = [1,0,SmlPrims.chk_ovf_i32(texX$1309 + width$1304),2.0];
 break; }case 1: {var v$2530 = stripdata$1314[0];
var v$2531 = stripdata$1314[1];
var r$2533 = v$2531[3];
if (r$2533[0] == "window-left.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2530,"src","window-left.png");
(r$2533[0] = "window-left.png",0);
};
v$1364 = [1,0,texX$1309,1.0];
 break; }case 2: {var v$2543 = stripdata$1314[0];
var v$2544 = stripdata$1314[1];
var r$2546 = v$2544[3];
if (r$2546[0] == "window-center.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2543,"src","window-center.png");
(r$2546[0] = "window-center.png",0);
};
v$1364 = [1,0,texX$1309,1.0];
 break; }case 0: {var v$2556 = stripdata$1314[0];
var v$2557 = stripdata$1314[1];
var r$2559 = v$2557[3];
if (r$2559[0] == "window-right.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2556,"src","window-right.png");
(r$2559[0] = "window-right.png",0);
};
v$1364 = [1,0,texX$1309,1.0];
 break; }case 7: {var v$2569 = stripdata$1314[0];
var v$2570 = stripdata$1314[1];
var r$2572 = v$2570[3];
if (r$2572[0] == "wall-white.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2569,"src","wall-white.png");
(r$2572[0] = "wall-white.png",0);
};
v$1364 = [1,0,texX$1309,1.0];
 break; }case 10: {var v$2582 = stripdata$1314[0];
var v$2583 = stripdata$1314[1];
var r$2585 = v$2583[3];
if (r$2585[0] == "wall-shelf1.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2582,"src","wall-shelf1.png");
(r$2585[0] = "wall-shelf1.png",0);
};
v$1364 = [1,0,texX$1309,1.0];
 break; }case 11: {var v$2595 = stripdata$1314[0];
var v$2596 = stripdata$1314[1];
var r$2598 = v$2596[3];
if (r$2598[0] == "wall-shelf2.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2595,"src","wall-shelf2.png");
(r$2598[0] = "wall-shelf2.png",0);
};
v$1364 = [1,0,texX$1309,1.0];
 break; }case 3: {var v$2608 = stripdata$1314[0];
var v$2609 = stripdata$1314[1];
var r$2611 = v$2609[3];
if (r$2611[0] == "wall-board.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2608,"src","wall-board.png");
(r$2611[0] = "wall-board.png",0);
};
v$1364 = [1,0,texX$1309,1.0];
 break; }case 14: {var v$2621 = stripdata$1314[0];
var v$2622 = stripdata$1314[1];
var r$2624 = v$2622[3];
if (r$2624[0] == "wall-bulletin.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2621,"src","wall-bulletin.png");
(r$2624[0] = "wall-bulletin.png",0);
};
v$1364 = [1,0,texX$1309,1.0];
 break; }case 6: {var v$2634 = stripdata$1314[0];
var v$2635 = stripdata$1314[1];
var r$2637 = v$2635[3];
if (r$2637[0] == "walls.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2634,"src","walls.png");
(r$2637[0] = "walls.png",0);
};
v$1364 = [4,0,texX$1309,2.0];
 break; }case 5: {var v$2647 = stripdata$1314[0];
var v$2648 = stripdata$1314[1];
var r$2650 = v$2648[3];
if (r$2650[0] == "walls.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2647,"src","walls.png");
(r$2650[0] = "walls.png",0);
};
v$1364 = [4,1,texX$1309,2.0];
 break; }case 4: {var v$2660 = stripdata$1314[0];
var v$2661 = stripdata$1314[1];
var r$2663 = v$2661[3];
if (r$2663[0] == "walls.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2660,"src","walls.png");
(r$2663[0] = "walls.png",0);
};
v$1364 = [4,2,texX$1309,2.0];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"obj not supported"];
} };
var v$1365 = v$1364[0];
var v$1366 = v$1364[1];
var v$1367 = v$1364[2];
var v$1368 = v$1364[3];
var v$3656 = stripdata$1314[0];
var v$3657 = stripdata$1314[1];
var r$3659 = v$3657[1];
if (r$3659[0] == height$1303) {0;
} else {var v$3660 = ((height$1303 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(height$1303))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(height$1303))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3656,"style"),"height",v$3660);
(r$3659[0] = height$1303,0);
};
var v$3663 = stripdata$1314[0];
var v$3664 = stripdata$1314[1];
var r$3666 = v$3664[4];
if (r$3666[0] == top$1307) {0;
} else {var v$3667 = ((top$1307 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(top$1307))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(top$1307))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3663,"style"),"top",v$3667);
(r$3666[0] = top$1307,0);
};
var imgTop$1333 = SmlPrims.chk_ovf_i32(Math.floor(heightR$1306 * v$1366));
var styleHeight$1334 = SmlPrims.chk_ovf_i32(Math.floor(heightR$1306 * v$1365));
var v$3670 = stripdata$1314[0];
var v$3671 = stripdata$1314[1];
var r$3673 = v$3671[1];
if (r$3673[0] == styleHeight$1334) {0;
} else {var v$3674 = ((styleHeight$1334 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(styleHeight$1334))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(styleHeight$1334))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3670,"style"),"height",v$3674);
(r$3673[0] = styleHeight$1334,0);
};
var styleWidth$1336 = SmlPrims.chk_ovf_i32(Math.floor(widthR$1305 * v$1368));
var v$3677 = stripdata$1314[0];
var v$3678 = stripdata$1314[1];
var r$3680 = v$3678[5];
if (r$3680[0] == styleWidth$1336) {0;
} else {var v$3681 = ((styleWidth$1336 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(styleWidth$1336))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(styleWidth$1336))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3677,"style"),"width",v$3681);
(r$3680[0] = styleWidth$1336,0);
};
var styleTop$1338 = SmlPrims.chk_ovf_i32(top$1307 - imgTop$1333);
var v$3684 = stripdata$1314[0];
var v$3685 = stripdata$1314[1];
var r$3687 = v$3685[4];
if (r$3687[0] == styleTop$1338) {0;
} else {var v$3688 = ((styleTop$1338 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(styleTop$1338))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(styleTop$1338))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3684,"style"),"top",v$3688);
(r$3687[0] = styleTop$1338,0);
};
var styleLeft$1340 = SmlPrims.chk_ovf_i32((SmlPrims.chk_ovf_i32(v$1438 * 1)) - v$1367);
var v$3691 = stripdata$1314[0];
var v$3692 = stripdata$1314[1];
var r$3694 = v$3692[2];
if (r$3694[0] == styleLeft$1340) {0;
} else {var v$3695 = ((styleLeft$1340 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(styleLeft$1340))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(styleLeft$1340))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3691,"style"),"left",v$3695);
(r$3694[0] = styleLeft$1340,0);
};
var styleClip$1342;
var t$4020;
var t$4019;
var t$4018;
var t$4017;
var t$4016;
var t$4015 = ("rect(" + ((imgTop$1333 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(imgTop$1333))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(imgTop$1333)))) + ",";
var t$4014;
var i$2687 = SmlPrims.chk_ovf_i32(v$1367 + 1);
t$4014 = ((i$2687 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$2687))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$2687)));
t$4016 = (t$4015 + t$4014);
t$4017 = (t$4016 + ",");
var t$4013;
var i$2689 = SmlPrims.chk_ovf_i32(imgTop$1333 + height$1303);
t$4013 = ((i$2689 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$2689))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$2689)));
t$4018 = (t$4017 + t$4013);
t$4019 = (t$4018 + ",");
t$4020 = (t$4019 + ((v$1367 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(v$1367))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(v$1367))));
styleClip$1342 = (t$4020 + ")");
var v$2694 = stripdata$1314[0];
var v$2695 = stripdata$1314[1];
var r$2697 = v$2695[0];
if (r$2697[0] == styleClip$1342) {0;
} else {(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$2694,"style"),"clip",styleClip$1342);
(r$2697[0] = styleClip$1342,0);
};
var dwx$1344 = v$1428 - player$319[5][0];
var dwy$1349 = v$1429 - player$319[6][0];
var wallDist$1354 = (dwx$1344 * dwx$1344) + (dwy$1349 * dwy$1349);
var v$3698 = stripdata$1314[0];
var v$3699 = stripdata$1314[1];
var n$3700 = SmlPrims.chk_ovf_i32(-(SmlPrims.chk_ovf_i32(Math.floor(wallDist$1354 * 1000.0))));
var r$3701 = v$3699[6];
if (r$3701[0] == n$3700) {0;
} else {var v$3702 = (n$3700 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(n$3700))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(n$3700));
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3698,"style"),"zIndex",v$3702);
(r$3701[0] = n$3700,0);
};
return v$1433;
};
};
};
});
var zero$1466 = SmlPrims.getrealtime();
var gameCycle$1471 = function(spriteMap$1474){var gameCycleDelay$1475 = TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.div$1394([0,[[1000,null],false]],[0,[[30,null],false]]);
var fix$4021 = {};
fix$4021.$cycle = function(lastGameCycleTime$1479){lab$cycle: while (true) {var n$1482;
var v$3754;
var v$3887 = SmlPrims.getrealtime();
v$3754 = (g14hFoVCUPM3ZC3WsORS6h$3basis$0Time$1.s$g$309(v$3887[0],v$3887[1],zero$1466[0],zero$1466[1]));
n$1482 = (g14hFoVCUPM3ZC3WsORS6h$3basis$0Time$1.toMilliseconds$97(v$3754[0],v$3754[1]));
var timeDelta$1483 = TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(lastGameCycleTime$1479,n$1482);
var mul$2725 = (xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.toInt$1823(timeDelta$1483)) / (xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.toInt$1823(gameCycleDelay$1475));
var moveStep$2727 = (mul$2725 * player$319[4][0]) * player$319[0];
var t$4023 = player$319[3];
var t$4022;
var a$2729 = player$319[3][0] + player$319[2][0];
t$4022 = ((a$2729 > 0.0)?((a$2729 > 2.0)?2.0:a$2729):((a$2729 < (-(2.0)))?(-(2.0)):a$2729));
(t$4023[0] = t$4022,0);
var drot$2731 = (mul$2725 * player$319[3][0]) * MaxRotSpeed$318;
var v$3450 = player$319[1];
(v$3450[0] = (v$3450[0] + drot$2731),0);
var dx$2736 = (Math.cos(player$319[1][0])) * moveStep$2727;
var dy$2737 = (Math.sin(player$319[1][0])) * moveStep$2727;
var fromX$2738 = player$319[5][0];
var fromY$2739 = player$319[6][0];
var v$2740 = checkCollision$504(spriteMap$1474,fromX$2738,fromY$2739,fromX$2738 + dx$2736,fromY$2739 + dy$2737,0.35);
var v$2741 = v$2740[0];
var v$2742 = v$2740[1];
(player$319[5][0] = v$2741,0);
(player$319[6][0] = v$2742,0);
var cycleDelay$1484 = (TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$l$1462(timeDelta$1483,gameCycleDelay$1475))?(xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.max$2267([0,[[1,null],false]],TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(gameCycleDelay$1475,timeDelta$1483),gameCycleDelay$1475))):gameCycleDelay$1475;
(function(i,f){return setTimeout(f,i);})(xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.toInt$1823(cycleDelay$1484),(function(env$4026){return function(v$3761){var v$4024 = env$4026[0];
var v$4025 = env$4026[1];
return v$4025(v$4024);
};
})([n$1482,fix$4021.$cycle]));
return 0;
};
};
var cycle$1476 = fix$4021.$cycle;
return cycle$1476([0,[null,false]]);
};
var updateOverlay$1510;
var old$2761 = [""];
updateOverlay$1510 = (function(v$2762){var s$2763 = "FPS: " + ((y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.fmt$169([2,[0,0]]))(v$2762));
if (old$2761[0] == s$2763) {return 0;
} else {var e$2767;
var v$2769 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"overlay");
switch (v$2769[0]) { case 0: {e$2767 = v$2769[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'overlay' in DOM"];
} };
(function(e,s){e.innerHTML = s;})(e$2767,s$2763);
return (old$2761[0] = s$2763,0);
};
});
var updateScore$1514;
var old$2779 = [""];
updateScore$1514 = (function(v$2780){var s$2781 = "SCORE: " + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(v$2780));
if (old$2779[0] == s$2781) {return 0;
} else {var e$2785;
var v$2787 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"score");
switch (v$2787[0]) { case 0: {e$2785 = v$2787[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'score' in DOM"];
} };
(function(e,s){e.innerHTML = s;})(e$2785,s$2781);
return (old$2779[0] = s$2781,0);
};
});
var renderSprites$1518 = function(oldSprites$1521,sprites$1524){var v$2795 = function(v$3816,v$3937,v$3938){var dx$2806 = (v$3937 + 0.5) - player$319[5][0];
var dy$2810 = (v$3938 + 0.5) - player$319[6][0];
var dist$2814 = Math.sqrt((dx$2806 * dx$2806) + (dy$2810 * dy$2810));
var spriteAngle$2815 = (Math.atan2(dy$2810,dx$2806)) - player$319[1][0];
var size$2819 = viewDist$340 / ((Math.cos(spriteAngle$2815)) * dist$2814);
if (size$2819 <= 0.0) {return 0;
} else {(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3816,"style"),"display","block");
var screen_x$2826 = ((Math.sin(spriteAngle$2815)) / (Math.cos(spriteAngle$2815))) * viewDist$340;
var left$2827 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(((screenWidthR$333 / 2.0) + screen_x$2826) - (size$2819 / 2.0));
var top$2828 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((screenHeightR$334 - size$2819) / 2.0);
var v$3495 = ((left$2827 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(left$2827))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(left$2827))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3816,"style"),"left",v$3495);
var v$3501 = ((top$2828 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(top$2828))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(top$2828))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3816,"style"),"top",v$3501);
var dbx$2831 = v$3937 - player$319[5][0];
var dby$2835 = v$3938 - player$319[6][0];
var sz$2839;
var t$4027;
var i$2886 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(size$2819);
t$4027 = ((i$2886 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$2886))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$2886)));
sz$2839 = (t$4027 + "px");
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3816,"style"),"width",sz$2839);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3816,"style"),"height",sz$2839);
var blockDist$2842 = (dbx$2831 * dbx$2831) + (dby$2835 * dby$2835);
var zIndex$2843 = SmlPrims.chk_ovf_i32(-(SmlPrims.chk_ovf_i32(Math.floor(blockDist$2842 * 1000.0))));
var v$3515 = (zIndex$2843 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(zIndex$2843))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(zIndex$2843));
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3816,"style"),"zIndex",v$3515);
return 0;
};
};
var fix$4028 = {};
fix$4028.$app = function(v$2846){lab$app: while (true) {if (v$2846 == null) {return 0;
} else {var v$2847 = v$2846;
var v$2848 = v$2847[0];
var v$2849 = v$2847[1];
var v$3940 = v$2848[3];
v$2795(v$2848[2],v$3940[0],v$3940[1]);
var t$4029 = v$2849;
var v$2846 = t$4029;
continue lab$app;
};
};
};
var app$2845 = fix$4028.$app;
app$2845(sprites$1524);
var fix$4030 = {};
fix$4030.$app = function(v$2914){lab$app: while (true) {if (v$2914 == null) {return 0;
} else {var v$2915 = v$2914;
var v$2916 = v$2915[0];
var v$2917 = v$2915[1];
(v$2916[4][0]?false:true)?((function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$2916[2],"style"),"display","none")):0;
var t$4031 = v$2917;
var v$2914 = t$4031;
continue lab$app;
};
};
};
var app$2913 = fix$4030.$app;
return app$2913(oldSprites$1521);
};
var score$1620 = [0];
var renderCycle$1621 = function(screenStrips$1624,spriteMap$1627){var renderCycleDelay$1628 = TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.div$1394([0,[[1000,null],false]],[0,[[30,null],false]]);
var fix$4032 = {};
fix$4032.$cycle = function(v$3817,v$3818){lab$cycle: while (true) {var miniMap$3707;
var v$3708 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimap");
switch (v$3708[0]) { case 0: {miniMap$3707 = v$3708[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimap' in DOM"];
} };
var miniMapObjects$3709;
var v$3710 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimapobjects");
switch (v$3710[0]) { case 0: {miniMapObjects$3709 = v$3710[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimapobjects' in DOM"];
} };
var height$3711 = (function(fp,s){return fp[s];})(miniMap$3707,"height");
var width$3712 = (function(fp,s){return fp[s];})(miniMap$3707,"width");
var c$3713 = (function(e,s){return e.getContext(s);})(miniMapObjects$3709,"2d");
(function(c,a1,a2,a3,a4){c.clearRect(a1,a2,a3,a4);})(c$3713,0,0,width$3712,height$3711);
(function(c,a1,a2,a3,a4){c.fillRect(a1,a2,a3,a4);})(c$3713,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$319[5][0] * miniMapScaleR$332) - 2.0),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$319[6][0] * miniMapScaleR$332) - 2.0),4,4);
(function(c){c.beginPath();})(c$3713);
(function(c,a1,a2){c.moveTo(a1,a2);})(c$3713,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(player$319[5][0] * miniMapScaleR$332),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(player$319[6][0] * miniMapScaleR$332));
(function(c,a1,a2){c.lineTo(a1,a2);})(c$3713,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$319[5][0] + (Math.cos(player$319[1][0]))) * miniMapScaleR$332),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$319[6][0] + (Math.sin(player$319[1][0]))) * miniMapScaleR$332));
(function(c){c.closePath();})(c$3713);
(function(c){c.stroke();})(c$3713);
var fix$4033 = {};
fix$4033.$app = function(v$2945){lab$app: while (true) {if (v$2945 == null) {return 0;
} else {var v$2946 = v$2945;
var v$2947 = v$2946[0];
var v$2948 = v$2946[1];
(v$2947[4][0] = false,0);
var t$4034 = v$2948;
var v$2945 = t$4034;
continue lab$app;
};
};
};
var app$2944 = fix$4033.$app;
app$2944(v$3818);
var sprites$1638;
var fix$4035 = {};
fix$4035.$loop = function(i$2954,acc$2955){lab$loop: while (true) {if (i$2954 >= numRays$338) {return acc$2955;
} else {var rayScreenPos$2956 = (((-(numRays$338)) / 2.0) + i$2954) * stripWidthR$336;
var rayViewDist$2958 = Math.sqrt((rayScreenPos$2956 * rayScreenPos$2956) + (viewDist$340 * viewDist$340));
var rayAngle$2959 = Math.asin(rayScreenPos$2956 / rayViewDist$2958);
var acc$2961 = ((castSingleRay$978(screenStrips$1624))(spriteMap$1627))([player$319[1][0] + rayAngle$2959,i$2954,acc$2955]);
var t$4036 = SmlPrims.chk_ovf_i32(i$2954 + 1);
var t$4037 = acc$2961;
var i$2954 = t$4036;
var acc$2955 = t$4037;
continue lab$loop;
};
};
};
var loop$2953 = fix$4035.$loop;
sprites$1638 = (loop$2953(0,null));
renderSprites$1518(v$3818,sprites$1638);
var n$1640;
var v$3772;
var v$3906 = SmlPrims.getrealtime();
v$3772 = (g14hFoVCUPM3ZC3WsORS6h$3basis$0Time$1.s$g$309(v$3906[0],v$3906[1],zero$1466[0],zero$1466[1]));
n$1640 = (g14hFoVCUPM3ZC3WsORS6h$3basis$0Time$1.toMilliseconds$97(v$3772[0],v$3772[1]));
var timeDelta$1641 = TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(v$3817,n$1640);
var cycleDelay$1642 = (TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$l$1462(timeDelta$1641,renderCycleDelay$1628))?(xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.max$2267([0,[[1,null],false]],TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(renderCycleDelay$1628,timeDelta$1641),renderCycleDelay$1628))):renderCycleDelay$1628;
var cycleDelay$1647 = xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.toInt$1823(cycleDelay$1642);
(function(i,f){return setTimeout(f,i);})(cycleDelay$1647,(function(env$4041){return function(v$3935){var v$4038 = env$4041[0];
var v$4039 = env$4041[1];
var v$4040 = env$4041[2];
return v$4040(v$4039,v$4038);
};
})([sprites$1638,n$1640,fix$4032.$cycle]));
var fps$1648 = 1000.0 / (xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.toInt$1823(timeDelta$1641));
updateOverlay$1510(fps$1648);
return updateScore$1514(score$1620[0]);
};
};
var cycle$1629 = fix$4032.$cycle;
return cycle$1629([0,[null,false]],null);
};
var init$1682 = function(){(function(f){document.onkeydown = function(e) { e = e || window.event; f(e.keyCode); };})(function(v$3002){switch (v$3002) { case 38: {return (player$319[4][0] = 1.0,0);
 break; }case 40: {return (player$319[4][0] = (-1.0),0);
 break; }case 37: {var rotAcc$3005 = player$319[2];
return (rotAcc$3005[0] > (-0.5))?(rotAcc$3005[0] = (rotAcc$3005[0] - 0.1),0):0;
 break; }case 39: {var rotAcc$3007 = player$319[2];
return (rotAcc$3007[0] < 0.5)?(rotAcc$3007[0] = (rotAcc$3007[0] + 0.1),0):0;
 break; }default: {return 0;
} };
});
(function(f){document.onkeyup = function(e) { e = e || window.event; f(e.keyCode); };})(function(v$3011){switch (v$3011) { case 38: {return (player$319[4][0] = 0.0,0);
 break; }case 40: {return (player$319[4][0] = 0.0,0);
 break; }case 37: {(player$319[3][0] = 0.0,0);
return (player$319[2][0] = 0.0,0);
 break; }case 39: {(player$319[3][0] = 0.0,0);
return (player$319[2][0] = 0.0,0);
 break; }default: {return 0;
} };
});
var v$3035 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"screen");
switch (v$3035[0]) { case 0: {v$3035[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'screen' in DOM"];
} };
var screenStrips$1686;
var xs$3018;
var fix$4042 = {};
fix$4042.$loop = function(i$3039){if (i$3039 >= screenWidth$56) {return null;
} else {var strip$3040 = document.createElement("img");
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(strip$3040,"style"),"position","absolute");
(function(fp,s,v){fp[s] = v;})(strip$3040,"src","walls.png");
var stripdata$3049;
var t$4044 = strip$3040;
var t$4043;
var v$3050 = [-1];
var v$3051 = [-1];
var v$3052 = [-1];
var v$3053 = [-1];
var v$3054 = [""];
var v$3055 = [-1];
t$4043 = [v$3054,v$3051,v$3052,["walls.png"],v$3053,v$3050,v$3055];
stripdata$3049 = [t$4044,t$4043];
var v$3716 = stripdata$3049[1];
var r$3718 = v$3716[1];
if (r$3718[0] == 0) {0;
} else {var v$3719 = (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(0)) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(strip$3040,"style"),"height",v$3719);
(r$3718[0] = 0,0);
};
var v$3723 = stripdata$3049[1];
var r$3725 = v$3723[2];
if (r$3725[0] == 0) {0;
} else {var v$3726 = (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(0)) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(strip$3040,"style"),"left",v$3726);
(r$3725[0] = 0,0);
};
var v$3730 = stripdata$3049[1];
var r$3732 = v$3730[4];
if (r$3732[0] == 0) {0;
} else {var v$3733 = (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(0)) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(strip$3040,"style"),"top",v$3733);
(r$3732[0] = 0,0);
};
var t$4045;
var v$3058 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"screen");
switch (v$3058[0]) { case 0: {t$4045 = v$3058[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'screen' in DOM"];
} };
(function(e,a){return e.appendChild(a);})(t$4045,strip$3040);
return [stripdata$3049,fix$4042.$loop(SmlPrims.chk_ovf_i32(i$3039 + 1))];
};
};
var loop$3038 = fix$4042.$loop;
xs$3018 = (loop$3038(0));
var fix$4046 = {};
fix$4046.$init = function(v$3821,v$3822,v$3823){lab$init: while (true) {if (v$3821 == null) {return v$3822;
} else {var v$3023 = v$3821;
var v$3024 = v$3023[0];
var v$3025 = v$3023[1];
(v$3822[v$3823] = v$3024,0);
var t$4047 = v$3025;
var t$4048 = v$3822;
var t$4049 = SmlPrims.chk_ovf_i32(v$3823 + 1);
var v$3821 = t$4047;
var v$3822 = t$4048;
var v$3823 = t$4049;
continue lab$init;
};
};
};
var init$3019 = fix$4046.$init;
var t$4055 = init$3019;
var t$4054 = xs$3018;
var t$4053;
var n$3027;
var fix$4050 = {};
fix$4050.$acc = function(v$3029,v$3030){lab$acc: while (true) {if (v$3029 == null) {return v$3030;
} else {var t$4051 = v$3029[1];
var t$4052 = SmlPrims.chk_ovf_i32(v$3030 + 1);
var v$3029 = t$4051;
var v$3030 = t$4052;
continue lab$acc;
};
};
};
var acc$3028 = fix$4050.$acc;
n$3027 = (acc$3028(xs$3018,0));
if ((0 <= n$3027)?(n$3027 <= 123456789):false) {0;
} else {throw CompilerInitial.exn$Size$51;
};
t$4053 = (Array(n$3027));
screenStrips$1686 = (t$4055(t$4054,t$4053,0));
var spriteMap$1687 = init$259(Y5y0a7l58ITwhpccCWLDEa$3basis$0Array2$1.foldi$383(0,function(v$3868){var v$3869 = v$3868[0];
var v$3870 = v$3868[1];
var v$3871 = v$3868[2];
var v$3872 = v$3868[3];
var v$3873;
switch (v$3871[0]) { case 8: {var v$3874 = v$3871[1];
v$3873 = [0,v$3874];
 break; }default: {v$3873 = [1];
} };
switch (v$3873[0]) { case 0: {return [[v$3873[1],v$3870,v$3869],v$3872];
 break; }default: {return v$3872;
} };
},null,Map$180,0,0,[1],[1]));
drawMiniMap$798();
gameCycle$1471(spriteMap$1687);
return renderCycle$1621(screenStrips$1686,spriteMap$1687);
};
(function(i,f){return setTimeout(f,i);})(1,function(v$3785){return init$1682();
});
return 0;
})();
