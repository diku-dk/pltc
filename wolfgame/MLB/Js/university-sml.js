if ((typeof(h5Gz8kAhgljIMpoVjaduMAf$3university$0university$1)) == "undefined") {h5Gz8kAhgljIMpoVjaduMAf$3university$0university$1 = {};
};
(function(){h5Gz8kAhgljIMpoVjaduMAf$3university$0university$1.eq_kind$1716 = function(v$3761,v$3762){return v$3761 == v$3762;
};
var screenWidth$54 = SmlPrims.div_i32(1600,2,CompilerInitial.exn$Div$45);
var screenHeight$55 = SmlPrims.div_i32(900,2,CompilerInitial.exn$Div$45);
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<html><head>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<title>Canvas example</title>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<style>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("div#minimapcontainer { position : absolute; width : 100%; }\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161((("canvas#minimap { position : absolute; width : " + ((screenWidth$54 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(screenWidth$54))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(screenWidth$54)))) + "px; }") + "\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161((("canvas#minimapobjects { position : absolute; width : " + ((screenWidth$54 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(screenWidth$54))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(screenWidth$54)))) + "px; }") + "\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("div#floor { position : absolute; width : 100%; height : 100%; background-color : rgb(128,128,128); z-index : -10000000; }\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("div#ceiling { position : absolute; width : 100%; height : 50%; background-color : rgb(96,96,96); z-index : -10000000; }\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161((((("#screen { position : relative; width : " + ((screenWidth$54 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(screenWidth$54))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(screenWidth$54)))) + "px; height : ") + ((screenHeight$55 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(screenHeight$55))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(screenHeight$55)))) + "px; border : 1px solid black; overflow : hidden; }") + "\n");
var t$3924 = EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161;
var t$3923;
var t$3922;
var t$3921;
var t$3920;
var t$3919;
var t$3918 = "div#overlay { position : absolute; display : block; width : ";
var t$3917;
var i$1769 = SmlPrims.chk_ovf_i32(screenWidth$54 - 10);
t$3917 = ((i$1769 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$1769))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$1769)));
t$3919 = (t$3918 + t$3917);
t$3920 = (t$3919 + "px; height : ");
var t$3916;
var i$1771 = SmlPrims.chk_ovf_i32(screenHeight$55 - 10);
t$3916 = ((i$1771 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$1771))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$1771)));
t$3921 = (t$3920 + t$3916);
t$3922 = (t$3921 + "px; padding : 5px; color : white; font-family : lucida console, courier new; font-size : 20px; z-index : 1; }");
t$3923 = (t$3922 + "\n");
t$3924(t$3923);
var t$3932 = EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161;
var t$3931;
var t$3930;
var t$3929;
var t$3928;
var t$3927;
var t$3926 = "div#score { position : relative; display : block; width : ";
var t$3925;
var i$1779 = SmlPrims.chk_ovf_i32(screenWidth$54 - 10);
t$3925 = ((i$1779 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$1779))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$1779)));
t$3927 = (t$3926 + t$3925);
t$3928 = (t$3927 + "px; height : ");
t$3929 = (t$3928 + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(30)));
t$3930 = (t$3929 + "px; padding : 5px; color : blue; font-family : lucida console, courier new; font-size : 20px; z-index : 1; }");
t$3931 = (t$3930 + "\n");
t$3932(t$3931);
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("</style>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("</head><body><center>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<h2>The PLTC Hallway!</h2>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='screen'>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='floor'></div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='ceiling'></div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='overlay'></div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("</div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='score'> </div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='minimapcontainer'>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<canvas id='minimap'></canvas>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<canvas id='minimapobjects'></canvas>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("</div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='log'></div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("</center></body></html>\n");
var Smap$112 = ["*abc*abc*abc*abc*abc*abc*abc*abc*abc*abc*abcabcabcabc*",["*   *   *  D*D  *  D*  D*   *T P*   * T *  L      L  *",["*   *   O   H   *   H   *   *   *   * T NL  TTTTTT   *",["* L * L * L * L * L H L * L * L * L * L ML  TTTTTT   *",["*   *T  H   *   *   *   *   *   *   *   *  L      L  *",["* L * L * L * L * L * L * L * L * L * LT*            *",["*   ** **   ** *** **   *   ** *** **  T**** *      T*",["*       *               *               *    *********",["******* ******     ***********     *******   * P******",["*TTTTT* ******T L  *TT *     *T L  *******P L  T******",["*       ******T    *  P*     *T    *******T  * T******",["******* ******     ** **** ***     *******   *********",["*  L  L   L L  L  L  L  L  L  L  L  L  L  L  L  L  L O",["*  L  L   L L  L  L  L  L  L  L  L  L  L  L  L  L  L O",["******* **** **** *** *** *** *** *** *** *** ********",["******* C*   *     H L * L * L * L * L * L * L *******",["******* C* * * TTA H  T*   *   *  T*   *  T*   *******",["*       C*** * TTA H   *   *   *   *   *   *   *******",["* ** ** **T  * TTA K  T*   *T T*H T*   *   *   *******",["* T* T* T*   *PTTAPH  A* AT*   *H A* TA*   *   *******",["**********cba*cbaca*cba*cba*cba*cba*cba*cba*cba*******",null]]]]]]]]]]]]]]]]]]]]];
var Map$171 = Y5y0a7l58ITwhpccCWLDEa$3basis$0Array2$1.fromList$58(dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.map$330(function(s$1837){var e$1845 = null;
var fix$3933 = {};
fix$3933.$rl = function(v$3763,v$3764){lab$rl: while (true) {if (v$3763 >= 0) {var t$3937 = SmlPrims.chk_ovf_i32(v$3763 - 1);
var t$3934;
var v$3168 = s$1837.charCodeAt(v$3763);
var t$3936;
var t$3935;
switch (v$3168) { case 32: {t$3935 = 0;
 break; }case 119: {t$3935 = 1;
 break; }case 61: {t$3935 = 2;
 break; }case 109: {t$3935 = 3;
 break; }case 37: {t$3935 = 3;
 break; }case 104: {t$3935 = 4;
 break; }case 77: {t$3935 = 5;
 break; }case 78: {t$3935 = 6;
 break; }case 97: {t$3935 = 7;
 break; }case 98: {t$3935 = 8;
 break; }case 99: {t$3935 = 9;
 break; }case 42: {t$3935 = 10;
 break; }case 72: {t$3935 = 11;
 break; }case 75: {t$3935 = 12;
 break; }case 79: {t$3935 = 13;
 break; }case 84: {t$3935 = 100;
 break; }case 65: {t$3935 = 101;
 break; }case 80: {t$3935 = 102;
 break; }case 76: {t$3935 = 103;
 break; }case 68: {t$3935 = 104;
 break; }case 67: {t$3935 = 105;
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,("unknown character '" + (h8UYb53cympluUQFSuaSASi$3basis$0Char$1.toString$275(v$3168))) + "'"];
} };
t$3936 = [t$3935,v$3764];
t$3934 = t$3936;
var t$3938 = t$3937;
var t$3939 = t$3934;
var v$3763 = t$3938;
var v$3764 = t$3939;
continue lab$rl;
} else {return v$3764;
};
};
};
var rl$1847 = fix$3933.$rl;
return rl$1847(SmlPrims.chk_ovf_i32(s$1837.length - 1),e$1845);
},Smap$112));
var init$273 = function(items$276){var screen$277;
var v$1880 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"screen");
switch (v$1880[0]) { case 0: {screen$277 = v$1880[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'screen' in DOM"];
} };
Map$171[0][0];
var v$3720 = Map$171[0][1];
var v$3721 = Map$171[0][2];
if ((0 <= v$3720)?(v$3720 <= 123456789):false) {0;
} else {throw CompilerInitial.exn$Size$51;
};
var spriteMap$281;
var v$3180 = [1];
var t$3947;
var t$3940;
var t$1890 = Array(v$3720);
var fix$3941 = {};
fix$3941.$init = function(v$3767,v$3768){lab$init: while (true) {if (v$3768 >= v$3720) {return 0;
} else {var t$3944 = v$3767;
var t$3943 = v$3768;
var t$3942;
if ((0 <= v$3721)?(v$3721 <= 123456789):false) {0;
} else {throw CompilerInitial.exn$Size$51;
};
t$3942 = (SmlPrims.wordTableInit(v$3721,v$3180));
(t$3944[t$3943] = t$3942,0);
var t$3945 = v$3767;
var t$3946 = SmlPrims.chk_ovf_i32(v$3768 + 1);
var v$3767 = t$3945;
var v$3768 = t$3946;
continue lab$init;
};
};
};
var init$1891 = fix$3941.$init;
init$1891(t$1890,0);
t$3940 = t$1890;
t$3947 = [t$3940,v$3720,v$3721];
spriteMap$281 = [t$3947];
var fix$3948 = {};
fix$3948.$app = function(v$1909){lab$app: while (true) {if (v$1909 == null) {return 0;
} else {var v$1910 = v$1909;
var v$1911 = v$1910[0];
var v$1912 = v$1910[1];
var v$1946 = v$1911[0];
var v$1947 = v$1911[1];
var v$1948 = v$1911[2];
var s$1949;
var pos$1951 = [v$1947,v$1948];
var e$1952 = document.createElement("img");
var t$3951 = e$1952;
var t$3950 = "src";
var t$3949;
switch (v$1946) { case 0: {t$3949 = "tablechairs.png";
 break; }case 1: {t$3949 = (("professor" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32((SmlPrims.mod_i32(SmlPrims.chk_ovf_i32(pos$1951[0] + pos$1951[1]),4,CompilerInitial.exn$Div$45)) + 1)))) + ".gif");
 break; }case 2: {t$3949 = "plantgreen.png";
 break; }case 3: {t$3949 = "lamp.png";
 break; }case 5: {t$3949 = "score.png";
 break; }default: {t$3949 = "desk.png";
} };
(function(fp,s,v){fp[s] = v;})(t$3951,t$3950,t$3949);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(e$1952,"style"),"display","none");
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(e$1952,"style"),"position","absolute");
var v$1955;
switch (v$1946) { case 0: {v$1955 = true;
 break; }case 1: {v$1955 = true;
 break; }case 2: {v$1955 = true;
 break; }case 3: {v$1955 = false;
 break; }case 5: {v$1955 = false;
 break; }default: {v$1955 = true;
} };
var v$1956 = [false];
s$1949 = [v$1955,[true],e$1952,pos$1951,v$1956];
var v$3188 = [0,s$1949];
var v$1959 = spriteMap$281[0][0];
spriteMap$281[0][1];
spriteMap$281[0][2];
var v$1961 = v$1959.length;
if ((0 <= v$1948)?(v$1948 < v$1961):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$1964 = v$1959[v$1948];
var v$1965 = v$1964.length;
if ((0 <= v$1947)?(v$1947 < v$1965):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
(v$1964[v$1947] = v$3188,0);
(function(e,a){return e.appendChild(a);})(screen$277,s$1949[2]);
var t$3952 = v$1912;
var v$1909 = t$3952;
continue lab$app;
};
};
};
var app$1908 = fix$3948.$app;
app$1908(items$276);
return spriteMap$281;
};
var MaxRotSpeed$332 = (3.0 * 3.14159265358979323846) / 360.0;
var player$333;
var v$334 = [16.0];
var v$335 = [10.0];
var v$336 = [0.0];
var v$337 = [0.0];
var v$338 = [0.0];
player$333 = [0.10,v$336,[0.0],v$338,v$337,v$334,v$335];
Map$171[0][0];
Map$171[0][1];
var mapWidth$341 = Map$171[0][2];
var mapWidthR$342 = mapWidth$341;
Map$171[0][0];
var mapHeight$343;
var v$1974 = Map$171[0][1];
Map$171[0][2];
mapHeight$343 = v$1974;
var mapHeightR$344 = mapHeight$343;
var miniMapScaleR$346 = 8;
var screenWidthR$347 = screenWidth$54;
var screenHeightR$348 = screenHeight$55;
var stripWidthR$350 = 1;
var fov$351 = (60.0 * 3.14159265358979323846) / 180.0;
var numRays$352 = SmlPrims.chk_ovf_i32(Math.ceil(screenWidthR$347 / stripWidthR$350));
var fovHalf$353 = fov$351 / 2.0;
var viewDist$354 = (screenWidthR$347 / 2.0) / ((Math.sin(fovHalf$353)) / (Math.cos(fovHalf$353)));
var twoPI$355 = 3.14159265358979323846 * 2.0;
var checkCollision$516 = function(spriteMap$519,v$3771,v$3772,v$3773,v$3774,v$3775){if ((v$3774 < 0.0)?true:((v$3774 >= mapHeightR$344)?true:((v$3773 < 0.0)?true:(v$3773 >= mapWidthR$342)))) {return [v$3771,v$3772];
} else {var blockX$531 = SmlPrims.chk_ovf_i32(Math.floor(v$3773));
var blockY$532 = SmlPrims.chk_ovf_i32(Math.floor(v$3774));
var t$3953;
if ((blockY$532 < 0.0)?true:((blockY$532 >= mapHeightR$344)?true:((blockX$531 < 0.0)?true:(blockX$531 >= mapWidthR$342)))) {t$3953 = true;
} else {var Y$3540 = SmlPrims.chk_ovf_i32(Math.floor(blockY$532));
var X$3541 = SmlPrims.chk_ovf_i32(Math.floor(blockX$531));
var wt$3542;
var v$3543 = Map$171[0][0];
Map$171[0][1];
Map$171[0][2];
var v$3544 = v$3543.length;
if ((0 <= Y$3540)?(Y$3540 < v$3544):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3545 = v$3543[Y$3540];
var v$3546 = v$3545.length;
if ((0 <= X$3541)?(X$3541 < v$3546):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$3542 = v$3545[X$3541];
if ((wt$3542 > 0)?((wt$3542 >= 100)?false:true):false) {t$3953 = true;
} else {var v$3547;
var v$3548 = spriteMap$519[0][0];
spriteMap$519[0][1];
spriteMap$519[0][2];
var v$3549 = v$3548.length;
if ((0 <= Y$3540)?(Y$3540 < v$3549):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3550 = v$3548[Y$3540];
var v$3551 = v$3550.length;
if ((0 <= X$3541)?(X$3541 < v$3551):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$3547 = v$3550[X$3541];
switch (v$3547[0]) { case 0: {t$3953 = v$3547[1][0];
 break; }default: {t$3953 = false;
} };
};
};
if (t$3953) {return [v$3771,v$3772];
} else {var blockTop$538;
var v$3713 = blockY$532 - 1.0;
if ((v$3713 < 0.0)?true:((v$3713 >= mapHeightR$344)?true:((blockX$531 < 0.0)?true:(blockX$531 >= mapWidthR$342)))) {blockTop$538 = true;
} else {var Y$3555 = SmlPrims.chk_ovf_i32(Math.floor(v$3713));
var X$3556 = SmlPrims.chk_ovf_i32(Math.floor(blockX$531));
var wt$3557;
var v$3558 = Map$171[0][0];
Map$171[0][1];
Map$171[0][2];
var v$3559 = v$3558.length;
if ((0 <= Y$3555)?(Y$3555 < v$3559):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3560 = v$3558[Y$3555];
var v$3561 = v$3560.length;
if ((0 <= X$3556)?(X$3556 < v$3561):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$3557 = v$3560[X$3556];
if ((wt$3557 > 0)?((wt$3557 >= 100)?false:true):false) {blockTop$538 = true;
} else {var v$3562;
var v$3563 = spriteMap$519[0][0];
spriteMap$519[0][1];
spriteMap$519[0][2];
var v$3564 = v$3563.length;
if ((0 <= Y$3555)?(Y$3555 < v$3564):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3565 = v$3563[Y$3555];
var v$3566 = v$3565.length;
if ((0 <= X$3556)?(X$3556 < v$3566):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$3562 = v$3565[X$3556];
switch (v$3562[0]) { case 0: {blockTop$538 = v$3562[1][0];
 break; }default: {blockTop$538 = false;
} };
};
};
var blockBottom$539;
var v$3715 = blockY$532 + 1.0;
if ((v$3715 < 0.0)?true:((v$3715 >= mapHeightR$344)?true:((blockX$531 < 0.0)?true:(blockX$531 >= mapWidthR$342)))) {blockBottom$539 = true;
} else {var Y$3570 = SmlPrims.chk_ovf_i32(Math.floor(v$3715));
var X$3571 = SmlPrims.chk_ovf_i32(Math.floor(blockX$531));
var wt$3572;
var v$3573 = Map$171[0][0];
Map$171[0][1];
Map$171[0][2];
var v$3574 = v$3573.length;
if ((0 <= Y$3570)?(Y$3570 < v$3574):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3575 = v$3573[Y$3570];
var v$3576 = v$3575.length;
if ((0 <= X$3571)?(X$3571 < v$3576):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$3572 = v$3575[X$3571];
if ((wt$3572 > 0)?((wt$3572 >= 100)?false:true):false) {blockBottom$539 = true;
} else {var v$3577;
var v$3578 = spriteMap$519[0][0];
spriteMap$519[0][1];
spriteMap$519[0][2];
var v$3579 = v$3578.length;
if ((0 <= Y$3570)?(Y$3570 < v$3579):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3580 = v$3578[Y$3570];
var v$3581 = v$3580.length;
if ((0 <= X$3571)?(X$3571 < v$3581):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$3577 = v$3580[X$3571];
switch (v$3577[0]) { case 0: {blockBottom$539 = v$3577[1][0];
 break; }default: {blockBottom$539 = false;
} };
};
};
var blockLeft$540;
var v$3716 = blockX$531 - 1.0;
if ((blockY$532 < 0.0)?true:((blockY$532 >= mapHeightR$344)?true:((v$3716 < 0.0)?true:(v$3716 >= mapWidthR$342)))) {blockLeft$540 = true;
} else {var Y$3585 = SmlPrims.chk_ovf_i32(Math.floor(blockY$532));
var X$3586 = SmlPrims.chk_ovf_i32(Math.floor(v$3716));
var wt$3587;
var v$3588 = Map$171[0][0];
Map$171[0][1];
Map$171[0][2];
var v$3589 = v$3588.length;
if ((0 <= Y$3585)?(Y$3585 < v$3589):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3590 = v$3588[Y$3585];
var v$3591 = v$3590.length;
if ((0 <= X$3586)?(X$3586 < v$3591):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$3587 = v$3590[X$3586];
if ((wt$3587 > 0)?((wt$3587 >= 100)?false:true):false) {blockLeft$540 = true;
} else {var v$3592;
var v$3593 = spriteMap$519[0][0];
spriteMap$519[0][1];
spriteMap$519[0][2];
var v$3594 = v$3593.length;
if ((0 <= Y$3585)?(Y$3585 < v$3594):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3595 = v$3593[Y$3585];
var v$3596 = v$3595.length;
if ((0 <= X$3586)?(X$3586 < v$3596):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$3592 = v$3595[X$3586];
switch (v$3592[0]) { case 0: {blockLeft$540 = v$3592[1][0];
 break; }default: {blockLeft$540 = false;
} };
};
};
var blockRight$541;
var v$3718 = blockX$531 + 1.0;
if ((blockY$532 < 0.0)?true:((blockY$532 >= mapHeightR$344)?true:((v$3718 < 0.0)?true:(v$3718 >= mapWidthR$342)))) {blockRight$541 = true;
} else {var Y$3600 = SmlPrims.chk_ovf_i32(Math.floor(blockY$532));
var X$3601 = SmlPrims.chk_ovf_i32(Math.floor(v$3718));
var wt$3602;
var v$3603 = Map$171[0][0];
Map$171[0][1];
Map$171[0][2];
var v$3604 = v$3603.length;
if ((0 <= Y$3600)?(Y$3600 < v$3604):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3605 = v$3603[Y$3600];
var v$3606 = v$3605.length;
if ((0 <= X$3601)?(X$3601 < v$3606):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$3602 = v$3605[X$3601];
if ((wt$3602 > 0)?((wt$3602 >= 100)?false:true):false) {blockRight$541 = true;
} else {var v$3607;
var v$3608 = spriteMap$519[0][0];
spriteMap$519[0][1];
spriteMap$519[0][2];
var v$3609 = v$3608.length;
if ((0 <= Y$3600)?(Y$3600 < v$3609):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3610 = v$3608[Y$3600];
var v$3611 = v$3610.length;
if ((0 <= X$3601)?(X$3601 < v$3611):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$3607 = v$3610[X$3601];
switch (v$3607[0]) { case 0: {blockRight$541 = v$3607[1][0];
 break; }default: {blockRight$541 = false;
} };
};
};
var toY$542 = (blockTop$538?((v$3774 - blockY$532) < v$3775):false)?(blockY$532 + v$3775):((blockBottom$539?(((blockY$532 + 1.0) - v$3774) < v$3775):false)?((blockY$532 + 1.0) - v$3775):v$3774);
return [(blockLeft$540?((v$3773 - blockX$531) < v$3775):false)?(blockX$531 + v$3775):((blockRight$541?(((blockX$531 + 1.0) - v$3773) < v$3775):false)?((blockX$531 + 1.0) - v$3775):v$3773),toY$542];
};
};
};
var drawMiniMap$810 = function(){var miniMap$817;
var v$2201 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimap");
switch (v$2201[0]) { case 0: {miniMap$817 = v$2201[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimap' in DOM"];
} };
var miniMapCtr$818;
var v$2207 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimapcontainer");
switch (v$2207[0]) { case 0: {miniMapCtr$818 = v$2207[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimapcontainer' in DOM"];
} };
var miniMapObjects$819;
var v$2213 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimapobjects");
switch (v$2213[0]) { case 0: {miniMapObjects$819 = v$2213[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimapobjects' in DOM"];
} };
var w$820 = SmlPrims.chk_ovf_i32(mapWidth$341 * 8);
var h$821 = SmlPrims.chk_ovf_i32(mapHeight$343 * 8);
(function(fp,s,v){fp[s] = v;})(miniMap$817,"width",w$820);
(function(fp,s,v){fp[s] = v;})(miniMap$817,"height",h$821);
(function(fp,s,v){fp[s] = v;})(miniMapObjects$819,"width",w$820);
(function(fp,s,v){fp[s] = v;})(miniMapObjects$819,"height",h$821);
(function(fp,s,v){fp[s] = v;})(miniMapCtr$818,"width",w$820);
(function(fp,s,v){fp[s] = v;})(miniMapCtr$818,"height",h$821);
var w_s$828 = ((w$820 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(w$820))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(w$820))) + "px";
var h_s$829 = ((h$821 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(h$821))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(h$821))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMap$817,"style"),"width",w_s$828);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMapObjects$819,"style"),"width",w_s$828);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMapCtr$818,"style"),"width",w_s$828);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMap$817,"style"),"height",h_s$829);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMapObjects$819,"style"),"height",h_s$829);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMapCtr$818,"style"),"height",h_s$829);
var c$836 = (function(e,s){return e.getContext(s);})(miniMap$817,"2d");
var entireMap$837 = function(v$3915){return [Map$171,0,[1],[1],0];
};
Y5y0a7l58ITwhpccCWLDEa$3basis$0Array2$1.appi$512(0,function(v$3837){var v$3838 = v$3837[0];
var v$3839 = v$3837[1];
var v$3840 = v$3837[2];
if ((v$3840 > 0)?((v$3840 >= 100)?false:true):false) {(function(c,s){c.fillStyle = s;})(c$836,"rgb(200,200,200)");
return (function(c,a1,a2,a3,a4){c.fillRect(a1,a2,a3,a4);})(c$836,SmlPrims.chk_ovf_i32(v$3839 * 8),SmlPrims.chk_ovf_i32(v$3838 * 8),8,8);
} else {return 0;
};
},(entireMap$837(0))[0],(entireMap$837(0))[4],(entireMap$837(0))[1],(entireMap$837(0))[3],(entireMap$837(0))[2]);
var miniMap$3613;
var v$3614 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimap");
switch (v$3614[0]) { case 0: {miniMap$3613 = v$3614[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimap' in DOM"];
} };
var miniMapObjects$3615;
var v$3616 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimapobjects");
switch (v$3616[0]) { case 0: {miniMapObjects$3615 = v$3616[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimapobjects' in DOM"];
} };
var height$3617 = (function(fp,s){return fp[s];})(miniMap$3613,"height");
var width$3618 = (function(fp,s){return fp[s];})(miniMap$3613,"width");
var c$3619 = (function(e,s){return e.getContext(s);})(miniMapObjects$3615,"2d");
(function(c,a1,a2,a3,a4){c.clearRect(a1,a2,a3,a4);})(c$3619,0,0,width$3618,height$3617);
(function(c,a1,a2,a3,a4){c.fillRect(a1,a2,a3,a4);})(c$3619,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$333[5][0] * miniMapScaleR$346) - 2.0),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$333[6][0] * miniMapScaleR$346) - 2.0),4,4);
(function(c){c.beginPath();})(c$3619);
(function(c,a1,a2){c.moveTo(a1,a2);})(c$3619,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(player$333[5][0] * miniMapScaleR$346),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(player$333[6][0] * miniMapScaleR$346));
(function(c,a1,a2){c.lineTo(a1,a2);})(c$3619,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$333[5][0] + (Math.cos(player$333[1][0]))) * miniMapScaleR$346),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$333[6][0] + (Math.sin(player$333[1][0]))) * miniMapScaleR$346));
(function(c){c.closePath();})(c$3619);
return (function(c){c.stroke();})(c$3619);
};
var castSingleRay$990;
var fix$3954 = {};
fix$3954.$RealMod = function(v$3776,v$3777){lab$RealMod: while (true) {if (v$3776 < v$3777) {return v$3776;
} else {var t$3955 = v$3776 - v$3777;
var t$3956 = v$3777;
var v$3776 = t$3955;
var v$3777 = t$3956;
continue lab$RealMod;
};
};
};
var RealMod$872 = fix$3954.$RealMod;
castSingleRay$990 = (function(screenStrips$993){return function(spriteMap$996){return function(v$1001){var v$1434 = v$1001[0];
var v$1435 = v$1001[1];
var v$1436 = v$1001[2];
var rayAngle$1002 = RealMod$872(v$1434,twoPI$355);
var rayAngle$1003 = (rayAngle$1002 < 0.0)?(rayAngle$1002 + twoPI$355):rayAngle$1002;
var right$1008 = (rayAngle$1003 > (twoPI$355 * 0.75))?true:(rayAngle$1003 < (twoPI$355 * 0.25));
var up$1013 = (rayAngle$1003 < 0.0)?true:(rayAngle$1003 > 3.14159265358979323846);
var angleSin$1018 = Math.sin(rayAngle$1003);
var angleCos$1019 = Math.cos(rayAngle$1003);
var slope$1020 = angleSin$1018 / angleCos$1019;
var dXVer$1021 = right$1008?1.0:(-1.0);
var dYVer$1026 = dXVer$1021 * slope$1020;
var x$1027 = right$1008?(SmlPrims.chk_ovf_i32(Math.ceil(player$333[5][0]))):(SmlPrims.chk_ovf_i32(Math.floor(player$333[5][0])));
var x$1040 = x$1027;
var y$1041 = player$333[6][0] + ((x$1040 - player$333[5][0]) * slope$1020);
var v$1424;
var fix$3957 = {};
fix$3957.$loop = function(v$3780,v$3781,visibleSprites$1057){lab$loop: while (true) {if ((v$3780 < 0.0)?true:((v$3780 >= mapWidthR$342)?true:((v$3781 < 0.0)?true:(v$3781 >= mapHeightR$344)))) {return [[0.0,0.0,0,0.0,0,0.0,0],visibleSprites$1057];
} else {var wallX$1069 = SmlPrims.chk_ovf_i32(Math.floor(right$1008?v$3780:(v$3780 - 1.0)));
var wallY$1074 = SmlPrims.chk_ovf_i32(Math.floor(v$3781));
var wt$1075;
var v$2433 = Map$171[0][0];
Map$171[0][1];
Map$171[0][2];
var v$2435 = v$2433.length;
if ((0 <= wallY$1074)?(wallY$1074 < v$2435):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$2437 = v$2433[wallY$1074];
var v$2438 = v$2437.length;
if ((0 <= wallX$1069)?(wallX$1069 < v$2438):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$1075 = v$2437[wallX$1069];
if ((wt$1075 > 0)?((wt$1075 >= 100)?false:true):false) {var distX$1080 = v$3780 - player$333[5][0];
var distY$1085 = v$3781 - player$333[6][0];
var dist$1090 = (distX$1080 * distX$1080) + (distY$1085 * distY$1085);
var textureX$1091 = v$3781 - (SmlPrims.chk_ovf_i32(Math.floor(v$3781)));
return [[dist$1090,(right$1008?false:true)?(1.0 - textureX$1091):textureX$1091,wt$1075,v$3780,wallX$1069,v$3781,wallY$1074],visibleSprites$1057];
} else {var t$3960 = v$3780 + dXVer$1021;
var t$3959 = v$3781 + dYVer$1026;
var t$3958;
var v$1108;
var v$2447 = spriteMap$996[0][0];
spriteMap$996[0][1];
spriteMap$996[0][2];
var v$2449 = v$2447.length;
if ((0 <= wallY$1074)?(wallY$1074 < v$2449):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$2451 = v$2447[wallY$1074];
var v$2452 = v$2451.length;
if ((0 <= wallX$1069)?(wallX$1069 < v$2452):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$1108 = v$2451[wallX$1069];
switch (v$1108[0]) { case 1: {t$3958 = visibleSprites$1057;
 break; }default: {var v$1123 = v$1108[1];
if (v$1123[4][0]) {t$3958 = visibleSprites$1057;
} else {(v$1123[4][0] = true,0);
t$3958 = [v$1123,visibleSprites$1057];
};
} };
var t$3961 = t$3960;
var t$3962 = t$3959;
var t$3963 = t$3958;
var v$3780 = t$3961;
var v$3781 = t$3962;
var visibleSprites$1057 = t$3963;
continue lab$loop;
};
};
};
};
var loop$1050 = fix$3957.$loop;
v$1424 = (loop$1050(x$1040,y$1041,v$1436));
var v$1425 = v$1424[0];
var v$1426 = v$1425[3];
var v$1427 = v$1425[5];
var v$1428 = v$1425[0];
var v$1429 = v$1425[1];
var v$1430 = v$1425[4];
var v$1431 = v$1425[6];
var v$1432 = v$1425[2];
var v$1433 = v$1424[1];
var slope$1147 = angleCos$1019 / angleSin$1018;
var dYHor$1148 = up$1013?(-1.0):1.0;
var dXHor$1153 = dYHor$1148 * slope$1147;
var y$1154 = up$1013?(SmlPrims.chk_ovf_i32(Math.floor(player$333[6][0]))):(SmlPrims.chk_ovf_i32(Math.ceil(player$333[6][0])));
var x$1167 = player$333[5][0] + ((y$1154 - player$333[6][0]) * slope$1147);
var v$1414;
var fix$3964 = {};
fix$3964.$loop = function(v$3784,v$3785,visibleSprites$1183){lab$loop: while (true) {if ((v$3784 < 0.0)?true:((v$3784 >= mapWidthR$342)?true:((v$3785 < 0.0)?true:((v$3785 >= mapHeightR$344)?true:((slope$1147 > 10000.0)?true:(up$1013?((v$3785 - 1.0) < 0.0):false)))))) {return [[v$1428,v$1429,v$1432,v$1426,v$1430,v$1427,v$1431],visibleSprites$1183];
} else {var wallY$1195 = SmlPrims.chk_ovf_i32(Math.floor(up$1013?(v$3785 - 1.0):v$3785));
var wallX$1200 = SmlPrims.chk_ovf_i32(Math.floor(v$3784));
var wt$1201;
try {var v$2467 = Map$171[0][0];
Map$171[0][1];
Map$171[0][2];
var v$2469 = v$2467.length;
if ((0 <= wallY$1195)?(wallY$1195 < v$2469):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$2471 = v$2467[wallY$1195];
var v$2472 = v$2471.length;
if ((0 <= wallX$1200)?(wallX$1200 < v$2472):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$1201 = v$2471[wallX$1200];
} catch(v$3965) {wt$1201 = (((function(env$3970){return function(s$m$1204){var v$3966 = env$3970[0];
var v$3967 = env$3970[1];
var v$3968 = env$3970[2];
var v$3969 = env$3970[3];
var s$2473 = (("wallX = " + ((v$3969 < 0)?("-" + (v$3968(SmlPrims.chk_ovf_i32(-(v$3969))))):(v$3968(v$3969)))) + "; wallY = ") + ((v$3967 < 0)?("-" + (v$3968(SmlPrims.chk_ovf_i32(-(v$3967))))):(v$3968(v$3967)));
var log$2474;
var v$2476 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(v$3966,"log");
switch (v$2476[0]) { case 0: {log$2474 = v$2476[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'log' in DOM"];
} };
(function(e,a){return e.appendChild(a);})(log$2474,document.createTextNode(s$2473));
(function(e,a){return e.appendChild(a);})(log$2474,document.createElement("br"));
throw s$m$1204;
};
})([z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,wallY$1195,abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456,wallX$1200]))(v$3965));
};
if ((wt$1201 > 0)?((wt$1201 >= 100)?false:true):false) {var distX$1211 = v$3784 - player$333[5][0];
var distY$1216 = v$3785 - player$333[6][0];
var blockDist$1221 = (distX$1211 * distX$1211) + (distY$1216 * distY$1216);
if (((v$1428 > 0.0)?false:true)?true:(blockDist$1221 < v$1428)) {var textureX$1226 = v$3784 - (SmlPrims.chk_ovf_i32(Math.floor(v$3784)));
return [[blockDist$1221,1.0 - (up$1013?(1.0 - textureX$1226):textureX$1226),wt$1201,v$3784,wallX$1200,v$3785,wallY$1195],visibleSprites$1183];
} else {return [[v$1428,v$1429,v$1432,v$1426,v$1430,v$1427,v$1431],visibleSprites$1183];
};
} else {var t$3973 = v$3784 + dXHor$1153;
var t$3972 = v$3785 + dYHor$1148;
var t$3971;
var v$1255;
var v$2498 = spriteMap$996[0][0];
spriteMap$996[0][1];
spriteMap$996[0][2];
var v$2500 = v$2498.length;
if ((0 <= wallY$1195)?(wallY$1195 < v$2500):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$2502 = v$2498[wallY$1195];
var v$2503 = v$2502.length;
if ((0 <= wallX$1200)?(wallX$1200 < v$2503):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$1255 = v$2502[wallX$1200];
switch (v$1255[0]) { case 1: {t$3971 = visibleSprites$1183;
 break; }default: {var v$1270 = v$1255[1];
if (v$1270[4][0]) {t$3971 = visibleSprites$1183;
} else {(v$1270[4][0] = true,0);
t$3971 = [v$1270,visibleSprites$1183];
};
} };
var t$3974 = t$3973;
var t$3975 = t$3972;
var t$3976 = t$3971;
var v$3784 = t$3974;
var v$3785 = t$3975;
var visibleSprites$1183 = t$3976;
continue lab$loop;
};
};
};
};
var loop$1176 = fix$3964.$loop;
v$1414 = (loop$1176(x$1167,y$1154,v$1433));
var v$1415 = v$1414[0];
var v$1416 = v$1415[0];
var v$1417 = v$1415[3];
var v$1418 = v$1415[5];
var v$1419 = v$1415[4];
var v$1420 = v$1415[6];
var v$1421 = v$1415[2];
var v$1422 = v$1415[1];
var v$1423 = v$1414[1];
if (v$1416 <= 0.0) {return v$1423;
} else {var miniMapObjects$2509;
var v$2511 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimapobjects");
switch (v$2511[0]) { case 0: {miniMapObjects$2509 = v$2511[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimapobjects' in DOM"];
} };
var c$2514 = (function(e,s){return e.getContext(s);})(miniMapObjects$2509,"2d");
(function(c,s){c.strokeStyle = s;})(c$2514,"rgba(0,100,0,0.3)");
(function(c,s){c.lineWidth = s;})(c$2514,"0.5");
(function(c){c.beginPath();})(c$2514);
(function(c,a1,a2){c.moveTo(a1,a2);})(c$2514,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(player$333[5][0] * miniMapScaleR$346),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(player$333[6][0] * miniMapScaleR$346));
(function(c,a1,a2){c.lineTo(a1,a2);})(c$2514,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(v$1417 * miniMapScaleR$346),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(v$1418 * miniMapScaleR$346));
(function(c){c.closePath();})(c$2514);
(function(c){c.stroke();})(c$2514);
var dist$1311 = Math.sqrt(v$1416);
var dist$1312 = dist$1311 * (Math.cos(player$333[1][0] - rayAngle$1003));
var height$1317 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(viewDist$354 / dist$1312);
var width$1318 = SmlPrims.chk_ovf_i32(height$1317 * 1);
var widthR$1319 = width$1318;
var heightR$1320 = height$1317;
var top$1321 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((screenHeightR$348 - heightR$1320) / 2.0);
var texX$1322 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(v$1422 * widthR$1319);
var texX$1323 = (texX$1322 > (SmlPrims.chk_ovf_i32(width$1318 - 1)))?(SmlPrims.chk_ovf_i32(width$1318 - 1)):texX$1322;
var v$2537 = screenStrips$993.length;
if ((0 <= v$1435)?(v$1435 < v$2537):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var stripdata$1328 = screenStrips$993[v$1435];
var v$1368;
switch (v$1421) { case 5: {var v$2539 = stripdata$1328[0];
var v$2540 = stripdata$1328[1];
var r$2542 = v$2540[3];
if (r$2542[0] == "datoek-000.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2539,"src","datoek-000.png");
(r$2542[0] = "datoek-000.png",0);
};
v$1368 = [1,1,texX$1323,2.0];
 break; }case 6: {var v$2552 = stripdata$1328[0];
var v$2553 = stripdata$1328[1];
var r$2555 = v$2553[3];
if (r$2555[0] == "datoek-000.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2552,"src","datoek-000.png");
(r$2555[0] = "datoek-000.png",0);
};
v$1368 = [1,1,SmlPrims.chk_ovf_i32(texX$1323 + width$1318),2.0];
 break; }case 7: {var v$2565 = stripdata$1328[0];
var v$2566 = stripdata$1328[1];
var r$2568 = v$2566[3];
if (r$2568[0] == "window-left.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2565,"src","window-left.png");
(r$2568[0] = "window-left.png",0);
};
v$1368 = [1,1,texX$1323,1.0];
 break; }case 8: {var v$2578 = stripdata$1328[0];
var v$2579 = stripdata$1328[1];
var r$2581 = v$2579[3];
if (r$2581[0] == "window-center.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2578,"src","window-center.png");
(r$2581[0] = "window-center.png",0);
};
v$1368 = [1,1,texX$1323,1.0];
 break; }case 9: {var v$2591 = stripdata$1328[0];
var v$2592 = stripdata$1328[1];
var r$2594 = v$2592[3];
if (r$2594[0] == "window-right.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2591,"src","window-right.png");
(r$2594[0] = "window-right.png",0);
};
v$1368 = [1,1,texX$1323,1.0];
 break; }case 10: {var v$2604 = stripdata$1328[0];
var v$2605 = stripdata$1328[1];
var r$2607 = v$2605[3];
if (r$2607[0] == "wall-white.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2604,"src","wall-white.png");
(r$2607[0] = "wall-white.png",0);
};
v$1368 = [1,1,texX$1323,1.0];
 break; }case 11: {var v$2617 = stripdata$1328[0];
var v$2618 = stripdata$1328[1];
var r$2620 = v$2618[3];
if (r$2620[0] == "wall-shelf1.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2617,"src","wall-shelf1.png");
(r$2620[0] = "wall-shelf1.png",0);
};
v$1368 = [1,1,texX$1323,1.0];
 break; }case 12: {var v$2630 = stripdata$1328[0];
var v$2631 = stripdata$1328[1];
var r$2633 = v$2631[3];
if (r$2633[0] == "wall-shelf2.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2630,"src","wall-shelf2.png");
(r$2633[0] = "wall-shelf2.png",0);
};
v$1368 = [1,1,texX$1323,1.0];
 break; }case 13: {var v$2643 = stripdata$1328[0];
var v$2644 = stripdata$1328[1];
var r$2646 = v$2644[3];
if (r$2646[0] == "wall-board.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2643,"src","wall-board.png");
(r$2646[0] = "wall-board.png",0);
};
v$1368 = [1,1,texX$1323,1.0];
 break; }default: {var v$2656 = stripdata$1328[0];
var v$2657 = stripdata$1328[1];
var r$2659 = v$2657[3];
if (r$2659[0] == "walls.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2656,"src","walls.png");
(r$2659[0] = "walls.png",0);
};
v$1368 = [4,v$1421,texX$1323,2.0];
} };
var v$1369 = v$1368[0];
var v$1370 = v$1368[1];
var v$1371 = v$1368[2];
var v$1372 = v$1368[3];
var v$3631 = stripdata$1328[0];
var v$3632 = stripdata$1328[1];
var r$3634 = v$3632[1];
if (r$3634[0] == height$1317) {0;
} else {var v$3635 = ((height$1317 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(height$1317))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(height$1317))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3631,"style"),"height",v$3635);
(r$3634[0] = height$1317,0);
};
var v$3638 = stripdata$1328[0];
var v$3639 = stripdata$1328[1];
var r$3641 = v$3639[4];
if (r$3641[0] == top$1321) {0;
} else {var v$3642 = ((top$1321 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(top$1321))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(top$1321))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3638,"style"),"top",v$3642);
(r$3641[0] = top$1321,0);
};
var imgTop$1337 = SmlPrims.chk_ovf_i32(Math.floor(heightR$1320 * (SmlPrims.chk_ovf_i32(v$1370 - 1))));
var styleHeight$1338 = SmlPrims.chk_ovf_i32(Math.floor(heightR$1320 * v$1369));
var v$3645 = stripdata$1328[0];
var v$3646 = stripdata$1328[1];
var r$3648 = v$3646[1];
if (r$3648[0] == styleHeight$1338) {0;
} else {var v$3649 = ((styleHeight$1338 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(styleHeight$1338))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(styleHeight$1338))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3645,"style"),"height",v$3649);
(r$3648[0] = styleHeight$1338,0);
};
var styleWidth$1340 = SmlPrims.chk_ovf_i32(Math.floor(widthR$1319 * v$1372));
var v$3652 = stripdata$1328[0];
var v$3653 = stripdata$1328[1];
var r$3655 = v$3653[5];
if (r$3655[0] == styleWidth$1340) {0;
} else {var v$3656 = ((styleWidth$1340 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(styleWidth$1340))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(styleWidth$1340))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3652,"style"),"width",v$3656);
(r$3655[0] = styleWidth$1340,0);
};
var styleTop$1342 = SmlPrims.chk_ovf_i32(top$1321 - imgTop$1337);
var v$3659 = stripdata$1328[0];
var v$3660 = stripdata$1328[1];
var r$3662 = v$3660[4];
if (r$3662[0] == styleTop$1342) {0;
} else {var v$3663 = ((styleTop$1342 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(styleTop$1342))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(styleTop$1342))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3659,"style"),"top",v$3663);
(r$3662[0] = styleTop$1342,0);
};
var styleLeft$1344 = SmlPrims.chk_ovf_i32((SmlPrims.chk_ovf_i32(v$1435 * 1)) - v$1371);
var v$3666 = stripdata$1328[0];
var v$3667 = stripdata$1328[1];
var r$3669 = v$3667[2];
if (r$3669[0] == styleLeft$1344) {0;
} else {var v$3670 = ((styleLeft$1344 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(styleLeft$1344))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(styleLeft$1344))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3666,"style"),"left",v$3670);
(r$3669[0] = styleLeft$1344,0);
};
var styleClip$1346;
var t$3984;
var t$3983;
var t$3982;
var t$3981;
var t$3980;
var t$3979 = ("rect(" + ((imgTop$1337 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(imgTop$1337))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(imgTop$1337)))) + ",";
var t$3978;
var i$2683 = SmlPrims.chk_ovf_i32(v$1371 + 1);
t$3978 = ((i$2683 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$2683))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$2683)));
t$3980 = (t$3979 + t$3978);
t$3981 = (t$3980 + ",");
var t$3977;
var i$2685 = SmlPrims.chk_ovf_i32(imgTop$1337 + height$1317);
t$3977 = ((i$2685 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$2685))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$2685)));
t$3982 = (t$3981 + t$3977);
t$3983 = (t$3982 + ",");
t$3984 = (t$3983 + ((v$1371 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(v$1371))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(v$1371))));
styleClip$1346 = (t$3984 + ")");
var v$2690 = stripdata$1328[0];
var v$2691 = stripdata$1328[1];
var r$2693 = v$2691[0];
if (r$2693[0] == styleClip$1346) {0;
} else {(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$2690,"style"),"clip",styleClip$1346);
(r$2693[0] = styleClip$1346,0);
};
var dwx$1348 = v$1419 - player$333[5][0];
var dwy$1353 = v$1420 - player$333[6][0];
var wallDist$1358 = (dwx$1348 * dwx$1348) + (dwy$1353 * dwy$1353);
var v$3673 = stripdata$1328[0];
var v$3674 = stripdata$1328[1];
var n$3675 = SmlPrims.chk_ovf_i32(-(SmlPrims.chk_ovf_i32(Math.floor(wallDist$1358 * 1000.0))));
var r$3676 = v$3674[6];
if (r$3676[0] == n$3675) {0;
} else {var v$3677 = (n$3675 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(n$3675))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(n$3675));
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3673,"style"),"zIndex",v$3677);
(r$3676[0] = n$3675,0);
};
return v$1423;
};
};
};
});
var zero$1463 = SmlPrims.getrealtime();
var gameCycle$1468 = function(spriteMap$1471){var gameCycleDelay$1472 = TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.div$1394([0,[[1000,null],false]],[0,[[30,null],false]]);
var fix$3985 = {};
fix$3985.$cycle = function(lastGameCycleTime$1476){lab$cycle: while (true) {var n$1479;
var v$3729;
var v$3859 = SmlPrims.getrealtime();
v$3729 = (g14hFoVCUPM3ZC3WsORS6h$3basis$0Time$1.s$g$309(v$3859[0],v$3859[1],zero$1463[0],zero$1463[1]));
n$1479 = (g14hFoVCUPM3ZC3WsORS6h$3basis$0Time$1.toMilliseconds$97(v$3729[0],v$3729[1]));
var timeDelta$1480 = TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(lastGameCycleTime$1476,n$1479);
var mul$2721 = (xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.toInt$1823(timeDelta$1480)) / (xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.toInt$1823(gameCycleDelay$1472));
var moveStep$2723 = (mul$2721 * player$333[4][0]) * player$333[0];
var t$3987 = player$333[3];
var t$3986;
var a$2725 = player$333[3][0] + player$333[2][0];
t$3986 = ((a$2725 > 0.0)?((a$2725 > 2.0)?2.0:a$2725):((a$2725 < (-(2.0)))?(-(2.0)):a$2725));
(t$3987[0] = t$3986,0);
var drot$2727 = (mul$2721 * player$333[3][0]) * MaxRotSpeed$332;
var v$3425 = player$333[1];
(v$3425[0] = (v$3425[0] + drot$2727),0);
var dx$2732 = (Math.cos(player$333[1][0])) * moveStep$2723;
var dy$2733 = (Math.sin(player$333[1][0])) * moveStep$2723;
var fromX$2734 = player$333[5][0];
var fromY$2735 = player$333[6][0];
var v$2736 = checkCollision$516(spriteMap$1471,fromX$2734,fromY$2735,fromX$2734 + dx$2732,fromY$2735 + dy$2733,0.35);
var v$2737 = v$2736[0];
var v$2738 = v$2736[1];
(player$333[5][0] = v$2737,0);
(player$333[6][0] = v$2738,0);
var cycleDelay$1481 = (TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$l$1462(timeDelta$1480,gameCycleDelay$1472))?(xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.max$2267([0,[[1,null],false]],TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(gameCycleDelay$1472,timeDelta$1480),gameCycleDelay$1472))):gameCycleDelay$1472;
(function(i,f){return setTimeout(f,i);})(xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.toInt$1823(cycleDelay$1481),(function(env$3990){return function(v$3736){var v$3988 = env$3990[0];
var v$3989 = env$3990[1];
return v$3989(v$3988);
};
})([n$1479,fix$3985.$cycle]));
return 0;
};
};
var cycle$1473 = fix$3985.$cycle;
return cycle$1473([0,[null,false]]);
};
var updateOverlay$1507;
var old$2757 = [""];
updateOverlay$1507 = (function(v$2758){var s$2759 = "FPS: " + ((y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.fmt$169([2,[0,0]]))(v$2758));
if (old$2757[0] == s$2759) {return 0;
} else {var e$2763;
var v$2765 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"overlay");
switch (v$2765[0]) { case 0: {e$2763 = v$2765[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'overlay' in DOM"];
} };
(function(e,s){e.innerHTML = s;})(e$2763,s$2759);
return (old$2757[0] = s$2759,0);
};
});
var updateScore$1511;
var old$2775 = [""];
updateScore$1511 = (function(v$2776){var s$2777 = "SCORE: " + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(v$2776));
if (old$2775[0] == s$2777) {return 0;
} else {var e$2781;
var v$2783 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"score");
switch (v$2783[0]) { case 0: {e$2781 = v$2783[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'score' in DOM"];
} };
(function(e,s){e.innerHTML = s;})(e$2781,s$2777);
return (old$2775[0] = s$2777,0);
};
});
var renderSprites$1515 = function(oldSprites$1518,sprites$1521){var v$2791 = function(v$3789,v$3909,v$3910){var dx$2802 = (v$3909 + 0.5) - player$333[5][0];
var dy$2806 = (v$3910 + 0.5) - player$333[6][0];
var dist$2810 = Math.sqrt((dx$2802 * dx$2802) + (dy$2806 * dy$2806));
var spriteAngle$2811 = (Math.atan2(dy$2806,dx$2802)) - player$333[1][0];
var size$2815 = viewDist$354 / ((Math.cos(spriteAngle$2811)) * dist$2810);
if (size$2815 <= 0.0) {return 0;
} else {(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3789,"style"),"display","block");
var screen_x$2822 = ((Math.sin(spriteAngle$2811)) / (Math.cos(spriteAngle$2811))) * viewDist$354;
var left$2823 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(((screenWidthR$347 / 2.0) + screen_x$2822) - (size$2815 / 2.0));
var top$2824 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((screenHeightR$348 - size$2815) / 2.0);
var v$3470 = ((left$2823 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(left$2823))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(left$2823))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3789,"style"),"left",v$3470);
var v$3476 = ((top$2824 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(top$2824))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(top$2824))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3789,"style"),"top",v$3476);
var dbx$2827 = v$3909 - player$333[5][0];
var dby$2831 = v$3910 - player$333[6][0];
var sz$2835;
var t$3991;
var i$2882 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(size$2815);
t$3991 = ((i$2882 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$2882))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$2882)));
sz$2835 = (t$3991 + "px");
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3789,"style"),"width",sz$2835);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3789,"style"),"height",sz$2835);
var blockDist$2838 = (dbx$2827 * dbx$2827) + (dby$2831 * dby$2831);
var zIndex$2839 = SmlPrims.chk_ovf_i32(-(SmlPrims.chk_ovf_i32(Math.floor(blockDist$2838 * 1000.0))));
var v$3490 = (zIndex$2839 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(zIndex$2839))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(zIndex$2839));
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3789,"style"),"zIndex",v$3490);
return 0;
};
};
var fix$3992 = {};
fix$3992.$app = function(v$2842){lab$app: while (true) {if (v$2842 == null) {return 0;
} else {var v$2843 = v$2842;
var v$2844 = v$2843[0];
var v$2845 = v$2843[1];
var v$3912 = v$2844[3];
v$2791(v$2844[2],v$3912[0],v$3912[1]);
var t$3993 = v$2845;
var v$2842 = t$3993;
continue lab$app;
};
};
};
var app$2841 = fix$3992.$app;
app$2841(sprites$1521);
var fix$3994 = {};
fix$3994.$app = function(v$2910){lab$app: while (true) {if (v$2910 == null) {return 0;
} else {var v$2911 = v$2910;
var v$2912 = v$2911[0];
var v$2913 = v$2911[1];
(v$2912[4][0]?false:true)?((function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$2912[2],"style"),"display","none")):0;
var t$3995 = v$2913;
var v$2910 = t$3995;
continue lab$app;
};
};
};
var app$2909 = fix$3994.$app;
return app$2909(oldSprites$1518);
};
var score$1617 = [0];
var renderCycle$1618 = function(screenStrips$1621,spriteMap$1624){var renderCycleDelay$1625 = TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.div$1394([0,[[1000,null],false]],[0,[[30,null],false]]);
var fix$3996 = {};
fix$3996.$cycle = function(v$3790,v$3791){lab$cycle: while (true) {var miniMap$3682;
var v$3683 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimap");
switch (v$3683[0]) { case 0: {miniMap$3682 = v$3683[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimap' in DOM"];
} };
var miniMapObjects$3684;
var v$3685 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimapobjects");
switch (v$3685[0]) { case 0: {miniMapObjects$3684 = v$3685[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimapobjects' in DOM"];
} };
var height$3686 = (function(fp,s){return fp[s];})(miniMap$3682,"height");
var width$3687 = (function(fp,s){return fp[s];})(miniMap$3682,"width");
var c$3688 = (function(e,s){return e.getContext(s);})(miniMapObjects$3684,"2d");
(function(c,a1,a2,a3,a4){c.clearRect(a1,a2,a3,a4);})(c$3688,0,0,width$3687,height$3686);
(function(c,a1,a2,a3,a4){c.fillRect(a1,a2,a3,a4);})(c$3688,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$333[5][0] * miniMapScaleR$346) - 2.0),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$333[6][0] * miniMapScaleR$346) - 2.0),4,4);
(function(c){c.beginPath();})(c$3688);
(function(c,a1,a2){c.moveTo(a1,a2);})(c$3688,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(player$333[5][0] * miniMapScaleR$346),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(player$333[6][0] * miniMapScaleR$346));
(function(c,a1,a2){c.lineTo(a1,a2);})(c$3688,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$333[5][0] + (Math.cos(player$333[1][0]))) * miniMapScaleR$346),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$333[6][0] + (Math.sin(player$333[1][0]))) * miniMapScaleR$346));
(function(c){c.closePath();})(c$3688);
(function(c){c.stroke();})(c$3688);
var fix$3997 = {};
fix$3997.$app = function(v$2941){lab$app: while (true) {if (v$2941 == null) {return 0;
} else {var v$2942 = v$2941;
var v$2943 = v$2942[0];
var v$2944 = v$2942[1];
(v$2943[4][0] = false,0);
var t$3998 = v$2944;
var v$2941 = t$3998;
continue lab$app;
};
};
};
var app$2940 = fix$3997.$app;
app$2940(v$3791);
var sprites$1635;
var fix$3999 = {};
fix$3999.$loop = function(i$2950,acc$2951){lab$loop: while (true) {if (i$2950 >= numRays$352) {return acc$2951;
} else {var rayScreenPos$2952 = (((-(numRays$352)) / 2.0) + i$2950) * stripWidthR$350;
var rayViewDist$2954 = Math.sqrt((rayScreenPos$2952 * rayScreenPos$2952) + (viewDist$354 * viewDist$354));
var rayAngle$2955 = Math.asin(rayScreenPos$2952 / rayViewDist$2954);
var acc$2957 = ((castSingleRay$990(screenStrips$1621))(spriteMap$1624))([player$333[1][0] + rayAngle$2955,i$2950,acc$2951]);
var t$4000 = SmlPrims.chk_ovf_i32(i$2950 + 1);
var t$4001 = acc$2957;
var i$2950 = t$4000;
var acc$2951 = t$4001;
continue lab$loop;
};
};
};
var loop$2949 = fix$3999.$loop;
sprites$1635 = (loop$2949(0,null));
renderSprites$1515(v$3791,sprites$1635);
var n$1637;
var v$3747;
var v$3878 = SmlPrims.getrealtime();
v$3747 = (g14hFoVCUPM3ZC3WsORS6h$3basis$0Time$1.s$g$309(v$3878[0],v$3878[1],zero$1463[0],zero$1463[1]));
n$1637 = (g14hFoVCUPM3ZC3WsORS6h$3basis$0Time$1.toMilliseconds$97(v$3747[0],v$3747[1]));
var timeDelta$1638 = TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(v$3790,n$1637);
var cycleDelay$1639 = (TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$l$1462(timeDelta$1638,renderCycleDelay$1625))?(xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.max$2267([0,[[1,null],false]],TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(renderCycleDelay$1625,timeDelta$1638),renderCycleDelay$1625))):renderCycleDelay$1625;
var cycleDelay$1644 = xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.toInt$1823(cycleDelay$1639);
(function(i,f){return setTimeout(f,i);})(cycleDelay$1644,(function(env$4005){return function(v$3907){var v$4002 = env$4005[0];
var v$4003 = env$4005[1];
var v$4004 = env$4005[2];
return v$4004(v$4003,v$4002);
};
})([sprites$1635,n$1637,fix$3996.$cycle]));
var fps$1645 = 1000.0 / (xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.toInt$1823(timeDelta$1638));
updateOverlay$1507(fps$1645);
return updateScore$1511(score$1617[0]);
};
};
var cycle$1626 = fix$3996.$cycle;
return cycle$1626([0,[null,false]],null);
};
var init$1679 = function(){(function(f){document.onkeydown = function(e) { e = e || window.event; f(e.keyCode); };})(function(v$2998){switch (v$2998) { case 38: {return (player$333[4][0] = 1.0,0);
 break; }case 40: {return (player$333[4][0] = (-1.0),0);
 break; }case 37: {var rotAcc$3001 = player$333[2];
return (rotAcc$3001[0] > (-0.5))?(rotAcc$3001[0] = (rotAcc$3001[0] - 0.1),0):0;
 break; }case 39: {var rotAcc$3003 = player$333[2];
return (rotAcc$3003[0] < 0.5)?(rotAcc$3003[0] = (rotAcc$3003[0] + 0.1),0):0;
 break; }default: {return 0;
} };
});
(function(f){document.onkeyup = function(e) { e = e || window.event; f(e.keyCode); };})(function(v$3007){switch (v$3007) { case 38: {return (player$333[4][0] = 0.0,0);
 break; }case 40: {return (player$333[4][0] = 0.0,0);
 break; }case 37: {(player$333[3][0] = 0.0,0);
return (player$333[2][0] = 0.0,0);
 break; }case 39: {(player$333[3][0] = 0.0,0);
return (player$333[2][0] = 0.0,0);
 break; }default: {return 0;
} };
});
var v$3031 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"screen");
switch (v$3031[0]) { case 0: {v$3031[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'screen' in DOM"];
} };
var screenStrips$1683;
var xs$3014;
var fix$4006 = {};
fix$4006.$loop = function(i$3035){if (i$3035 >= screenWidth$54) {return null;
} else {var strip$3036 = document.createElement("img");
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(strip$3036,"style"),"position","absolute");
(function(fp,s,v){fp[s] = v;})(strip$3036,"src","walls.png");
var stripdata$3045;
var t$4008 = strip$3036;
var t$4007;
var v$3046 = [-1];
var v$3047 = [-1];
var v$3048 = [-1];
var v$3049 = [-1];
var v$3050 = [""];
var v$3051 = [-1];
t$4007 = [v$3050,v$3047,v$3048,["walls.png"],v$3049,v$3046,v$3051];
stripdata$3045 = [t$4008,t$4007];
var v$3691 = stripdata$3045[1];
var r$3693 = v$3691[1];
if (r$3693[0] == 0) {0;
} else {var v$3694 = (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(0)) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(strip$3036,"style"),"height",v$3694);
(r$3693[0] = 0,0);
};
var v$3698 = stripdata$3045[1];
var r$3700 = v$3698[2];
if (r$3700[0] == 0) {0;
} else {var v$3701 = (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(0)) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(strip$3036,"style"),"left",v$3701);
(r$3700[0] = 0,0);
};
var v$3705 = stripdata$3045[1];
var r$3707 = v$3705[4];
if (r$3707[0] == 0) {0;
} else {var v$3708 = (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(0)) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(strip$3036,"style"),"top",v$3708);
(r$3707[0] = 0,0);
};
var t$4009;
var v$3054 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"screen");
switch (v$3054[0]) { case 0: {t$4009 = v$3054[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'screen' in DOM"];
} };
(function(e,a){return e.appendChild(a);})(t$4009,strip$3036);
return [stripdata$3045,fix$4006.$loop(SmlPrims.chk_ovf_i32(i$3035 + 1))];
};
};
var loop$3034 = fix$4006.$loop;
xs$3014 = (loop$3034(0));
var fix$4010 = {};
fix$4010.$init = function(v$3794,v$3795,v$3796){lab$init: while (true) {if (v$3794 == null) {return v$3795;
} else {var v$3019 = v$3794;
var v$3020 = v$3019[0];
var v$3021 = v$3019[1];
(v$3795[v$3796] = v$3020,0);
var t$4011 = v$3021;
var t$4012 = v$3795;
var t$4013 = SmlPrims.chk_ovf_i32(v$3796 + 1);
var v$3794 = t$4011;
var v$3795 = t$4012;
var v$3796 = t$4013;
continue lab$init;
};
};
};
var init$3015 = fix$4010.$init;
var t$4019 = init$3015;
var t$4018 = xs$3014;
var t$4017;
var n$3023;
var fix$4014 = {};
fix$4014.$acc = function(v$3025,v$3026){lab$acc: while (true) {if (v$3025 == null) {return v$3026;
} else {var t$4015 = v$3025[1];
var t$4016 = SmlPrims.chk_ovf_i32(v$3026 + 1);
var v$3025 = t$4015;
var v$3026 = t$4016;
continue lab$acc;
};
};
};
var acc$3024 = fix$4014.$acc;
n$3023 = (acc$3024(xs$3014,0));
if ((0 <= n$3023)?(n$3023 <= 123456789):false) {0;
} else {throw CompilerInitial.exn$Size$51;
};
t$4017 = (Array(n$3023));
screenStrips$1683 = (t$4019(t$4018,t$4017,0));
var spriteMap$1684 = init$273(Y5y0a7l58ITwhpccCWLDEa$3basis$0Array2$1.foldi$383(0,function(v$3841){var v$3842 = v$3841[0];
var v$3843 = v$3841[1];
var v$3844 = v$3841[2];
var v$3845 = v$3841[3];
var v$3846 = ((v$3844 >= 100)?false:true)?[1]:((v$3844 == 100)?[0,0]:((v$3844 == 101)?[0,1]:((v$3844 == 102)?[0,2]:((v$3844 == 103)?[0,3]:((v$3844 == 105)?[0,5]:((v$3844 == 104)?[0,4]:[1]))))));
switch (v$3846[0]) { case 0: {return [[v$3846[1],v$3843,v$3842],v$3845];
 break; }default: {return v$3845;
} };
},null,Map$171,0,0,[1],[1]));
drawMiniMap$810();
gameCycle$1468(spriteMap$1684);
return renderCycle$1618(screenStrips$1683,spriteMap$1684);
};
(function(i,f){return setTimeout(f,i);})(1,function(v$3760){return init$1679();
});
return 0;
})();
