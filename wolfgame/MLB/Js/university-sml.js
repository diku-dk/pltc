if ((typeof(h9AP67nN46MQi5f2NQrocNd$3university$0university$1)) == "undefined") {h9AP67nN46MQi5f2NQrocNd$3university$0university$1 = {};
};
(function(){h9AP67nN46MQi5f2NQrocNd$3university$0university$1.eq_lang$2575 = function(v$7286,v$7287){return v$7286 == v$7287;
};
h9AP67nN46MQi5f2NQrocNd$3university$0university$1.eq_sprite$2579 = function(v$7288,v$7289){return v$7288 == v$7289;
};
h9AP67nN46MQi5f2NQrocNd$3university$0university$1.eq_dir$2583 = function(v$7290,v$7291){return v$7290 == v$7291;
};
h9AP67nN46MQi5f2NQrocNd$3university$0university$1.eq_hitkind$2587 = function(v$7292,v$7293){return v$7292 == v$7293;
};
h9AP67nN46MQi5f2NQrocNd$3university$0university$1.s$sl$61 = function(v$7294,v$7295){return v$7295(v$7294);
};
h9AP67nN46MQi5f2NQrocNd$3university$0university$1.mapi$68 = function(f$71,xs$74){var fix$7511 = {};
fix$7511.$loop = function(v$7296,v$7297,v$7298){lab$loop: while (true) {if (v$7296 == null) {return dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.rev$680(v$7297);
} else {var v$94 = v$7296;
var v$95 = v$94[0];
var v$96 = v$94[1];
var v$7428 = SmlPrims.chk_ovf_i32(v$7298 + 1);
var t$7512 = v$96;
var t$7513 = [f$71([v$7298,v$95]),v$7297];
var t$7514 = v$7428;
var v$7296 = t$7512;
var v$7297 = t$7513;
var v$7298 = t$7514;
continue lab$loop;
};
};
};
var loop$75 = fix$7511.$loop;
return loop$75(xs$74,null,0);
};
h9AP67nN46MQi5f2NQrocNd$3university$0university$1.ppInt$97 = function(i$100){if (i$100 < 0) {return "-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$100))));
} else {return abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$100);
};
};
h9AP67nN46MQi5f2NQrocNd$3university$0university$1.s$d$105 = function(id$108){var v$113 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,id$108);
switch (v$113[0]) { case 0: {return v$113[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,("no element with id '" + id$108) + "' in DOM"];
} };
};
h9AP67nN46MQi5f2NQrocNd$3university$0university$1.println$116 = function(s$119){return EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161(s$119 + "\n");
};
h9AP67nN46MQi5f2NQrocNd$3university$0university$1.serverGet$120 = function(file$123){var file$124;
var t$7518 = file$123 + "?_=";
var t$7517;
var t$7516 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.toString$158;
var t$7515;
var v$2611 = SmlPrims.getrealtime();
var v$2612 = v$2611[0];
var v$2613 = v$2611[1];
t$7515 = ((v$2612 - (-2147483648)) + (v$2613 / 1000000.0));
t$7517 = (t$7516(t$7515));
file$124 = (t$7518 + t$7517);
var r$125 = SmlPrims.newRequest();
(function(r,m,u,a){return r.open(m,u,a);})(r$125,"GET",file$124,false);
z11cymP27JOrM6FBeJkkje$3js$0Js$1.send$652(r$125,[1]);
var v$132 = (function(r){return SmlPrims.option(r.responseText);})(r$125);
switch (v$132[0]) { case 0: {return v$132[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"serverGet failed on file " + file$124];
} };
};
h9AP67nN46MQi5f2NQrocNd$3university$0university$1.look$140 = function(k$143,xs$146){return dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(k$143,xs$146);
};
h9AP67nN46MQi5f2NQrocNd$3university$0university$1.log$147 = function(s$150){var log$151;
var v$2621 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"log");
switch (v$2621[0]) { case 0: {log$151 = v$2621[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'log' in DOM"];
} };
(function(e,a){return e.appendChild(a);})(log$151,document.createTextNode(s$150));
return (function(e,a){return e.appendChild(a);})(log$151,document.createElement("br"));
};
h9AP67nN46MQi5f2NQrocNd$3university$0university$1.loadStaff$156 = function(data$159){var jsonToStaff$261 = function(j$264){switch (j$264[0]) { case 2: {var v$276 = j$264[1];
var v$271;
var v$2786;
var v$2789 = DNzgidgaaiBsxwxK6Q4Ukm$3json$0json$1.objLook$96(v$276,"id");
switch (v$2789[0]) { case 0: {v$2786 = v$2789[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find  json object id in staff.json"];
} };
switch (v$2786[0]) { case 0: {v$271 = v$2786[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find string json object id in staff.json"];
} };
var v$272;
var v$2802;
var v$2805 = DNzgidgaaiBsxwxK6Q4Ukm$3json$0json$1.objLook$96(v$276,"name");
switch (v$2805[0]) { case 0: {v$2802 = v$2805[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find  json object name in staff.json"];
} };
switch (v$2802[0]) { case 0: {v$272 = v$2802[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find string json object name in staff.json"];
} };
var t$7531;
var v$2818;
var v$2821 = DNzgidgaaiBsxwxK6Q4Ukm$3json$0json$1.objLook$96(v$276,"avatar");
switch (v$2821[0]) { case 0: {v$2818 = v$2821[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find  json object avatar in staff.json"];
} };
switch (v$2818[0]) { case 0: {t$7531 = v$2818[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find string json object avatar in staff.json"];
} };
var t$7530 = v$271;
var t$7529 = v$272;
var t$7528;
var v$2834;
var v$2837 = DNzgidgaaiBsxwxK6Q4Ukm$3json$0json$1.objLook$96(v$276,"office");
switch (v$2837[0]) { case 0: {v$2834 = v$2837[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find  json object office in staff.json"];
} };
switch (v$2834[0]) { case 0: {t$7528 = v$2834[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find string json object office in staff.json"];
} };
var t$7519;
var v$6422;
var v$6423 = DNzgidgaaiBsxwxK6Q4Ukm$3json$0json$1.objLook$96(v$276,"slides");
switch (v$6423[0]) { case 0: {v$6422 = v$6423[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find  json object slides in staff.json"];
} };
switch (v$6422[0]) { case 6: {var v$6424 = v$6422[1];
var v$6442 = null;
var fix$7520 = {};
fix$7520.$foldr = function(v$6444){if (v$6444 == null) {return v$6442;
} else {var v$6445 = v$6444;
var v$6446 = v$6445[0];
var v$6447 = v$6445[1];
var v$6987 = fix$7520.$foldr(v$6447);
switch (v$6446[0]) { case 2: {var v$6451 = v$6446[1];
var t$7527;
var t$7526;
var t$7525;
var v$6452;
var v$6453 = DNzgidgaaiBsxwxK6Q4Ukm$3json$0json$1.objLook$96(v$6451,"id");
switch (v$6453[0]) { case 0: {v$6452 = v$6453[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find  json object id in staff.json"];
} };
switch (v$6452[0]) { case 0: {t$7525 = v$6452[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find string json object id in staff.json"];
} };
var t$7524;
var v$6454 = DNzgidgaaiBsxwxK6Q4Ukm$3json$0json$1.objLook$96(v$6451,"lang");
switch (v$6454[0]) { case 0: {var v$6455 = v$6454[1];
switch (v$6455[0]) { case 0: {switch (v$6455[1]) { case "EN": {t$7524 = [0,0];
 break; }case "en": {t$7524 = [0,0];
 break; }case "DA": {t$7524 = [0,1];
 break; }case "da": {t$7524 = [0,1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find da or en json object lang in staff.json"];
} };
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find da or en json object lang in staff.json"];
} };
 break; }default: {t$7524 = [1];
} };
var t$7523;
var v$6456;
var t$7522 = abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.fromString$460;
var t$7521;
var v$6457;
var v$6458 = DNzgidgaaiBsxwxK6Q4Ukm$3json$0json$1.objLook$96(v$6451,"pages");
switch (v$6458[0]) { case 0: {v$6457 = v$6458[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find  json object pages in staff.json"];
} };
switch (v$6457[0]) { case 0: {t$7521 = v$6457[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find string json object pages in staff.json"];
} };
v$6456 = (t$7522(t$7521));
switch (v$6456[0]) { case 0: {t$7523 = v$6456[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find int json object pages in staff.json"];
} };
t$7526 = [t$7525,t$7524,t$7523];
t$7527 = [t$7526,v$6987];
return t$7527;
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find ARRAY OBJECT json object slides in staff.json"];
} };
};
};
var foldr$6443 = fix$7520.$foldr;
t$7519 = (foldr$6443(v$6424));
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find ARRAY json object slides in staff.json"];
} };
return [t$7531,t$7530,t$7529,t$7528,t$7519];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find OBJECT json object ARRAY in staff.json"];
} };
};
return DNzgidgaaiBsxwxK6Q4Ukm$3json$0json$1.foldlArrayJson$963(function(v$280){var v$281 = v$280[0];
var v$282 = v$280[1];
return [jsonToStaff$261(v$281),v$282];
},null,data$159);
};
h9AP67nN46MQi5f2NQrocNd$3university$0university$1.pagesDeck$283 = function(staff$286,sid$289,did$292){var v$297 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$6460){return v$6460[1] == sid$289;
},staff$286);
switch (v$297[0]) { case 1: {return [1];
 break; }default: {var v$316 = v$297[1];
var v$302 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$6464){return v$6464[0] == did$292;
},v$316[4]);
switch (v$302[0]) { case 1: {return [1];
 break; }default: {return [0,v$302[1][2]];
} };
} };
};
h9AP67nN46MQi5f2NQrocNd$3university$0university$1.nextSlide$321 = function(staff$324,v$7301,v$7302,v$7303){var did$328 = v$7303[0];
var v$338;
var v$2865 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$2883){return v$2883[1] == v$7301;
},staff$324);
switch (v$2865[0]) { case 1: {v$338 = [1];
 break; }default: {var v$2873 = v$2865[1];
var v$2874 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$2888){return v$2888[0] == did$328;
},v$2873[4]);
switch (v$2874[0]) { case 1: {v$338 = [1];
 break; }default: {v$338 = [0,v$2874[1][2]];
} };
} };
switch (v$338[0]) { case 0: {var v$340 = v$338[1];
return (v$7302[0] = (SmlPrims.mod_i32(SmlPrims.chk_ovf_i32(v$7302[0] + 1),v$340,CompilerInitial.exn$Div$45)),0);
 break; }default: {return 0;
} };
};
h9AP67nN46MQi5f2NQrocNd$3university$0university$1.prevSlide$346 = function(staff$349,v$7304,v$7305,v$7306){var did$353 = v$7306[0];
var v$363;
var v$2897 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$2915){return v$2915[1] == v$7304;
},staff$349);
switch (v$2897[0]) { case 1: {v$363 = [1];
 break; }default: {var v$2905 = v$2897[1];
var v$2906 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$2920){return v$2920[0] == did$353;
},v$2905[4]);
switch (v$2906[0]) { case 1: {v$363 = [1];
 break; }default: {v$363 = [0,v$2906[1][2]];
} };
} };
switch (v$363[0]) { case 0: {var v$365 = v$363[1];
return (v$7305[0] = (SmlPrims.mod_i32(SmlPrims.chk_ovf_i32((SmlPrims.chk_ovf_i32(v$7305[0] - 1)) + v$365),v$365,CompilerInitial.exn$Div$45)),0);
 break; }default: {return 0;
} };
};
h9AP67nN46MQi5f2NQrocNd$3university$0university$1.onDeck$371 = function(f$374,staff$377,v$7307,v$7308,v$7309){var v$387 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$6468){return v$6468[1] == v$7307;
},staff$377);
switch (v$387[0]) { case 1: {return 0;
 break; }default: {var v$437 = v$387[1];
var v$438 = v$437[4];
var slides$388 = f$374(v$438);
var did$389 = v$7309[0];
var fix$7532 = {};
fix$7532.$loop = function(v$393){lab$loop: while (true) {if (v$393 == null) {return (slides$388 == null)?0:(v$7309[0] = slides$388[0][0],0);
} else {var v$403 = v$393;
var v$404 = v$403[1];
if (v$404 == null) {return (slides$388 == null)?0:(v$7309[0] = slides$388[0][0],0);
} else {var v$418 = v$403[0];
var v$419 = v$404;
var v$420 = v$419[0];
var v$421 = v$419[1];
if (v$418[0] == did$389) {return (v$7309[0] = v$420[0],0);
} else {var t$7533 = [v$420,v$421];
var v$393 = t$7533;
continue lab$loop;
};
};
};
};
};
var loop$390 = fix$7532.$loop;
loop$390(slides$388);
return (v$7308[0] = 0,0);
} };
};
h9AP67nN46MQi5f2NQrocNd$3university$0university$1.nextDeck$446 = function(staff$449,v$7310,v$7311,v$7312){var v$2950 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$2982){return v$2982[1] == v$7310;
},staff$449);
switch (v$2950[0]) { case 1: {return 0;
 break; }default: {var v$2958 = v$2950[1];
var v$2959 = v$2958[4];
var did$2961 = v$7312[0];
var fix$7534 = {};
fix$7534.$loop = function(v$2963){lab$loop: while (true) {if (v$2963 == null) {return (v$2959 == null)?0:(v$7312[0] = v$2959[0][0],0);
} else {var v$2964 = v$2963;
var v$2965 = v$2964[1];
if (v$2965 == null) {return (v$2959 == null)?0:(v$7312[0] = v$2959[0][0],0);
} else {var v$2966 = v$2964[0];
var v$2967 = v$2965;
var v$2968 = v$2967[0];
var v$2969 = v$2967[1];
if (v$2966[0] == did$2961) {return (v$7312[0] = v$2968[0],0);
} else {var t$7535 = [v$2968,v$2969];
var v$2963 = t$7535;
continue lab$loop;
};
};
};
};
};
var loop$2962 = fix$7534.$loop;
loop$2962(v$2959);
return (v$7311[0] = 0,0);
} };
};
h9AP67nN46MQi5f2NQrocNd$3university$0university$1.prevDeck$456 = function(staff$459,v$7313,v$7314,v$7315){var v$2993 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$3025){return v$3025[1] == v$7313;
},staff$459);
switch (v$2993[0]) { case 1: {return 0;
 break; }default: {var v$3001 = v$2993[1];
var v$3002 = v$3001[4];
var slides$3003 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.rev$680(v$3002);
var did$3004 = v$7315[0];
var fix$7536 = {};
fix$7536.$loop = function(v$3006){lab$loop: while (true) {if (v$3006 == null) {return (slides$3003 == null)?0:(v$7315[0] = slides$3003[0][0],0);
} else {var v$3007 = v$3006;
var v$3008 = v$3007[1];
if (v$3008 == null) {return (slides$3003 == null)?0:(v$7315[0] = slides$3003[0][0],0);
} else {var v$3009 = v$3007[0];
var v$3010 = v$3008;
var v$3011 = v$3010[0];
var v$3012 = v$3010[1];
if (v$3009[0] == did$3004) {return (v$7315[0] = v$3011[0],0);
} else {var t$7537 = [v$3011,v$3012];
var v$3006 = t$7537;
continue lab$loop;
};
};
};
};
};
var loop$3005 = fix$7536.$loop;
loop$3005(slides$3003);
return (v$7314[0] = 0,0);
} };
};
h9AP67nN46MQi5f2NQrocNd$3university$0university$1.isWall$489 = function(v$492){switch (v$492[0]) { case 9: {return false;
 break; }case 8: {return false;
 break; }default: {return true;
} };
};
var mkFun$677 = function(v$7316,v$7317,displays$684){var north$685;
var v$5663 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.filter$415(function(s$688){return (SmlPrims.chk_ovf_i32(s$688[2] - 1)) == v$7317;
},displays$684);
var dists$6498 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.map$695(function(v$6499){var v$6500 = v$6499[0];
var v$6501 = v$6499[1];
var v$6502 = v$6499[2];
var t$7542 = v$6500;
var t$7541;
var t$7540;
var t$7539;
var r$6503 = SmlPrims.chk_ovf_i32(v$6501 - v$7316);
t$7539 = (r$6503 * r$6503);
var t$7538;
var r$6504 = SmlPrims.chk_ovf_i32(v$6502 - v$7317);
t$7538 = (r$6504 * r$6504);
t$7540 = (t$7539 * t$7538);
t$7541 = (Math.sqrt(t$7540));
return [t$7542,t$7541];
},v$5663);
var v$6505;
var fix$7543 = {};
fix$7543.$mini = function(v$6507,v$6508){lab$mini: while (true) {switch (v$6507[0]) { case 1: {if (v$6508 == null) {return v$6507;
} else {var v$6509 = v$6508;
var t$7544 = [0,v$6509[0]];
var t$7545 = v$6509[1];
var v$6507 = t$7544;
var v$6508 = t$7545;
continue lab$mini;
};
 break; }default: {if (v$6508 == null) {return v$6507;
} else {var v$6512 = v$6507[1];
var v$6513 = v$6512[1];
var v$6514 = v$6508;
var v$6515 = v$6514[0];
var v$6516 = v$6515[0];
var v$6517 = v$6515[1];
var v$6518 = v$6514[1];
if (v$6517 < v$6513) {var t$7546 = [0,[v$6516,v$6517]];
var t$7547 = v$6518;
var v$6507 = t$7546;
var v$6508 = t$7547;
continue lab$mini;
} else {var t$7548 = v$6507;
var t$7549 = v$6518;
var v$6507 = t$7548;
var v$6508 = t$7549;
continue lab$mini;
};
};
} };
};
};
var mini$6506 = fix$7543.$mini;
v$6505 = (mini$6506([1],dists$6498));
switch (v$6505[0]) { case 0: {var v$6519 = v$6505[1];
var v$6520 = v$6519[0];
north$685 = [0,v$6520];
 break; }default: {north$685 = [1];
} };
var south$693;
var v$5667 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.filter$415(function(s$696){return (SmlPrims.chk_ovf_i32(s$696[2] + 1)) == v$7317;
},displays$684);
var dists$6546 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.map$695(function(v$6547){var v$6548 = v$6547[0];
var v$6549 = v$6547[1];
var v$6550 = v$6547[2];
var t$7554 = v$6548;
var t$7553;
var t$7552;
var t$7551;
var r$6551 = SmlPrims.chk_ovf_i32(v$6549 - v$7316);
t$7551 = (r$6551 * r$6551);
var t$7550;
var r$6552 = SmlPrims.chk_ovf_i32(v$6550 - v$7317);
t$7550 = (r$6552 * r$6552);
t$7552 = (t$7551 * t$7550);
t$7553 = (Math.sqrt(t$7552));
return [t$7554,t$7553];
},v$5667);
var v$6553;
var fix$7555 = {};
fix$7555.$mini = function(v$6555,v$6556){lab$mini: while (true) {switch (v$6555[0]) { case 1: {if (v$6556 == null) {return v$6555;
} else {var v$6557 = v$6556;
var t$7556 = [0,v$6557[0]];
var t$7557 = v$6557[1];
var v$6555 = t$7556;
var v$6556 = t$7557;
continue lab$mini;
};
 break; }default: {if (v$6556 == null) {return v$6555;
} else {var v$6560 = v$6555[1];
var v$6561 = v$6560[1];
var v$6562 = v$6556;
var v$6563 = v$6562[0];
var v$6564 = v$6563[0];
var v$6565 = v$6563[1];
var v$6566 = v$6562[1];
if (v$6565 < v$6561) {var t$7558 = [0,[v$6564,v$6565]];
var t$7559 = v$6566;
var v$6555 = t$7558;
var v$6556 = t$7559;
continue lab$mini;
} else {var t$7560 = v$6555;
var t$7561 = v$6566;
var v$6555 = t$7560;
var v$6556 = t$7561;
continue lab$mini;
};
};
} };
};
};
var mini$6554 = fix$7555.$mini;
v$6553 = (mini$6554([1],dists$6546));
switch (v$6553[0]) { case 0: {var v$6567 = v$6553[1];
var v$6568 = v$6567[0];
south$693 = [0,v$6568];
 break; }default: {south$693 = [1];
} };
var west$701;
var v$5671 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.filter$415(function(s$704){return (SmlPrims.chk_ovf_i32(s$704[1] + 1)) == v$7316;
},displays$684);
var dists$6594 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.map$695(function(v$6595){var v$6596 = v$6595[0];
var v$6597 = v$6595[1];
var v$6598 = v$6595[2];
var t$7566 = v$6596;
var t$7565;
var t$7564;
var t$7563;
var r$6599 = SmlPrims.chk_ovf_i32(v$6597 - v$7316);
t$7563 = (r$6599 * r$6599);
var t$7562;
var r$6600 = SmlPrims.chk_ovf_i32(v$6598 - v$7317);
t$7562 = (r$6600 * r$6600);
t$7564 = (t$7563 * t$7562);
t$7565 = (Math.sqrt(t$7564));
return [t$7566,t$7565];
},v$5671);
var v$6601;
var fix$7567 = {};
fix$7567.$mini = function(v$6603,v$6604){lab$mini: while (true) {switch (v$6603[0]) { case 1: {if (v$6604 == null) {return v$6603;
} else {var v$6605 = v$6604;
var t$7568 = [0,v$6605[0]];
var t$7569 = v$6605[1];
var v$6603 = t$7568;
var v$6604 = t$7569;
continue lab$mini;
};
 break; }default: {if (v$6604 == null) {return v$6603;
} else {var v$6608 = v$6603[1];
var v$6609 = v$6608[1];
var v$6610 = v$6604;
var v$6611 = v$6610[0];
var v$6612 = v$6611[0];
var v$6613 = v$6611[1];
var v$6614 = v$6610[1];
if (v$6613 < v$6609) {var t$7570 = [0,[v$6612,v$6613]];
var t$7571 = v$6614;
var v$6603 = t$7570;
var v$6604 = t$7571;
continue lab$mini;
} else {var t$7572 = v$6603;
var t$7573 = v$6614;
var v$6603 = t$7572;
var v$6604 = t$7573;
continue lab$mini;
};
};
} };
};
};
var mini$6602 = fix$7567.$mini;
v$6601 = (mini$6602([1],dists$6594));
switch (v$6601[0]) { case 0: {var v$6615 = v$6601[1];
var v$6616 = v$6615[0];
west$701 = [0,v$6616];
 break; }default: {west$701 = [1];
} };
var east$709;
var v$5675 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.filter$415(function(s$712){return (SmlPrims.chk_ovf_i32(s$712[1] - 1)) == v$7316;
},displays$684);
var dists$6642 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.map$695(function(v$6643){var v$6644 = v$6643[0];
var v$6645 = v$6643[1];
var v$6646 = v$6643[2];
var t$7578 = v$6644;
var t$7577;
var t$7576;
var t$7575;
var r$6647 = SmlPrims.chk_ovf_i32(v$6645 - v$7316);
t$7575 = (r$6647 * r$6647);
var t$7574;
var r$6648 = SmlPrims.chk_ovf_i32(v$6646 - v$7317);
t$7574 = (r$6648 * r$6648);
t$7576 = (t$7575 * t$7574);
t$7577 = (Math.sqrt(t$7576));
return [t$7578,t$7577];
},v$5675);
var v$6649;
var fix$7579 = {};
fix$7579.$mini = function(v$6651,v$6652){lab$mini: while (true) {switch (v$6651[0]) { case 1: {if (v$6652 == null) {return v$6651;
} else {var v$6653 = v$6652;
var t$7580 = [0,v$6653[0]];
var t$7581 = v$6653[1];
var v$6651 = t$7580;
var v$6652 = t$7581;
continue lab$mini;
};
 break; }default: {if (v$6652 == null) {return v$6651;
} else {var v$6656 = v$6651[1];
var v$6657 = v$6656[1];
var v$6658 = v$6652;
var v$6659 = v$6658[0];
var v$6660 = v$6659[0];
var v$6661 = v$6659[1];
var v$6662 = v$6658[1];
if (v$6661 < v$6657) {var t$7582 = [0,[v$6660,v$6661]];
var t$7583 = v$6662;
var v$6651 = t$7582;
var v$6652 = t$7583;
continue lab$mini;
} else {var t$7584 = v$6651;
var t$7585 = v$6662;
var v$6651 = t$7584;
var v$6652 = t$7585;
continue lab$mini;
};
};
} };
};
};
var mini$6650 = fix$7579.$mini;
v$6649 = (mini$6650([1],dists$6642));
switch (v$6649[0]) { case 0: {var v$6663 = v$6649[1];
var v$6664 = v$6663[0];
east$709 = [0,v$6664];
 break; }default: {east$709 = [1];
} };
return function(v$735){switch (v$735) { case 2: {return north$685;
 break; }case 1: {return south$693;
 break; }case 3: {return east$709;
 break; }default: {return west$701;
} };
};
};
var dsps$813 = [null];
h9AP67nN46MQi5f2NQrocNd$3university$0university$1.load$814 = function(data$817){var v$827;
var v$3241;
var fix$7586 = {};
fix$7586.$loop = function(v$3243,v$3244){lab$loop: while (true) {if (v$3243 == null) {return [dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.rev$680(v$3244),null];
} else {var v$3245 = v$3243;
var v$3246 = v$3245[0];
switch (v$3246) { case "=": {var v$3247 = v$3245[1];
return [dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.rev$680(v$3244),v$3247];
 break; }default: {var t$7587 = v$3245[1];
var t$7588 = [v$3246,v$3244];
var v$3243 = t$7587;
var v$3244 = t$7588;
continue lab$loop;
} };
};
};
};
var loop$3242 = fix$7586.$loop;
var v$7092 = null;
v$3241 = (loop$3242(h7fbaDWer1eD5BCDBpvTxeg$3basis$0String$1.tokens$222(function(c$3249){return c$3249 == 10;
},data$817),v$7092));
v$827 = [v$3241[0],dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.map$695(function(s$3255){var v$3256 = h7fbaDWer1eD5BCDBpvTxeg$3basis$0String$1.tokens$222(function(c$3257){return (c$3257 == 58)?true:(c$3257 == 44);
},s$3255);
if (v$3256 == null) {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to parse display locations in gameMap.txt"];
} else {var v$3262 = v$3256;
var v$3263 = v$3262[1];
if (v$3263 == null) {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to parse display locations in gameMap.txt"];
} else {var v$3264 = v$3263;
var v$3265 = v$3264[1];
if (v$3265 == null) {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to parse display locations in gameMap.txt"];
} else {var v$3266 = v$3265;
if (v$3266[1] == null) {var v$3267 = v$3262[0];
var v$3268 = v$3264[0];
var v$3269 = v$3266[0];
var v$5691 = abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.fromString$460(v$3268);
var v$5692 = abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.fromString$460(v$3269);
switch (v$5691[0]) { case 0: {switch (v$5692[0]) { case 0: {return [v$3267,v$5691[1],v$5692[1]];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to parse integer locations of displays in gameMap.txt"];
} };
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to parse integer locations of displays in gameMap.txt"];
} };
} else {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to parse display locations in gameMap.txt"];
};
};
};
};
},v$3241[1])];
var v$828 = v$827[0];
var v$829 = v$827[1];
(dsps$813[0] = v$829,0);
var t$7606;
var t$7605 = Y5y0a7l58ITwhpccCWLDEa$3basis$0Array2$1.fromList$58;
var t$7604;
var fix$7589 = {};
fix$7589.$loop = function(v$7318,v$7319,v$7320){lab$loop: while (true) {if (v$7318 == null) {return dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.rev$680(v$7319);
} else {var v$3282 = v$7318;
var v$3283 = v$3282[0];
var v$3284 = v$3282[1];
var v$7434 = SmlPrims.chk_ovf_i32(v$7320 + 1);
var t$7600 = v$3284;
var t$7599;
var t$7598;
var t$7590;
var e$6668 = null;
var start$6669 = SmlPrims.chk_ovf_i32(v$3283.length - 1);
var fix$7591 = {};
fix$7591.$rl = function(v$7321,v$7322){lab$rl: while (true) {if (v$7321 >= 0) {var t$7595 = SmlPrims.chk_ovf_i32(v$7321 - 1);
var t$7592;
var v$6674 = v$3283.charCodeAt(v$7321);
var t$7594;
var t$7593;
switch (v$6674) { case 32: {t$7593 = [9];
 break; }case 119: {t$7593 = [6];
 break; }case 61: {t$7593 = [5];
 break; }case 37: {t$7593 = [4];
 break; }case 77: {t$7593 = [13,mkFun$677(v$7321,v$7320,v$829)];
 break; }case 78: {t$7593 = [12,mkFun$677(v$7321,v$7320,v$829)];
 break; }case 97: {t$7593 = [1];
 break; }case 98: {t$7593 = [2];
 break; }case 99: {t$7593 = [0];
 break; }case 42: {t$7593 = [7];
 break; }case 72: {t$7593 = [10];
 break; }case 75: {t$7593 = [11];
 break; }case 79: {t$7593 = [3];
 break; }case 73: {t$7593 = [14];
 break; }case 84: {t$7593 = [8,1];
 break; }case 65: {t$7593 = [8,6];
 break; }case 80: {t$7593 = [8,3];
 break; }case 76: {t$7593 = [8,4];
 break; }case 68: {t$7593 = [8,5];
 break; }case 83: {t$7593 = [8,2];
 break; }case 85: {t$7593 = [8,0];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,("unknown character '" + (h8UYb53cympluUQFSuaSASi$3basis$0Char$1.toString$275(v$6674))) + "' in map"];
} };
t$7594 = [t$7593,v$7322];
t$7592 = t$7594;
var t$7596 = t$7595;
var t$7597 = t$7592;
var v$7321 = t$7596;
var v$7322 = t$7597;
continue lab$rl;
} else {return v$7322;
};
};
};
var rl$6670 = fix$7591.$rl;
t$7590 = (rl$6670(start$6669,e$6668));
t$7598 = [t$7590,v$7319];
t$7599 = t$7598;
var t$7601 = t$7600;
var t$7602 = t$7599;
var t$7603 = v$7434;
var v$7318 = t$7601;
var v$7319 = t$7602;
var v$7320 = t$7603;
continue lab$loop;
};
};
};
var loop$3277 = fix$7589.$loop;
t$7604 = (loop$3277(v$828,null,0));
t$7606 = (t$7605(t$7604));
return [t$7606,dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.map$695(function(v$824){return v$824[0];
},v$829)];
};
h9AP67nN46MQi5f2NQrocNd$3university$0university$1.findClosestDisplay$830 = function(v$7329,v$7330){var displays$3317 = dsps$813[0];
var dists$3318 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.map$695(function(v$3319){var v$3320 = v$3319[0];
var v$3321 = v$3319[1];
var v$3322 = v$3319[2];
var t$7611 = v$3320;
var t$7610;
var t$7609;
var t$7608;
var r$3329 = SmlPrims.chk_ovf_i32(v$3321 - v$7329);
t$7608 = (r$3329 * r$3329);
var t$7607;
var r$3330 = SmlPrims.chk_ovf_i32(v$3322 - v$7330);
t$7607 = (r$3330 * r$3330);
t$7609 = (t$7608 * t$7607);
t$7610 = (Math.sqrt(t$7609));
return [t$7611,t$7610];
},displays$3317);
var v$3331;
var fix$7612 = {};
fix$7612.$mini = function(v$3333,v$3334){lab$mini: while (true) {switch (v$3333[0]) { case 1: {if (v$3334 == null) {return v$3333;
} else {var v$3335 = v$3334;
var t$7613 = [0,v$3335[0]];
var t$7614 = v$3335[1];
var v$3333 = t$7613;
var v$3334 = t$7614;
continue lab$mini;
};
 break; }default: {if (v$3334 == null) {return v$3333;
} else {var v$3338 = v$3333[1];
var v$3339 = v$3338[1];
var v$3340 = v$3334;
var v$3341 = v$3340[0];
var v$3342 = v$3341[0];
var v$3343 = v$3341[1];
var v$3344 = v$3340[1];
if (v$3343 < v$3339) {var t$7615 = [0,[v$3342,v$3343]];
var t$7616 = v$3344;
var v$3333 = t$7615;
var v$3334 = t$7616;
continue lab$mini;
} else {var t$7617 = v$3333;
var t$7618 = v$3344;
var v$3333 = t$7617;
var v$3334 = t$7618;
continue lab$mini;
};
};
} };
};
};
var mini$3332 = fix$7612.$mini;
v$3331 = (mini$3332([1],dists$3318));
switch (v$3331[0]) { case 0: {var v$3345 = v$3331[1];
var v$3346 = v$3345[0];
return [0,v$3346];
 break; }default: {return [1];
} };
};
h9AP67nN46MQi5f2NQrocNd$3university$0university$1.findDisplayState$837 = function(displayContent$840,sid$843){return dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$848){return sid$843 == v$848[1];
},displayContent$840);
};
var screenWidth$852 = SmlPrims.div_i32(1600,2,CompilerInitial.exn$Div$45);
var screenHeight$853 = SmlPrims.div_i32(900,2,CompilerInitial.exn$Div$45);
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<html><head>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<title>Canvas example</title>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<link rel='shortcut icon' type='image/x-icon' href='favicon.ico' />\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<style>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("div#minimapcontainer { position : absolute; width : 100%; }\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161((("canvas#minimap { position : absolute; width : " + ((screenWidth$852 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(screenWidth$852))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(screenWidth$852)))) + "px; }") + "\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161((("canvas#minimapobjects { position : absolute; width : " + ((screenWidth$852 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(screenWidth$852))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(screenWidth$852)))) + "px; }") + "\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("div#floor { position : absolute; width : 100%; height : 100%; background-color : rgb(128,128,128); z-index : -10000000; }\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("div#ceiling { position : absolute; width : 100%; height : 50%; background-color : rgb(96,96,96); z-index : -10000000; }\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161((((("#screen { position : relative; width : " + ((screenWidth$852 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(screenWidth$852))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(screenWidth$852)))) + "px; height : ") + ((screenHeight$853 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(screenHeight$853))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(screenHeight$853)))) + "px; border : 1px solid black; overflow : hidden; }") + "\n");
var t$7627 = EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161;
var t$7626;
var t$7625;
var t$7624;
var t$7623;
var t$7622;
var t$7621 = "div#overlay { position : absolute; display : block; width : ";
var t$7620;
var i$3392 = SmlPrims.chk_ovf_i32(screenWidth$852 - 10);
t$7620 = ((i$3392 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$3392))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$3392)));
t$7622 = (t$7621 + t$7620);
t$7623 = (t$7622 + "px; height : ");
var t$7619;
var i$3394 = SmlPrims.chk_ovf_i32(screenHeight$853 - 10);
t$7619 = ((i$3394 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$3394))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$3394)));
t$7624 = (t$7623 + t$7619);
t$7625 = (t$7624 + "px; padding : 5px; color : white; font-family : lucida console, courier new; font-size : 20px; z-index : 1; }");
t$7626 = (t$7625 + "\n");
t$7627(t$7626);
var t$7635 = EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161;
var t$7634;
var t$7633;
var t$7632;
var t$7631;
var t$7630;
var t$7629 = "div#score { position : relative; display : block; width : ";
var t$7628;
var i$3402 = SmlPrims.chk_ovf_i32(screenWidth$852 - 10);
t$7628 = ((i$3402 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$3402))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$3402)));
t$7630 = (t$7629 + t$7628);
t$7631 = (t$7630 + "px; height : ");
t$7632 = (t$7631 + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(30)));
t$7633 = (t$7632 + "px; padding : 5px; color : blue; font-family : lucida console, courier new; font-size : 20px; z-index : 1; }");
t$7634 = (t$7633 + "\n");
t$7635(t$7634);
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("</style>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("</head><body><center>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<h2>The PLTC Hallway!</h2>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='screen'>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='floor'></div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='ceiling'></div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='overlay'></div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("</div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='score'> </div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='minimapcontainer'>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<canvas id='minimap'></canvas>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<canvas id='minimapobjects'></canvas>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("</div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='log'></div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("</center></body></html>\n");
var v$2539;
try {var t$7642 = h9AP67nN46MQi5f2NQrocNd$3university$0university$1.load$814;
var t$7641;
var file$3437;
var t$7640 = "data/gameMap.txt?_=";
var t$7639;
var t$7638 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.toString$158;
var t$7637;
var v$3440 = SmlPrims.getrealtime();
var v$3441 = v$3440[0];
var v$3442 = v$3440[1];
t$7637 = ((v$3441 - (-2147483648)) + (v$3442 / 1000000.0));
t$7639 = (t$7638(t$7637));
file$3437 = (t$7640 + t$7639);
var r$3443 = SmlPrims.newRequest();
(function(r,m,u,a){return r.open(m,u,a);})(r$3443,"GET",file$3437,false);
z11cymP27JOrM6FBeJkkje$3js$0Js$1.send$652(r$3443,[1]);
var v$3446 = (function(r){return SmlPrims.option(r.responseText);})(r$3443);
switch (v$3446[0]) { case 0: {t$7641 = v$3446[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"serverGet failed on file " + file$3437];
} };
v$2539 = (t$7642(t$7641));
} catch(v$7636) {v$2539 = ((function(exn$2546){var t$7643 = exn$2546;
if (t$7643[0] == sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52) {var msg$2543 = exn$2546[1];
var log$3449;
var v$3451 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"log");
switch (v$3451[0]) { case 0: {log$3449 = v$3451[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'log' in DOM"];
} };
(function(e,a){return e.appendChild(a);})(log$3449,document.createTextNode(msg$2543));
(function(e,a){return e.appendChild(a);})(log$3449,document.createElement("br"));
throw exn$2546;
} else {throw exn$2546;
};
})(v$7636));
};
var v$2540 = v$2539[0];
var v$2541 = v$2539[1];
var init$935 = function(items$938){var screen$939;
var v$3480 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"screen");
switch (v$3480[0]) { case 0: {screen$939 = v$3480[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'screen' in DOM"];
} };
v$2540[0][0];
var v$7010 = v$2540[0][1];
var v$7011 = v$2540[0][2];
if ((0 <= v$7010)?(v$7010 <= 123456789):false) {0;
} else {throw CompilerInitial.exn$Size$51;
};
var spriteMap$943;
var v$5827 = [1];
var t$7651;
var t$7644;
var t$3490 = Array(v$7010);
var fix$7645 = {};
fix$7645.$init = function(v$7331,v$7332){lab$init: while (true) {if (v$7332 >= v$7010) {return 0;
} else {var t$7648 = v$7331;
var t$7647 = v$7332;
var t$7646;
if ((0 <= v$7011)?(v$7011 <= 123456789):false) {0;
} else {throw CompilerInitial.exn$Size$51;
};
t$7646 = (SmlPrims.wordTableInit(v$7011,v$5827));
(t$7648[t$7647] = t$7646,0);
var t$7649 = v$7331;
var t$7650 = SmlPrims.chk_ovf_i32(v$7332 + 1);
var v$7331 = t$7649;
var v$7332 = t$7650;
continue lab$init;
};
};
};
var init$3491 = fix$7645.$init;
init$3491(t$3490,0);
t$7644 = t$3490;
t$7651 = [t$7644,v$7010,v$7011];
spriteMap$943 = [t$7651];
var fix$7652 = {};
fix$7652.$app = function(v$3509){lab$app: while (true) {if (v$3509 == null) {return 0;
} else {var v$3510 = v$3509;
var v$3511 = v$3510[0];
var v$3512 = v$3510[1];
var v$3546 = v$3511[0];
var v$3547 = v$3511[1];
var v$3548 = v$3511[2];
var s$3549;
var pos$3551 = [v$3547,v$3548];
var e$3552 = document.createElement("img");
var t$7655 = e$3552;
var t$7654 = "src";
var t$7653;
switch (v$3546) { case 1: {t$7653 = "tablechairs.png";
 break; }case 6: {t$7653 = (("professor" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32((SmlPrims.mod_i32(SmlPrims.chk_ovf_i32(pos$3551[0] + pos$3551[1]),4,CompilerInitial.exn$Div$45)) + 1)))) + ".gif");
 break; }case 3: {t$7653 = "plantgreen.png";
 break; }case 4: {t$7653 = "lamp.png";
 break; }case 2: {t$7653 = "sink.png";
 break; }case 5: {t$7653 = "desk.png";
 break; }default: {t$7653 = "toilet.png";
} };
(function(fp,s,v){fp[s] = v;})(t$7655,t$7654,t$7653);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(e$3552,"style"),"display","none");
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(e$3552,"style"),"position","absolute");
var v$3555;
switch (v$3546) { case 1: {v$3555 = true;
 break; }case 6: {v$3555 = true;
 break; }case 3: {v$3555 = true;
 break; }case 4: {v$3555 = false;
 break; }case 2: {v$3555 = false;
 break; }case 5: {v$3555 = true;
 break; }default: {v$3555 = true;
} };
var v$3556 = [false];
s$3549 = [v$3555,[true],e$3552,pos$3551,v$3556];
var v$5835 = [0,s$3549];
var v$3559 = spriteMap$943[0][0];
spriteMap$943[0][1];
spriteMap$943[0][2];
var v$3561 = v$3559.length;
if ((0 <= v$3548)?(v$3548 < v$3561):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3564 = v$3559[v$3548];
var v$3565 = v$3564.length;
if ((0 <= v$3547)?(v$3547 < v$3565):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
(v$3564[v$3547] = v$5835,0);
(function(e,a){return e.appendChild(a);})(screen$939,s$3549[2]);
var t$7656 = v$3512;
var v$3509 = t$7656;
continue lab$app;
};
};
};
var app$3508 = fix$7652.$app;
app$3508(items$938);
return spriteMap$943;
};
var MaxRotSpeed$994 = (3.0 * 3.14159265358979323846) / 360.0;
var player$995;
var v$996 = [16.0];
var v$997 = [10.0];
var v$998 = [0.0];
var v$999 = [0.0];
var v$1000 = [0.0];
player$995 = [0.10,v$998,[0.0],v$1000,v$999,v$996,v$997];
var fov$1003 = (60.0 * 3.14159265358979323846) / 180.0;
var fovHalf$1004 = fov$1003 / 2.0;
var twoPI$1005 = 3.14159265358979323846 * 2.0;
var stripWidthR$1007 = 1;
var miniMapScaleR$1009 = 8;
v$2540[0][0];
v$2540[0][1];
var mapWidth$1011 = v$2540[0][2];
var mapWidthR$1012 = mapWidth$1011;
v$2540[0][0];
var mapHeight$1013;
var v$3579 = v$2540[0][1];
v$2540[0][2];
mapHeight$1013 = v$3579;
var mapHeightR$1014 = mapHeight$1013;
var screenWidthR$1015 = screenWidth$852;
var screenHeightR$1016 = screenHeight$853;
var numRays$1017 = SmlPrims.chk_ovf_i32(Math.ceil(screenWidthR$1015 / stripWidthR$1007));
var viewDist$1018 = (screenWidthR$1015 / 2.0) / ((Math.sin(fovHalf$1004)) / (Math.cos(fovHalf$1004)));
var bindKeys$1037 = function(staff$1040,displayContent$1043){(function(f){document.onkeydown = function(e) { e = e || window.event; f(e.keyCode); };})(function(v$1139){switch (v$1139) { case 38: {return (player$995[4][0] = 1.0,0);
 break; }case 40: {return (player$995[4][0] = (-1.0),0);
 break; }case 37: {var rotAcc$1149 = player$995[2];
return (rotAcc$1149[0] > (-0.5))?(rotAcc$1149[0] = (rotAcc$1149[0] - 0.1),0):0;
 break; }case 39: {var rotAcc$1140 = player$995[2];
return (rotAcc$1140[0] < 0.5)?(rotAcc$1140[0] = (rotAcc$1140[0] + 0.1),0):0;
 break; }case 112: {var x$3670 = SmlPrims.chk_ovf_i32(Math.floor(player$995[5][0]));
var y$3671 = SmlPrims.chk_ovf_i32(Math.floor(player$995[6][0]));
var v$3672;
var displays$3676 = dsps$813[0];
var dists$3677 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.map$695(function(v$3678){var v$3679 = v$3678[0];
var v$3680 = v$3678[1];
var v$3681 = v$3678[2];
var t$7765 = v$3679;
var t$7764;
var t$7763;
var t$7762;
var r$3682 = SmlPrims.chk_ovf_i32(v$3680 - x$3670);
t$7762 = (r$3682 * r$3682);
var t$7761;
var r$3683 = SmlPrims.chk_ovf_i32(v$3681 - y$3671);
t$7761 = (r$3683 * r$3683);
t$7763 = (t$7762 * t$7761);
t$7764 = (Math.sqrt(t$7763));
return [t$7765,t$7764];
},displays$3676);
var v$3684;
var fix$7766 = {};
fix$7766.$mini = function(v$3686,v$3687){lab$mini: while (true) {switch (v$3686[0]) { case 1: {if (v$3687 == null) {return v$3686;
} else {var v$3688 = v$3687;
var t$7767 = [0,v$3688[0]];
var t$7768 = v$3688[1];
var v$3686 = t$7767;
var v$3687 = t$7768;
continue lab$mini;
};
 break; }default: {if (v$3687 == null) {return v$3686;
} else {var v$3691 = v$3686[1];
var v$3692 = v$3691[1];
var v$3693 = v$3687;
var v$3694 = v$3693[0];
var v$3695 = v$3694[0];
var v$3696 = v$3694[1];
var v$3697 = v$3693[1];
if (v$3696 < v$3692) {var t$7769 = [0,[v$3695,v$3696]];
var t$7770 = v$3697;
var v$3686 = t$7769;
var v$3687 = t$7770;
continue lab$mini;
} else {var t$7771 = v$3686;
var t$7772 = v$3697;
var v$3686 = t$7771;
var v$3687 = t$7772;
continue lab$mini;
};
};
} };
};
};
var mini$3685 = fix$7766.$mini;
v$3684 = (mini$3685([1],dists$3677));
switch (v$3684[0]) { case 0: {var v$3698 = v$3684[1];
var v$3699 = v$3698[0];
v$3672 = [0,v$3699];
 break; }default: {v$3672 = [1];
} };
switch (v$3672[0]) { case 1: {return 0;
 break; }default: {var v$3700 = v$3672[1];
var v$3701 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$3704){return v$3700 == v$3704[1];
},displayContent$1043);
switch (v$3701[0]) { case 1: {return 0;
 break; }default: {var v$6676 = v$3701[1];
var v$6677 = v$6676[1];
var v$6678 = v$6676[2];
var v$6679 = v$6676[0];
var did$6680 = v$6679[0];
var v$6681;
var v$6682 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$6683){return v$6683[1] == v$6677;
},staff$1040);
switch (v$6682[0]) { case 1: {v$6681 = [1];
 break; }default: {var v$6684 = v$6682[1];
var v$6685 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$6687){return v$6687[0] == did$6680;
},v$6684[4]);
switch (v$6685[0]) { case 1: {v$6681 = [1];
 break; }default: {v$6681 = [0,v$6685[1][2]];
} };
} };
switch (v$6681[0]) { case 0: {var v$6688 = v$6681[1];
return (v$6678[0] = (SmlPrims.mod_i32(SmlPrims.chk_ovf_i32((SmlPrims.chk_ovf_i32(v$6678[0] - 1)) + v$6688),v$6688,CompilerInitial.exn$Div$45)),0);
 break; }default: {return 0;
} };
} };
} };
 break; }case 80: {var x$3733 = SmlPrims.chk_ovf_i32(Math.floor(player$995[5][0]));
var y$3734 = SmlPrims.chk_ovf_i32(Math.floor(player$995[6][0]));
var v$3735;
var displays$3739 = dsps$813[0];
var dists$3740 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.map$695(function(v$3741){var v$3742 = v$3741[0];
var v$3743 = v$3741[1];
var v$3744 = v$3741[2];
var t$7753 = v$3742;
var t$7752;
var t$7751;
var t$7750;
var r$3745 = SmlPrims.chk_ovf_i32(v$3743 - x$3733);
t$7750 = (r$3745 * r$3745);
var t$7749;
var r$3746 = SmlPrims.chk_ovf_i32(v$3744 - y$3734);
t$7749 = (r$3746 * r$3746);
t$7751 = (t$7750 * t$7749);
t$7752 = (Math.sqrt(t$7751));
return [t$7753,t$7752];
},displays$3739);
var v$3747;
var fix$7754 = {};
fix$7754.$mini = function(v$3749,v$3750){lab$mini: while (true) {switch (v$3749[0]) { case 1: {if (v$3750 == null) {return v$3749;
} else {var v$3751 = v$3750;
var t$7755 = [0,v$3751[0]];
var t$7756 = v$3751[1];
var v$3749 = t$7755;
var v$3750 = t$7756;
continue lab$mini;
};
 break; }default: {if (v$3750 == null) {return v$3749;
} else {var v$3754 = v$3749[1];
var v$3755 = v$3754[1];
var v$3756 = v$3750;
var v$3757 = v$3756[0];
var v$3758 = v$3757[0];
var v$3759 = v$3757[1];
var v$3760 = v$3756[1];
if (v$3759 < v$3755) {var t$7757 = [0,[v$3758,v$3759]];
var t$7758 = v$3760;
var v$3749 = t$7757;
var v$3750 = t$7758;
continue lab$mini;
} else {var t$7759 = v$3749;
var t$7760 = v$3760;
var v$3749 = t$7759;
var v$3750 = t$7760;
continue lab$mini;
};
};
} };
};
};
var mini$3748 = fix$7754.$mini;
v$3747 = (mini$3748([1],dists$3740));
switch (v$3747[0]) { case 0: {var v$3761 = v$3747[1];
var v$3762 = v$3761[0];
v$3735 = [0,v$3762];
 break; }default: {v$3735 = [1];
} };
switch (v$3735[0]) { case 1: {return 0;
 break; }default: {var v$3763 = v$3735[1];
var v$3764 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$3767){return v$3763 == v$3767[1];
},displayContent$1043);
switch (v$3764[0]) { case 1: {return 0;
 break; }default: {var v$6689 = v$3764[1];
var v$6690 = v$6689[1];
var v$6691 = v$6689[2];
var v$6692 = v$6689[0];
var did$6693 = v$6692[0];
var v$6694;
var v$6695 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$6696){return v$6696[1] == v$6690;
},staff$1040);
switch (v$6695[0]) { case 1: {v$6694 = [1];
 break; }default: {var v$6697 = v$6695[1];
var v$6698 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$6700){return v$6700[0] == did$6693;
},v$6697[4]);
switch (v$6698[0]) { case 1: {v$6694 = [1];
 break; }default: {v$6694 = [0,v$6698[1][2]];
} };
} };
switch (v$6694[0]) { case 0: {var v$6701 = v$6694[1];
return (v$6691[0] = (SmlPrims.mod_i32(SmlPrims.chk_ovf_i32((SmlPrims.chk_ovf_i32(v$6691[0] - 1)) + v$6701),v$6701,CompilerInitial.exn$Div$45)),0);
 break; }default: {return 0;
} };
} };
} };
 break; }case 110: {var x$3796 = SmlPrims.chk_ovf_i32(Math.floor(player$995[5][0]));
var y$3797 = SmlPrims.chk_ovf_i32(Math.floor(player$995[6][0]));
var v$3798;
var displays$3802 = dsps$813[0];
var dists$3803 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.map$695(function(v$3804){var v$3805 = v$3804[0];
var v$3806 = v$3804[1];
var v$3807 = v$3804[2];
var t$7741 = v$3805;
var t$7740;
var t$7739;
var t$7738;
var r$3808 = SmlPrims.chk_ovf_i32(v$3806 - x$3796);
t$7738 = (r$3808 * r$3808);
var t$7737;
var r$3809 = SmlPrims.chk_ovf_i32(v$3807 - y$3797);
t$7737 = (r$3809 * r$3809);
t$7739 = (t$7738 * t$7737);
t$7740 = (Math.sqrt(t$7739));
return [t$7741,t$7740];
},displays$3802);
var v$3810;
var fix$7742 = {};
fix$7742.$mini = function(v$3812,v$3813){lab$mini: while (true) {switch (v$3812[0]) { case 1: {if (v$3813 == null) {return v$3812;
} else {var v$3814 = v$3813;
var t$7743 = [0,v$3814[0]];
var t$7744 = v$3814[1];
var v$3812 = t$7743;
var v$3813 = t$7744;
continue lab$mini;
};
 break; }default: {if (v$3813 == null) {return v$3812;
} else {var v$3817 = v$3812[1];
var v$3818 = v$3817[1];
var v$3819 = v$3813;
var v$3820 = v$3819[0];
var v$3821 = v$3820[0];
var v$3822 = v$3820[1];
var v$3823 = v$3819[1];
if (v$3822 < v$3818) {var t$7745 = [0,[v$3821,v$3822]];
var t$7746 = v$3823;
var v$3812 = t$7745;
var v$3813 = t$7746;
continue lab$mini;
} else {var t$7747 = v$3812;
var t$7748 = v$3823;
var v$3812 = t$7747;
var v$3813 = t$7748;
continue lab$mini;
};
};
} };
};
};
var mini$3811 = fix$7742.$mini;
v$3810 = (mini$3811([1],dists$3803));
switch (v$3810[0]) { case 0: {var v$3824 = v$3810[1];
var v$3825 = v$3824[0];
v$3798 = [0,v$3825];
 break; }default: {v$3798 = [1];
} };
switch (v$3798[0]) { case 1: {return 0;
 break; }default: {var v$3826 = v$3798[1];
var v$3827 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$3830){return v$3826 == v$3830[1];
},displayContent$1043);
switch (v$3827[0]) { case 1: {return 0;
 break; }default: {var v$6702 = v$3827[1];
var v$6703 = v$6702[1];
var v$6704 = v$6702[2];
var v$6705 = v$6702[0];
var did$6706 = v$6705[0];
var v$6707;
var v$6708 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$6709){return v$6709[1] == v$6703;
},staff$1040);
switch (v$6708[0]) { case 1: {v$6707 = [1];
 break; }default: {var v$6710 = v$6708[1];
var v$6711 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$6713){return v$6713[0] == did$6706;
},v$6710[4]);
switch (v$6711[0]) { case 1: {v$6707 = [1];
 break; }default: {v$6707 = [0,v$6711[1][2]];
} };
} };
switch (v$6707[0]) { case 0: {var v$6714 = v$6707[1];
return (v$6704[0] = (SmlPrims.mod_i32(SmlPrims.chk_ovf_i32(v$6704[0] + 1),v$6714,CompilerInitial.exn$Div$45)),0);
 break; }default: {return 0;
} };
} };
} };
 break; }case 78: {var x$3859 = SmlPrims.chk_ovf_i32(Math.floor(player$995[5][0]));
var y$3860 = SmlPrims.chk_ovf_i32(Math.floor(player$995[6][0]));
var v$3861;
var displays$3865 = dsps$813[0];
var dists$3866 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.map$695(function(v$3867){var v$3868 = v$3867[0];
var v$3869 = v$3867[1];
var v$3870 = v$3867[2];
var t$7729 = v$3868;
var t$7728;
var t$7727;
var t$7726;
var r$3871 = SmlPrims.chk_ovf_i32(v$3869 - x$3859);
t$7726 = (r$3871 * r$3871);
var t$7725;
var r$3872 = SmlPrims.chk_ovf_i32(v$3870 - y$3860);
t$7725 = (r$3872 * r$3872);
t$7727 = (t$7726 * t$7725);
t$7728 = (Math.sqrt(t$7727));
return [t$7729,t$7728];
},displays$3865);
var v$3873;
var fix$7730 = {};
fix$7730.$mini = function(v$3875,v$3876){lab$mini: while (true) {switch (v$3875[0]) { case 1: {if (v$3876 == null) {return v$3875;
} else {var v$3877 = v$3876;
var t$7731 = [0,v$3877[0]];
var t$7732 = v$3877[1];
var v$3875 = t$7731;
var v$3876 = t$7732;
continue lab$mini;
};
 break; }default: {if (v$3876 == null) {return v$3875;
} else {var v$3880 = v$3875[1];
var v$3881 = v$3880[1];
var v$3882 = v$3876;
var v$3883 = v$3882[0];
var v$3884 = v$3883[0];
var v$3885 = v$3883[1];
var v$3886 = v$3882[1];
if (v$3885 < v$3881) {var t$7733 = [0,[v$3884,v$3885]];
var t$7734 = v$3886;
var v$3875 = t$7733;
var v$3876 = t$7734;
continue lab$mini;
} else {var t$7735 = v$3875;
var t$7736 = v$3886;
var v$3875 = t$7735;
var v$3876 = t$7736;
continue lab$mini;
};
};
} };
};
};
var mini$3874 = fix$7730.$mini;
v$3873 = (mini$3874([1],dists$3866));
switch (v$3873[0]) { case 0: {var v$3887 = v$3873[1];
var v$3888 = v$3887[0];
v$3861 = [0,v$3888];
 break; }default: {v$3861 = [1];
} };
switch (v$3861[0]) { case 1: {return 0;
 break; }default: {var v$3889 = v$3861[1];
var v$3890 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$3893){return v$3889 == v$3893[1];
},displayContent$1043);
switch (v$3890[0]) { case 1: {return 0;
 break; }default: {var v$6715 = v$3890[1];
var v$6716 = v$6715[1];
var v$6717 = v$6715[2];
var v$6718 = v$6715[0];
var did$6719 = v$6718[0];
var v$6720;
var v$6721 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$6722){return v$6722[1] == v$6716;
},staff$1040);
switch (v$6721[0]) { case 1: {v$6720 = [1];
 break; }default: {var v$6723 = v$6721[1];
var v$6724 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$6726){return v$6726[0] == did$6719;
},v$6723[4]);
switch (v$6724[0]) { case 1: {v$6720 = [1];
 break; }default: {v$6720 = [0,v$6724[1][2]];
} };
} };
switch (v$6720[0]) { case 0: {var v$6727 = v$6720[1];
return (v$6717[0] = (SmlPrims.mod_i32(SmlPrims.chk_ovf_i32(v$6717[0] + 1),v$6727,CompilerInitial.exn$Div$45)),0);
 break; }default: {return 0;
} };
} };
} };
 break; }case 32: {var x$3922 = SmlPrims.chk_ovf_i32(Math.floor(player$995[5][0]));
var y$3923 = SmlPrims.chk_ovf_i32(Math.floor(player$995[6][0]));
var v$3924;
var displays$3928 = dsps$813[0];
var dists$3929 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.map$695(function(v$3930){var v$3931 = v$3930[0];
var v$3932 = v$3930[1];
var v$3933 = v$3930[2];
var t$7717 = v$3931;
var t$7716;
var t$7715;
var t$7714;
var r$3934 = SmlPrims.chk_ovf_i32(v$3932 - x$3922);
t$7714 = (r$3934 * r$3934);
var t$7713;
var r$3935 = SmlPrims.chk_ovf_i32(v$3933 - y$3923);
t$7713 = (r$3935 * r$3935);
t$7715 = (t$7714 * t$7713);
t$7716 = (Math.sqrt(t$7715));
return [t$7717,t$7716];
},displays$3928);
var v$3936;
var fix$7718 = {};
fix$7718.$mini = function(v$3938,v$3939){lab$mini: while (true) {switch (v$3938[0]) { case 1: {if (v$3939 == null) {return v$3938;
} else {var v$3940 = v$3939;
var t$7719 = [0,v$3940[0]];
var t$7720 = v$3940[1];
var v$3938 = t$7719;
var v$3939 = t$7720;
continue lab$mini;
};
 break; }default: {if (v$3939 == null) {return v$3938;
} else {var v$3943 = v$3938[1];
var v$3944 = v$3943[1];
var v$3945 = v$3939;
var v$3946 = v$3945[0];
var v$3947 = v$3946[0];
var v$3948 = v$3946[1];
var v$3949 = v$3945[1];
if (v$3948 < v$3944) {var t$7721 = [0,[v$3947,v$3948]];
var t$7722 = v$3949;
var v$3938 = t$7721;
var v$3939 = t$7722;
continue lab$mini;
} else {var t$7723 = v$3938;
var t$7724 = v$3949;
var v$3938 = t$7723;
var v$3939 = t$7724;
continue lab$mini;
};
};
} };
};
};
var mini$3937 = fix$7718.$mini;
v$3936 = (mini$3937([1],dists$3929));
switch (v$3936[0]) { case 0: {var v$3950 = v$3936[1];
var v$3951 = v$3950[0];
v$3924 = [0,v$3951];
 break; }default: {v$3924 = [1];
} };
switch (v$3924[0]) { case 1: {return 0;
 break; }default: {var v$3952 = v$3924[1];
var v$3953 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$3956){return v$3952 == v$3956[1];
},displayContent$1043);
switch (v$3953[0]) { case 1: {return 0;
 break; }default: {var v$6728 = v$3953[1];
var v$6729 = v$6728[1];
var v$6730 = v$6728[2];
var v$6731 = v$6728[0];
var did$6732 = v$6731[0];
var v$6733;
var v$6734 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$6735){return v$6735[1] == v$6729;
},staff$1040);
switch (v$6734[0]) { case 1: {v$6733 = [1];
 break; }default: {var v$6736 = v$6734[1];
var v$6737 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$6739){return v$6739[0] == did$6732;
},v$6736[4]);
switch (v$6737[0]) { case 1: {v$6733 = [1];
 break; }default: {v$6733 = [0,v$6737[1][2]];
} };
} };
switch (v$6733[0]) { case 0: {var v$6740 = v$6733[1];
return (v$6730[0] = (SmlPrims.mod_i32(SmlPrims.chk_ovf_i32(v$6730[0] + 1),v$6740,CompilerInitial.exn$Div$45)),0);
 break; }default: {return 0;
} };
} };
} };
 break; }case 97: {var x$3985 = SmlPrims.chk_ovf_i32(Math.floor(player$995[5][0]));
var y$3986 = SmlPrims.chk_ovf_i32(Math.floor(player$995[6][0]));
var v$3987;
var displays$3991 = dsps$813[0];
var dists$3992 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.map$695(function(v$3993){var v$3994 = v$3993[0];
var v$3995 = v$3993[1];
var v$3996 = v$3993[2];
var t$7703 = v$3994;
var t$7702;
var t$7701;
var t$7700;
var r$3997 = SmlPrims.chk_ovf_i32(v$3995 - x$3985);
t$7700 = (r$3997 * r$3997);
var t$7699;
var r$3998 = SmlPrims.chk_ovf_i32(v$3996 - y$3986);
t$7699 = (r$3998 * r$3998);
t$7701 = (t$7700 * t$7699);
t$7702 = (Math.sqrt(t$7701));
return [t$7703,t$7702];
},displays$3991);
var v$3999;
var fix$7704 = {};
fix$7704.$mini = function(v$4001,v$4002){lab$mini: while (true) {switch (v$4001[0]) { case 1: {if (v$4002 == null) {return v$4001;
} else {var v$4003 = v$4002;
var t$7705 = [0,v$4003[0]];
var t$7706 = v$4003[1];
var v$4001 = t$7705;
var v$4002 = t$7706;
continue lab$mini;
};
 break; }default: {if (v$4002 == null) {return v$4001;
} else {var v$4006 = v$4001[1];
var v$4007 = v$4006[1];
var v$4008 = v$4002;
var v$4009 = v$4008[0];
var v$4010 = v$4009[0];
var v$4011 = v$4009[1];
var v$4012 = v$4008[1];
if (v$4011 < v$4007) {var t$7707 = [0,[v$4010,v$4011]];
var t$7708 = v$4012;
var v$4001 = t$7707;
var v$4002 = t$7708;
continue lab$mini;
} else {var t$7709 = v$4001;
var t$7710 = v$4012;
var v$4001 = t$7709;
var v$4002 = t$7710;
continue lab$mini;
};
};
} };
};
};
var mini$4000 = fix$7704.$mini;
v$3999 = (mini$4000([1],dists$3992));
switch (v$3999[0]) { case 0: {var v$4013 = v$3999[1];
var v$4014 = v$4013[0];
v$3987 = [0,v$4014];
 break; }default: {v$3987 = [1];
} };
switch (v$3987[0]) { case 1: {return 0;
 break; }default: {var v$4015 = v$3987[1];
var v$4016 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$4019){return v$4015 == v$4019[1];
},displayContent$1043);
switch (v$4016[0]) { case 1: {return 0;
 break; }default: {var x$6741 = v$4016[1];
var v$6742 = x$6741[1];
var v$6743 = x$6741[2];
var v$6744 = x$6741[0];
var v$6745 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$6746){return v$6746[1] == v$6742;
},staff$1040);
switch (v$6745[0]) { case 1: {return 0;
 break; }default: {var v$6747 = v$6745[1];
var v$6748 = v$6747[4];
var slides$6749 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.rev$680(v$6748);
var did$6750 = v$6744[0];
var fix$7711 = {};
fix$7711.$loop = function(v$6752){lab$loop: while (true) {if (v$6752 == null) {return (slides$6749 == null)?0:(v$6744[0] = slides$6749[0][0],0);
} else {var v$6753 = v$6752;
var v$6754 = v$6753[1];
if (v$6754 == null) {return (slides$6749 == null)?0:(v$6744[0] = slides$6749[0][0],0);
} else {var v$6755 = v$6753[0];
var v$6756 = v$6754;
var v$6757 = v$6756[0];
var v$6758 = v$6756[1];
if (v$6755[0] == did$6750) {return (v$6744[0] = v$6757[0],0);
} else {var t$7712 = [v$6757,v$6758];
var v$6752 = t$7712;
continue lab$loop;
};
};
};
};
};
var loop$6751 = fix$7711.$loop;
loop$6751(slides$6749);
return (v$6743[0] = 0,0);
} };
} };
} };
 break; }case 65: {var x$4059 = SmlPrims.chk_ovf_i32(Math.floor(player$995[5][0]));
var y$4060 = SmlPrims.chk_ovf_i32(Math.floor(player$995[6][0]));
var v$4061;
var displays$4065 = dsps$813[0];
var dists$4066 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.map$695(function(v$4067){var v$4068 = v$4067[0];
var v$4069 = v$4067[1];
var v$4070 = v$4067[2];
var t$7689 = v$4068;
var t$7688;
var t$7687;
var t$7686;
var r$4071 = SmlPrims.chk_ovf_i32(v$4069 - x$4059);
t$7686 = (r$4071 * r$4071);
var t$7685;
var r$4072 = SmlPrims.chk_ovf_i32(v$4070 - y$4060);
t$7685 = (r$4072 * r$4072);
t$7687 = (t$7686 * t$7685);
t$7688 = (Math.sqrt(t$7687));
return [t$7689,t$7688];
},displays$4065);
var v$4073;
var fix$7690 = {};
fix$7690.$mini = function(v$4075,v$4076){lab$mini: while (true) {switch (v$4075[0]) { case 1: {if (v$4076 == null) {return v$4075;
} else {var v$4077 = v$4076;
var t$7691 = [0,v$4077[0]];
var t$7692 = v$4077[1];
var v$4075 = t$7691;
var v$4076 = t$7692;
continue lab$mini;
};
 break; }default: {if (v$4076 == null) {return v$4075;
} else {var v$4080 = v$4075[1];
var v$4081 = v$4080[1];
var v$4082 = v$4076;
var v$4083 = v$4082[0];
var v$4084 = v$4083[0];
var v$4085 = v$4083[1];
var v$4086 = v$4082[1];
if (v$4085 < v$4081) {var t$7693 = [0,[v$4084,v$4085]];
var t$7694 = v$4086;
var v$4075 = t$7693;
var v$4076 = t$7694;
continue lab$mini;
} else {var t$7695 = v$4075;
var t$7696 = v$4086;
var v$4075 = t$7695;
var v$4076 = t$7696;
continue lab$mini;
};
};
} };
};
};
var mini$4074 = fix$7690.$mini;
v$4073 = (mini$4074([1],dists$4066));
switch (v$4073[0]) { case 0: {var v$4087 = v$4073[1];
var v$4088 = v$4087[0];
v$4061 = [0,v$4088];
 break; }default: {v$4061 = [1];
} };
switch (v$4061[0]) { case 1: {return 0;
 break; }default: {var v$4089 = v$4061[1];
var v$4090 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$4093){return v$4089 == v$4093[1];
},displayContent$1043);
switch (v$4090[0]) { case 1: {return 0;
 break; }default: {var x$6759 = v$4090[1];
var v$6760 = x$6759[1];
var v$6761 = x$6759[2];
var v$6762 = x$6759[0];
var v$6763 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$6764){return v$6764[1] == v$6760;
},staff$1040);
switch (v$6763[0]) { case 1: {return 0;
 break; }default: {var v$6765 = v$6763[1];
var v$6766 = v$6765[4];
var slides$6767 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.rev$680(v$6766);
var did$6768 = v$6762[0];
var fix$7697 = {};
fix$7697.$loop = function(v$6770){lab$loop: while (true) {if (v$6770 == null) {return (slides$6767 == null)?0:(v$6762[0] = slides$6767[0][0],0);
} else {var v$6771 = v$6770;
var v$6772 = v$6771[1];
if (v$6772 == null) {return (slides$6767 == null)?0:(v$6762[0] = slides$6767[0][0],0);
} else {var v$6773 = v$6771[0];
var v$6774 = v$6772;
var v$6775 = v$6774[0];
var v$6776 = v$6774[1];
if (v$6773[0] == did$6768) {return (v$6762[0] = v$6775[0],0);
} else {var t$7698 = [v$6775,v$6776];
var v$6770 = t$7698;
continue lab$loop;
};
};
};
};
};
var loop$6769 = fix$7697.$loop;
loop$6769(slides$6767);
return (v$6761[0] = 0,0);
} };
} };
} };
 break; }case 115: {var x$4133 = SmlPrims.chk_ovf_i32(Math.floor(player$995[5][0]));
var y$4134 = SmlPrims.chk_ovf_i32(Math.floor(player$995[6][0]));
var v$4135;
var displays$4139 = dsps$813[0];
var dists$4140 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.map$695(function(v$4141){var v$4142 = v$4141[0];
var v$4143 = v$4141[1];
var v$4144 = v$4141[2];
var t$7675 = v$4142;
var t$7674;
var t$7673;
var t$7672;
var r$4145 = SmlPrims.chk_ovf_i32(v$4143 - x$4133);
t$7672 = (r$4145 * r$4145);
var t$7671;
var r$4146 = SmlPrims.chk_ovf_i32(v$4144 - y$4134);
t$7671 = (r$4146 * r$4146);
t$7673 = (t$7672 * t$7671);
t$7674 = (Math.sqrt(t$7673));
return [t$7675,t$7674];
},displays$4139);
var v$4147;
var fix$7676 = {};
fix$7676.$mini = function(v$4149,v$4150){lab$mini: while (true) {switch (v$4149[0]) { case 1: {if (v$4150 == null) {return v$4149;
} else {var v$4151 = v$4150;
var t$7677 = [0,v$4151[0]];
var t$7678 = v$4151[1];
var v$4149 = t$7677;
var v$4150 = t$7678;
continue lab$mini;
};
 break; }default: {if (v$4150 == null) {return v$4149;
} else {var v$4154 = v$4149[1];
var v$4155 = v$4154[1];
var v$4156 = v$4150;
var v$4157 = v$4156[0];
var v$4158 = v$4157[0];
var v$4159 = v$4157[1];
var v$4160 = v$4156[1];
if (v$4159 < v$4155) {var t$7679 = [0,[v$4158,v$4159]];
var t$7680 = v$4160;
var v$4149 = t$7679;
var v$4150 = t$7680;
continue lab$mini;
} else {var t$7681 = v$4149;
var t$7682 = v$4160;
var v$4149 = t$7681;
var v$4150 = t$7682;
continue lab$mini;
};
};
} };
};
};
var mini$4148 = fix$7676.$mini;
v$4147 = (mini$4148([1],dists$4140));
switch (v$4147[0]) { case 0: {var v$4161 = v$4147[1];
var v$4162 = v$4161[0];
v$4135 = [0,v$4162];
 break; }default: {v$4135 = [1];
} };
switch (v$4135[0]) { case 1: {return 0;
 break; }default: {var v$4163 = v$4135[1];
var v$4164 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$4167){return v$4163 == v$4167[1];
},displayContent$1043);
switch (v$4164[0]) { case 1: {return 0;
 break; }default: {var x$6777 = v$4164[1];
var v$6778 = x$6777[1];
var v$6779 = x$6777[2];
var v$6780 = x$6777[0];
var v$6781 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$6782){return v$6782[1] == v$6778;
},staff$1040);
switch (v$6781[0]) { case 1: {return 0;
 break; }default: {var v$6783 = v$6781[1];
var v$6784 = v$6783[4];
var did$6785 = v$6780[0];
var fix$7683 = {};
fix$7683.$loop = function(v$6787){lab$loop: while (true) {if (v$6787 == null) {return (v$6784 == null)?0:(v$6780[0] = v$6784[0][0],0);
} else {var v$6788 = v$6787;
var v$6789 = v$6788[1];
if (v$6789 == null) {return (v$6784 == null)?0:(v$6780[0] = v$6784[0][0],0);
} else {var v$6790 = v$6788[0];
var v$6791 = v$6789;
var v$6792 = v$6791[0];
var v$6793 = v$6791[1];
if (v$6790[0] == did$6785) {return (v$6780[0] = v$6792[0],0);
} else {var t$7684 = [v$6792,v$6793];
var v$6787 = t$7684;
continue lab$loop;
};
};
};
};
};
var loop$6786 = fix$7683.$loop;
loop$6786(v$6784);
return (v$6779[0] = 0,0);
} };
} };
} };
 break; }case 83: {var x$4209 = SmlPrims.chk_ovf_i32(Math.floor(player$995[5][0]));
var y$4210 = SmlPrims.chk_ovf_i32(Math.floor(player$995[6][0]));
var v$4211;
var displays$4215 = dsps$813[0];
var dists$4216 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.map$695(function(v$4217){var v$4218 = v$4217[0];
var v$4219 = v$4217[1];
var v$4220 = v$4217[2];
var t$7661 = v$4218;
var t$7660;
var t$7659;
var t$7658;
var r$4221 = SmlPrims.chk_ovf_i32(v$4219 - x$4209);
t$7658 = (r$4221 * r$4221);
var t$7657;
var r$4222 = SmlPrims.chk_ovf_i32(v$4220 - y$4210);
t$7657 = (r$4222 * r$4222);
t$7659 = (t$7658 * t$7657);
t$7660 = (Math.sqrt(t$7659));
return [t$7661,t$7660];
},displays$4215);
var v$4223;
var fix$7662 = {};
fix$7662.$mini = function(v$4225,v$4226){lab$mini: while (true) {switch (v$4225[0]) { case 1: {if (v$4226 == null) {return v$4225;
} else {var v$4227 = v$4226;
var t$7663 = [0,v$4227[0]];
var t$7664 = v$4227[1];
var v$4225 = t$7663;
var v$4226 = t$7664;
continue lab$mini;
};
 break; }default: {if (v$4226 == null) {return v$4225;
} else {var v$4230 = v$4225[1];
var v$4231 = v$4230[1];
var v$4232 = v$4226;
var v$4233 = v$4232[0];
var v$4234 = v$4233[0];
var v$4235 = v$4233[1];
var v$4236 = v$4232[1];
if (v$4235 < v$4231) {var t$7665 = [0,[v$4234,v$4235]];
var t$7666 = v$4236;
var v$4225 = t$7665;
var v$4226 = t$7666;
continue lab$mini;
} else {var t$7667 = v$4225;
var t$7668 = v$4236;
var v$4225 = t$7667;
var v$4226 = t$7668;
continue lab$mini;
};
};
} };
};
};
var mini$4224 = fix$7662.$mini;
v$4223 = (mini$4224([1],dists$4216));
switch (v$4223[0]) { case 0: {var v$4237 = v$4223[1];
var v$4238 = v$4237[0];
v$4211 = [0,v$4238];
 break; }default: {v$4211 = [1];
} };
switch (v$4211[0]) { case 1: {return 0;
 break; }default: {var v$4239 = v$4211[1];
var v$4240 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$4243){return v$4239 == v$4243[1];
},displayContent$1043);
switch (v$4240[0]) { case 1: {return 0;
 break; }default: {var x$6794 = v$4240[1];
var v$6795 = x$6794[1];
var v$6796 = x$6794[2];
var v$6797 = x$6794[0];
var v$6798 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$6799){return v$6799[1] == v$6795;
},staff$1040);
switch (v$6798[0]) { case 1: {return 0;
 break; }default: {var v$6800 = v$6798[1];
var v$6801 = v$6800[4];
var did$6802 = v$6797[0];
var fix$7669 = {};
fix$7669.$loop = function(v$6804){lab$loop: while (true) {if (v$6804 == null) {return (v$6801 == null)?0:(v$6797[0] = v$6801[0][0],0);
} else {var v$6805 = v$6804;
var v$6806 = v$6805[1];
if (v$6806 == null) {return (v$6801 == null)?0:(v$6797[0] = v$6801[0][0],0);
} else {var v$6807 = v$6805[0];
var v$6808 = v$6806;
var v$6809 = v$6808[0];
var v$6810 = v$6808[1];
if (v$6807[0] == did$6802) {return (v$6797[0] = v$6809[0],0);
} else {var t$7670 = [v$6809,v$6810];
var v$6804 = t$7670;
continue lab$loop;
};
};
};
};
};
var loop$6803 = fix$7669.$loop;
loop$6803(v$6801);
return (v$6796[0] = 0,0);
} };
} };
} };
 break; }default: {return 0;
} };
});
(function(f){document.onkeyup = function(e) { e = e || window.event; f(e.keyCode); };})(function(v$1082){switch (v$1082) { case 38: {return (player$995[4][0] = 0.0,0);
 break; }case 40: {return (player$995[4][0] = 0.0,0);
 break; }case 37: {(player$995[3][0] = 0.0,0);
return (player$995[2][0] = 0.0,0);
 break; }case 39: {(player$995[3][0] = 0.0,0);
return (player$995[2][0] = 0.0,0);
 break; }default: {return 0;
} };
});
return 0;
};
var checkCollision$1217 = function(spriteMap$1220,v$7335,v$7336,v$7337,v$7338,v$7339){if ((v$7338 < 0.0)?true:((v$7338 >= mapHeightR$1014)?true:((v$7337 < 0.0)?true:(v$7337 >= mapWidthR$1012)))) {return [v$7335,v$7336];
} else {var blockX$1232 = SmlPrims.chk_ovf_i32(Math.floor(v$7337));
var blockY$1233 = SmlPrims.chk_ovf_i32(Math.floor(v$7338));
var t$7773;
if ((blockY$1233 < 0.0)?true:((blockY$1233 >= mapHeightR$1014)?true:((blockX$1232 < 0.0)?true:(blockX$1232 >= mapWidthR$1012)))) {t$7773 = true;
} else {var Y$6814 = SmlPrims.chk_ovf_i32(Math.floor(blockY$1233));
var X$6815 = SmlPrims.chk_ovf_i32(Math.floor(blockX$1232));
var wt$6816;
var v$6817 = v$2540[0][0];
v$2540[0][1];
v$2540[0][2];
var v$6818 = v$6817.length;
if ((0 <= Y$6814)?(Y$6814 < v$6818):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$6819 = v$6817[Y$6814];
var v$6820 = v$6819.length;
if ((0 <= X$6815)?(X$6815 < v$6820):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$6816 = v$6819[X$6815];
var t$7774;
switch (wt$6816[0]) { case 9: {t$7774 = false;
 break; }case 8: {t$7774 = false;
 break; }default: {t$7774 = true;
} };
if (t$7774) {t$7773 = true;
} else {var v$6821;
var v$6822 = spriteMap$1220[0][0];
spriteMap$1220[0][1];
spriteMap$1220[0][2];
var v$6823 = v$6822.length;
if ((0 <= Y$6814)?(Y$6814 < v$6823):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$6824 = v$6822[Y$6814];
var v$6825 = v$6824.length;
if ((0 <= X$6815)?(X$6815 < v$6825):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$6821 = v$6824[X$6815];
switch (v$6821[0]) { case 0: {t$7773 = v$6821[1][0];
 break; }default: {t$7773 = false;
} };
};
};
if (t$7773) {return [v$7335,v$7336];
} else {var blockTop$1239;
var v$7003 = blockY$1233 - 1.0;
if ((v$7003 < 0.0)?true:((v$7003 >= mapHeightR$1014)?true:((blockX$1232 < 0.0)?true:(blockX$1232 >= mapWidthR$1012)))) {blockTop$1239 = true;
} else {var Y$6829 = SmlPrims.chk_ovf_i32(Math.floor(v$7003));
var X$6830 = SmlPrims.chk_ovf_i32(Math.floor(blockX$1232));
var wt$6831;
var v$6832 = v$2540[0][0];
v$2540[0][1];
v$2540[0][2];
var v$6833 = v$6832.length;
if ((0 <= Y$6829)?(Y$6829 < v$6833):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$6834 = v$6832[Y$6829];
var v$6835 = v$6834.length;
if ((0 <= X$6830)?(X$6830 < v$6835):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$6831 = v$6834[X$6830];
var t$7775;
switch (wt$6831[0]) { case 9: {t$7775 = false;
 break; }case 8: {t$7775 = false;
 break; }default: {t$7775 = true;
} };
if (t$7775) {blockTop$1239 = true;
} else {var v$6836;
var v$6837 = spriteMap$1220[0][0];
spriteMap$1220[0][1];
spriteMap$1220[0][2];
var v$6838 = v$6837.length;
if ((0 <= Y$6829)?(Y$6829 < v$6838):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$6839 = v$6837[Y$6829];
var v$6840 = v$6839.length;
if ((0 <= X$6830)?(X$6830 < v$6840):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$6836 = v$6839[X$6830];
switch (v$6836[0]) { case 0: {blockTop$1239 = v$6836[1][0];
 break; }default: {blockTop$1239 = false;
} };
};
};
var blockBottom$1240;
var v$7005 = blockY$1233 + 1.0;
if ((v$7005 < 0.0)?true:((v$7005 >= mapHeightR$1014)?true:((blockX$1232 < 0.0)?true:(blockX$1232 >= mapWidthR$1012)))) {blockBottom$1240 = true;
} else {var Y$6844 = SmlPrims.chk_ovf_i32(Math.floor(v$7005));
var X$6845 = SmlPrims.chk_ovf_i32(Math.floor(blockX$1232));
var wt$6846;
var v$6847 = v$2540[0][0];
v$2540[0][1];
v$2540[0][2];
var v$6848 = v$6847.length;
if ((0 <= Y$6844)?(Y$6844 < v$6848):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$6849 = v$6847[Y$6844];
var v$6850 = v$6849.length;
if ((0 <= X$6845)?(X$6845 < v$6850):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$6846 = v$6849[X$6845];
var t$7776;
switch (wt$6846[0]) { case 9: {t$7776 = false;
 break; }case 8: {t$7776 = false;
 break; }default: {t$7776 = true;
} };
if (t$7776) {blockBottom$1240 = true;
} else {var v$6851;
var v$6852 = spriteMap$1220[0][0];
spriteMap$1220[0][1];
spriteMap$1220[0][2];
var v$6853 = v$6852.length;
if ((0 <= Y$6844)?(Y$6844 < v$6853):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$6854 = v$6852[Y$6844];
var v$6855 = v$6854.length;
if ((0 <= X$6845)?(X$6845 < v$6855):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$6851 = v$6854[X$6845];
switch (v$6851[0]) { case 0: {blockBottom$1240 = v$6851[1][0];
 break; }default: {blockBottom$1240 = false;
} };
};
};
var blockLeft$1241;
var v$7006 = blockX$1232 - 1.0;
if ((blockY$1233 < 0.0)?true:((blockY$1233 >= mapHeightR$1014)?true:((v$7006 < 0.0)?true:(v$7006 >= mapWidthR$1012)))) {blockLeft$1241 = true;
} else {var Y$6859 = SmlPrims.chk_ovf_i32(Math.floor(blockY$1233));
var X$6860 = SmlPrims.chk_ovf_i32(Math.floor(v$7006));
var wt$6861;
var v$6862 = v$2540[0][0];
v$2540[0][1];
v$2540[0][2];
var v$6863 = v$6862.length;
if ((0 <= Y$6859)?(Y$6859 < v$6863):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$6864 = v$6862[Y$6859];
var v$6865 = v$6864.length;
if ((0 <= X$6860)?(X$6860 < v$6865):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$6861 = v$6864[X$6860];
var t$7777;
switch (wt$6861[0]) { case 9: {t$7777 = false;
 break; }case 8: {t$7777 = false;
 break; }default: {t$7777 = true;
} };
if (t$7777) {blockLeft$1241 = true;
} else {var v$6866;
var v$6867 = spriteMap$1220[0][0];
spriteMap$1220[0][1];
spriteMap$1220[0][2];
var v$6868 = v$6867.length;
if ((0 <= Y$6859)?(Y$6859 < v$6868):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$6869 = v$6867[Y$6859];
var v$6870 = v$6869.length;
if ((0 <= X$6860)?(X$6860 < v$6870):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$6866 = v$6869[X$6860];
switch (v$6866[0]) { case 0: {blockLeft$1241 = v$6866[1][0];
 break; }default: {blockLeft$1241 = false;
} };
};
};
var blockRight$1242;
var v$7008 = blockX$1232 + 1.0;
if ((blockY$1233 < 0.0)?true:((blockY$1233 >= mapHeightR$1014)?true:((v$7008 < 0.0)?true:(v$7008 >= mapWidthR$1012)))) {blockRight$1242 = true;
} else {var Y$6874 = SmlPrims.chk_ovf_i32(Math.floor(blockY$1233));
var X$6875 = SmlPrims.chk_ovf_i32(Math.floor(v$7008));
var wt$6876;
var v$6877 = v$2540[0][0];
v$2540[0][1];
v$2540[0][2];
var v$6878 = v$6877.length;
if ((0 <= Y$6874)?(Y$6874 < v$6878):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$6879 = v$6877[Y$6874];
var v$6880 = v$6879.length;
if ((0 <= X$6875)?(X$6875 < v$6880):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$6876 = v$6879[X$6875];
var t$7778;
switch (wt$6876[0]) { case 9: {t$7778 = false;
 break; }case 8: {t$7778 = false;
 break; }default: {t$7778 = true;
} };
if (t$7778) {blockRight$1242 = true;
} else {var v$6881;
var v$6882 = spriteMap$1220[0][0];
spriteMap$1220[0][1];
spriteMap$1220[0][2];
var v$6883 = v$6882.length;
if ((0 <= Y$6874)?(Y$6874 < v$6883):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$6884 = v$6882[Y$6874];
var v$6885 = v$6884.length;
if ((0 <= X$6875)?(X$6875 < v$6885):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$6881 = v$6884[X$6875];
switch (v$6881[0]) { case 0: {blockRight$1242 = v$6881[1][0];
 break; }default: {blockRight$1242 = false;
} };
};
};
var toY$1243 = (blockTop$1239?((v$7338 - blockY$1233) < v$7339):false)?(blockY$1233 + v$7339):((blockBottom$1240?(((blockY$1233 + 1.0) - v$7338) < v$7339):false)?((blockY$1233 + 1.0) - v$7339):v$7338);
return [(blockLeft$1241?((v$7337 - blockX$1232) < v$7339):false)?(blockX$1232 + v$7339):((blockRight$1242?(((blockX$1232 + 1.0) - v$7337) < v$7339):false)?((blockX$1232 + 1.0) - v$7339):v$7337),toY$1243];
};
};
};
var drawMiniMap$1511 = function(){var miniMap$1518;
var v$4433 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimap");
switch (v$4433[0]) { case 0: {miniMap$1518 = v$4433[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimap' in DOM"];
} };
var miniMapCtr$1519;
var v$4439 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimapcontainer");
switch (v$4439[0]) { case 0: {miniMapCtr$1519 = v$4439[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimapcontainer' in DOM"];
} };
var miniMapObjects$1520;
var v$4445 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimapobjects");
switch (v$4445[0]) { case 0: {miniMapObjects$1520 = v$4445[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimapobjects' in DOM"];
} };
var w$1521 = SmlPrims.chk_ovf_i32(mapWidth$1011 * 8);
var h$1522 = SmlPrims.chk_ovf_i32(mapHeight$1013 * 8);
(function(fp,s,v){fp[s] = v;})(miniMap$1518,"width",w$1521);
(function(fp,s,v){fp[s] = v;})(miniMap$1518,"height",h$1522);
(function(fp,s,v){fp[s] = v;})(miniMapObjects$1520,"width",w$1521);
(function(fp,s,v){fp[s] = v;})(miniMapObjects$1520,"height",h$1522);
(function(fp,s,v){fp[s] = v;})(miniMapCtr$1519,"width",w$1521);
(function(fp,s,v){fp[s] = v;})(miniMapCtr$1519,"height",h$1522);
var w_s$1529 = ((w$1521 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(w$1521))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(w$1521))) + "px";
var h_s$1530 = ((h$1522 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(h$1522))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(h$1522))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMap$1518,"style"),"width",w_s$1529);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMapObjects$1520,"style"),"width",w_s$1529);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMapCtr$1519,"style"),"width",w_s$1529);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMap$1518,"style"),"height",h_s$1530);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMapObjects$1520,"style"),"height",h_s$1530);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMapCtr$1519,"style"),"height",h_s$1530);
var c$1537 = (function(e,s){return e.getContext(s);})(miniMap$1518,"2d");
var entireMap$1538 = function(v$7510){return [v$2540,0,[1],[1],0];
};
Y5y0a7l58ITwhpccCWLDEa$3basis$0Array2$1.appi$512(0,function(v$7417){var v$7418 = v$7417[0];
var v$7419 = v$7417[1];
var v$7420 = v$7417[2];
var t$7779;
switch (v$7420[0]) { case 9: {t$7779 = false;
 break; }case 8: {t$7779 = false;
 break; }default: {t$7779 = true;
} };
if (t$7779) {(function(c,s){c.fillStyle = s;})(c$1537,"rgb(200,200,200)");
return (function(c,a1,a2,a3,a4){c.fillRect(a1,a2,a3,a4);})(c$1537,SmlPrims.chk_ovf_i32(v$7419 * 8),SmlPrims.chk_ovf_i32(v$7418 * 8),8,8);
} else {return 0;
};
},(entireMap$1538(0))[0],(entireMap$1538(0))[4],(entireMap$1538(0))[1],(entireMap$1538(0))[3],(entireMap$1538(0))[2]);
var miniMap$6887;
var v$6888 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimap");
switch (v$6888[0]) { case 0: {miniMap$6887 = v$6888[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimap' in DOM"];
} };
var miniMapObjects$6889;
var v$6890 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimapobjects");
switch (v$6890[0]) { case 0: {miniMapObjects$6889 = v$6890[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimapobjects' in DOM"];
} };
var height$6891 = (function(fp,s){return fp[s];})(miniMap$6887,"height");
var width$6892 = (function(fp,s){return fp[s];})(miniMap$6887,"width");
var c$6893 = (function(e,s){return e.getContext(s);})(miniMapObjects$6889,"2d");
(function(c,a1,a2,a3,a4){c.clearRect(a1,a2,a3,a4);})(c$6893,0,0,width$6892,height$6891);
(function(c,a1,a2,a3,a4){c.fillRect(a1,a2,a3,a4);})(c$6893,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$995[5][0] * miniMapScaleR$1009) - 2.0),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$995[6][0] * miniMapScaleR$1009) - 2.0),4,4);
(function(c){c.beginPath();})(c$6893);
(function(c,a1,a2){c.moveTo(a1,a2);})(c$6893,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(player$995[5][0] * miniMapScaleR$1009),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(player$995[6][0] * miniMapScaleR$1009));
(function(c,a1,a2){c.lineTo(a1,a2);})(c$6893,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$995[5][0] + (Math.cos(player$995[1][0]))) * miniMapScaleR$1009),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$995[6][0] + (Math.sin(player$995[1][0]))) * miniMapScaleR$1009));
(function(c){c.closePath();})(c$6893);
return (function(c){c.stroke();})(c$6893);
};
var castSingleRay$1691;
var fix$7780 = {};
fix$7780.$RealMod = function(v$7340,v$7341){lab$RealMod: while (true) {if (v$7340 < v$7341) {return v$7340;
} else {var t$7781 = v$7340 - v$7341;
var t$7782 = v$7341;
var v$7340 = t$7781;
var v$7341 = t$7782;
continue lab$RealMod;
};
};
};
var RealMod$1573 = fix$7780.$RealMod;
castSingleRay$1691 = (function(displayContent$1694){return function(screenStrips$1697){return function(spriteMap$1700){return function(v$1705){var v$2223 = v$1705[0];
var v$2224 = v$1705[1];
var v$2225 = v$1705[2];
var rayAngle$1706 = RealMod$1573(v$2223,twoPI$1005);
var rayAngle$1707 = (rayAngle$1706 < 0.0)?(rayAngle$1706 + twoPI$1005):rayAngle$1706;
var right$1712 = (rayAngle$1707 > (twoPI$1005 * 0.75))?true:(rayAngle$1707 < (twoPI$1005 * 0.25));
var up$1717 = (rayAngle$1707 < 0.0)?true:(rayAngle$1707 > 3.14159265358979323846);
var angleSin$1722 = Math.sin(rayAngle$1707);
var angleCos$1723 = Math.cos(rayAngle$1707);
var slope$1724 = angleSin$1722 / angleCos$1723;
var dXVer$1725 = right$1712?1.0:(-1.0);
var dYVer$1730 = dXVer$1725 * slope$1724;
var x$1731 = right$1712?(SmlPrims.chk_ovf_i32(Math.ceil(player$995[5][0]))):(SmlPrims.chk_ovf_i32(Math.floor(player$995[5][0])));
var x$1744 = x$1731;
var y$1745 = player$995[6][0] + ((x$1744 - player$995[5][0]) * slope$1724);
var emptyHit$1756 = [0.0,0,false,0.0,[9],0.0,0,0.0,0];
var v$2220;
var fix$7783 = {};
fix$7783.$loopV = function(v$7344,v$7345,visibleSprites$1773){lab$loopV: while (true) {if ((v$7344 < 0.0)?true:((v$7344 >= mapWidthR$1012)?true:((v$7345 < 0.0)?true:(v$7345 >= mapHeightR$1014)))) {return [emptyHit$1756,visibleSprites$1773];
} else {var wallX$1778 = SmlPrims.chk_ovf_i32(Math.floor(right$1712?v$7344:(v$7344 - 1.0)));
var wallY$1783 = SmlPrims.chk_ovf_i32(Math.floor(v$7345));
var wt$1784;
var v$4664 = v$2540[0][0];
v$2540[0][1];
v$2540[0][2];
var v$4666 = v$4664.length;
if ((0 <= wallY$1783)?(wallY$1783 < v$4666):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$4668 = v$4664[wallY$1783];
var v$4669 = v$4668.length;
if ((0 <= wallX$1778)?(wallX$1778 < v$4669):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$1784 = v$4668[wallX$1778];
var t$7784;
switch (wt$1784[0]) { case 9: {t$7784 = false;
 break; }case 8: {t$7784 = false;
 break; }default: {t$7784 = true;
} };
if (t$7784) {var distX$1789 = v$7344 - player$995[5][0];
var distY$1794 = v$7345 - player$995[6][0];
var dist$1799 = (distX$1789 * distX$1789) + (distY$1794 * distY$1794);
var textureX$1800 = v$7345 - (SmlPrims.chk_ovf_i32(Math.floor(v$7345)));
var textureX$1801 = (right$1712?false:true)?(1.0 - textureX$1800):textureX$1800;
return [[dist$1799,0,(rayAngle$1707 < (3.14159265358979323846 / 2.0))?true:(rayAngle$1707 > ((3.0 * 3.14159265358979323846) / 2.0)),textureX$1801,wt$1784,v$7344,wallX$1778,v$7345,wallY$1783],visibleSprites$1773];
} else {var t$7787 = v$7344 + dXVer$1725;
var t$7786 = v$7345 + dYVer$1730;
var t$7785;
var v$1824;
var v$4680 = spriteMap$1700[0][0];
spriteMap$1700[0][1];
spriteMap$1700[0][2];
var v$4682 = v$4680.length;
if ((0 <= wallY$1783)?(wallY$1783 < v$4682):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$4684 = v$4680[wallY$1783];
var v$4685 = v$4684.length;
if ((0 <= wallX$1778)?(wallX$1778 < v$4685):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$1824 = v$4684[wallX$1778];
switch (v$1824[0]) { case 1: {t$7785 = visibleSprites$1773;
 break; }default: {var v$1839 = v$1824[1];
if (v$1839[4][0]) {t$7785 = visibleSprites$1773;
} else {(v$1839[4][0] = true,0);
t$7785 = [v$1839,visibleSprites$1773];
};
} };
var t$7788 = t$7787;
var t$7789 = t$7786;
var t$7790 = t$7785;
var v$7344 = t$7788;
var v$7345 = t$7789;
var visibleSprites$1773 = t$7790;
continue lab$loopV;
};
};
};
};
var loopV$1766 = fix$7783.$loopV;
v$2220 = (loopV$1766(x$1744,y$1745,v$2225));
var v$2221 = v$2220[0];
var v$2222 = v$2220[1];
var slope$1857 = angleCos$1723 / angleSin$1722;
var dYHor$1858 = up$1717?(-1.0):1.0;
var dXHor$1863 = dYHor$1858 * slope$1857;
var y$1864 = up$1717?(SmlPrims.chk_ovf_i32(Math.floor(player$995[6][0]))):(SmlPrims.chk_ovf_i32(Math.ceil(player$995[6][0])));
var x$1877 = player$995[5][0] + ((y$1864 - player$995[6][0]) * slope$1857);
var v$2208;
var fix$7791 = {};
fix$7791.$loopH = function(v$7348,v$7349,visibleSprites$1893){lab$loopH: while (true) {if ((v$7348 < 0.0)?true:((v$7348 >= mapWidthR$1012)?true:((v$7349 < 0.0)?true:((v$7349 >= mapHeightR$1014)?true:((slope$1857 > 10000.0)?true:(up$1717?((v$7349 - 1.0) < 0.0):false)))))) {return [v$2221,visibleSprites$1893];
} else {var wallY$1898 = SmlPrims.chk_ovf_i32(Math.floor(up$1717?(v$7349 - 1.0):v$7349));
var wallX$1903 = SmlPrims.chk_ovf_i32(Math.floor(v$7348));
var wt$1904;
try {var v$4700 = v$2540[0][0];
v$2540[0][1];
v$2540[0][2];
var v$4702 = v$4700.length;
if ((0 <= wallY$1898)?(wallY$1898 < v$4702):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$4704 = v$4700[wallY$1898];
var v$4705 = v$4704.length;
if ((0 <= wallX$1903)?(wallX$1903 < v$4705):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$1904 = v$4704[wallX$1903];
} catch(v$7792) {wt$1904 = (((function(env$7797){return function(s$m$1907){var v$7793 = env$7797[0];
var v$7794 = env$7797[1];
var v$7795 = env$7797[2];
var v$7796 = env$7797[3];
var s$4706 = (("wallX = " + ((v$7796 < 0)?("-" + (v$7795(SmlPrims.chk_ovf_i32(-(v$7796))))):(v$7795(v$7796)))) + "; wallY = ") + ((v$7794 < 0)?("-" + (v$7795(SmlPrims.chk_ovf_i32(-(v$7794))))):(v$7795(v$7794)));
var log$4707;
var v$4709 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(v$7793,"log");
switch (v$4709[0]) { case 0: {log$4707 = v$4709[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'log' in DOM"];
} };
(function(e,a){return e.appendChild(a);})(log$4707,document.createTextNode(s$4706));
(function(e,a){return e.appendChild(a);})(log$4707,document.createElement("br"));
throw s$m$1907;
};
})([z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,wallY$1898,abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456,wallX$1903]))(v$7792));
};
var t$7798;
switch (wt$1904[0]) { case 9: {t$7798 = false;
 break; }case 8: {t$7798 = false;
 break; }default: {t$7798 = true;
} };
if (t$7798) {var distX$1914 = v$7348 - player$995[5][0];
var distY$1919 = v$7349 - player$995[6][0];
var blockDist$1924 = (distX$1914 * distX$1914) + (distY$1919 * distY$1919);
if (((v$2221[0] > 0.0)?false:true)?true:(blockDist$1924 < v$2221[0])) {var textureX$1929 = v$7348 - (SmlPrims.chk_ovf_i32(Math.floor(v$7348)));
return [[blockDist$1924,1,rayAngle$1707 < 3.14159265358979323846,1.0 - (up$1717?(1.0 - textureX$1929):textureX$1929),wt$1904,v$7348,wallX$1903,v$7349,wallY$1898],visibleSprites$1893];
} else {return [v$2221,visibleSprites$1893];
};
} else {var t$7801 = v$7348 + dXHor$1863;
var t$7800 = v$7349 + dYHor$1858;
var t$7799;
var v$1962;
var v$4731 = spriteMap$1700[0][0];
spriteMap$1700[0][1];
spriteMap$1700[0][2];
var v$4733 = v$4731.length;
if ((0 <= wallY$1898)?(wallY$1898 < v$4733):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$4735 = v$4731[wallY$1898];
var v$4736 = v$4735.length;
if ((0 <= wallX$1903)?(wallX$1903 < v$4736):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$1962 = v$4735[wallX$1903];
switch (v$1962[0]) { case 1: {t$7799 = visibleSprites$1893;
 break; }default: {var v$1977 = v$1962[1];
if (v$1977[4][0]) {t$7799 = visibleSprites$1893;
} else {(v$1977[4][0] = true,0);
t$7799 = [v$1977,visibleSprites$1893];
};
} };
var t$7802 = t$7801;
var t$7803 = t$7800;
var t$7804 = t$7799;
var v$7348 = t$7802;
var v$7349 = t$7803;
var visibleSprites$1893 = t$7804;
continue lab$loopH;
};
};
};
};
var loopH$1886 = fix$7791.$loopH;
v$2208 = (loopH$1886(x$1877,y$1864,v$2222));
var v$2209 = v$2208[0];
var v$2210 = v$2209[0];
var v$2211 = v$2209[5];
var v$2212 = v$2209[7];
var v$2213 = v$2209[6];
var v$2214 = v$2209[8];
var v$2215 = v$2209[4];
var v$2216 = v$2209[3];
var v$2217 = v$2209[2];
var v$2218 = v$2209[1];
var v$2219 = v$2208[1];
if (v$2210 <= 0.0) {return v$2219;
} else {var dist$2019 = Math.sqrt(v$2210);
var dist$2020 = dist$2019 * (Math.cos(player$995[1][0] - rayAngle$1707));
var height$2025 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(viewDist$1018 / dist$2020);
var width$2026 = SmlPrims.chk_ovf_i32(height$2025 * 1);
var widthR$2027 = width$2026;
var heightR$2028 = height$2025;
var top$2029 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((screenHeightR$1016 - heightR$2028) / 2.0);
var texX$2030 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(v$2216 * widthR$2027);
var texX$2031 = (texX$2030 > (SmlPrims.chk_ovf_i32(width$2026 - 1)))?(SmlPrims.chk_ovf_i32(width$2026 - 1)):texX$2030;
var v$4749 = screenStrips$1697.length;
if ((0 <= v$2224)?(v$2224 < v$4749):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var stripdata$2036 = screenStrips$1697[v$2224];
var wallType$2037;
if (v$2217) {switch (v$2215[0]) { case 13: {var v$2053 = v$2215[1];
wallType$2037 = [12,v$2053];
 break; }case 12: {var v$2051 = v$2215[1];
wallType$2037 = [13,v$2051];
 break; }default: {wallType$2037 = v$2215;
} };
} else {wallType$2037 = v$2215;
};
var v$2143;
switch (wallType$2037[0]) { case 13: {var v$2207 = wallType$2037[1];
var v$4771 = stripdata$2036[0];
var v$4772 = stripdata$2036[1];
var s$4773;
var dir$4784;
switch (v$2218) { case 0: {dir$4784 = ((player$995[5][0] > v$2211)?3:0);
 break; }default: {dir$4784 = ((player$995[6][0] > v$2212)?1:2);
} };
var v$4785 = v$2207(dir$4784);
switch (v$4785[0]) { case 0: {var v$4786 = v$4785[1];
var v$4787 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$4790){return v$4786 == v$4790[1];
},displayContent$1694);
switch (v$4787[0]) { case 0: {var v$4794 = v$4787[1];
var v$4795 = v$4794[2];
var v$4796 = v$4794[0];
var b$4797 = v$4796[0];
var i$4798 = v$4795[0];
var v$4799;
var fix$7807 = {};
fix$7807.$pre = function(n$4801){lab$pre: while (true) {if (n$4801.length < 3) {var t$7808 = "0" + n$4801;
var n$4801 = t$7808;
continue lab$pre;
} else {return n$4801;
};
};
};
var pre$4800 = fix$7807.$pre;
v$4799 = [(((((("data/" + v$4786) + "/") + b$4797) + "/") + b$4797) + "-") + (pre$4800(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$4798))),".png"];
s$4773 = (v$4799[0] + v$4799[1]);
 break; }default: {s$4773 = "wall-white.png";
} };
 break; }default: {s$4773 = "wall-white.png";
} };
var r$4774 = v$4772[3];
if (r$4774[0] == s$4773) {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$4771,"src",s$4773);
(r$4774[0] = s$4773,0);
};
v$2143 = [1,0,texX$2031,2.0];
 break; }case 12: {var v$2203 = wallType$2037[1];
var v$4811 = stripdata$2036[0];
var v$4812 = stripdata$2036[1];
var s$4813;
var dir$4824;
switch (v$2218) { case 0: {dir$4824 = ((player$995[5][0] > v$2211)?3:0);
 break; }default: {dir$4824 = ((player$995[6][0] > v$2212)?1:2);
} };
var v$4825 = v$2203(dir$4824);
switch (v$4825[0]) { case 0: {var v$4826 = v$4825[1];
var v$4827 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$4830){return v$4826 == v$4830[1];
},displayContent$1694);
switch (v$4827[0]) { case 0: {var v$4834 = v$4827[1];
var v$4835 = v$4834[2];
var v$4836 = v$4834[0];
var b$4837 = v$4836[0];
var i$4838 = v$4835[0];
var v$4839;
var fix$7805 = {};
fix$7805.$pre = function(n$4841){lab$pre: while (true) {if (n$4841.length < 3) {var t$7806 = "0" + n$4841;
var n$4841 = t$7806;
continue lab$pre;
} else {return n$4841;
};
};
};
var pre$4840 = fix$7805.$pre;
v$4839 = [(((((("data/" + v$4826) + "/") + b$4837) + "/") + b$4837) + "-") + (pre$4840(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$4838))),".png"];
s$4813 = (v$4839[0] + v$4839[1]);
 break; }default: {s$4813 = "wall-white.png";
} };
 break; }default: {s$4813 = "wall-white.png";
} };
var r$4814 = v$4812[3];
if (r$4814[0] == s$4813) {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$4811,"src",s$4813);
(r$4814[0] = s$4813,0);
};
v$2143 = [1,0,SmlPrims.chk_ovf_i32(texX$2031 + width$2026),2.0];
 break; }case 1: {var v$4851 = stripdata$2036[0];
var v$4852 = stripdata$2036[1];
var r$4854 = v$4852[3];
if (r$4854[0] == "window-left.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$4851,"src","window-left.png");
(r$4854[0] = "window-left.png",0);
};
v$2143 = [1,0,texX$2031,1.0];
 break; }case 2: {var v$4864 = stripdata$2036[0];
var v$4865 = stripdata$2036[1];
var r$4867 = v$4865[3];
if (r$4867[0] == "window-center.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$4864,"src","window-center.png");
(r$4867[0] = "window-center.png",0);
};
v$2143 = [1,0,texX$2031,1.0];
 break; }case 0: {var v$4877 = stripdata$2036[0];
var v$4878 = stripdata$2036[1];
var r$4880 = v$4878[3];
if (r$4880[0] == "window-right.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$4877,"src","window-right.png");
(r$4880[0] = "window-right.png",0);
};
v$2143 = [1,0,texX$2031,1.0];
 break; }case 7: {var v$4890 = stripdata$2036[0];
var v$4891 = stripdata$2036[1];
var r$4893 = v$4891[3];
if (r$4893[0] == "wall-white.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$4890,"src","wall-white.png");
(r$4893[0] = "wall-white.png",0);
};
v$2143 = [1,0,texX$2031,1.0];
 break; }case 10: {var v$4903 = stripdata$2036[0];
var v$4904 = stripdata$2036[1];
var r$4906 = v$4904[3];
if (r$4906[0] == "wall-shelf1.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$4903,"src","wall-shelf1.png");
(r$4906[0] = "wall-shelf1.png",0);
};
v$2143 = [1,0,texX$2031,1.0];
 break; }case 11: {var v$4916 = stripdata$2036[0];
var v$4917 = stripdata$2036[1];
var r$4919 = v$4917[3];
if (r$4919[0] == "wall-shelf2.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$4916,"src","wall-shelf2.png");
(r$4919[0] = "wall-shelf2.png",0);
};
v$2143 = [1,0,texX$2031,1.0];
 break; }case 3: {var v$4929 = stripdata$2036[0];
var v$4930 = stripdata$2036[1];
var r$4932 = v$4930[3];
if (r$4932[0] == "wall-board.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$4929,"src","wall-board.png");
(r$4932[0] = "wall-board.png",0);
};
v$2143 = [1,0,texX$2031,1.0];
 break; }case 14: {var v$4942 = stripdata$2036[0];
var v$4943 = stripdata$2036[1];
var r$4945 = v$4943[3];
if (r$4945[0] == "wall-bulletin.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$4942,"src","wall-bulletin.png");
(r$4945[0] = "wall-bulletin.png",0);
};
v$2143 = [1,0,texX$2031,1.0];
 break; }case 6: {var v$4955 = stripdata$2036[0];
var v$4956 = stripdata$2036[1];
var r$4958 = v$4956[3];
if (r$4958[0] == "walls.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$4955,"src","walls.png");
(r$4958[0] = "walls.png",0);
};
v$2143 = [4,0,texX$2031,2.0];
 break; }case 5: {var v$4968 = stripdata$2036[0];
var v$4969 = stripdata$2036[1];
var r$4971 = v$4969[3];
if (r$4971[0] == "walls.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$4968,"src","walls.png");
(r$4971[0] = "walls.png",0);
};
v$2143 = [4,1,texX$2031,2.0];
 break; }case 4: {var v$4981 = stripdata$2036[0];
var v$4982 = stripdata$2036[1];
var r$4984 = v$4982[3];
if (r$4984[0] == "walls.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$4981,"src","walls.png");
(r$4984[0] = "walls.png",0);
};
v$2143 = [4,2,texX$2031,2.0];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"obj not supported"];
} };
var v$2144 = v$2143[0];
var v$2145 = v$2143[1];
var v$2146 = v$2143[2];
var v$2147 = v$2143[3];
var v$6905 = stripdata$2036[0];
var v$6906 = stripdata$2036[1];
var r$6908 = v$6906[1];
if (r$6908[0] == height$2025) {0;
} else {var v$6909 = ((height$2025 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(height$2025))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(height$2025))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$6905,"style"),"height",v$6909);
(r$6908[0] = height$2025,0);
};
var v$6912 = stripdata$2036[0];
var v$6913 = stripdata$2036[1];
var r$6915 = v$6913[4];
if (r$6915[0] == top$2029) {0;
} else {var v$6916 = ((top$2029 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(top$2029))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(top$2029))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$6912,"style"),"top",v$6916);
(r$6915[0] = top$2029,0);
};
var imgTop$2112 = SmlPrims.chk_ovf_i32(Math.floor(heightR$2028 * v$2145));
var styleHeight$2113 = SmlPrims.chk_ovf_i32(Math.floor(heightR$2028 * v$2144));
var v$6919 = stripdata$2036[0];
var v$6920 = stripdata$2036[1];
var r$6922 = v$6920[1];
if (r$6922[0] == styleHeight$2113) {0;
} else {var v$6923 = ((styleHeight$2113 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(styleHeight$2113))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(styleHeight$2113))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$6919,"style"),"height",v$6923);
(r$6922[0] = styleHeight$2113,0);
};
var styleWidth$2115 = SmlPrims.chk_ovf_i32(Math.floor(widthR$2027 * v$2147));
var v$6926 = stripdata$2036[0];
var v$6927 = stripdata$2036[1];
var r$6929 = v$6927[5];
if (r$6929[0] == styleWidth$2115) {0;
} else {var v$6930 = ((styleWidth$2115 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(styleWidth$2115))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(styleWidth$2115))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$6926,"style"),"width",v$6930);
(r$6929[0] = styleWidth$2115,0);
};
var styleTop$2117 = SmlPrims.chk_ovf_i32(top$2029 - imgTop$2112);
var v$6933 = stripdata$2036[0];
var v$6934 = stripdata$2036[1];
var r$6936 = v$6934[4];
if (r$6936[0] == styleTop$2117) {0;
} else {var v$6937 = ((styleTop$2117 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(styleTop$2117))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(styleTop$2117))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$6933,"style"),"top",v$6937);
(r$6936[0] = styleTop$2117,0);
};
var styleLeft$2119 = SmlPrims.chk_ovf_i32((SmlPrims.chk_ovf_i32(v$2224 * 1)) - v$2146);
var v$6940 = stripdata$2036[0];
var v$6941 = stripdata$2036[1];
var r$6943 = v$6941[2];
if (r$6943[0] == styleLeft$2119) {0;
} else {var v$6944 = ((styleLeft$2119 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(styleLeft$2119))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(styleLeft$2119))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$6940,"style"),"left",v$6944);
(r$6943[0] = styleLeft$2119,0);
};
var styleClip$2121;
var t$7816;
var t$7815;
var t$7814;
var t$7813;
var t$7812;
var t$7811 = ("rect(" + ((imgTop$2112 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(imgTop$2112))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(imgTop$2112)))) + ",";
var t$7810;
var i$5008 = SmlPrims.chk_ovf_i32(v$2146 + 1);
t$7810 = ((i$5008 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$5008))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$5008)));
t$7812 = (t$7811 + t$7810);
t$7813 = (t$7812 + ",");
var t$7809;
var i$5010 = SmlPrims.chk_ovf_i32(imgTop$2112 + height$2025);
t$7809 = ((i$5010 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$5010))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$5010)));
t$7814 = (t$7813 + t$7809);
t$7815 = (t$7814 + ",");
t$7816 = (t$7815 + ((v$2146 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(v$2146))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(v$2146))));
styleClip$2121 = (t$7816 + ")");
var v$5015 = stripdata$2036[0];
var v$5016 = stripdata$2036[1];
var r$5018 = v$5016[0];
if (r$5018[0] == styleClip$2121) {0;
} else {(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$5015,"style"),"clip",styleClip$2121);
(r$5018[0] = styleClip$2121,0);
};
var dwx$2123 = v$2213 - player$995[5][0];
var dwy$2128 = v$2214 - player$995[6][0];
var wallDist$2133 = (dwx$2123 * dwx$2123) + (dwy$2128 * dwy$2128);
var v$6947 = stripdata$2036[0];
var v$6948 = stripdata$2036[1];
var n$6949 = SmlPrims.chk_ovf_i32(-(SmlPrims.chk_ovf_i32(Math.floor(wallDist$2133 * 1000.0))));
var r$6950 = v$6948[6];
if (r$6950[0] == n$6949) {0;
} else {var v$6951 = (n$6949 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(n$6949))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(n$6949));
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$6947,"style"),"zIndex",v$6951);
(r$6950[0] = n$6949,0);
};
return v$2219;
};
};
};
};
});
var zero$2255 = SmlPrims.getrealtime();
var gameCycle$2260 = function(spriteMap$2263){var gameCycleDelay$2264 = TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.div$1394([0,[[1000,null],false]],[0,[[30,null],false]]);
var fix$7817 = {};
fix$7817.$cycle = function(lastGameCycleTime$2268){lab$cycle: while (true) {var n$2271;
var v$7247;
var v$7450 = SmlPrims.getrealtime();
v$7247 = (g14hFoVCUPM3ZC3WsORS6h$3basis$0Time$1.s$g$309(v$7450[0],v$7450[1],zero$2255[0],zero$2255[1]));
n$2271 = (g14hFoVCUPM3ZC3WsORS6h$3basis$0Time$1.toMilliseconds$97(v$7247[0],v$7247[1]));
var timeDelta$2272 = TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(lastGameCycleTime$2268,n$2271);
var mul$5046 = (xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.toInt$1823(timeDelta$2272)) / (xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.toInt$1823(gameCycleDelay$2264));
var moveStep$5048 = (mul$5046 * player$995[4][0]) * player$995[0];
var t$7819 = player$995[3];
var t$7818;
var a$5050 = player$995[3][0] + player$995[2][0];
t$7818 = ((a$5050 > 0.0)?((a$5050 > 2.0)?2.0:a$5050):((a$5050 < (-(2.0)))?(-(2.0)):a$5050));
(t$7819[0] = t$7818,0);
var drot$5052 = (mul$5046 * player$995[3][0]) * MaxRotSpeed$994;
var v$6306 = player$995[1];
(v$6306[0] = (v$6306[0] + drot$5052),0);
var dx$5057 = (Math.cos(player$995[1][0])) * moveStep$5048;
var dy$5058 = (Math.sin(player$995[1][0])) * moveStep$5048;
var fromX$5059 = player$995[5][0];
var fromY$5060 = player$995[6][0];
var v$5061 = checkCollision$1217(spriteMap$2263,fromX$5059,fromY$5060,fromX$5059 + dx$5057,fromY$5060 + dy$5058,0.35);
var v$5062 = v$5061[0];
var v$5063 = v$5061[1];
(player$995[5][0] = v$5062,0);
(player$995[6][0] = v$5063,0);
var cycleDelay$2273 = (TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$l$1462(timeDelta$2272,gameCycleDelay$2264))?(xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.max$2267([0,[[1,null],false]],TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(gameCycleDelay$2264,timeDelta$2272),gameCycleDelay$2264))):gameCycleDelay$2264;
(function(i,f){return setTimeout(f,i);})(xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.toInt$1823(cycleDelay$2273),(function(env$7822){return function(v$7254){var v$7820 = env$7822[0];
var v$7821 = env$7822[1];
return v$7821(v$7820);
};
})([n$2271,fix$7817.$cycle]));
return 0;
};
};
var cycle$2265 = fix$7817.$cycle;
return cycle$2265([0,[null,false]]);
};
var updateOverlay$2299;
var old$5082 = [""];
updateOverlay$2299 = (function(v$5083){var s$5084 = "FPS: " + ((y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.fmt$169([2,[0,0]]))(v$5083));
if (old$5082[0] == s$5084) {return 0;
} else {var e$5088;
var v$5090 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"overlay");
switch (v$5090[0]) { case 0: {e$5088 = v$5090[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'overlay' in DOM"];
} };
(function(e,s){e.innerHTML = s;})(e$5088,s$5084);
return (old$5082[0] = s$5084,0);
};
});
var updateScore$2303;
var old$5100 = [""];
updateScore$2303 = (function(v$5101){var s$5102 = "SCORE: " + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(v$5101));
if (old$5100[0] == s$5102) {return 0;
} else {var e$5106;
var v$5108 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"score");
switch (v$5108[0]) { case 0: {e$5106 = v$5108[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'score' in DOM"];
} };
(function(e,s){e.innerHTML = s;})(e$5106,s$5102);
return (old$5100[0] = s$5102,0);
};
});
var renderSprites$2307 = function(oldSprites$2310,sprites$2313){var v$5116 = function(v$7353,v$7504,v$7505){var dx$5127 = (v$7504 + 0.5) - player$995[5][0];
var dy$5131 = (v$7505 + 0.5) - player$995[6][0];
var dist$5135 = Math.sqrt((dx$5127 * dx$5127) + (dy$5131 * dy$5131));
var spriteAngle$5136 = (Math.atan2(dy$5131,dx$5127)) - player$995[1][0];
var size$5140 = viewDist$1018 / ((Math.cos(spriteAngle$5136)) * dist$5135);
if (size$5140 <= 0.0) {return 0;
} else {(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$7353,"style"),"display","block");
var screen_x$5147 = ((Math.sin(spriteAngle$5136)) / (Math.cos(spriteAngle$5136))) * viewDist$1018;
var left$5148 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(((screenWidthR$1015 / 2.0) + screen_x$5147) - (size$5140 / 2.0));
var top$5149 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((screenHeightR$1016 - size$5140) / 2.0);
var v$6351 = ((left$5148 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(left$5148))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(left$5148))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$7353,"style"),"left",v$6351);
var v$6357 = ((top$5149 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(top$5149))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(top$5149))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$7353,"style"),"top",v$6357);
var dbx$5152 = v$7504 - player$995[5][0];
var dby$5156 = v$7505 - player$995[6][0];
var sz$5160;
var t$7823;
var i$5207 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(size$5140);
t$7823 = ((i$5207 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$5207))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$5207)));
sz$5160 = (t$7823 + "px");
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$7353,"style"),"width",sz$5160);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$7353,"style"),"height",sz$5160);
var blockDist$5163 = (dbx$5152 * dbx$5152) + (dby$5156 * dby$5156);
var zIndex$5164 = SmlPrims.chk_ovf_i32(-(SmlPrims.chk_ovf_i32(Math.floor(blockDist$5163 * 1000.0))));
var v$6371 = (zIndex$5164 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(zIndex$5164))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(zIndex$5164));
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$7353,"style"),"zIndex",v$6371);
return 0;
};
};
var fix$7824 = {};
fix$7824.$app = function(v$5167){lab$app: while (true) {if (v$5167 == null) {return 0;
} else {var v$5168 = v$5167;
var v$5169 = v$5168[0];
var v$5170 = v$5168[1];
var v$7507 = v$5169[3];
v$5116(v$5169[2],v$7507[0],v$7507[1]);
var t$7825 = v$5170;
var v$5167 = t$7825;
continue lab$app;
};
};
};
var app$5166 = fix$7824.$app;
app$5166(sprites$2313);
var fix$7826 = {};
fix$7826.$app = function(v$5235){lab$app: while (true) {if (v$5235 == null) {return 0;
} else {var v$5236 = v$5235;
var v$5237 = v$5236[0];
var v$5238 = v$5236[1];
(v$5237[4][0]?false:true)?((function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$5237[2],"style"),"display","none")):0;
var t$7827 = v$5238;
var v$5235 = t$7827;
continue lab$app;
};
};
};
var app$5234 = fix$7826.$app;
return app$5234(oldSprites$2310);
};
var score$2409 = [0];
var renderCycle$2410 = function(displayContent$2413,screenStrips$2416,spriteMap$2419){var renderCycleDelay$2420 = TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.div$1394([0,[[1000,null],false]],[0,[[30,null],false]]);
var fix$7828 = {};
fix$7828.$cycle = function(v$7354,v$7355){lab$cycle: while (true) {var miniMap$6956;
var v$6957 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimap");
switch (v$6957[0]) { case 0: {miniMap$6956 = v$6957[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimap' in DOM"];
} };
var miniMapObjects$6958;
var v$6959 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimapobjects");
switch (v$6959[0]) { case 0: {miniMapObjects$6958 = v$6959[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimapobjects' in DOM"];
} };
var height$6960 = (function(fp,s){return fp[s];})(miniMap$6956,"height");
var width$6961 = (function(fp,s){return fp[s];})(miniMap$6956,"width");
var c$6962 = (function(e,s){return e.getContext(s);})(miniMapObjects$6958,"2d");
(function(c,a1,a2,a3,a4){c.clearRect(a1,a2,a3,a4);})(c$6962,0,0,width$6961,height$6960);
(function(c,a1,a2,a3,a4){c.fillRect(a1,a2,a3,a4);})(c$6962,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$995[5][0] * miniMapScaleR$1009) - 2.0),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$995[6][0] * miniMapScaleR$1009) - 2.0),4,4);
(function(c){c.beginPath();})(c$6962);
(function(c,a1,a2){c.moveTo(a1,a2);})(c$6962,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(player$995[5][0] * miniMapScaleR$1009),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(player$995[6][0] * miniMapScaleR$1009));
(function(c,a1,a2){c.lineTo(a1,a2);})(c$6962,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$995[5][0] + (Math.cos(player$995[1][0]))) * miniMapScaleR$1009),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$995[6][0] + (Math.sin(player$995[1][0]))) * miniMapScaleR$1009));
(function(c){c.closePath();})(c$6962);
(function(c){c.stroke();})(c$6962);
var fix$7829 = {};
fix$7829.$app = function(v$5266){lab$app: while (true) {if (v$5266 == null) {return 0;
} else {var v$5267 = v$5266;
var v$5268 = v$5267[0];
var v$5269 = v$5267[1];
(v$5268[4][0] = false,0);
var t$7830 = v$5269;
var v$5266 = t$7830;
continue lab$app;
};
};
};
var app$5265 = fix$7829.$app;
app$5265(v$7355);
var sprites$2430;
var fix$7831 = {};
fix$7831.$loop = function(i$5276,acc$5277){lab$loop: while (true) {if (i$5276 >= numRays$1017) {return acc$5277;
} else {var rayScreenPos$5278 = (((-(numRays$1017)) / 2.0) + i$5276) * stripWidthR$1007;
var rayViewDist$5280 = Math.sqrt((rayScreenPos$5278 * rayScreenPos$5278) + (viewDist$1018 * viewDist$1018));
var rayAngle$5281 = Math.asin(rayScreenPos$5278 / rayViewDist$5280);
var acc$5283 = (((castSingleRay$1691(displayContent$2413))(screenStrips$2416))(spriteMap$2419))([player$995[1][0] + rayAngle$5281,i$5276,acc$5277]);
var t$7832 = SmlPrims.chk_ovf_i32(i$5276 + 1);
var t$7833 = acc$5283;
var i$5276 = t$7832;
var acc$5277 = t$7833;
continue lab$loop;
};
};
};
var loop$5275 = fix$7831.$loop;
sprites$2430 = (loop$5275(0,null));
renderSprites$2307(v$7355,sprites$2430);
var n$2432;
var v$7265;
var v$7469 = SmlPrims.getrealtime();
v$7265 = (g14hFoVCUPM3ZC3WsORS6h$3basis$0Time$1.s$g$309(v$7469[0],v$7469[1],zero$2255[0],zero$2255[1]));
n$2432 = (g14hFoVCUPM3ZC3WsORS6h$3basis$0Time$1.toMilliseconds$97(v$7265[0],v$7265[1]));
var timeDelta$2433 = TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(v$7354,n$2432);
var cycleDelay$2434 = (TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$l$1462(timeDelta$2433,renderCycleDelay$2420))?(xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.max$2267([0,[[1,null],false]],TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(renderCycleDelay$2420,timeDelta$2433),renderCycleDelay$2420))):renderCycleDelay$2420;
var cycleDelay$2439 = xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.toInt$1823(cycleDelay$2434);
(function(i,f){return setTimeout(f,i);})(cycleDelay$2439,(function(env$7837){return function(v$7502){var v$7834 = env$7837[0];
var v$7835 = env$7837[1];
var v$7836 = env$7837[2];
return v$7836(v$7835,v$7834);
};
})([sprites$2430,n$2432,fix$7828.$cycle]));
var fps$2440 = 1000.0 / (xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.toInt$1823(timeDelta$2433));
updateOverlay$2299(fps$2440);
return updateScore$2303(score$2409[0]);
};
};
var cycle$2421 = fix$7828.$cycle;
return cycle$2421([0,[null,false]],null);
};
var init$2507 = function(){var staff$2510;
try {var t$7844 = h9AP67nN46MQi5f2NQrocNd$3university$0university$1.loadStaff$156;
var t$7843;
var file$5324;
var t$7842 = "data/staff.json?_=";
var t$7841;
var t$7840 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.toString$158;
var t$7839;
var v$5327 = SmlPrims.getrealtime();
var v$5328 = v$5327[0];
var v$5329 = v$5327[1];
t$7839 = ((v$5328 - (-2147483648)) + (v$5329 / 1000000.0));
t$7841 = (t$7840(t$7839));
file$5324 = (t$7842 + t$7841);
var r$5330 = SmlPrims.newRequest();
(function(r,m,u,a){return r.open(m,u,a);})(r$5330,"GET",file$5324,false);
z11cymP27JOrM6FBeJkkje$3js$0Js$1.send$652(r$5330,[1]);
var v$5333 = (function(r){return SmlPrims.option(r.responseText);})(r$5330);
switch (v$5333[0]) { case 0: {t$7843 = v$5333[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"serverGet failed on file " + file$5324];
} };
staff$2510 = (t$7844(t$7843));
} catch(v$7838) {staff$2510 = ((function(v$2514){var t$7845 = v$2514;
if (t$7845[0] == sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52) {var msg$2511 = v$2514[1];
var s$5335 = "Failed to load data/staff.json file: " + msg$2511;
var log$5336;
var v$5338 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"log");
switch (v$5338[0]) { case 0: {log$5336 = v$5338[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'log' in DOM"];
} };
(function(e,a){return e.appendChild(a);})(log$5336,document.createTextNode(s$5335));
(function(e,a){return e.appendChild(a);})(log$5336,document.createElement("br"));
return null;
} else {throw v$2514;
};
})(v$7838));
};
var v$5363 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"screen");
switch (v$5363[0]) { case 0: {v$5363[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'screen' in DOM"];
} };
var screenStrips$2517;
var xs$5346;
var fix$7846 = {};
fix$7846.$loop = function(i$5367){if (i$5367 >= screenWidth$852) {return null;
} else {var strip$5368 = document.createElement("img");
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(strip$5368,"style"),"position","absolute");
(function(fp,s,v){fp[s] = v;})(strip$5368,"src","walls.png");
var stripdata$5377;
var t$7848 = strip$5368;
var t$7847;
var v$5378 = [-1];
var v$5379 = [-1];
var v$5380 = [-1];
var v$5381 = [-1];
var v$5382 = [""];
var v$5383 = [-1];
t$7847 = [v$5382,v$5379,v$5380,["walls.png"],v$5381,v$5378,v$5383];
stripdata$5377 = [t$7848,t$7847];
var v$6965 = stripdata$5377[1];
var r$6967 = v$6965[1];
if (r$6967[0] == 0) {0;
} else {var v$6968 = (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(0)) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(strip$5368,"style"),"height",v$6968);
(r$6967[0] = 0,0);
};
var v$6972 = stripdata$5377[1];
var r$6974 = v$6972[2];
if (r$6974[0] == 0) {0;
} else {var v$6975 = (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(0)) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(strip$5368,"style"),"left",v$6975);
(r$6974[0] = 0,0);
};
var v$6979 = stripdata$5377[1];
var r$6981 = v$6979[4];
if (r$6981[0] == 0) {0;
} else {var v$6982 = (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(0)) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(strip$5368,"style"),"top",v$6982);
(r$6981[0] = 0,0);
};
var t$7849;
var v$5386 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"screen");
switch (v$5386[0]) { case 0: {t$7849 = v$5386[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'screen' in DOM"];
} };
(function(e,a){return e.appendChild(a);})(t$7849,strip$5368);
return [stripdata$5377,fix$7846.$loop(SmlPrims.chk_ovf_i32(i$5367 + 1))];
};
};
var loop$5366 = fix$7846.$loop;
xs$5346 = (loop$5366(0));
var fix$7850 = {};
fix$7850.$init = function(v$7358,v$7359,v$7360){lab$init: while (true) {if (v$7358 == null) {return v$7359;
} else {var v$5351 = v$7358;
var v$5352 = v$5351[0];
var v$5353 = v$5351[1];
(v$7359[v$7360] = v$5352,0);
var t$7851 = v$5353;
var t$7852 = v$7359;
var t$7853 = SmlPrims.chk_ovf_i32(v$7360 + 1);
var v$7358 = t$7851;
var v$7359 = t$7852;
var v$7360 = t$7853;
continue lab$init;
};
};
};
var init$5347 = fix$7850.$init;
var t$7859 = init$5347;
var t$7858 = xs$5346;
var t$7857;
var n$5355;
var fix$7854 = {};
fix$7854.$acc = function(v$5357,v$5358){lab$acc: while (true) {if (v$5357 == null) {return v$5358;
} else {var t$7855 = v$5357[1];
var t$7856 = SmlPrims.chk_ovf_i32(v$5358 + 1);
var v$5357 = t$7855;
var v$5358 = t$7856;
continue lab$acc;
};
};
};
var acc$5356 = fix$7854.$acc;
n$5355 = (acc$5356(xs$5346,0));
if ((0 <= n$5355)?(n$5355 <= 123456789):false) {0;
} else {throw CompilerInitial.exn$Size$51;
};
t$7857 = (Array(n$5355));
screenStrips$2517 = (t$7859(t$7858,t$7857,0));
var spriteMap$2518 = init$935(Y5y0a7l58ITwhpccCWLDEa$3basis$0Array2$1.foldi$383(0,function(v$7421){var v$7422 = v$7421[0];
var v$7423 = v$7421[1];
var v$7424 = v$7421[2];
var v$7425 = v$7421[3];
var v$7426;
switch (v$7424[0]) { case 8: {var v$7427 = v$7424[1];
v$7426 = [0,v$7427];
 break; }default: {v$7426 = [1];
} };
switch (v$7426[0]) { case 0: {return [[v$7426[1],v$7423,v$7422],v$7425];
 break; }default: {return v$7425;
} };
},null,v$2540,0,0,[1],[1]));
var displayContent$2519 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.map$695(function(sid$2522){var v$2524 = [0];
var t$7861;
var t$7860;
var v$5401 = dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.find$390(function(v$5402){return v$5402[1] == sid$2522;
},staff$2510);
switch (v$5401[0]) { case 0: {var v$5407 = v$5401[1];
var v$5408 = v$5407[4];
t$7860 = ((v$5408 == null)?"default":v$5408[0][0]);
 break; }default: {t$7860 = "default";
} };
t$7861 = [t$7860];
return [t$7861,sid$2522,v$2524];
},v$2541);
bindKeys$1037(staff$2510,displayContent$2519);
drawMiniMap$1511();
gameCycle$2260(spriteMap$2518);
return renderCycle$2410(displayContent$2519,screenStrips$2517,spriteMap$2518);
};
(function(a){return window.onload=a;})(function(v$7285){return init$2507();
});
return 0;
})();
