if ((typeof(h5Gz8kAhgljIMpoVjaduMAf$3university$0university$1)) == "undefined") {h5Gz8kAhgljIMpoVjaduMAf$3university$0university$1 = {};
};
(function(){h5Gz8kAhgljIMpoVjaduMAf$3university$0university$1.eq_kind$1702 = function(v$3766,v$3767){return v$3766 == v$3767;
};
var screenWidth$54 = SmlPrims.div_i32(1600,2,CompilerInitial.exn$Div$45);
var screenHeight$55 = SmlPrims.div_i32(900,2,CompilerInitial.exn$Div$45);
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<html><head>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<title>Canvas example</title>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<style>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("div#minimapcontainer { position : absolute; width : 100%; }\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161((("canvas#minimap { position : absolute; width : " + ((screenWidth$54 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(screenWidth$54))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(screenWidth$54)))) + "px; }") + "\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161((("canvas#minimapobjects { position : absolute; width : " + ((screenWidth$54 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(screenWidth$54))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(screenWidth$54)))) + "px; }") + "\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("div#floor { position : absolute; width : 100%; height : 100%; background-color : rgb(128,128,128); z-index : -10000000; }\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("div#ceiling { position : absolute; width : 100%; height : 50%; background-color : rgb(96,96,96); z-index : -10000000; }\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161((((("#screen { position : relative; width : " + ((screenWidth$54 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(screenWidth$54))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(screenWidth$54)))) + "px; height : ") + ((screenHeight$55 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(screenHeight$55))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(screenHeight$55)))) + "px; border : 1px solid black; overflow : hidden; }") + "\n");
var t$3929 = EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161;
var t$3928;
var t$3927;
var t$3926;
var t$3925;
var t$3924;
var t$3923 = "div#overlay { position : absolute; display : block; width : ";
var t$3922;
var i$1755 = SmlPrims.chk_ovf_i32(screenWidth$54 - 10);
t$3922 = ((i$1755 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$1755))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$1755)));
t$3924 = (t$3923 + t$3922);
t$3925 = (t$3924 + "px; height : ");
var t$3921;
var i$1757 = SmlPrims.chk_ovf_i32(screenHeight$55 - 10);
t$3921 = ((i$1757 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$1757))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$1757)));
t$3926 = (t$3925 + t$3921);
t$3927 = (t$3926 + "px; padding : 5px; color : white; font-family : lucida console, courier new; font-size : 20px; z-index : 1; }");
t$3928 = (t$3927 + "\n");
t$3929(t$3928);
var t$3937 = EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161;
var t$3936;
var t$3935;
var t$3934;
var t$3933;
var t$3932;
var t$3931 = "div#score { position : relative; display : block; width : ";
var t$3930;
var i$1765 = SmlPrims.chk_ovf_i32(screenWidth$54 - 10);
t$3930 = ((i$1765 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$1765))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$1765)));
t$3932 = (t$3931 + t$3930);
t$3933 = (t$3932 + "px; height : ");
t$3934 = (t$3933 + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(30)));
t$3935 = (t$3934 + "px; padding : 5px; color : blue; font-family : lucida console, courier new; font-size : 20px; z-index : 1; }");
t$3936 = (t$3935 + "\n");
t$3937(t$3936);
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("</style>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("</head><body><center>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<h2>The PLTC Hallway!</h2>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='screen'>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='floor'></div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='ceiling'></div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='overlay'></div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("</div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='score'> </div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='minimapcontainer'>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<canvas id='minimap'></canvas>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<canvas id='minimapobjects'></canvas>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("</div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='log'></div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("</center></body></html>\n");
var Smap$92 = ["*abc*abc*abc*abc*abc*abc*abc*abc*abc*abc*abcabcabc*",["*D DKD  *  D*D  *  D*  D*   *T P*   * T *  L   L  *",["*   K   O   H   *   H   *   *   *   * T NL  TTT   O",["*DL H L * L * L * L H L * L * L * L * L ML  TTT  A*",["*   *T  H   *   *   *   *   *   *   *   *A L   L  *",["* L * L * L * L * L * L * L * L * L * LT*         *",["*D  ** **   ** *** **   *   ** *** **  T**I* *  AT*",["*       *               *               *    ******",["******* ******     ***********     *******   * P***",["*TTTTT* ******T L  *TT *     *T L  *******P L  T***",["*       I*****T    *  P*     *T    *******T  * T***",["******* ******     ** **** ***     ***O***   ******",["*  L  L   L L  L  L  L  L  L  L  L  L  L  L  L  L O",["*  L  L   L L  L  L  L  L  L  L  L  L  L  L  L  L I",["****I** **** **** *I* *** *** *I* *** *** *** *****",["******* C*   *     H L * L * L * L * L * L * L ****",["******* C* * * TTA H  T*   *   *  T*   *  T*   ****",["*       C*** * TT  H   *   *   K   *   *   *   ****",["* ** ** **T  * TTA K  T*   *T TH  T*   *   *   ****",["* T* T* T*   *PTTAPH  A* AT*   H  A* TA*   *   ****",["**********cba*cbaca*cba*cba*cba*cba*cba*cba*cba****",null]]]]]]]]]]]]]]]]]]]]];
var Map$153 = Y5y0a7l58ITwhpccCWLDEa$3basis$0Array2$1.fromList$58(dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.map$330(function(s$1823){var e$1831 = null;
var fix$3938 = {};
fix$3938.$rl = function(v$3768,v$3769){lab$rl: while (true) {if (v$3768 >= 0) {var t$3942 = SmlPrims.chk_ovf_i32(v$3768 - 1);
var t$3939;
var v$3167 = s$1823.charCodeAt(v$3768);
var t$3941;
var t$3940;
switch (v$3167) { case 32: {t$3940 = 0;
 break; }case 119: {t$3940 = 1;
 break; }case 61: {t$3940 = 2;
 break; }case 109: {t$3940 = 3;
 break; }case 37: {t$3940 = 3;
 break; }case 104: {t$3940 = 4;
 break; }case 77: {t$3940 = 5;
 break; }case 78: {t$3940 = 6;
 break; }case 97: {t$3940 = 7;
 break; }case 98: {t$3940 = 8;
 break; }case 99: {t$3940 = 9;
 break; }case 42: {t$3940 = 10;
 break; }case 72: {t$3940 = 11;
 break; }case 75: {t$3940 = 12;
 break; }case 79: {t$3940 = 13;
 break; }case 73: {t$3940 = 14;
 break; }case 84: {t$3940 = 100;
 break; }case 65: {t$3940 = 101;
 break; }case 80: {t$3940 = 102;
 break; }case 76: {t$3940 = 103;
 break; }case 68: {t$3940 = 104;
 break; }case 67: {t$3940 = 105;
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,("unknown character '" + (h8UYb53cympluUQFSuaSASi$3basis$0Char$1.toString$275(v$3167))) + "'"];
} };
t$3941 = [t$3940,v$3769];
t$3939 = t$3941;
var t$3943 = t$3942;
var t$3944 = t$3939;
var v$3768 = t$3943;
var v$3769 = t$3944;
continue lab$rl;
} else {return v$3769;
};
};
};
var rl$1833 = fix$3938.$rl;
return rl$1833(SmlPrims.chk_ovf_i32(s$1823.length - 1),e$1831);
},Smap$92));
var init$255 = function(items$258){var screen$259;
var v$1866 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"screen");
switch (v$1866[0]) { case 0: {screen$259 = v$1866[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'screen' in DOM"];
} };
Map$153[0][0];
var v$3725 = Map$153[0][1];
var v$3726 = Map$153[0][2];
if ((0 <= v$3725)?(v$3725 <= 123456789):false) {0;
} else {throw CompilerInitial.exn$Size$51;
};
var spriteMap$263;
var v$3179 = [1];
var t$3952;
var t$3945;
var t$1876 = Array(v$3725);
var fix$3946 = {};
fix$3946.$init = function(v$3772,v$3773){lab$init: while (true) {if (v$3773 >= v$3725) {return 0;
} else {var t$3949 = v$3772;
var t$3948 = v$3773;
var t$3947;
if ((0 <= v$3726)?(v$3726 <= 123456789):false) {0;
} else {throw CompilerInitial.exn$Size$51;
};
t$3947 = (SmlPrims.wordTableInit(v$3726,v$3179));
(t$3949[t$3948] = t$3947,0);
var t$3950 = v$3772;
var t$3951 = SmlPrims.chk_ovf_i32(v$3773 + 1);
var v$3772 = t$3950;
var v$3773 = t$3951;
continue lab$init;
};
};
};
var init$1877 = fix$3946.$init;
init$1877(t$1876,0);
t$3945 = t$1876;
t$3952 = [t$3945,v$3725,v$3726];
spriteMap$263 = [t$3952];
var fix$3953 = {};
fix$3953.$app = function(v$1895){lab$app: while (true) {if (v$1895 == null) {return 0;
} else {var v$1896 = v$1895;
var v$1897 = v$1896[0];
var v$1898 = v$1896[1];
var v$1932 = v$1897[0];
var v$1933 = v$1897[1];
var v$1934 = v$1897[2];
var s$1935;
var pos$1937 = [v$1933,v$1934];
var e$1938 = document.createElement("img");
var t$3956 = e$1938;
var t$3955 = "src";
var t$3954;
switch (v$1932) { case 0: {t$3954 = "tablechairs.png";
 break; }case 1: {t$3954 = (("professor" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32((SmlPrims.mod_i32(SmlPrims.chk_ovf_i32(pos$1937[0] + pos$1937[1]),4,CompilerInitial.exn$Div$45)) + 1)))) + ".gif");
 break; }case 2: {t$3954 = "plantgreen.png";
 break; }case 3: {t$3954 = "lamp.png";
 break; }case 5: {t$3954 = "score.png";
 break; }default: {t$3954 = "desk.png";
} };
(function(fp,s,v){fp[s] = v;})(t$3956,t$3955,t$3954);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(e$1938,"style"),"display","none");
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(e$1938,"style"),"position","absolute");
var v$1941;
switch (v$1932) { case 0: {v$1941 = true;
 break; }case 1: {v$1941 = true;
 break; }case 2: {v$1941 = true;
 break; }case 3: {v$1941 = false;
 break; }case 5: {v$1941 = false;
 break; }default: {v$1941 = true;
} };
var v$1942 = [false];
s$1935 = [v$1941,[true],e$1938,pos$1937,v$1942];
var v$3187 = [0,s$1935];
var v$1945 = spriteMap$263[0][0];
spriteMap$263[0][1];
spriteMap$263[0][2];
var v$1947 = v$1945.length;
if ((0 <= v$1934)?(v$1934 < v$1947):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$1950 = v$1945[v$1934];
var v$1951 = v$1950.length;
if ((0 <= v$1933)?(v$1933 < v$1951):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
(v$1950[v$1933] = v$3187,0);
(function(e,a){return e.appendChild(a);})(screen$259,s$1935[2]);
var t$3957 = v$1898;
var v$1895 = t$3957;
continue lab$app;
};
};
};
var app$1894 = fix$3953.$app;
app$1894(items$258);
return spriteMap$263;
};
var MaxRotSpeed$314 = (3.0 * 3.14159265358979323846) / 360.0;
var player$315;
var v$316 = [16.0];
var v$317 = [10.0];
var v$318 = [0.0];
var v$319 = [0.0];
var v$320 = [0.0];
player$315 = [0.10,v$318,[0.0],v$320,v$319,v$316,v$317];
Map$153[0][0];
Map$153[0][1];
var mapWidth$323 = Map$153[0][2];
var mapWidthR$324 = mapWidth$323;
Map$153[0][0];
var mapHeight$325;
var v$1960 = Map$153[0][1];
Map$153[0][2];
mapHeight$325 = v$1960;
var mapHeightR$326 = mapHeight$325;
var miniMapScaleR$328 = 8;
var screenWidthR$329 = screenWidth$54;
var screenHeightR$330 = screenHeight$55;
var stripWidthR$332 = 1;
var fov$333 = (60.0 * 3.14159265358979323846) / 180.0;
var numRays$334 = SmlPrims.chk_ovf_i32(Math.ceil(screenWidthR$329 / stripWidthR$332));
var fovHalf$335 = fov$333 / 2.0;
var viewDist$336 = (screenWidthR$329 / 2.0) / ((Math.sin(fovHalf$335)) / (Math.cos(fovHalf$335)));
var twoPI$337 = 3.14159265358979323846 * 2.0;
var checkCollision$498 = function(spriteMap$501,v$3776,v$3777,v$3778,v$3779,v$3780){if ((v$3779 < 0.0)?true:((v$3779 >= mapHeightR$326)?true:((v$3778 < 0.0)?true:(v$3778 >= mapWidthR$324)))) {return [v$3776,v$3777];
} else {var blockX$513 = SmlPrims.chk_ovf_i32(Math.floor(v$3778));
var blockY$514 = SmlPrims.chk_ovf_i32(Math.floor(v$3779));
var t$3958;
if ((blockY$514 < 0.0)?true:((blockY$514 >= mapHeightR$326)?true:((blockX$513 < 0.0)?true:(blockX$513 >= mapWidthR$324)))) {t$3958 = true;
} else {var Y$3545 = SmlPrims.chk_ovf_i32(Math.floor(blockY$514));
var X$3546 = SmlPrims.chk_ovf_i32(Math.floor(blockX$513));
var wt$3547;
var v$3548 = Map$153[0][0];
Map$153[0][1];
Map$153[0][2];
var v$3549 = v$3548.length;
if ((0 <= Y$3545)?(Y$3545 < v$3549):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3550 = v$3548[Y$3545];
var v$3551 = v$3550.length;
if ((0 <= X$3546)?(X$3546 < v$3551):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$3547 = v$3550[X$3546];
if ((wt$3547 > 0)?((wt$3547 >= 100)?false:true):false) {t$3958 = true;
} else {var v$3552;
var v$3553 = spriteMap$501[0][0];
spriteMap$501[0][1];
spriteMap$501[0][2];
var v$3554 = v$3553.length;
if ((0 <= Y$3545)?(Y$3545 < v$3554):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3555 = v$3553[Y$3545];
var v$3556 = v$3555.length;
if ((0 <= X$3546)?(X$3546 < v$3556):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$3552 = v$3555[X$3546];
switch (v$3552[0]) { case 0: {t$3958 = v$3552[1][0];
 break; }default: {t$3958 = false;
} };
};
};
if (t$3958) {return [v$3776,v$3777];
} else {var blockTop$520;
var v$3718 = blockY$514 - 1.0;
if ((v$3718 < 0.0)?true:((v$3718 >= mapHeightR$326)?true:((blockX$513 < 0.0)?true:(blockX$513 >= mapWidthR$324)))) {blockTop$520 = true;
} else {var Y$3560 = SmlPrims.chk_ovf_i32(Math.floor(v$3718));
var X$3561 = SmlPrims.chk_ovf_i32(Math.floor(blockX$513));
var wt$3562;
var v$3563 = Map$153[0][0];
Map$153[0][1];
Map$153[0][2];
var v$3564 = v$3563.length;
if ((0 <= Y$3560)?(Y$3560 < v$3564):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3565 = v$3563[Y$3560];
var v$3566 = v$3565.length;
if ((0 <= X$3561)?(X$3561 < v$3566):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$3562 = v$3565[X$3561];
if ((wt$3562 > 0)?((wt$3562 >= 100)?false:true):false) {blockTop$520 = true;
} else {var v$3567;
var v$3568 = spriteMap$501[0][0];
spriteMap$501[0][1];
spriteMap$501[0][2];
var v$3569 = v$3568.length;
if ((0 <= Y$3560)?(Y$3560 < v$3569):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3570 = v$3568[Y$3560];
var v$3571 = v$3570.length;
if ((0 <= X$3561)?(X$3561 < v$3571):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$3567 = v$3570[X$3561];
switch (v$3567[0]) { case 0: {blockTop$520 = v$3567[1][0];
 break; }default: {blockTop$520 = false;
} };
};
};
var blockBottom$521;
var v$3720 = blockY$514 + 1.0;
if ((v$3720 < 0.0)?true:((v$3720 >= mapHeightR$326)?true:((blockX$513 < 0.0)?true:(blockX$513 >= mapWidthR$324)))) {blockBottom$521 = true;
} else {var Y$3575 = SmlPrims.chk_ovf_i32(Math.floor(v$3720));
var X$3576 = SmlPrims.chk_ovf_i32(Math.floor(blockX$513));
var wt$3577;
var v$3578 = Map$153[0][0];
Map$153[0][1];
Map$153[0][2];
var v$3579 = v$3578.length;
if ((0 <= Y$3575)?(Y$3575 < v$3579):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3580 = v$3578[Y$3575];
var v$3581 = v$3580.length;
if ((0 <= X$3576)?(X$3576 < v$3581):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$3577 = v$3580[X$3576];
if ((wt$3577 > 0)?((wt$3577 >= 100)?false:true):false) {blockBottom$521 = true;
} else {var v$3582;
var v$3583 = spriteMap$501[0][0];
spriteMap$501[0][1];
spriteMap$501[0][2];
var v$3584 = v$3583.length;
if ((0 <= Y$3575)?(Y$3575 < v$3584):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3585 = v$3583[Y$3575];
var v$3586 = v$3585.length;
if ((0 <= X$3576)?(X$3576 < v$3586):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$3582 = v$3585[X$3576];
switch (v$3582[0]) { case 0: {blockBottom$521 = v$3582[1][0];
 break; }default: {blockBottom$521 = false;
} };
};
};
var blockLeft$522;
var v$3721 = blockX$513 - 1.0;
if ((blockY$514 < 0.0)?true:((blockY$514 >= mapHeightR$326)?true:((v$3721 < 0.0)?true:(v$3721 >= mapWidthR$324)))) {blockLeft$522 = true;
} else {var Y$3590 = SmlPrims.chk_ovf_i32(Math.floor(blockY$514));
var X$3591 = SmlPrims.chk_ovf_i32(Math.floor(v$3721));
var wt$3592;
var v$3593 = Map$153[0][0];
Map$153[0][1];
Map$153[0][2];
var v$3594 = v$3593.length;
if ((0 <= Y$3590)?(Y$3590 < v$3594):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3595 = v$3593[Y$3590];
var v$3596 = v$3595.length;
if ((0 <= X$3591)?(X$3591 < v$3596):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$3592 = v$3595[X$3591];
if ((wt$3592 > 0)?((wt$3592 >= 100)?false:true):false) {blockLeft$522 = true;
} else {var v$3597;
var v$3598 = spriteMap$501[0][0];
spriteMap$501[0][1];
spriteMap$501[0][2];
var v$3599 = v$3598.length;
if ((0 <= Y$3590)?(Y$3590 < v$3599):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3600 = v$3598[Y$3590];
var v$3601 = v$3600.length;
if ((0 <= X$3591)?(X$3591 < v$3601):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$3597 = v$3600[X$3591];
switch (v$3597[0]) { case 0: {blockLeft$522 = v$3597[1][0];
 break; }default: {blockLeft$522 = false;
} };
};
};
var blockRight$523;
var v$3723 = blockX$513 + 1.0;
if ((blockY$514 < 0.0)?true:((blockY$514 >= mapHeightR$326)?true:((v$3723 < 0.0)?true:(v$3723 >= mapWidthR$324)))) {blockRight$523 = true;
} else {var Y$3605 = SmlPrims.chk_ovf_i32(Math.floor(blockY$514));
var X$3606 = SmlPrims.chk_ovf_i32(Math.floor(v$3723));
var wt$3607;
var v$3608 = Map$153[0][0];
Map$153[0][1];
Map$153[0][2];
var v$3609 = v$3608.length;
if ((0 <= Y$3605)?(Y$3605 < v$3609):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3610 = v$3608[Y$3605];
var v$3611 = v$3610.length;
if ((0 <= X$3606)?(X$3606 < v$3611):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$3607 = v$3610[X$3606];
if ((wt$3607 > 0)?((wt$3607 >= 100)?false:true):false) {blockRight$523 = true;
} else {var v$3612;
var v$3613 = spriteMap$501[0][0];
spriteMap$501[0][1];
spriteMap$501[0][2];
var v$3614 = v$3613.length;
if ((0 <= Y$3605)?(Y$3605 < v$3614):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3615 = v$3613[Y$3605];
var v$3616 = v$3615.length;
if ((0 <= X$3606)?(X$3606 < v$3616):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$3612 = v$3615[X$3606];
switch (v$3612[0]) { case 0: {blockRight$523 = v$3612[1][0];
 break; }default: {blockRight$523 = false;
} };
};
};
var toY$524 = (blockTop$520?((v$3779 - blockY$514) < v$3780):false)?(blockY$514 + v$3780):((blockBottom$521?(((blockY$514 + 1.0) - v$3779) < v$3780):false)?((blockY$514 + 1.0) - v$3780):v$3779);
return [(blockLeft$522?((v$3778 - blockX$513) < v$3780):false)?(blockX$513 + v$3780):((blockRight$523?(((blockX$513 + 1.0) - v$3778) < v$3780):false)?((blockX$513 + 1.0) - v$3780):v$3778),toY$524];
};
};
};
var drawMiniMap$792 = function(){var miniMap$799;
var v$2187 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimap");
switch (v$2187[0]) { case 0: {miniMap$799 = v$2187[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimap' in DOM"];
} };
var miniMapCtr$800;
var v$2193 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimapcontainer");
switch (v$2193[0]) { case 0: {miniMapCtr$800 = v$2193[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimapcontainer' in DOM"];
} };
var miniMapObjects$801;
var v$2199 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimapobjects");
switch (v$2199[0]) { case 0: {miniMapObjects$801 = v$2199[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimapobjects' in DOM"];
} };
var w$802 = SmlPrims.chk_ovf_i32(mapWidth$323 * 8);
var h$803 = SmlPrims.chk_ovf_i32(mapHeight$325 * 8);
(function(fp,s,v){fp[s] = v;})(miniMap$799,"width",w$802);
(function(fp,s,v){fp[s] = v;})(miniMap$799,"height",h$803);
(function(fp,s,v){fp[s] = v;})(miniMapObjects$801,"width",w$802);
(function(fp,s,v){fp[s] = v;})(miniMapObjects$801,"height",h$803);
(function(fp,s,v){fp[s] = v;})(miniMapCtr$800,"width",w$802);
(function(fp,s,v){fp[s] = v;})(miniMapCtr$800,"height",h$803);
var w_s$810 = ((w$802 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(w$802))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(w$802))) + "px";
var h_s$811 = ((h$803 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(h$803))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(h$803))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMap$799,"style"),"width",w_s$810);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMapObjects$801,"style"),"width",w_s$810);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMapCtr$800,"style"),"width",w_s$810);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMap$799,"style"),"height",h_s$811);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMapObjects$801,"style"),"height",h_s$811);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMapCtr$800,"style"),"height",h_s$811);
var c$818 = (function(e,s){return e.getContext(s);})(miniMap$799,"2d");
var entireMap$819 = function(v$3920){return [Map$153,0,[1],[1],0];
};
Y5y0a7l58ITwhpccCWLDEa$3basis$0Array2$1.appi$512(0,function(v$3842){var v$3843 = v$3842[0];
var v$3844 = v$3842[1];
var v$3845 = v$3842[2];
if ((v$3845 > 0)?((v$3845 >= 100)?false:true):false) {(function(c,s){c.fillStyle = s;})(c$818,"rgb(200,200,200)");
return (function(c,a1,a2,a3,a4){c.fillRect(a1,a2,a3,a4);})(c$818,SmlPrims.chk_ovf_i32(v$3844 * 8),SmlPrims.chk_ovf_i32(v$3843 * 8),8,8);
} else {return 0;
};
},(entireMap$819(0))[0],(entireMap$819(0))[4],(entireMap$819(0))[1],(entireMap$819(0))[3],(entireMap$819(0))[2]);
var miniMap$3618;
var v$3619 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimap");
switch (v$3619[0]) { case 0: {miniMap$3618 = v$3619[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimap' in DOM"];
} };
var miniMapObjects$3620;
var v$3621 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimapobjects");
switch (v$3621[0]) { case 0: {miniMapObjects$3620 = v$3621[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimapobjects' in DOM"];
} };
var height$3622 = (function(fp,s){return fp[s];})(miniMap$3618,"height");
var width$3623 = (function(fp,s){return fp[s];})(miniMap$3618,"width");
var c$3624 = (function(e,s){return e.getContext(s);})(miniMapObjects$3620,"2d");
(function(c,a1,a2,a3,a4){c.clearRect(a1,a2,a3,a4);})(c$3624,0,0,width$3623,height$3622);
(function(c,a1,a2,a3,a4){c.fillRect(a1,a2,a3,a4);})(c$3624,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$315[5][0] * miniMapScaleR$328) - 2.0),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$315[6][0] * miniMapScaleR$328) - 2.0),4,4);
(function(c){c.beginPath();})(c$3624);
(function(c,a1,a2){c.moveTo(a1,a2);})(c$3624,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(player$315[5][0] * miniMapScaleR$328),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(player$315[6][0] * miniMapScaleR$328));
(function(c,a1,a2){c.lineTo(a1,a2);})(c$3624,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$315[5][0] + (Math.cos(player$315[1][0]))) * miniMapScaleR$328),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$315[6][0] + (Math.sin(player$315[1][0]))) * miniMapScaleR$328));
(function(c){c.closePath();})(c$3624);
return (function(c){c.stroke();})(c$3624);
};
var castSingleRay$972;
var fix$3959 = {};
fix$3959.$RealMod = function(v$3781,v$3782){lab$RealMod: while (true) {if (v$3781 < v$3782) {return v$3781;
} else {var t$3960 = v$3781 - v$3782;
var t$3961 = v$3782;
var v$3781 = t$3960;
var v$3782 = t$3961;
continue lab$RealMod;
};
};
};
var RealMod$854 = fix$3959.$RealMod;
castSingleRay$972 = (function(screenStrips$975){return function(spriteMap$978){return function(v$983){var v$1420 = v$983[0];
var v$1421 = v$983[1];
var v$1422 = v$983[2];
var rayAngle$984 = RealMod$854(v$1420,twoPI$337);
var rayAngle$985 = (rayAngle$984 < 0.0)?(rayAngle$984 + twoPI$337):rayAngle$984;
var right$990 = (rayAngle$985 > (twoPI$337 * 0.75))?true:(rayAngle$985 < (twoPI$337 * 0.25));
var up$995 = (rayAngle$985 < 0.0)?true:(rayAngle$985 > 3.14159265358979323846);
var angleSin$1000 = Math.sin(rayAngle$985);
var angleCos$1001 = Math.cos(rayAngle$985);
var slope$1002 = angleSin$1000 / angleCos$1001;
var dXVer$1003 = right$990?1.0:(-1.0);
var dYVer$1008 = dXVer$1003 * slope$1002;
var x$1009 = right$990?(SmlPrims.chk_ovf_i32(Math.ceil(player$315[5][0]))):(SmlPrims.chk_ovf_i32(Math.floor(player$315[5][0])));
var x$1022 = x$1009;
var y$1023 = player$315[6][0] + ((x$1022 - player$315[5][0]) * slope$1002);
var v$1410;
var fix$3962 = {};
fix$3962.$loop = function(v$3785,v$3786,visibleSprites$1039){lab$loop: while (true) {if ((v$3785 < 0.0)?true:((v$3785 >= mapWidthR$324)?true:((v$3786 < 0.0)?true:(v$3786 >= mapHeightR$326)))) {return [[0.0,0.0,0,0.0,0,0.0,0],visibleSprites$1039];
} else {var wallX$1051 = SmlPrims.chk_ovf_i32(Math.floor(right$990?v$3785:(v$3785 - 1.0)));
var wallY$1056 = SmlPrims.chk_ovf_i32(Math.floor(v$3786));
var wt$1057;
var v$2419 = Map$153[0][0];
Map$153[0][1];
Map$153[0][2];
var v$2421 = v$2419.length;
if ((0 <= wallY$1056)?(wallY$1056 < v$2421):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$2423 = v$2419[wallY$1056];
var v$2424 = v$2423.length;
if ((0 <= wallX$1051)?(wallX$1051 < v$2424):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$1057 = v$2423[wallX$1051];
if ((wt$1057 > 0)?((wt$1057 >= 100)?false:true):false) {var distX$1062 = v$3785 - player$315[5][0];
var distY$1067 = v$3786 - player$315[6][0];
var dist$1072 = (distX$1062 * distX$1062) + (distY$1067 * distY$1067);
var textureX$1073 = v$3786 - (SmlPrims.chk_ovf_i32(Math.floor(v$3786)));
return [[dist$1072,(right$990?false:true)?(1.0 - textureX$1073):textureX$1073,wt$1057,v$3785,wallX$1051,v$3786,wallY$1056],visibleSprites$1039];
} else {var t$3965 = v$3785 + dXVer$1003;
var t$3964 = v$3786 + dYVer$1008;
var t$3963;
var v$1090;
var v$2433 = spriteMap$978[0][0];
spriteMap$978[0][1];
spriteMap$978[0][2];
var v$2435 = v$2433.length;
if ((0 <= wallY$1056)?(wallY$1056 < v$2435):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$2437 = v$2433[wallY$1056];
var v$2438 = v$2437.length;
if ((0 <= wallX$1051)?(wallX$1051 < v$2438):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$1090 = v$2437[wallX$1051];
switch (v$1090[0]) { case 1: {t$3963 = visibleSprites$1039;
 break; }default: {var v$1105 = v$1090[1];
if (v$1105[4][0]) {t$3963 = visibleSprites$1039;
} else {(v$1105[4][0] = true,0);
t$3963 = [v$1105,visibleSprites$1039];
};
} };
var t$3966 = t$3965;
var t$3967 = t$3964;
var t$3968 = t$3963;
var v$3785 = t$3966;
var v$3786 = t$3967;
var visibleSprites$1039 = t$3968;
continue lab$loop;
};
};
};
};
var loop$1032 = fix$3962.$loop;
v$1410 = (loop$1032(x$1022,y$1023,v$1422));
var v$1411 = v$1410[0];
var v$1412 = v$1411[3];
var v$1413 = v$1411[5];
var v$1414 = v$1411[0];
var v$1415 = v$1411[1];
var v$1416 = v$1411[4];
var v$1417 = v$1411[6];
var v$1418 = v$1411[2];
var v$1419 = v$1410[1];
var slope$1129 = angleCos$1001 / angleSin$1000;
var dYHor$1130 = up$995?(-1.0):1.0;
var dXHor$1135 = dYHor$1130 * slope$1129;
var y$1136 = up$995?(SmlPrims.chk_ovf_i32(Math.floor(player$315[6][0]))):(SmlPrims.chk_ovf_i32(Math.ceil(player$315[6][0])));
var x$1149 = player$315[5][0] + ((y$1136 - player$315[6][0]) * slope$1129);
var v$1400;
var fix$3969 = {};
fix$3969.$loop = function(v$3789,v$3790,visibleSprites$1165){lab$loop: while (true) {if ((v$3789 < 0.0)?true:((v$3789 >= mapWidthR$324)?true:((v$3790 < 0.0)?true:((v$3790 >= mapHeightR$326)?true:((slope$1129 > 10000.0)?true:(up$995?((v$3790 - 1.0) < 0.0):false)))))) {return [[v$1414,v$1415,v$1418,v$1412,v$1416,v$1413,v$1417],visibleSprites$1165];
} else {var wallY$1177 = SmlPrims.chk_ovf_i32(Math.floor(up$995?(v$3790 - 1.0):v$3790));
var wallX$1182 = SmlPrims.chk_ovf_i32(Math.floor(v$3789));
var wt$1183;
try {var v$2453 = Map$153[0][0];
Map$153[0][1];
Map$153[0][2];
var v$2455 = v$2453.length;
if ((0 <= wallY$1177)?(wallY$1177 < v$2455):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$2457 = v$2453[wallY$1177];
var v$2458 = v$2457.length;
if ((0 <= wallX$1182)?(wallX$1182 < v$2458):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$1183 = v$2457[wallX$1182];
} catch(v$3970) {wt$1183 = (((function(env$3975){return function(s$m$1186){var v$3971 = env$3975[0];
var v$3972 = env$3975[1];
var v$3973 = env$3975[2];
var v$3974 = env$3975[3];
var s$2459 = (("wallX = " + ((v$3974 < 0)?("-" + (v$3973(SmlPrims.chk_ovf_i32(-(v$3974))))):(v$3973(v$3974)))) + "; wallY = ") + ((v$3972 < 0)?("-" + (v$3973(SmlPrims.chk_ovf_i32(-(v$3972))))):(v$3973(v$3972)));
var log$2460;
var v$2462 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(v$3971,"log");
switch (v$2462[0]) { case 0: {log$2460 = v$2462[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'log' in DOM"];
} };
(function(e,a){return e.appendChild(a);})(log$2460,document.createTextNode(s$2459));
(function(e,a){return e.appendChild(a);})(log$2460,document.createElement("br"));
throw s$m$1186;
};
})([z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,wallY$1177,abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456,wallX$1182]))(v$3970));
};
if ((wt$1183 > 0)?((wt$1183 >= 100)?false:true):false) {var distX$1193 = v$3789 - player$315[5][0];
var distY$1198 = v$3790 - player$315[6][0];
var blockDist$1203 = (distX$1193 * distX$1193) + (distY$1198 * distY$1198);
if (((v$1414 > 0.0)?false:true)?true:(blockDist$1203 < v$1414)) {var textureX$1208 = v$3789 - (SmlPrims.chk_ovf_i32(Math.floor(v$3789)));
return [[blockDist$1203,1.0 - (up$995?(1.0 - textureX$1208):textureX$1208),wt$1183,v$3789,wallX$1182,v$3790,wallY$1177],visibleSprites$1165];
} else {return [[v$1414,v$1415,v$1418,v$1412,v$1416,v$1413,v$1417],visibleSprites$1165];
};
} else {var t$3978 = v$3789 + dXHor$1135;
var t$3977 = v$3790 + dYHor$1130;
var t$3976;
var v$1237;
var v$2484 = spriteMap$978[0][0];
spriteMap$978[0][1];
spriteMap$978[0][2];
var v$2486 = v$2484.length;
if ((0 <= wallY$1177)?(wallY$1177 < v$2486):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$2488 = v$2484[wallY$1177];
var v$2489 = v$2488.length;
if ((0 <= wallX$1182)?(wallX$1182 < v$2489):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$1237 = v$2488[wallX$1182];
switch (v$1237[0]) { case 1: {t$3976 = visibleSprites$1165;
 break; }default: {var v$1252 = v$1237[1];
if (v$1252[4][0]) {t$3976 = visibleSprites$1165;
} else {(v$1252[4][0] = true,0);
t$3976 = [v$1252,visibleSprites$1165];
};
} };
var t$3979 = t$3978;
var t$3980 = t$3977;
var t$3981 = t$3976;
var v$3789 = t$3979;
var v$3790 = t$3980;
var visibleSprites$1165 = t$3981;
continue lab$loop;
};
};
};
};
var loop$1158 = fix$3969.$loop;
v$1400 = (loop$1158(x$1149,y$1136,v$1419));
var v$1401 = v$1400[0];
var v$1402 = v$1401[0];
var v$1403 = v$1401[3];
var v$1404 = v$1401[5];
var v$1405 = v$1401[4];
var v$1406 = v$1401[6];
var v$1407 = v$1401[2];
var v$1408 = v$1401[1];
var v$1409 = v$1400[1];
if (v$1402 <= 0.0) {return v$1409;
} else {var miniMapObjects$2495;
var v$2497 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimapobjects");
switch (v$2497[0]) { case 0: {miniMapObjects$2495 = v$2497[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimapobjects' in DOM"];
} };
var c$2500 = (function(e,s){return e.getContext(s);})(miniMapObjects$2495,"2d");
(function(c,s){c.strokeStyle = s;})(c$2500,"rgba(0,100,0,0.3)");
(function(c,s){c.lineWidth = s;})(c$2500,"0.5");
(function(c){c.beginPath();})(c$2500);
(function(c,a1,a2){c.moveTo(a1,a2);})(c$2500,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(player$315[5][0] * miniMapScaleR$328),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(player$315[6][0] * miniMapScaleR$328));
(function(c,a1,a2){c.lineTo(a1,a2);})(c$2500,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(v$1403 * miniMapScaleR$328),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(v$1404 * miniMapScaleR$328));
(function(c){c.closePath();})(c$2500);
(function(c){c.stroke();})(c$2500);
var dist$1293 = Math.sqrt(v$1402);
var dist$1294 = dist$1293 * (Math.cos(player$315[1][0] - rayAngle$985));
var height$1299 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(viewDist$336 / dist$1294);
var width$1300 = SmlPrims.chk_ovf_i32(height$1299 * 1);
var widthR$1301 = width$1300;
var heightR$1302 = height$1299;
var top$1303 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((screenHeightR$330 - heightR$1302) / 2.0);
var texX$1304 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(v$1408 * widthR$1301);
var texX$1305 = (texX$1304 > (SmlPrims.chk_ovf_i32(width$1300 - 1)))?(SmlPrims.chk_ovf_i32(width$1300 - 1)):texX$1304;
var v$2523 = screenStrips$975.length;
if ((0 <= v$1421)?(v$1421 < v$2523):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var stripdata$1310 = screenStrips$975[v$1421];
var v$1350;
switch (v$1407) { case 5: {var v$2525 = stripdata$1310[0];
var v$2526 = stripdata$1310[1];
var r$2528 = v$2526[3];
if (r$2528[0] == "datoek-000.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2525,"src","datoek-000.png");
(r$2528[0] = "datoek-000.png",0);
};
v$1350 = [1,1,texX$1305,2.0];
 break; }case 6: {var v$2538 = stripdata$1310[0];
var v$2539 = stripdata$1310[1];
var r$2541 = v$2539[3];
if (r$2541[0] == "datoek-000.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2538,"src","datoek-000.png");
(r$2541[0] = "datoek-000.png",0);
};
v$1350 = [1,1,SmlPrims.chk_ovf_i32(texX$1305 + width$1300),2.0];
 break; }case 7: {var v$2551 = stripdata$1310[0];
var v$2552 = stripdata$1310[1];
var r$2554 = v$2552[3];
if (r$2554[0] == "window-left.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2551,"src","window-left.png");
(r$2554[0] = "window-left.png",0);
};
v$1350 = [1,1,texX$1305,1.0];
 break; }case 8: {var v$2564 = stripdata$1310[0];
var v$2565 = stripdata$1310[1];
var r$2567 = v$2565[3];
if (r$2567[0] == "window-center.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2564,"src","window-center.png");
(r$2567[0] = "window-center.png",0);
};
v$1350 = [1,1,texX$1305,1.0];
 break; }case 9: {var v$2577 = stripdata$1310[0];
var v$2578 = stripdata$1310[1];
var r$2580 = v$2578[3];
if (r$2580[0] == "window-right.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2577,"src","window-right.png");
(r$2580[0] = "window-right.png",0);
};
v$1350 = [1,1,texX$1305,1.0];
 break; }case 10: {var v$2590 = stripdata$1310[0];
var v$2591 = stripdata$1310[1];
var r$2593 = v$2591[3];
if (r$2593[0] == "wall-white.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2590,"src","wall-white.png");
(r$2593[0] = "wall-white.png",0);
};
v$1350 = [1,1,texX$1305,1.0];
 break; }case 11: {var v$2603 = stripdata$1310[0];
var v$2604 = stripdata$1310[1];
var r$2606 = v$2604[3];
if (r$2606[0] == "wall-shelf1.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2603,"src","wall-shelf1.png");
(r$2606[0] = "wall-shelf1.png",0);
};
v$1350 = [1,1,texX$1305,1.0];
 break; }case 12: {var v$2616 = stripdata$1310[0];
var v$2617 = stripdata$1310[1];
var r$2619 = v$2617[3];
if (r$2619[0] == "wall-shelf2.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2616,"src","wall-shelf2.png");
(r$2619[0] = "wall-shelf2.png",0);
};
v$1350 = [1,1,texX$1305,1.0];
 break; }case 13: {var v$2629 = stripdata$1310[0];
var v$2630 = stripdata$1310[1];
var r$2632 = v$2630[3];
if (r$2632[0] == "wall-board.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2629,"src","wall-board.png");
(r$2632[0] = "wall-board.png",0);
};
v$1350 = [1,1,texX$1305,1.0];
 break; }case 14: {var v$2642 = stripdata$1310[0];
var v$2643 = stripdata$1310[1];
var r$2645 = v$2643[3];
if (r$2645[0] == "wall-bulletin.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2642,"src","wall-bulletin.png");
(r$2645[0] = "wall-bulletin.png",0);
};
v$1350 = [1,1,texX$1305,1.0];
 break; }default: {var v$2655 = stripdata$1310[0];
var v$2656 = stripdata$1310[1];
var r$2658 = v$2656[3];
if (r$2658[0] == "walls.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$2655,"src","walls.png");
(r$2658[0] = "walls.png",0);
};
v$1350 = [4,v$1407,texX$1305,2.0];
} };
var v$1351 = v$1350[0];
var v$1352 = v$1350[1];
var v$1353 = v$1350[2];
var v$1354 = v$1350[3];
var v$3636 = stripdata$1310[0];
var v$3637 = stripdata$1310[1];
var r$3639 = v$3637[1];
if (r$3639[0] == height$1299) {0;
} else {var v$3640 = ((height$1299 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(height$1299))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(height$1299))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3636,"style"),"height",v$3640);
(r$3639[0] = height$1299,0);
};
var v$3643 = stripdata$1310[0];
var v$3644 = stripdata$1310[1];
var r$3646 = v$3644[4];
if (r$3646[0] == top$1303) {0;
} else {var v$3647 = ((top$1303 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(top$1303))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(top$1303))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3643,"style"),"top",v$3647);
(r$3646[0] = top$1303,0);
};
var imgTop$1319 = SmlPrims.chk_ovf_i32(Math.floor(heightR$1302 * (SmlPrims.chk_ovf_i32(v$1352 - 1))));
var styleHeight$1320 = SmlPrims.chk_ovf_i32(Math.floor(heightR$1302 * v$1351));
var v$3650 = stripdata$1310[0];
var v$3651 = stripdata$1310[1];
var r$3653 = v$3651[1];
if (r$3653[0] == styleHeight$1320) {0;
} else {var v$3654 = ((styleHeight$1320 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(styleHeight$1320))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(styleHeight$1320))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3650,"style"),"height",v$3654);
(r$3653[0] = styleHeight$1320,0);
};
var styleWidth$1322 = SmlPrims.chk_ovf_i32(Math.floor(widthR$1301 * v$1354));
var v$3657 = stripdata$1310[0];
var v$3658 = stripdata$1310[1];
var r$3660 = v$3658[5];
if (r$3660[0] == styleWidth$1322) {0;
} else {var v$3661 = ((styleWidth$1322 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(styleWidth$1322))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(styleWidth$1322))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3657,"style"),"width",v$3661);
(r$3660[0] = styleWidth$1322,0);
};
var styleTop$1324 = SmlPrims.chk_ovf_i32(top$1303 - imgTop$1319);
var v$3664 = stripdata$1310[0];
var v$3665 = stripdata$1310[1];
var r$3667 = v$3665[4];
if (r$3667[0] == styleTop$1324) {0;
} else {var v$3668 = ((styleTop$1324 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(styleTop$1324))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(styleTop$1324))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3664,"style"),"top",v$3668);
(r$3667[0] = styleTop$1324,0);
};
var styleLeft$1326 = SmlPrims.chk_ovf_i32((SmlPrims.chk_ovf_i32(v$1421 * 1)) - v$1353);
var v$3671 = stripdata$1310[0];
var v$3672 = stripdata$1310[1];
var r$3674 = v$3672[2];
if (r$3674[0] == styleLeft$1326) {0;
} else {var v$3675 = ((styleLeft$1326 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(styleLeft$1326))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(styleLeft$1326))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3671,"style"),"left",v$3675);
(r$3674[0] = styleLeft$1326,0);
};
var styleClip$1328;
var t$3989;
var t$3988;
var t$3987;
var t$3986;
var t$3985;
var t$3984 = ("rect(" + ((imgTop$1319 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(imgTop$1319))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(imgTop$1319)))) + ",";
var t$3983;
var i$2682 = SmlPrims.chk_ovf_i32(v$1353 + 1);
t$3983 = ((i$2682 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$2682))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$2682)));
t$3985 = (t$3984 + t$3983);
t$3986 = (t$3985 + ",");
var t$3982;
var i$2684 = SmlPrims.chk_ovf_i32(imgTop$1319 + height$1299);
t$3982 = ((i$2684 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$2684))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$2684)));
t$3987 = (t$3986 + t$3982);
t$3988 = (t$3987 + ",");
t$3989 = (t$3988 + ((v$1353 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(v$1353))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(v$1353))));
styleClip$1328 = (t$3989 + ")");
var v$2689 = stripdata$1310[0];
var v$2690 = stripdata$1310[1];
var r$2692 = v$2690[0];
if (r$2692[0] == styleClip$1328) {0;
} else {(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$2689,"style"),"clip",styleClip$1328);
(r$2692[0] = styleClip$1328,0);
};
var dwx$1330 = v$1405 - player$315[5][0];
var dwy$1335 = v$1406 - player$315[6][0];
var wallDist$1340 = (dwx$1330 * dwx$1330) + (dwy$1335 * dwy$1335);
var v$3678 = stripdata$1310[0];
var v$3679 = stripdata$1310[1];
var n$3680 = SmlPrims.chk_ovf_i32(-(SmlPrims.chk_ovf_i32(Math.floor(wallDist$1340 * 1000.0))));
var r$3681 = v$3679[6];
if (r$3681[0] == n$3680) {0;
} else {var v$3682 = (n$3680 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(n$3680))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(n$3680));
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3678,"style"),"zIndex",v$3682);
(r$3681[0] = n$3680,0);
};
return v$1409;
};
};
};
});
var zero$1449 = SmlPrims.getrealtime();
var gameCycle$1454 = function(spriteMap$1457){var gameCycleDelay$1458 = TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.div$1394([0,[[1000,null],false]],[0,[[30,null],false]]);
var fix$3990 = {};
fix$3990.$cycle = function(lastGameCycleTime$1462){lab$cycle: while (true) {var n$1465;
var v$3734;
var v$3864 = SmlPrims.getrealtime();
v$3734 = (g14hFoVCUPM3ZC3WsORS6h$3basis$0Time$1.s$g$309(v$3864[0],v$3864[1],zero$1449[0],zero$1449[1]));
n$1465 = (g14hFoVCUPM3ZC3WsORS6h$3basis$0Time$1.toMilliseconds$97(v$3734[0],v$3734[1]));
var timeDelta$1466 = TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(lastGameCycleTime$1462,n$1465);
var mul$2720 = (xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.toInt$1823(timeDelta$1466)) / (xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.toInt$1823(gameCycleDelay$1458));
var moveStep$2722 = (mul$2720 * player$315[4][0]) * player$315[0];
var t$3992 = player$315[3];
var t$3991;
var a$2724 = player$315[3][0] + player$315[2][0];
t$3991 = ((a$2724 > 0.0)?((a$2724 > 2.0)?2.0:a$2724):((a$2724 < (-(2.0)))?(-(2.0)):a$2724));
(t$3992[0] = t$3991,0);
var drot$2726 = (mul$2720 * player$315[3][0]) * MaxRotSpeed$314;
var v$3430 = player$315[1];
(v$3430[0] = (v$3430[0] + drot$2726),0);
var dx$2731 = (Math.cos(player$315[1][0])) * moveStep$2722;
var dy$2732 = (Math.sin(player$315[1][0])) * moveStep$2722;
var fromX$2733 = player$315[5][0];
var fromY$2734 = player$315[6][0];
var v$2735 = checkCollision$498(spriteMap$1457,fromX$2733,fromY$2734,fromX$2733 + dx$2731,fromY$2734 + dy$2732,0.35);
var v$2736 = v$2735[0];
var v$2737 = v$2735[1];
(player$315[5][0] = v$2736,0);
(player$315[6][0] = v$2737,0);
var cycleDelay$1467 = (TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$l$1462(timeDelta$1466,gameCycleDelay$1458))?(xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.max$2267([0,[[1,null],false]],TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(gameCycleDelay$1458,timeDelta$1466),gameCycleDelay$1458))):gameCycleDelay$1458;
(function(i,f){return setTimeout(f,i);})(xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.toInt$1823(cycleDelay$1467),(function(env$3995){return function(v$3741){var v$3993 = env$3995[0];
var v$3994 = env$3995[1];
return v$3994(v$3993);
};
})([n$1465,fix$3990.$cycle]));
return 0;
};
};
var cycle$1459 = fix$3990.$cycle;
return cycle$1459([0,[null,false]]);
};
var updateOverlay$1493;
var old$2756 = [""];
updateOverlay$1493 = (function(v$2757){var s$2758 = "FPS: " + ((y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.fmt$169([2,[0,0]]))(v$2757));
if (old$2756[0] == s$2758) {return 0;
} else {var e$2762;
var v$2764 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"overlay");
switch (v$2764[0]) { case 0: {e$2762 = v$2764[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'overlay' in DOM"];
} };
(function(e,s){e.innerHTML = s;})(e$2762,s$2758);
return (old$2756[0] = s$2758,0);
};
});
var updateScore$1497;
var old$2774 = [""];
updateScore$1497 = (function(v$2775){var s$2776 = "SCORE: " + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(v$2775));
if (old$2774[0] == s$2776) {return 0;
} else {var e$2780;
var v$2782 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"score");
switch (v$2782[0]) { case 0: {e$2780 = v$2782[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'score' in DOM"];
} };
(function(e,s){e.innerHTML = s;})(e$2780,s$2776);
return (old$2774[0] = s$2776,0);
};
});
var renderSprites$1501 = function(oldSprites$1504,sprites$1507){var v$2790 = function(v$3794,v$3914,v$3915){var dx$2801 = (v$3914 + 0.5) - player$315[5][0];
var dy$2805 = (v$3915 + 0.5) - player$315[6][0];
var dist$2809 = Math.sqrt((dx$2801 * dx$2801) + (dy$2805 * dy$2805));
var spriteAngle$2810 = (Math.atan2(dy$2805,dx$2801)) - player$315[1][0];
var size$2814 = viewDist$336 / ((Math.cos(spriteAngle$2810)) * dist$2809);
if (size$2814 <= 0.0) {return 0;
} else {(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3794,"style"),"display","block");
var screen_x$2821 = ((Math.sin(spriteAngle$2810)) / (Math.cos(spriteAngle$2810))) * viewDist$336;
var left$2822 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(((screenWidthR$329 / 2.0) + screen_x$2821) - (size$2814 / 2.0));
var top$2823 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((screenHeightR$330 - size$2814) / 2.0);
var v$3475 = ((left$2822 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(left$2822))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(left$2822))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3794,"style"),"left",v$3475);
var v$3481 = ((top$2823 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(top$2823))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(top$2823))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3794,"style"),"top",v$3481);
var dbx$2826 = v$3914 - player$315[5][0];
var dby$2830 = v$3915 - player$315[6][0];
var sz$2834;
var t$3996;
var i$2881 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(size$2814);
t$3996 = ((i$2881 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$2881))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$2881)));
sz$2834 = (t$3996 + "px");
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3794,"style"),"width",sz$2834);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3794,"style"),"height",sz$2834);
var blockDist$2837 = (dbx$2826 * dbx$2826) + (dby$2830 * dby$2830);
var zIndex$2838 = SmlPrims.chk_ovf_i32(-(SmlPrims.chk_ovf_i32(Math.floor(blockDist$2837 * 1000.0))));
var v$3495 = (zIndex$2838 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(zIndex$2838))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(zIndex$2838));
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3794,"style"),"zIndex",v$3495);
return 0;
};
};
var fix$3997 = {};
fix$3997.$app = function(v$2841){lab$app: while (true) {if (v$2841 == null) {return 0;
} else {var v$2842 = v$2841;
var v$2843 = v$2842[0];
var v$2844 = v$2842[1];
var v$3917 = v$2843[3];
v$2790(v$2843[2],v$3917[0],v$3917[1]);
var t$3998 = v$2844;
var v$2841 = t$3998;
continue lab$app;
};
};
};
var app$2840 = fix$3997.$app;
app$2840(sprites$1507);
var fix$3999 = {};
fix$3999.$app = function(v$2909){lab$app: while (true) {if (v$2909 == null) {return 0;
} else {var v$2910 = v$2909;
var v$2911 = v$2910[0];
var v$2912 = v$2910[1];
(v$2911[4][0]?false:true)?((function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$2911[2],"style"),"display","none")):0;
var t$4000 = v$2912;
var v$2909 = t$4000;
continue lab$app;
};
};
};
var app$2908 = fix$3999.$app;
return app$2908(oldSprites$1504);
};
var score$1603 = [0];
var renderCycle$1604 = function(screenStrips$1607,spriteMap$1610){var renderCycleDelay$1611 = TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.div$1394([0,[[1000,null],false]],[0,[[30,null],false]]);
var fix$4001 = {};
fix$4001.$cycle = function(v$3795,v$3796){lab$cycle: while (true) {var miniMap$3687;
var v$3688 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimap");
switch (v$3688[0]) { case 0: {miniMap$3687 = v$3688[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimap' in DOM"];
} };
var miniMapObjects$3689;
var v$3690 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimapobjects");
switch (v$3690[0]) { case 0: {miniMapObjects$3689 = v$3690[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimapobjects' in DOM"];
} };
var height$3691 = (function(fp,s){return fp[s];})(miniMap$3687,"height");
var width$3692 = (function(fp,s){return fp[s];})(miniMap$3687,"width");
var c$3693 = (function(e,s){return e.getContext(s);})(miniMapObjects$3689,"2d");
(function(c,a1,a2,a3,a4){c.clearRect(a1,a2,a3,a4);})(c$3693,0,0,width$3692,height$3691);
(function(c,a1,a2,a3,a4){c.fillRect(a1,a2,a3,a4);})(c$3693,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$315[5][0] * miniMapScaleR$328) - 2.0),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$315[6][0] * miniMapScaleR$328) - 2.0),4,4);
(function(c){c.beginPath();})(c$3693);
(function(c,a1,a2){c.moveTo(a1,a2);})(c$3693,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(player$315[5][0] * miniMapScaleR$328),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(player$315[6][0] * miniMapScaleR$328));
(function(c,a1,a2){c.lineTo(a1,a2);})(c$3693,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$315[5][0] + (Math.cos(player$315[1][0]))) * miniMapScaleR$328),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$315[6][0] + (Math.sin(player$315[1][0]))) * miniMapScaleR$328));
(function(c){c.closePath();})(c$3693);
(function(c){c.stroke();})(c$3693);
var fix$4002 = {};
fix$4002.$app = function(v$2940){lab$app: while (true) {if (v$2940 == null) {return 0;
} else {var v$2941 = v$2940;
var v$2942 = v$2941[0];
var v$2943 = v$2941[1];
(v$2942[4][0] = false,0);
var t$4003 = v$2943;
var v$2940 = t$4003;
continue lab$app;
};
};
};
var app$2939 = fix$4002.$app;
app$2939(v$3796);
var sprites$1621;
var fix$4004 = {};
fix$4004.$loop = function(i$2949,acc$2950){lab$loop: while (true) {if (i$2949 >= numRays$334) {return acc$2950;
} else {var rayScreenPos$2951 = (((-(numRays$334)) / 2.0) + i$2949) * stripWidthR$332;
var rayViewDist$2953 = Math.sqrt((rayScreenPos$2951 * rayScreenPos$2951) + (viewDist$336 * viewDist$336));
var rayAngle$2954 = Math.asin(rayScreenPos$2951 / rayViewDist$2953);
var acc$2956 = ((castSingleRay$972(screenStrips$1607))(spriteMap$1610))([player$315[1][0] + rayAngle$2954,i$2949,acc$2950]);
var t$4005 = SmlPrims.chk_ovf_i32(i$2949 + 1);
var t$4006 = acc$2956;
var i$2949 = t$4005;
var acc$2950 = t$4006;
continue lab$loop;
};
};
};
var loop$2948 = fix$4004.$loop;
sprites$1621 = (loop$2948(0,null));
renderSprites$1501(v$3796,sprites$1621);
var n$1623;
var v$3752;
var v$3883 = SmlPrims.getrealtime();
v$3752 = (g14hFoVCUPM3ZC3WsORS6h$3basis$0Time$1.s$g$309(v$3883[0],v$3883[1],zero$1449[0],zero$1449[1]));
n$1623 = (g14hFoVCUPM3ZC3WsORS6h$3basis$0Time$1.toMilliseconds$97(v$3752[0],v$3752[1]));
var timeDelta$1624 = TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(v$3795,n$1623);
var cycleDelay$1625 = (TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$l$1462(timeDelta$1624,renderCycleDelay$1611))?(xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.max$2267([0,[[1,null],false]],TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(renderCycleDelay$1611,timeDelta$1624),renderCycleDelay$1611))):renderCycleDelay$1611;
var cycleDelay$1630 = xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.toInt$1823(cycleDelay$1625);
(function(i,f){return setTimeout(f,i);})(cycleDelay$1630,(function(env$4010){return function(v$3912){var v$4007 = env$4010[0];
var v$4008 = env$4010[1];
var v$4009 = env$4010[2];
return v$4009(v$4008,v$4007);
};
})([sprites$1621,n$1623,fix$4001.$cycle]));
var fps$1631 = 1000.0 / (xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.toInt$1823(timeDelta$1624));
updateOverlay$1493(fps$1631);
return updateScore$1497(score$1603[0]);
};
};
var cycle$1612 = fix$4001.$cycle;
return cycle$1612([0,[null,false]],null);
};
var init$1665 = function(){(function(f){document.onkeydown = function(e) { e = e || window.event; f(e.keyCode); };})(function(v$2997){switch (v$2997) { case 38: {return (player$315[4][0] = 1.0,0);
 break; }case 40: {return (player$315[4][0] = (-1.0),0);
 break; }case 37: {var rotAcc$3000 = player$315[2];
return (rotAcc$3000[0] > (-0.5))?(rotAcc$3000[0] = (rotAcc$3000[0] - 0.1),0):0;
 break; }case 39: {var rotAcc$3002 = player$315[2];
return (rotAcc$3002[0] < 0.5)?(rotAcc$3002[0] = (rotAcc$3002[0] + 0.1),0):0;
 break; }default: {return 0;
} };
});
(function(f){document.onkeyup = function(e) { e = e || window.event; f(e.keyCode); };})(function(v$3006){switch (v$3006) { case 38: {return (player$315[4][0] = 0.0,0);
 break; }case 40: {return (player$315[4][0] = 0.0,0);
 break; }case 37: {(player$315[3][0] = 0.0,0);
return (player$315[2][0] = 0.0,0);
 break; }case 39: {(player$315[3][0] = 0.0,0);
return (player$315[2][0] = 0.0,0);
 break; }default: {return 0;
} };
});
var v$3030 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"screen");
switch (v$3030[0]) { case 0: {v$3030[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'screen' in DOM"];
} };
var screenStrips$1669;
var xs$3013;
var fix$4011 = {};
fix$4011.$loop = function(i$3034){if (i$3034 >= screenWidth$54) {return null;
} else {var strip$3035 = document.createElement("img");
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(strip$3035,"style"),"position","absolute");
(function(fp,s,v){fp[s] = v;})(strip$3035,"src","walls.png");
var stripdata$3044;
var t$4013 = strip$3035;
var t$4012;
var v$3045 = [-1];
var v$3046 = [-1];
var v$3047 = [-1];
var v$3048 = [-1];
var v$3049 = [""];
var v$3050 = [-1];
t$4012 = [v$3049,v$3046,v$3047,["walls.png"],v$3048,v$3045,v$3050];
stripdata$3044 = [t$4013,t$4012];
var v$3696 = stripdata$3044[1];
var r$3698 = v$3696[1];
if (r$3698[0] == 0) {0;
} else {var v$3699 = (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(0)) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(strip$3035,"style"),"height",v$3699);
(r$3698[0] = 0,0);
};
var v$3703 = stripdata$3044[1];
var r$3705 = v$3703[2];
if (r$3705[0] == 0) {0;
} else {var v$3706 = (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(0)) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(strip$3035,"style"),"left",v$3706);
(r$3705[0] = 0,0);
};
var v$3710 = stripdata$3044[1];
var r$3712 = v$3710[4];
if (r$3712[0] == 0) {0;
} else {var v$3713 = (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(0)) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(strip$3035,"style"),"top",v$3713);
(r$3712[0] = 0,0);
};
var t$4014;
var v$3053 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"screen");
switch (v$3053[0]) { case 0: {t$4014 = v$3053[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'screen' in DOM"];
} };
(function(e,a){return e.appendChild(a);})(t$4014,strip$3035);
return [stripdata$3044,fix$4011.$loop(SmlPrims.chk_ovf_i32(i$3034 + 1))];
};
};
var loop$3033 = fix$4011.$loop;
xs$3013 = (loop$3033(0));
var fix$4015 = {};
fix$4015.$init = function(v$3799,v$3800,v$3801){lab$init: while (true) {if (v$3799 == null) {return v$3800;
} else {var v$3018 = v$3799;
var v$3019 = v$3018[0];
var v$3020 = v$3018[1];
(v$3800[v$3801] = v$3019,0);
var t$4016 = v$3020;
var t$4017 = v$3800;
var t$4018 = SmlPrims.chk_ovf_i32(v$3801 + 1);
var v$3799 = t$4016;
var v$3800 = t$4017;
var v$3801 = t$4018;
continue lab$init;
};
};
};
var init$3014 = fix$4015.$init;
var t$4024 = init$3014;
var t$4023 = xs$3013;
var t$4022;
var n$3022;
var fix$4019 = {};
fix$4019.$acc = function(v$3024,v$3025){lab$acc: while (true) {if (v$3024 == null) {return v$3025;
} else {var t$4020 = v$3024[1];
var t$4021 = SmlPrims.chk_ovf_i32(v$3025 + 1);
var v$3024 = t$4020;
var v$3025 = t$4021;
continue lab$acc;
};
};
};
var acc$3023 = fix$4019.$acc;
n$3022 = (acc$3023(xs$3013,0));
if ((0 <= n$3022)?(n$3022 <= 123456789):false) {0;
} else {throw CompilerInitial.exn$Size$51;
};
t$4022 = (Array(n$3022));
screenStrips$1669 = (t$4024(t$4023,t$4022,0));
var spriteMap$1670 = init$255(Y5y0a7l58ITwhpccCWLDEa$3basis$0Array2$1.foldi$383(0,function(v$3846){var v$3847 = v$3846[0];
var v$3848 = v$3846[1];
var v$3849 = v$3846[2];
var v$3850 = v$3846[3];
var v$3851 = ((v$3849 >= 100)?false:true)?[1]:((v$3849 == 100)?[0,0]:((v$3849 == 101)?[0,1]:((v$3849 == 102)?[0,2]:((v$3849 == 103)?[0,3]:((v$3849 == 104)?[0,4]:((v$3849 == 105)?[0,5]:[1]))))));
switch (v$3851[0]) { case 0: {return [[v$3851[1],v$3848,v$3847],v$3850];
 break; }default: {return v$3850;
} };
},null,Map$153,0,0,[1],[1]));
drawMiniMap$792();
gameCycle$1454(spriteMap$1670);
return renderCycle$1604(screenStrips$1669,spriteMap$1670);
};
(function(i,f){return setTimeout(f,i);})(1,function(v$3765){return init$1665();
});
return 0;
})();
