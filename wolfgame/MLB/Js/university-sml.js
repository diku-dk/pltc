if ((typeof(h9AP67nN46MQi5f2NQrocNd$3university$0university$1)) == "undefined") {h9AP67nN46MQi5f2NQrocNd$3university$0university$1 = {};
};
(function(){h9AP67nN46MQi5f2NQrocNd$3university$0university$1.eq_lang$1987 = function(v$4744,v$4745){return v$4744 == v$4745;
};
h9AP67nN46MQi5f2NQrocNd$3university$0university$1.eq_sprite$1991 = function(v$4746,v$4747){return v$4746 == v$4747;
};
h9AP67nN46MQi5f2NQrocNd$3university$0university$1.eq_obj$1995 = function(v$4748,v$4749){if (v$4748 == v$4749) {return true;
} else {switch (v$4748[0]) { case 8: {switch (v$4749[0]) { case 8: {return v$4748[1] == v$4749[1];
 break; }default: {return false;
} };
 break; }case 0: {switch (v$4749[0]) { case 0: {return true;
 break; }default: {return false;
} };
 break; }case 1: {switch (v$4749[0]) { case 1: {return true;
 break; }default: {return false;
} };
 break; }case 2: {switch (v$4749[0]) { case 2: {return true;
 break; }default: {return false;
} };
 break; }case 3: {switch (v$4749[0]) { case 3: {return true;
 break; }default: {return false;
} };
 break; }case 4: {switch (v$4749[0]) { case 4: {return true;
 break; }default: {return false;
} };
 break; }case 5: {switch (v$4749[0]) { case 5: {return true;
 break; }default: {return false;
} };
 break; }case 6: {switch (v$4749[0]) { case 6: {return true;
 break; }default: {return false;
} };
 break; }case 7: {switch (v$4749[0]) { case 7: {return true;
 break; }default: {return false;
} };
 break; }case 9: {switch (v$4749[0]) { case 9: {return true;
 break; }default: {return false;
} };
 break; }case 10: {switch (v$4749[0]) { case 10: {return true;
 break; }default: {return false;
} };
 break; }case 11: {switch (v$4749[0]) { case 11: {return true;
 break; }default: {return false;
} };
 break; }case 12: {switch (v$4749[0]) { case 12: {return true;
 break; }default: {return false;
} };
 break; }case 13: {switch (v$4749[0]) { case 13: {return true;
 break; }default: {return false;
} };
 break; }case 14: {switch (v$4749[0]) { case 14: {return true;
 break; }default: {return false;
} };
 break; } };
};
};
h9AP67nN46MQi5f2NQrocNd$3university$0university$1.loadStaff$60 = function(data$63){var jsonToStaff$165 = function(j$168){switch (j$168[0]) { case 2: {var v$180 = j$168[1];
var v$175;
var v$2162;
var v$2165 = DNzgidgaaiBsxwxK6Q4Ukm$3json$0json$1.objLook$96(v$180,"id");
switch (v$2165[0]) { case 0: {v$2162 = v$2165[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find  json object id in staff.json"];
} };
switch (v$2162[0]) { case 0: {v$175 = v$2162[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find string json object id in staff.json"];
} };
var v$176;
var v$2178;
var v$2181 = DNzgidgaaiBsxwxK6Q4Ukm$3json$0json$1.objLook$96(v$180,"name");
switch (v$2181[0]) { case 0: {v$2178 = v$2181[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find  json object name in staff.json"];
} };
switch (v$2178[0]) { case 0: {v$176 = v$2178[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find string json object name in staff.json"];
} };
var t$4916;
var v$2194;
var v$2197 = DNzgidgaaiBsxwxK6Q4Ukm$3json$0json$1.objLook$96(v$180,"avatar");
switch (v$2197[0]) { case 0: {v$2194 = v$2197[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find  json object avatar in staff.json"];
} };
switch (v$2194[0]) { case 0: {t$4916 = v$2194[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find string json object avatar in staff.json"];
} };
var t$4915 = v$175;
var t$4914 = v$176;
var t$4913;
var v$2210;
var v$2213 = DNzgidgaaiBsxwxK6Q4Ukm$3json$0json$1.objLook$96(v$180,"office");
switch (v$2213[0]) { case 0: {v$2210 = v$2213[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find  json object office in staff.json"];
} };
switch (v$2210[0]) { case 0: {t$4913 = v$2210[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find string json object office in staff.json"];
} };
var t$4904;
var v$4443;
var v$4444 = DNzgidgaaiBsxwxK6Q4Ukm$3json$0json$1.objLook$96(v$180,"slides");
switch (v$4444[0]) { case 0: {v$4443 = v$4444[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find  json object slides in staff.json"];
} };
switch (v$4443[0]) { case 6: {var v$4445 = v$4443[1];
var v$4463 = null;
var fix$4905 = {};
fix$4905.$foldr = function(v$4465){if (v$4465 == null) {return v$4463;
} else {var v$4466 = v$4465;
var v$4467 = v$4466[0];
var v$4468 = v$4466[1];
var v$4657 = fix$4905.$foldr(v$4468);
switch (v$4467[0]) { case 2: {var v$4472 = v$4467[1];
var t$4912;
var t$4911;
var t$4910;
var v$4473;
var v$4474 = DNzgidgaaiBsxwxK6Q4Ukm$3json$0json$1.objLook$96(v$4472,"id");
switch (v$4474[0]) { case 0: {v$4473 = v$4474[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find  json object id in staff.json"];
} };
switch (v$4473[0]) { case 0: {t$4910 = v$4473[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find string json object id in staff.json"];
} };
var t$4909;
var v$4475 = DNzgidgaaiBsxwxK6Q4Ukm$3json$0json$1.objLook$96(v$4472,"lang");
switch (v$4475[0]) { case 0: {var v$4476 = v$4475[1];
switch (v$4476[0]) { case 0: {switch (v$4476[1]) { case "EN": {t$4909 = [0,0];
 break; }case "en": {t$4909 = [0,0];
 break; }case "DA": {t$4909 = [0,1];
 break; }case "da": {t$4909 = [0,1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find da or en json object lang in staff.json"];
} };
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find da or en json object lang in staff.json"];
} };
 break; }default: {t$4909 = [1];
} };
var t$4908;
var v$4477;
var t$4907 = abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.fromString$460;
var t$4906;
var v$4478;
var v$4479 = DNzgidgaaiBsxwxK6Q4Ukm$3json$0json$1.objLook$96(v$4472,"pages");
switch (v$4479[0]) { case 0: {v$4478 = v$4479[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find  json object pages in staff.json"];
} };
switch (v$4478[0]) { case 0: {t$4906 = v$4478[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find string json object pages in staff.json"];
} };
v$4477 = (t$4907(t$4906));
switch (v$4477[0]) { case 0: {t$4908 = v$4477[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find int json object pages in staff.json"];
} };
t$4911 = [t$4910,t$4909,t$4908];
t$4912 = [t$4911,v$4657];
return t$4912;
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find ARRAY OBJECT json object slides in staff.json"];
} };
};
};
var foldr$4464 = fix$4905.$foldr;
t$4904 = (foldr$4464(v$4445));
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find ARRAY json object slides in staff.json"];
} };
return [t$4916,t$4915,t$4914,t$4913,t$4904];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to find OBJECT json object ARRAY in staff.json"];
} };
};
return DNzgidgaaiBsxwxK6Q4Ukm$3json$0json$1.foldlArrayJson$963(function(v$184){var v$185 = v$184[0];
var v$186 = v$184[1];
return [jsonToStaff$165(v$185),v$186];
},null,data$63);
};
h9AP67nN46MQi5f2NQrocNd$3university$0university$1.loadMapAndScreens$187 = function(data$190){var v$269;
var fix$4917 = {};
fix$4917.$loop = function(v$194,v$197){lab$loop: while (true) {if (v$194 == null) {return [dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.rev$680(v$197),null];
} else {var v$212 = v$194;
var v$213 = v$212[0];
switch (v$213) { case "=": {var v$214 = v$212[1];
return [dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.rev$680(v$197),v$214];
 break; }default: {var t$4918 = v$212[1];
var t$4919 = [v$213,v$197];
var v$194 = t$4918;
var v$197 = t$4919;
continue lab$loop;
} };
};
};
};
var loop$191 = fix$4917.$loop;
var v$4688 = null;
v$269 = (loop$191(h7fbaDWer1eD5BCDBpvTxeg$3basis$0String$1.tokens$222(function(c$274){return c$274 == 10;
},data$190),v$4688));
return [v$269[0],dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.map$695(function(s$2242){var v$2243 = h7fbaDWer1eD5BCDBpvTxeg$3basis$0String$1.tokens$222(function(c$2244){return (c$2244 == 58)?true:(c$2244 == 44);
},s$2242);
if (v$2243 == null) {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to parse screen locations in gameMap.txt"];
} else {var v$2251 = v$2243;
var v$2252 = v$2251[1];
if (v$2252 == null) {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to parse screen locations in gameMap.txt"];
} else {var v$2253 = v$2252;
var v$2254 = v$2253[1];
if (v$2254 == null) {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to parse screen locations in gameMap.txt"];
} else {var v$2255 = v$2254;
if (v$2255[1] == null) {var v$2256 = v$2251[0];
var v$2257 = v$2253[0];
var v$2258 = v$2255[0];
var v$3878 = abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.fromString$460(v$2257);
var v$3879 = abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.fromString$460(v$2258);
switch (v$3878[0]) { case 0: {switch (v$3879[0]) { case 0: {return [v$2256,v$3878[1],v$3879[1]];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to parse integer locations of screens in gameMap.txt"];
} };
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to parse integer locations of screens in gameMap.txt"];
} };
} else {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to parse screen locations in gameMap.txt"];
};
};
};
};
},v$269[1])];
};
h9AP67nN46MQi5f2NQrocNd$3university$0university$1.ppInt$275 = function(i$278){if (i$278 < 0) {return "-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$278))));
} else {return abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$278);
};
};
h9AP67nN46MQi5f2NQrocNd$3university$0university$1.s$d$283 = function(id$286){var v$291 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,id$286);
switch (v$291[0]) { case 0: {return v$291[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,("no element with id '" + id$286) + "' in DOM"];
} };
};
h9AP67nN46MQi5f2NQrocNd$3university$0university$1.println$294 = function(s$297){return EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161(s$297 + "\n");
};
h9AP67nN46MQi5f2NQrocNd$3university$0university$1.serverGet$298 = function(file$301){var file$302;
var t$4923 = file$301 + "?_=";
var t$4922;
var t$4921 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.toString$158;
var t$4920;
var v$2272 = SmlPrims.getrealtime();
var v$2273 = v$2272[0];
var v$2274 = v$2272[1];
t$4920 = ((v$2273 - (-2147483648)) + (v$2274 / 1000000.0));
t$4922 = (t$4921(t$4920));
file$302 = (t$4923 + t$4922);
var r$303 = SmlPrims.newRequest();
(function(r,m,u,a){return r.open(m,u,a);})(r$303,"GET",file$302,false);
z11cymP27JOrM6FBeJkkje$3js$0Js$1.send$652(r$303,[1]);
var v$310 = (function(r){return SmlPrims.option(r.responseText);})(r$303);
switch (v$310[0]) { case 0: {return v$310[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"serverGet failed on file " + file$302];
} };
};
var screenWidth$318 = SmlPrims.div_i32(1600,2,CompilerInitial.exn$Div$45);
var screenHeight$319 = SmlPrims.div_i32(900,2,CompilerInitial.exn$Div$45);
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<html><head>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<title>Canvas example</title>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<link rel='shortcut icon' type='image/x-icon' href='favicon.ico' />\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<style>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("div#minimapcontainer { position : absolute; width : 100%; }\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161((("canvas#minimap { position : absolute; width : " + ((screenWidth$318 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(screenWidth$318))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(screenWidth$318)))) + "px; }") + "\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161((("canvas#minimapobjects { position : absolute; width : " + ((screenWidth$318 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(screenWidth$318))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(screenWidth$318)))) + "px; }") + "\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("div#floor { position : absolute; width : 100%; height : 100%; background-color : rgb(128,128,128); z-index : -10000000; }\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("div#ceiling { position : absolute; width : 100%; height : 50%; background-color : rgb(96,96,96); z-index : -10000000; }\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161((((("#screen { position : relative; width : " + ((screenWidth$318 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(screenWidth$318))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(screenWidth$318)))) + "px; height : ") + ((screenHeight$319 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(screenHeight$319))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(screenHeight$319)))) + "px; border : 1px solid black; overflow : hidden; }") + "\n");
var t$4932 = EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161;
var t$4931;
var t$4930;
var t$4929;
var t$4928;
var t$4927;
var t$4926 = "div#overlay { position : absolute; display : block; width : ";
var t$4925;
var i$2323 = SmlPrims.chk_ovf_i32(screenWidth$318 - 10);
t$4925 = ((i$2323 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$2323))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$2323)));
t$4927 = (t$4926 + t$4925);
t$4928 = (t$4927 + "px; height : ");
var t$4924;
var i$2325 = SmlPrims.chk_ovf_i32(screenHeight$319 - 10);
t$4924 = ((i$2325 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$2325))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$2325)));
t$4929 = (t$4928 + t$4924);
t$4930 = (t$4929 + "px; padding : 5px; color : white; font-family : lucida console, courier new; font-size : 20px; z-index : 1; }");
t$4931 = (t$4930 + "\n");
t$4932(t$4931);
var t$4940 = EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161;
var t$4939;
var t$4938;
var t$4937;
var t$4936;
var t$4935;
var t$4934 = "div#score { position : relative; display : block; width : ";
var t$4933;
var i$2333 = SmlPrims.chk_ovf_i32(screenWidth$318 - 10);
t$4933 = ((i$2333 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$2333))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$2333)));
t$4935 = (t$4934 + t$4933);
t$4936 = (t$4935 + "px; height : ");
t$4937 = (t$4936 + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(30)));
t$4938 = (t$4937 + "px; padding : 5px; color : blue; font-family : lucida console, courier new; font-size : 20px; z-index : 1; }");
t$4939 = (t$4938 + "\n");
t$4940(t$4939);
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("</style>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("</head><body><center>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<h2>The PLTC Hallway!</h2>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='screen'>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='floor'></div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='ceiling'></div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='overlay'></div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("</div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='score'> </div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='minimapcontainer'>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<canvas id='minimap'></canvas>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<canvas id='minimapobjects'></canvas>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("</div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("<div id='log'></div>\n");
EJ47NxTIZkokCnHI8kSKKb$3basis$0General$1.print$161("</center></body></html>\n");
var v$1951;
try {var data$2379;
var file$2414;
var t$4945 = "data/gameMap.txt?_=";
var t$4944;
var t$4943 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.toString$158;
var t$4942;
var v$2417 = SmlPrims.getrealtime();
var v$2418 = v$2417[0];
var v$2419 = v$2417[1];
t$4942 = ((v$2418 - (-2147483648)) + (v$2419 / 1000000.0));
t$4944 = (t$4943(t$4942));
file$2414 = (t$4945 + t$4944);
var r$2420 = SmlPrims.newRequest();
(function(r,m,u,a){return r.open(m,u,a);})(r$2420,"GET",file$2414,false);
z11cymP27JOrM6FBeJkkje$3js$0Js$1.send$652(r$2420,[1]);
var v$2423 = (function(r){return SmlPrims.option(r.responseText);})(r$2420);
switch (v$2423[0]) { case 0: {data$2379 = v$2423[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"serverGet failed on file " + file$2414];
} };
var v$2380;
var fix$4946 = {};
fix$4946.$loop = function(v$2382,v$2383){lab$loop: while (true) {if (v$2382 == null) {return [dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.rev$680(v$2383),null];
} else {var v$2384 = v$2382;
var v$2385 = v$2384[0];
switch (v$2385) { case "=": {var v$2386 = v$2384[1];
return [dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.rev$680(v$2383),v$2386];
 break; }default: {var t$4947 = v$2384[1];
var t$4948 = [v$2385,v$2383];
var v$2382 = t$4947;
var v$2383 = t$4948;
continue lab$loop;
} };
};
};
};
var loop$2381 = fix$4946.$loop;
var v$4699 = null;
v$2380 = (loop$2381(h7fbaDWer1eD5BCDBpvTxeg$3basis$0String$1.tokens$222(function(c$2388){return c$2388 == 10;
},data$2379),v$4699));
v$1951 = [v$2380[0],dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.map$695(function(s$2394){var v$2395 = h7fbaDWer1eD5BCDBpvTxeg$3basis$0String$1.tokens$222(function(c$2396){return (c$2396 == 58)?true:(c$2396 == 44);
},s$2394);
if (v$2395 == null) {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to parse screen locations in gameMap.txt"];
} else {var v$2401 = v$2395;
var v$2402 = v$2401[1];
if (v$2402 == null) {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to parse screen locations in gameMap.txt"];
} else {var v$2403 = v$2402;
var v$2404 = v$2403[1];
if (v$2404 == null) {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to parse screen locations in gameMap.txt"];
} else {var v$2405 = v$2404;
if (v$2405[1] == null) {var v$2406 = v$2401[0];
var v$2407 = v$2403[0];
var v$2408 = v$2405[0];
var v$4020 = abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.fromString$460(v$2407);
var v$4021 = abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.fromString$460(v$2408);
switch (v$4020[0]) { case 0: {switch (v$4021[0]) { case 0: {return [v$2406,v$4020[1],v$4021[1]];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to parse integer locations of screens in gameMap.txt"];
} };
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to parse integer locations of screens in gameMap.txt"];
} };
} else {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"Failed to parse screen locations in gameMap.txt"];
};
};
};
};
},v$2380[1])];
} catch(v$4941) {v$1951 = ((function(exn$1958){var t$4949 = exn$1958;
if (t$4949[0] == sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52) {var msg$1955 = exn$1958[1];
var log$2426;
var v$2428 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"log");
switch (v$2428[0]) { case 0: {log$2426 = v$2428[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'log' in DOM"];
} };
(function(e,a){return e.appendChild(a);})(log$2426,document.createTextNode(msg$1955));
(function(e,a){return e.appendChild(a);})(log$2426,document.createElement("br"));
throw exn$1958;
} else {throw exn$1958;
};
})(v$4941));
};
var v$1952 = v$1951[0];
var Map$419;
try {Map$419 = (Y5y0a7l58ITwhpccCWLDEa$3basis$0Array2$1.fromList$58(dQvcrgdPh2Rb0tWb4ecVml$3basis$0List$1.map$330(function(s$2447){var e$2455 = null;
var fix$4951 = {};
fix$4951.$rl = function(v$4750,v$4751){lab$rl: while (true) {if (v$4750 >= 0) {var t$4955 = SmlPrims.chk_ovf_i32(v$4750 - 1);
var t$4952;
var v$4026 = s$2447.charCodeAt(v$4750);
var t$4954;
var t$4953;
switch (v$4026) { case 32: {t$4953 = [9];
 break; }case 119: {t$4953 = [6];
 break; }case 61: {t$4953 = [5];
 break; }case 37: {t$4953 = [4];
 break; }case 77: {t$4953 = [13];
 break; }case 78: {t$4953 = [12];
 break; }case 97: {t$4953 = [1];
 break; }case 98: {t$4953 = [2];
 break; }case 99: {t$4953 = [0];
 break; }case 42: {t$4953 = [7];
 break; }case 72: {t$4953 = [10];
 break; }case 75: {t$4953 = [11];
 break; }case 79: {t$4953 = [3];
 break; }case 73: {t$4953 = [14];
 break; }case 84: {t$4953 = [8,1];
 break; }case 65: {t$4953 = [8,6];
 break; }case 80: {t$4953 = [8,3];
 break; }case 76: {t$4953 = [8,4];
 break; }case 68: {t$4953 = [8,5];
 break; }case 83: {t$4953 = [8,2];
 break; }case 85: {t$4953 = [8,0];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,("unknown character '" + (h8UYb53cympluUQFSuaSASi$3basis$0Char$1.toString$275(v$4026))) + "'"];
} };
t$4954 = [t$4953,v$4751];
t$4952 = t$4954;
var t$4956 = t$4955;
var t$4957 = t$4952;
var v$4750 = t$4956;
var v$4751 = t$4957;
continue lab$rl;
} else {return v$4751;
};
};
};
var rl$2457 = fix$4951.$rl;
return rl$2457(SmlPrims.chk_ovf_i32(s$2447.length - 1),e$2455);
},v$1952)));
} catch(v$4950) {Map$419 = ((function(s$m$422){var log$2467;
var v$2469 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"log");
switch (v$2469[0]) { case 0: {log$2467 = v$2469[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'log' in DOM"];
} };
(function(e,a){return e.appendChild(a);})(log$2467,document.createTextNode("error loading map"));
(function(e,a){return e.appendChild(a);})(log$2467,document.createElement("br"));
throw s$m$422;
})(v$4950));
};
var init$503 = function(items$506){var screen$507;
var v$2498 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"screen");
switch (v$2498[0]) { case 0: {screen$507 = v$2498[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'screen' in DOM"];
} };
Map$419[0][0];
var v$4670 = Map$419[0][1];
var v$4671 = Map$419[0][2];
if ((0 <= v$4670)?(v$4670 <= 123456789):false) {0;
} else {throw CompilerInitial.exn$Size$51;
};
var spriteMap$511;
var v$4042 = [1];
var t$4965;
var t$4958;
var t$2508 = Array(v$4670);
var fix$4959 = {};
fix$4959.$init = function(v$4754,v$4755){lab$init: while (true) {if (v$4755 >= v$4670) {return 0;
} else {var t$4962 = v$4754;
var t$4961 = v$4755;
var t$4960;
if ((0 <= v$4671)?(v$4671 <= 123456789):false) {0;
} else {throw CompilerInitial.exn$Size$51;
};
t$4960 = (SmlPrims.wordTableInit(v$4671,v$4042));
(t$4962[t$4961] = t$4960,0);
var t$4963 = v$4754;
var t$4964 = SmlPrims.chk_ovf_i32(v$4755 + 1);
var v$4754 = t$4963;
var v$4755 = t$4964;
continue lab$init;
};
};
};
var init$2509 = fix$4959.$init;
init$2509(t$2508,0);
t$4958 = t$2508;
t$4965 = [t$4958,v$4670,v$4671];
spriteMap$511 = [t$4965];
var fix$4966 = {};
fix$4966.$app = function(v$2527){lab$app: while (true) {if (v$2527 == null) {return 0;
} else {var v$2528 = v$2527;
var v$2529 = v$2528[0];
var v$2530 = v$2528[1];
var v$2564 = v$2529[0];
var v$2565 = v$2529[1];
var v$2566 = v$2529[2];
var s$2567;
var pos$2569 = [v$2565,v$2566];
var e$2570 = document.createElement("img");
var t$4969 = e$2570;
var t$4968 = "src";
var t$4967;
switch (v$2564) { case 1: {t$4967 = "tablechairs.png";
 break; }case 6: {t$4967 = (("professor" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32((SmlPrims.mod_i32(SmlPrims.chk_ovf_i32(pos$2569[0] + pos$2569[1]),4,CompilerInitial.exn$Div$45)) + 1)))) + ".gif");
 break; }case 3: {t$4967 = "plantgreen.png";
 break; }case 4: {t$4967 = "lamp.png";
 break; }case 2: {t$4967 = "sink.png";
 break; }case 5: {t$4967 = "desk.png";
 break; }default: {t$4967 = "toilet.png";
} };
(function(fp,s,v){fp[s] = v;})(t$4969,t$4968,t$4967);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(e$2570,"style"),"display","none");
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(e$2570,"style"),"position","absolute");
var v$2573;
switch (v$2564) { case 1: {v$2573 = true;
 break; }case 6: {v$2573 = true;
 break; }case 3: {v$2573 = true;
 break; }case 4: {v$2573 = false;
 break; }case 2: {v$2573 = false;
 break; }case 5: {v$2573 = true;
 break; }default: {v$2573 = true;
} };
var v$2574 = [false];
s$2567 = [v$2573,[true],e$2570,pos$2569,v$2574];
var v$4050 = [0,s$2567];
var v$2577 = spriteMap$511[0][0];
spriteMap$511[0][1];
spriteMap$511[0][2];
var v$2579 = v$2577.length;
if ((0 <= v$2566)?(v$2566 < v$2579):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$2582 = v$2577[v$2566];
var v$2583 = v$2582.length;
if ((0 <= v$2565)?(v$2565 < v$2583):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
(v$2582[v$2565] = v$4050,0);
(function(e,a){return e.appendChild(a);})(screen$507,s$2567[2]);
var t$4970 = v$2530;
var v$2527 = t$4970;
continue lab$app;
};
};
};
var app$2526 = fix$4966.$app;
app$2526(items$506);
return spriteMap$511;
};
var MaxRotSpeed$562 = (3.0 * 3.14159265358979323846) / 360.0;
var player$563;
var v$564 = [16.0];
var v$565 = [10.0];
var v$566 = [0.0];
var v$567 = [0.0];
var v$568 = [0.0];
player$563 = [0.10,v$566,[0.0],v$568,v$567,v$564,v$565];
var fov$571 = (60.0 * 3.14159265358979323846) / 180.0;
var fovHalf$572 = fov$571 / 2.0;
var twoPI$573 = 3.14159265358979323846 * 2.0;
var stripWidthR$575 = 1;
var miniMapScaleR$577 = 8;
Map$419[0][0];
Map$419[0][1];
var mapWidth$579 = Map$419[0][2];
var mapWidthR$580 = mapWidth$579;
Map$419[0][0];
var mapHeight$581;
var v$2597 = Map$419[0][1];
Map$419[0][2];
mapHeight$581 = v$2597;
var mapHeightR$582 = mapHeight$581;
var screenWidthR$583 = screenWidth$318;
var screenHeightR$584 = screenHeight$319;
var numRays$585 = SmlPrims.chk_ovf_i32(Math.ceil(screenWidthR$583 / stripWidthR$575));
var viewDist$586 = (screenWidthR$583 / 2.0) / ((Math.sin(fovHalf$572)) / (Math.cos(fovHalf$572)));
var checkCollision$748 = function(spriteMap$751,v$4758,v$4759,v$4760,v$4761,v$4762){if ((v$4761 < 0.0)?true:((v$4761 >= mapHeightR$582)?true:((v$4760 < 0.0)?true:(v$4760 >= mapWidthR$580)))) {return [v$4758,v$4759];
} else {var blockX$763 = SmlPrims.chk_ovf_i32(Math.floor(v$4760));
var blockY$764 = SmlPrims.chk_ovf_i32(Math.floor(v$4761));
var t$4971;
if ((blockY$764 < 0.0)?true:((blockY$764 >= mapHeightR$582)?true:((blockX$763 < 0.0)?true:(blockX$763 >= mapWidthR$580)))) {t$4971 = true;
} else {var Y$4484 = SmlPrims.chk_ovf_i32(Math.floor(blockY$764));
var X$4485 = SmlPrims.chk_ovf_i32(Math.floor(blockX$763));
var wt$4486;
var v$4487 = Map$419[0][0];
Map$419[0][1];
Map$419[0][2];
var v$4488 = v$4487.length;
if ((0 <= Y$4484)?(Y$4484 < v$4488):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$4489 = v$4487[Y$4484];
var v$4490 = v$4489.length;
if ((0 <= X$4485)?(X$4485 < v$4490):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$4486 = v$4489[X$4485];
var t$4972;
switch (wt$4486[0]) { case 9: {t$4972 = false;
 break; }case 8: {t$4972 = false;
 break; }default: {t$4972 = true;
} };
if (t$4972) {t$4971 = true;
} else {var v$4491;
var v$4492 = spriteMap$751[0][0];
spriteMap$751[0][1];
spriteMap$751[0][2];
var v$4493 = v$4492.length;
if ((0 <= Y$4484)?(Y$4484 < v$4493):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$4494 = v$4492[Y$4484];
var v$4495 = v$4494.length;
if ((0 <= X$4485)?(X$4485 < v$4495):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$4491 = v$4494[X$4485];
switch (v$4491[0]) { case 0: {t$4971 = v$4491[1][0];
 break; }default: {t$4971 = false;
} };
};
};
if (t$4971) {return [v$4758,v$4759];
} else {var blockTop$770;
var v$4663 = blockY$764 - 1.0;
if ((v$4663 < 0.0)?true:((v$4663 >= mapHeightR$582)?true:((blockX$763 < 0.0)?true:(blockX$763 >= mapWidthR$580)))) {blockTop$770 = true;
} else {var Y$4499 = SmlPrims.chk_ovf_i32(Math.floor(v$4663));
var X$4500 = SmlPrims.chk_ovf_i32(Math.floor(blockX$763));
var wt$4501;
var v$4502 = Map$419[0][0];
Map$419[0][1];
Map$419[0][2];
var v$4503 = v$4502.length;
if ((0 <= Y$4499)?(Y$4499 < v$4503):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$4504 = v$4502[Y$4499];
var v$4505 = v$4504.length;
if ((0 <= X$4500)?(X$4500 < v$4505):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$4501 = v$4504[X$4500];
var t$4973;
switch (wt$4501[0]) { case 9: {t$4973 = false;
 break; }case 8: {t$4973 = false;
 break; }default: {t$4973 = true;
} };
if (t$4973) {blockTop$770 = true;
} else {var v$4506;
var v$4507 = spriteMap$751[0][0];
spriteMap$751[0][1];
spriteMap$751[0][2];
var v$4508 = v$4507.length;
if ((0 <= Y$4499)?(Y$4499 < v$4508):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$4509 = v$4507[Y$4499];
var v$4510 = v$4509.length;
if ((0 <= X$4500)?(X$4500 < v$4510):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$4506 = v$4509[X$4500];
switch (v$4506[0]) { case 0: {blockTop$770 = v$4506[1][0];
 break; }default: {blockTop$770 = false;
} };
};
};
var blockBottom$771;
var v$4665 = blockY$764 + 1.0;
if ((v$4665 < 0.0)?true:((v$4665 >= mapHeightR$582)?true:((blockX$763 < 0.0)?true:(blockX$763 >= mapWidthR$580)))) {blockBottom$771 = true;
} else {var Y$4514 = SmlPrims.chk_ovf_i32(Math.floor(v$4665));
var X$4515 = SmlPrims.chk_ovf_i32(Math.floor(blockX$763));
var wt$4516;
var v$4517 = Map$419[0][0];
Map$419[0][1];
Map$419[0][2];
var v$4518 = v$4517.length;
if ((0 <= Y$4514)?(Y$4514 < v$4518):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$4519 = v$4517[Y$4514];
var v$4520 = v$4519.length;
if ((0 <= X$4515)?(X$4515 < v$4520):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$4516 = v$4519[X$4515];
var t$4974;
switch (wt$4516[0]) { case 9: {t$4974 = false;
 break; }case 8: {t$4974 = false;
 break; }default: {t$4974 = true;
} };
if (t$4974) {blockBottom$771 = true;
} else {var v$4521;
var v$4522 = spriteMap$751[0][0];
spriteMap$751[0][1];
spriteMap$751[0][2];
var v$4523 = v$4522.length;
if ((0 <= Y$4514)?(Y$4514 < v$4523):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$4524 = v$4522[Y$4514];
var v$4525 = v$4524.length;
if ((0 <= X$4515)?(X$4515 < v$4525):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$4521 = v$4524[X$4515];
switch (v$4521[0]) { case 0: {blockBottom$771 = v$4521[1][0];
 break; }default: {blockBottom$771 = false;
} };
};
};
var blockLeft$772;
var v$4666 = blockX$763 - 1.0;
if ((blockY$764 < 0.0)?true:((blockY$764 >= mapHeightR$582)?true:((v$4666 < 0.0)?true:(v$4666 >= mapWidthR$580)))) {blockLeft$772 = true;
} else {var Y$4529 = SmlPrims.chk_ovf_i32(Math.floor(blockY$764));
var X$4530 = SmlPrims.chk_ovf_i32(Math.floor(v$4666));
var wt$4531;
var v$4532 = Map$419[0][0];
Map$419[0][1];
Map$419[0][2];
var v$4533 = v$4532.length;
if ((0 <= Y$4529)?(Y$4529 < v$4533):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$4534 = v$4532[Y$4529];
var v$4535 = v$4534.length;
if ((0 <= X$4530)?(X$4530 < v$4535):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$4531 = v$4534[X$4530];
var t$4975;
switch (wt$4531[0]) { case 9: {t$4975 = false;
 break; }case 8: {t$4975 = false;
 break; }default: {t$4975 = true;
} };
if (t$4975) {blockLeft$772 = true;
} else {var v$4536;
var v$4537 = spriteMap$751[0][0];
spriteMap$751[0][1];
spriteMap$751[0][2];
var v$4538 = v$4537.length;
if ((0 <= Y$4529)?(Y$4529 < v$4538):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$4539 = v$4537[Y$4529];
var v$4540 = v$4539.length;
if ((0 <= X$4530)?(X$4530 < v$4540):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$4536 = v$4539[X$4530];
switch (v$4536[0]) { case 0: {blockLeft$772 = v$4536[1][0];
 break; }default: {blockLeft$772 = false;
} };
};
};
var blockRight$773;
var v$4668 = blockX$763 + 1.0;
if ((blockY$764 < 0.0)?true:((blockY$764 >= mapHeightR$582)?true:((v$4668 < 0.0)?true:(v$4668 >= mapWidthR$580)))) {blockRight$773 = true;
} else {var Y$4544 = SmlPrims.chk_ovf_i32(Math.floor(blockY$764));
var X$4545 = SmlPrims.chk_ovf_i32(Math.floor(v$4668));
var wt$4546;
var v$4547 = Map$419[0][0];
Map$419[0][1];
Map$419[0][2];
var v$4548 = v$4547.length;
if ((0 <= Y$4544)?(Y$4544 < v$4548):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$4549 = v$4547[Y$4544];
var v$4550 = v$4549.length;
if ((0 <= X$4545)?(X$4545 < v$4550):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$4546 = v$4549[X$4545];
var t$4976;
switch (wt$4546[0]) { case 9: {t$4976 = false;
 break; }case 8: {t$4976 = false;
 break; }default: {t$4976 = true;
} };
if (t$4976) {blockRight$773 = true;
} else {var v$4551;
var v$4552 = spriteMap$751[0][0];
spriteMap$751[0][1];
spriteMap$751[0][2];
var v$4553 = v$4552.length;
if ((0 <= Y$4544)?(Y$4544 < v$4553):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$4554 = v$4552[Y$4544];
var v$4555 = v$4554.length;
if ((0 <= X$4545)?(X$4545 < v$4555):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$4551 = v$4554[X$4545];
switch (v$4551[0]) { case 0: {blockRight$773 = v$4551[1][0];
 break; }default: {blockRight$773 = false;
} };
};
};
var toY$774 = (blockTop$770?((v$4761 - blockY$764) < v$4762):false)?(blockY$764 + v$4762):((blockBottom$771?(((blockY$764 + 1.0) - v$4761) < v$4762):false)?((blockY$764 + 1.0) - v$4762):v$4761);
return [(blockLeft$772?((v$4760 - blockX$763) < v$4762):false)?(blockX$763 + v$4762):((blockRight$773?(((blockX$763 + 1.0) - v$4760) < v$4762):false)?((blockX$763 + 1.0) - v$4762):v$4760),toY$774];
};
};
};
var drawMiniMap$1042 = function(){var miniMap$1049;
var v$2794 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimap");
switch (v$2794[0]) { case 0: {miniMap$1049 = v$2794[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimap' in DOM"];
} };
var miniMapCtr$1050;
var v$2800 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimapcontainer");
switch (v$2800[0]) { case 0: {miniMapCtr$1050 = v$2800[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimapcontainer' in DOM"];
} };
var miniMapObjects$1051;
var v$2806 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimapobjects");
switch (v$2806[0]) { case 0: {miniMapObjects$1051 = v$2806[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimapobjects' in DOM"];
} };
var w$1052 = SmlPrims.chk_ovf_i32(mapWidth$579 * 8);
var h$1053 = SmlPrims.chk_ovf_i32(mapHeight$581 * 8);
(function(fp,s,v){fp[s] = v;})(miniMap$1049,"width",w$1052);
(function(fp,s,v){fp[s] = v;})(miniMap$1049,"height",h$1053);
(function(fp,s,v){fp[s] = v;})(miniMapObjects$1051,"width",w$1052);
(function(fp,s,v){fp[s] = v;})(miniMapObjects$1051,"height",h$1053);
(function(fp,s,v){fp[s] = v;})(miniMapCtr$1050,"width",w$1052);
(function(fp,s,v){fp[s] = v;})(miniMapCtr$1050,"height",h$1053);
var w_s$1060 = ((w$1052 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(w$1052))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(w$1052))) + "px";
var h_s$1061 = ((h$1053 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(h$1053))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(h$1053))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMap$1049,"style"),"width",w_s$1060);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMapObjects$1051,"style"),"width",w_s$1060);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMapCtr$1050,"style"),"width",w_s$1060);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMap$1049,"style"),"height",h_s$1061);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMapObjects$1051,"style"),"height",h_s$1061);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(miniMapCtr$1050,"style"),"height",h_s$1061);
var c$1068 = (function(e,s){return e.getContext(s);})(miniMap$1049,"2d");
var entireMap$1069 = function(v$4903){return [Map$419,0,[1],[1],0];
};
Y5y0a7l58ITwhpccCWLDEa$3basis$0Array2$1.appi$512(0,function(v$4824){var v$4825 = v$4824[0];
var v$4826 = v$4824[1];
var v$4827 = v$4824[2];
var t$4977;
switch (v$4827[0]) { case 9: {t$4977 = false;
 break; }case 8: {t$4977 = false;
 break; }default: {t$4977 = true;
} };
if (t$4977) {(function(c,s){c.fillStyle = s;})(c$1068,"rgb(200,200,200)");
return (function(c,a1,a2,a3,a4){c.fillRect(a1,a2,a3,a4);})(c$1068,SmlPrims.chk_ovf_i32(v$4826 * 8),SmlPrims.chk_ovf_i32(v$4825 * 8),8,8);
} else {return 0;
};
},(entireMap$1069(0))[0],(entireMap$1069(0))[4],(entireMap$1069(0))[1],(entireMap$1069(0))[3],(entireMap$1069(0))[2]);
var miniMap$4557;
var v$4558 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimap");
switch (v$4558[0]) { case 0: {miniMap$4557 = v$4558[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimap' in DOM"];
} };
var miniMapObjects$4559;
var v$4560 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimapobjects");
switch (v$4560[0]) { case 0: {miniMapObjects$4559 = v$4560[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimapobjects' in DOM"];
} };
var height$4561 = (function(fp,s){return fp[s];})(miniMap$4557,"height");
var width$4562 = (function(fp,s){return fp[s];})(miniMap$4557,"width");
var c$4563 = (function(e,s){return e.getContext(s);})(miniMapObjects$4559,"2d");
(function(c,a1,a2,a3,a4){c.clearRect(a1,a2,a3,a4);})(c$4563,0,0,width$4562,height$4561);
(function(c,a1,a2,a3,a4){c.fillRect(a1,a2,a3,a4);})(c$4563,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$563[5][0] * miniMapScaleR$577) - 2.0),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$563[6][0] * miniMapScaleR$577) - 2.0),4,4);
(function(c){c.beginPath();})(c$4563);
(function(c,a1,a2){c.moveTo(a1,a2);})(c$4563,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(player$563[5][0] * miniMapScaleR$577),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(player$563[6][0] * miniMapScaleR$577));
(function(c,a1,a2){c.lineTo(a1,a2);})(c$4563,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$563[5][0] + (Math.cos(player$563[1][0]))) * miniMapScaleR$577),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$563[6][0] + (Math.sin(player$563[1][0]))) * miniMapScaleR$577));
(function(c){c.closePath();})(c$4563);
return (function(c){c.stroke();})(c$4563);
};
var castSingleRay$1222;
var fix$4978 = {};
fix$4978.$RealMod = function(v$4763,v$4764){lab$RealMod: while (true) {if (v$4763 < v$4764) {return v$4763;
} else {var t$4979 = v$4763 - v$4764;
var t$4980 = v$4764;
var v$4763 = t$4979;
var v$4764 = t$4980;
continue lab$RealMod;
};
};
};
var RealMod$1104 = fix$4978.$RealMod;
castSingleRay$1222 = (function(screenStrips$1225){return function(spriteMap$1228){return function(v$1233){var v$1681 = v$1233[0];
var v$1682 = v$1233[1];
var v$1683 = v$1233[2];
var rayAngle$1234 = RealMod$1104(v$1681,twoPI$573);
var rayAngle$1235 = (rayAngle$1234 < 0.0)?(rayAngle$1234 + twoPI$573):rayAngle$1234;
var right$1240 = (rayAngle$1235 > (twoPI$573 * 0.75))?true:(rayAngle$1235 < (twoPI$573 * 0.25));
var up$1245 = (rayAngle$1235 < 0.0)?true:(rayAngle$1235 > 3.14159265358979323846);
var angleSin$1250 = Math.sin(rayAngle$1235);
var angleCos$1251 = Math.cos(rayAngle$1235);
var slope$1252 = angleSin$1250 / angleCos$1251;
var dXVer$1253 = right$1240?1.0:(-1.0);
var dYVer$1258 = dXVer$1253 * slope$1252;
var x$1259 = right$1240?(SmlPrims.chk_ovf_i32(Math.ceil(player$563[5][0]))):(SmlPrims.chk_ovf_i32(Math.floor(player$563[5][0])));
var x$1272 = x$1259;
var y$1273 = player$563[6][0] + ((x$1272 - player$563[5][0]) * slope$1252);
var emptyHit$1282 = [0.0,false,0.0,[9],0.0,0,0.0,0];
var v$1678;
var fix$4981 = {};
fix$4981.$loopV = function(v$4767,v$4768,visibleSprites$1298){lab$loopV: while (true) {if ((v$4767 < 0.0)?true:((v$4767 >= mapWidthR$580)?true:((v$4768 < 0.0)?true:(v$4768 >= mapHeightR$582)))) {return [emptyHit$1282,visibleSprites$1298];
} else {var wallX$1303 = SmlPrims.chk_ovf_i32(Math.floor(right$1240?v$4767:(v$4767 - 1.0)));
var wallY$1308 = SmlPrims.chk_ovf_i32(Math.floor(v$4768));
var wt$1309;
var v$3025 = Map$419[0][0];
Map$419[0][1];
Map$419[0][2];
var v$3027 = v$3025.length;
if ((0 <= wallY$1308)?(wallY$1308 < v$3027):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3029 = v$3025[wallY$1308];
var v$3030 = v$3029.length;
if ((0 <= wallX$1303)?(wallX$1303 < v$3030):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$1309 = v$3029[wallX$1303];
var t$4982;
switch (wt$1309[0]) { case 9: {t$4982 = false;
 break; }case 8: {t$4982 = false;
 break; }default: {t$4982 = true;
} };
if (t$4982) {var distX$1314 = v$4767 - player$563[5][0];
var distY$1319 = v$4768 - player$563[6][0];
var dist$1324 = (distX$1314 * distX$1314) + (distY$1319 * distY$1319);
var textureX$1325 = v$4768 - (SmlPrims.chk_ovf_i32(Math.floor(v$4768)));
var textureX$1326 = (right$1240?false:true)?(1.0 - textureX$1325):textureX$1325;
return [[dist$1324,(rayAngle$1235 < (3.14159265358979323846 / 2.0))?true:(rayAngle$1235 > ((3.0 * 3.14159265358979323846) / 2.0)),textureX$1326,wt$1309,v$4767,wallX$1303,v$4768,wallY$1308],visibleSprites$1298];
} else {var t$4985 = v$4767 + dXVer$1253;
var t$4984 = v$4768 + dYVer$1258;
var t$4983;
var v$1348;
var v$3041 = spriteMap$1228[0][0];
spriteMap$1228[0][1];
spriteMap$1228[0][2];
var v$3043 = v$3041.length;
if ((0 <= wallY$1308)?(wallY$1308 < v$3043):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3045 = v$3041[wallY$1308];
var v$3046 = v$3045.length;
if ((0 <= wallX$1303)?(wallX$1303 < v$3046):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$1348 = v$3045[wallX$1303];
switch (v$1348[0]) { case 1: {t$4983 = visibleSprites$1298;
 break; }default: {var v$1363 = v$1348[1];
if (v$1363[4][0]) {t$4983 = visibleSprites$1298;
} else {(v$1363[4][0] = true,0);
t$4983 = [v$1363,visibleSprites$1298];
};
} };
var t$4986 = t$4985;
var t$4987 = t$4984;
var t$4988 = t$4983;
var v$4767 = t$4986;
var v$4768 = t$4987;
var visibleSprites$1298 = t$4988;
continue lab$loopV;
};
};
};
};
var loopV$1291 = fix$4981.$loopV;
v$1678 = (loopV$1291(x$1272,y$1273,v$1683));
var v$1679 = v$1678[0];
var v$1680 = v$1678[1];
var slope$1381 = angleCos$1251 / angleSin$1250;
var dYHor$1382 = up$1245?(-1.0):1.0;
var dXHor$1387 = dYHor$1382 * slope$1381;
var y$1388 = up$1245?(SmlPrims.chk_ovf_i32(Math.floor(player$563[6][0]))):(SmlPrims.chk_ovf_i32(Math.ceil(player$563[6][0])));
var x$1401 = player$563[5][0] + ((y$1388 - player$563[6][0]) * slope$1381);
var v$1667;
var fix$4989 = {};
fix$4989.$loopH = function(v$4771,v$4772,visibleSprites$1417){lab$loopH: while (true) {if ((v$4771 < 0.0)?true:((v$4771 >= mapWidthR$580)?true:((v$4772 < 0.0)?true:((v$4772 >= mapHeightR$582)?true:((slope$1381 > 10000.0)?true:(up$1245?((v$4772 - 1.0) < 0.0):false)))))) {return [v$1679,visibleSprites$1417];
} else {var wallY$1422 = SmlPrims.chk_ovf_i32(Math.floor(up$1245?(v$4772 - 1.0):v$4772));
var wallX$1427 = SmlPrims.chk_ovf_i32(Math.floor(v$4771));
var wt$1428;
try {var v$3061 = Map$419[0][0];
Map$419[0][1];
Map$419[0][2];
var v$3063 = v$3061.length;
if ((0 <= wallY$1422)?(wallY$1422 < v$3063):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3065 = v$3061[wallY$1422];
var v$3066 = v$3065.length;
if ((0 <= wallX$1427)?(wallX$1427 < v$3066):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
wt$1428 = v$3065[wallX$1427];
} catch(v$4990) {wt$1428 = (((function(env$4995){return function(s$m$1431){var v$4991 = env$4995[0];
var v$4992 = env$4995[1];
var v$4993 = env$4995[2];
var v$4994 = env$4995[3];
var s$3067 = (("wallX = " + ((v$4994 < 0)?("-" + (v$4993(SmlPrims.chk_ovf_i32(-(v$4994))))):(v$4993(v$4994)))) + "; wallY = ") + ((v$4992 < 0)?("-" + (v$4993(SmlPrims.chk_ovf_i32(-(v$4992))))):(v$4993(v$4992)));
var log$3068;
var v$3070 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(v$4991,"log");
switch (v$3070[0]) { case 0: {log$3068 = v$3070[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'log' in DOM"];
} };
(function(e,a){return e.appendChild(a);})(log$3068,document.createTextNode(s$3067));
(function(e,a){return e.appendChild(a);})(log$3068,document.createElement("br"));
throw s$m$1431;
};
})([z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,wallY$1422,abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456,wallX$1427]))(v$4990));
};
var t$4996;
switch (wt$1428[0]) { case 9: {t$4996 = false;
 break; }case 8: {t$4996 = false;
 break; }default: {t$4996 = true;
} };
if (t$4996) {var distX$1438 = v$4771 - player$563[5][0];
var distY$1443 = v$4772 - player$563[6][0];
var blockDist$1448 = (distX$1438 * distX$1438) + (distY$1443 * distY$1443);
if (((v$1679[0] > 0.0)?false:true)?true:(blockDist$1448 < v$1679[0])) {var textureX$1453 = v$4771 - (SmlPrims.chk_ovf_i32(Math.floor(v$4771)));
return [[blockDist$1448,rayAngle$1235 < 3.14159265358979323846,1.0 - (up$1245?(1.0 - textureX$1453):textureX$1453),wt$1428,v$4771,wallX$1427,v$4772,wallY$1422],visibleSprites$1417];
} else {return [v$1679,visibleSprites$1417];
};
} else {var t$4999 = v$4771 + dXHor$1387;
var t$4998 = v$4772 + dYHor$1382;
var t$4997;
var v$1485;
var v$3092 = spriteMap$1228[0][0];
spriteMap$1228[0][1];
spriteMap$1228[0][2];
var v$3094 = v$3092.length;
if ((0 <= wallY$1422)?(wallY$1422 < v$3094):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var v$3096 = v$3092[wallY$1422];
var v$3097 = v$3096.length;
if ((0 <= wallX$1427)?(wallX$1427 < v$3097):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
v$1485 = v$3096[wallX$1427];
switch (v$1485[0]) { case 1: {t$4997 = visibleSprites$1417;
 break; }default: {var v$1500 = v$1485[1];
if (v$1500[4][0]) {t$4997 = visibleSprites$1417;
} else {(v$1500[4][0] = true,0);
t$4997 = [v$1500,visibleSprites$1417];
};
} };
var t$5000 = t$4999;
var t$5001 = t$4998;
var t$5002 = t$4997;
var v$4771 = t$5000;
var v$4772 = t$5001;
var visibleSprites$1417 = t$5002;
continue lab$loopH;
};
};
};
};
var loopH$1410 = fix$4989.$loopH;
v$1667 = (loopH$1410(x$1401,y$1388,v$1680));
var v$1668 = v$1667[0];
var v$1669 = v$1668[0];
var v$1672 = v$1668[5];
var v$1673 = v$1668[7];
var v$1674 = v$1668[3];
var v$1675 = v$1668[2];
var v$1676 = v$1668[1];
var v$1677 = v$1667[1];
if (v$1669 <= 0.0) {return v$1677;
} else {var dist$1541 = Math.sqrt(v$1669);
var dist$1542 = dist$1541 * (Math.cos(player$563[1][0] - rayAngle$1235));
var height$1547 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(viewDist$586 / dist$1542);
var width$1548 = SmlPrims.chk_ovf_i32(height$1547 * 1);
var widthR$1549 = width$1548;
var heightR$1550 = height$1547;
var top$1551 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((screenHeightR$584 - heightR$1550) / 2.0);
var texX$1552 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(v$1675 * widthR$1549);
var texX$1553 = (texX$1552 > (SmlPrims.chk_ovf_i32(width$1548 - 1)))?(SmlPrims.chk_ovf_i32(width$1548 - 1)):texX$1552;
var v$3110 = screenStrips$1225.length;
if ((0 <= v$1682)?(v$1682 < v$3110):false) {0;
} else {throw CompilerInitial.exn$Subscript$50;
};
var stripdata$1558 = screenStrips$1225[v$1682];
var wallType$1559;
if (v$1676) {switch (v$1674[0]) { case 13: {wallType$1559 = [12];
 break; }case 12: {wallType$1559 = [13];
 break; }default: {wallType$1559 = v$1674;
} };
} else {wallType$1559 = v$1674;
};
var v$1608;
switch (wallType$1559[0]) { case 13: {var v$3112 = stripdata$1558[0];
var v$3113 = stripdata$1558[1];
var r$3115 = v$3113[3];
if (r$3115[0] == "datoek-000.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$3112,"src","datoek-000.png");
(r$3115[0] = "datoek-000.png",0);
};
v$1608 = [1,0,texX$1553,2.0];
 break; }case 12: {var v$3125 = stripdata$1558[0];
var v$3126 = stripdata$1558[1];
var r$3128 = v$3126[3];
if (r$3128[0] == "datoek-000.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$3125,"src","datoek-000.png");
(r$3128[0] = "datoek-000.png",0);
};
v$1608 = [1,0,SmlPrims.chk_ovf_i32(texX$1553 + width$1548),2.0];
 break; }case 1: {var v$3138 = stripdata$1558[0];
var v$3139 = stripdata$1558[1];
var r$3141 = v$3139[3];
if (r$3141[0] == "window-left.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$3138,"src","window-left.png");
(r$3141[0] = "window-left.png",0);
};
v$1608 = [1,0,texX$1553,1.0];
 break; }case 2: {var v$3151 = stripdata$1558[0];
var v$3152 = stripdata$1558[1];
var r$3154 = v$3152[3];
if (r$3154[0] == "window-center.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$3151,"src","window-center.png");
(r$3154[0] = "window-center.png",0);
};
v$1608 = [1,0,texX$1553,1.0];
 break; }case 0: {var v$3164 = stripdata$1558[0];
var v$3165 = stripdata$1558[1];
var r$3167 = v$3165[3];
if (r$3167[0] == "window-right.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$3164,"src","window-right.png");
(r$3167[0] = "window-right.png",0);
};
v$1608 = [1,0,texX$1553,1.0];
 break; }case 7: {var v$3177 = stripdata$1558[0];
var v$3178 = stripdata$1558[1];
var r$3180 = v$3178[3];
if (r$3180[0] == "wall-white.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$3177,"src","wall-white.png");
(r$3180[0] = "wall-white.png",0);
};
v$1608 = [1,0,texX$1553,1.0];
 break; }case 10: {var v$3190 = stripdata$1558[0];
var v$3191 = stripdata$1558[1];
var r$3193 = v$3191[3];
if (r$3193[0] == "wall-shelf1.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$3190,"src","wall-shelf1.png");
(r$3193[0] = "wall-shelf1.png",0);
};
v$1608 = [1,0,texX$1553,1.0];
 break; }case 11: {var v$3203 = stripdata$1558[0];
var v$3204 = stripdata$1558[1];
var r$3206 = v$3204[3];
if (r$3206[0] == "wall-shelf2.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$3203,"src","wall-shelf2.png");
(r$3206[0] = "wall-shelf2.png",0);
};
v$1608 = [1,0,texX$1553,1.0];
 break; }case 3: {var v$3216 = stripdata$1558[0];
var v$3217 = stripdata$1558[1];
var r$3219 = v$3217[3];
if (r$3219[0] == "wall-board.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$3216,"src","wall-board.png");
(r$3219[0] = "wall-board.png",0);
};
v$1608 = [1,0,texX$1553,1.0];
 break; }case 14: {var v$3229 = stripdata$1558[0];
var v$3230 = stripdata$1558[1];
var r$3232 = v$3230[3];
if (r$3232[0] == "wall-bulletin.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$3229,"src","wall-bulletin.png");
(r$3232[0] = "wall-bulletin.png",0);
};
v$1608 = [1,0,texX$1553,1.0];
 break; }case 6: {var v$3242 = stripdata$1558[0];
var v$3243 = stripdata$1558[1];
var r$3245 = v$3243[3];
if (r$3245[0] == "walls.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$3242,"src","walls.png");
(r$3245[0] = "walls.png",0);
};
v$1608 = [4,0,texX$1553,2.0];
 break; }case 5: {var v$3255 = stripdata$1558[0];
var v$3256 = stripdata$1558[1];
var r$3258 = v$3256[3];
if (r$3258[0] == "walls.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$3255,"src","walls.png");
(r$3258[0] = "walls.png",0);
};
v$1608 = [4,1,texX$1553,2.0];
 break; }case 4: {var v$3268 = stripdata$1558[0];
var v$3269 = stripdata$1558[1];
var r$3271 = v$3269[3];
if (r$3271[0] == "walls.png") {0;
} else {(function(e,a,b){return e.setAttribute(a,b);})(v$3268,"src","walls.png");
(r$3271[0] = "walls.png",0);
};
v$1608 = [4,2,texX$1553,2.0];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"obj not supported"];
} };
var v$1609 = v$1608[0];
var v$1610 = v$1608[1];
var v$1611 = v$1608[2];
var v$1612 = v$1608[3];
var v$4575 = stripdata$1558[0];
var v$4576 = stripdata$1558[1];
var r$4578 = v$4576[1];
if (r$4578[0] == height$1547) {0;
} else {var v$4579 = ((height$1547 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(height$1547))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(height$1547))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$4575,"style"),"height",v$4579);
(r$4578[0] = height$1547,0);
};
var v$4582 = stripdata$1558[0];
var v$4583 = stripdata$1558[1];
var r$4585 = v$4583[4];
if (r$4585[0] == top$1551) {0;
} else {var v$4586 = ((top$1551 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(top$1551))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(top$1551))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$4582,"style"),"top",v$4586);
(r$4585[0] = top$1551,0);
};
var imgTop$1577 = SmlPrims.chk_ovf_i32(Math.floor(heightR$1550 * v$1610));
var styleHeight$1578 = SmlPrims.chk_ovf_i32(Math.floor(heightR$1550 * v$1609));
var v$4589 = stripdata$1558[0];
var v$4590 = stripdata$1558[1];
var r$4592 = v$4590[1];
if (r$4592[0] == styleHeight$1578) {0;
} else {var v$4593 = ((styleHeight$1578 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(styleHeight$1578))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(styleHeight$1578))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$4589,"style"),"height",v$4593);
(r$4592[0] = styleHeight$1578,0);
};
var styleWidth$1580 = SmlPrims.chk_ovf_i32(Math.floor(widthR$1549 * v$1612));
var v$4596 = stripdata$1558[0];
var v$4597 = stripdata$1558[1];
var r$4599 = v$4597[5];
if (r$4599[0] == styleWidth$1580) {0;
} else {var v$4600 = ((styleWidth$1580 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(styleWidth$1580))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(styleWidth$1580))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$4596,"style"),"width",v$4600);
(r$4599[0] = styleWidth$1580,0);
};
var styleTop$1582 = SmlPrims.chk_ovf_i32(top$1551 - imgTop$1577);
var v$4603 = stripdata$1558[0];
var v$4604 = stripdata$1558[1];
var r$4606 = v$4604[4];
if (r$4606[0] == styleTop$1582) {0;
} else {var v$4607 = ((styleTop$1582 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(styleTop$1582))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(styleTop$1582))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$4603,"style"),"top",v$4607);
(r$4606[0] = styleTop$1582,0);
};
var styleLeft$1584 = SmlPrims.chk_ovf_i32((SmlPrims.chk_ovf_i32(v$1682 * 1)) - v$1611);
var v$4610 = stripdata$1558[0];
var v$4611 = stripdata$1558[1];
var r$4613 = v$4611[2];
if (r$4613[0] == styleLeft$1584) {0;
} else {var v$4614 = ((styleLeft$1584 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(styleLeft$1584))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(styleLeft$1584))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$4610,"style"),"left",v$4614);
(r$4613[0] = styleLeft$1584,0);
};
var styleClip$1586;
var t$5010;
var t$5009;
var t$5008;
var t$5007;
var t$5006;
var t$5005 = ("rect(" + ((imgTop$1577 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(imgTop$1577))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(imgTop$1577)))) + ",";
var t$5004;
var i$3295 = SmlPrims.chk_ovf_i32(v$1611 + 1);
t$5004 = ((i$3295 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$3295))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$3295)));
t$5006 = (t$5005 + t$5004);
t$5007 = (t$5006 + ",");
var t$5003;
var i$3297 = SmlPrims.chk_ovf_i32(imgTop$1577 + height$1547);
t$5003 = ((i$3297 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$3297))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$3297)));
t$5008 = (t$5007 + t$5003);
t$5009 = (t$5008 + ",");
t$5010 = (t$5009 + ((v$1611 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(v$1611))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(v$1611))));
styleClip$1586 = (t$5010 + ")");
var v$3302 = stripdata$1558[0];
var v$3303 = stripdata$1558[1];
var r$3305 = v$3303[0];
if (r$3305[0] == styleClip$1586) {0;
} else {(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3302,"style"),"clip",styleClip$1586);
(r$3305[0] = styleClip$1586,0);
};
var dwx$1588 = v$1672 - player$563[5][0];
var dwy$1593 = v$1673 - player$563[6][0];
var wallDist$1598 = (dwx$1588 * dwx$1588) + (dwy$1593 * dwy$1593);
var v$4617 = stripdata$1558[0];
var v$4618 = stripdata$1558[1];
var n$4619 = SmlPrims.chk_ovf_i32(-(SmlPrims.chk_ovf_i32(Math.floor(wallDist$1598 * 1000.0))));
var r$4620 = v$4618[6];
if (r$4620[0] == n$4619) {0;
} else {var v$4621 = (n$4619 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(n$4619))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(n$4619));
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$4617,"style"),"zIndex",v$4621);
(r$4620[0] = n$4619,0);
};
return v$1677;
};
};
};
});
var zero$1710 = SmlPrims.getrealtime();
var gameCycle$1715 = function(spriteMap$1718){var gameCycleDelay$1719 = TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.div$1394([0,[[1000,null],false]],[0,[[30,null],false]]);
var fix$5011 = {};
fix$5011.$cycle = function(lastGameCycleTime$1723){lab$cycle: while (true) {var n$1726;
var v$4711;
var v$4847 = SmlPrims.getrealtime();
v$4711 = (g14hFoVCUPM3ZC3WsORS6h$3basis$0Time$1.s$g$309(v$4847[0],v$4847[1],zero$1710[0],zero$1710[1]));
n$1726 = (g14hFoVCUPM3ZC3WsORS6h$3basis$0Time$1.toMilliseconds$97(v$4711[0],v$4711[1]));
var timeDelta$1727 = TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(lastGameCycleTime$1723,n$1726);
var mul$3333 = (xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.toInt$1823(timeDelta$1727)) / (xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.toInt$1823(gameCycleDelay$1719));
var moveStep$3335 = (mul$3333 * player$563[4][0]) * player$563[0];
var t$5013 = player$563[3];
var t$5012;
var a$3337 = player$563[3][0] + player$563[2][0];
t$5012 = ((a$3337 > 0.0)?((a$3337 > 2.0)?2.0:a$3337):((a$3337 < (-(2.0)))?(-(2.0)):a$3337));
(t$5013[0] = t$5012,0);
var drot$3339 = (mul$3333 * player$563[3][0]) * MaxRotSpeed$562;
var v$4303 = player$563[1];
(v$4303[0] = (v$4303[0] + drot$3339),0);
var dx$3344 = (Math.cos(player$563[1][0])) * moveStep$3335;
var dy$3345 = (Math.sin(player$563[1][0])) * moveStep$3335;
var fromX$3346 = player$563[5][0];
var fromY$3347 = player$563[6][0];
var v$3348 = checkCollision$748(spriteMap$1718,fromX$3346,fromY$3347,fromX$3346 + dx$3344,fromY$3347 + dy$3345,0.35);
var v$3349 = v$3348[0];
var v$3350 = v$3348[1];
(player$563[5][0] = v$3349,0);
(player$563[6][0] = v$3350,0);
var cycleDelay$1728 = (TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$l$1462(timeDelta$1727,gameCycleDelay$1719))?(xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.max$2267([0,[[1,null],false]],TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(gameCycleDelay$1719,timeDelta$1727),gameCycleDelay$1719))):gameCycleDelay$1719;
(function(i,f){return setTimeout(f,i);})(xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.toInt$1823(cycleDelay$1728),(function(env$5016){return function(v$4718){var v$5014 = env$5016[0];
var v$5015 = env$5016[1];
return v$5015(v$5014);
};
})([n$1726,fix$5011.$cycle]));
return 0;
};
};
var cycle$1720 = fix$5011.$cycle;
return cycle$1720([0,[null,false]]);
};
var updateOverlay$1754;
var old$3369 = [""];
updateOverlay$1754 = (function(v$3370){var s$3371 = "FPS: " + ((y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.fmt$169([2,[0,0]]))(v$3370));
if (old$3369[0] == s$3371) {return 0;
} else {var e$3375;
var v$3377 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"overlay");
switch (v$3377[0]) { case 0: {e$3375 = v$3377[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'overlay' in DOM"];
} };
(function(e,s){e.innerHTML = s;})(e$3375,s$3371);
return (old$3369[0] = s$3371,0);
};
});
var updateScore$1758;
var old$3387 = [""];
updateScore$1758 = (function(v$3388){var s$3389 = "SCORE: " + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(v$3388));
if (old$3387[0] == s$3389) {return 0;
} else {var e$3393;
var v$3395 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"score");
switch (v$3395[0]) { case 0: {e$3393 = v$3395[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'score' in DOM"];
} };
(function(e,s){e.innerHTML = s;})(e$3393,s$3389);
return (old$3387[0] = s$3389,0);
};
});
var renderSprites$1762 = function(oldSprites$1765,sprites$1768){var v$3403 = function(v$4776,v$4897,v$4898){var dx$3414 = (v$4897 + 0.5) - player$563[5][0];
var dy$3418 = (v$4898 + 0.5) - player$563[6][0];
var dist$3422 = Math.sqrt((dx$3414 * dx$3414) + (dy$3418 * dy$3418));
var spriteAngle$3423 = (Math.atan2(dy$3418,dx$3414)) - player$563[1][0];
var size$3427 = viewDist$586 / ((Math.cos(spriteAngle$3423)) * dist$3422);
if (size$3427 <= 0.0) {return 0;
} else {(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$4776,"style"),"display","block");
var screen_x$3434 = ((Math.sin(spriteAngle$3423)) / (Math.cos(spriteAngle$3423))) * viewDist$586;
var left$3435 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(((screenWidthR$583 / 2.0) + screen_x$3434) - (size$3427 / 2.0));
var top$3436 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((screenHeightR$584 - size$3427) / 2.0);
var v$4348 = ((left$3435 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(left$3435))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(left$3435))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$4776,"style"),"left",v$4348);
var v$4354 = ((top$3436 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(top$3436))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(top$3436))) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$4776,"style"),"top",v$4354);
var dbx$3439 = v$4897 - player$563[5][0];
var dby$3443 = v$4898 - player$563[6][0];
var sz$3447;
var t$5017;
var i$3494 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(size$3427);
t$5017 = ((i$3494 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(i$3494))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(i$3494)));
sz$3447 = (t$5017 + "px");
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$4776,"style"),"width",sz$3447);
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$4776,"style"),"height",sz$3447);
var blockDist$3450 = (dbx$3439 * dbx$3439) + (dby$3443 * dby$3443);
var zIndex$3451 = SmlPrims.chk_ovf_i32(-(SmlPrims.chk_ovf_i32(Math.floor(blockDist$3450 * 1000.0))));
var v$4368 = (zIndex$3451 < 0)?("-" + (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(SmlPrims.chk_ovf_i32(-(zIndex$3451))))):(abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(zIndex$3451));
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$4776,"style"),"zIndex",v$4368);
return 0;
};
};
var fix$5018 = {};
fix$5018.$app = function(v$3454){lab$app: while (true) {if (v$3454 == null) {return 0;
} else {var v$3455 = v$3454;
var v$3456 = v$3455[0];
var v$3457 = v$3455[1];
var v$4900 = v$3456[3];
v$3403(v$3456[2],v$4900[0],v$4900[1]);
var t$5019 = v$3457;
var v$3454 = t$5019;
continue lab$app;
};
};
};
var app$3453 = fix$5018.$app;
app$3453(sprites$1768);
var fix$5020 = {};
fix$5020.$app = function(v$3522){lab$app: while (true) {if (v$3522 == null) {return 0;
} else {var v$3523 = v$3522;
var v$3524 = v$3523[0];
var v$3525 = v$3523[1];
(v$3524[4][0]?false:true)?((function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(v$3524[2],"style"),"display","none")):0;
var t$5021 = v$3525;
var v$3522 = t$5021;
continue lab$app;
};
};
};
var app$3521 = fix$5020.$app;
return app$3521(oldSprites$1765);
};
var score$1864 = [0];
var renderCycle$1865 = function(screenStrips$1868,spriteMap$1871){var renderCycleDelay$1872 = TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.div$1394([0,[[1000,null],false]],[0,[[30,null],false]]);
var fix$5022 = {};
fix$5022.$cycle = function(v$4777,v$4778){lab$cycle: while (true) {var miniMap$4626;
var v$4627 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimap");
switch (v$4627[0]) { case 0: {miniMap$4626 = v$4627[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimap' in DOM"];
} };
var miniMapObjects$4628;
var v$4629 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"minimapobjects");
switch (v$4629[0]) { case 0: {miniMapObjects$4628 = v$4629[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'minimapobjects' in DOM"];
} };
var height$4630 = (function(fp,s){return fp[s];})(miniMap$4626,"height");
var width$4631 = (function(fp,s){return fp[s];})(miniMap$4626,"width");
var c$4632 = (function(e,s){return e.getContext(s);})(miniMapObjects$4628,"2d");
(function(c,a1,a2,a3,a4){c.clearRect(a1,a2,a3,a4);})(c$4632,0,0,width$4631,height$4630);
(function(c,a1,a2,a3,a4){c.fillRect(a1,a2,a3,a4);})(c$4632,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$563[5][0] * miniMapScaleR$577) - 2.0),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$563[6][0] * miniMapScaleR$577) - 2.0),4,4);
(function(c){c.beginPath();})(c$4632);
(function(c,a1,a2){c.moveTo(a1,a2);})(c$4632,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(player$563[5][0] * miniMapScaleR$577),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615(player$563[6][0] * miniMapScaleR$577));
(function(c,a1,a2){c.lineTo(a1,a2);})(c$4632,y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$563[5][0] + (Math.cos(player$563[1][0]))) * miniMapScaleR$577),y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.round$615((player$563[6][0] + (Math.sin(player$563[1][0]))) * miniMapScaleR$577));
(function(c){c.closePath();})(c$4632);
(function(c){c.stroke();})(c$4632);
var fix$5023 = {};
fix$5023.$app = function(v$3553){lab$app: while (true) {if (v$3553 == null) {return 0;
} else {var v$3554 = v$3553;
var v$3555 = v$3554[0];
var v$3556 = v$3554[1];
(v$3555[4][0] = false,0);
var t$5024 = v$3556;
var v$3553 = t$5024;
continue lab$app;
};
};
};
var app$3552 = fix$5023.$app;
app$3552(v$4778);
var sprites$1882;
var fix$5025 = {};
fix$5025.$loop = function(i$3562,acc$3563){lab$loop: while (true) {if (i$3562 >= numRays$585) {return acc$3563;
} else {var rayScreenPos$3564 = (((-(numRays$585)) / 2.0) + i$3562) * stripWidthR$575;
var rayViewDist$3566 = Math.sqrt((rayScreenPos$3564 * rayScreenPos$3564) + (viewDist$586 * viewDist$586));
var rayAngle$3567 = Math.asin(rayScreenPos$3564 / rayViewDist$3566);
var acc$3569 = ((castSingleRay$1222(screenStrips$1868))(spriteMap$1871))([player$563[1][0] + rayAngle$3567,i$3562,acc$3563]);
var t$5026 = SmlPrims.chk_ovf_i32(i$3562 + 1);
var t$5027 = acc$3569;
var i$3562 = t$5026;
var acc$3563 = t$5027;
continue lab$loop;
};
};
};
var loop$3561 = fix$5025.$loop;
sprites$1882 = (loop$3561(0,null));
renderSprites$1762(v$4778,sprites$1882);
var n$1884;
var v$4729;
var v$4866 = SmlPrims.getrealtime();
v$4729 = (g14hFoVCUPM3ZC3WsORS6h$3basis$0Time$1.s$g$309(v$4866[0],v$4866[1],zero$1710[0],zero$1710[1]));
n$1884 = (g14hFoVCUPM3ZC3WsORS6h$3basis$0Time$1.toMilliseconds$97(v$4729[0],v$4729[1]));
var timeDelta$1885 = TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(v$4777,n$1884);
var cycleDelay$1886 = (TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$l$1462(timeDelta$1885,renderCycleDelay$1872))?(xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.max$2267([0,[[1,null],false]],TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(TtcHr52auHS5gydZjBhWJe$3basis$0IntInfRep$1.s$g$1258(renderCycleDelay$1872,timeDelta$1885),renderCycleDelay$1872))):renderCycleDelay$1872;
var cycleDelay$1891 = xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.toInt$1823(cycleDelay$1886);
(function(i,f){return setTimeout(f,i);})(cycleDelay$1891,(function(env$5031){return function(v$4895){var v$5028 = env$5031[0];
var v$5029 = env$5031[1];
var v$5030 = env$5031[2];
return v$5030(v$5029,v$5028);
};
})([sprites$1882,n$1884,fix$5022.$cycle]));
var fps$1892 = 1000.0 / (xe4rCkobvAWmCENzbhJ8Ed$3basis$0IntInf$1.toInt$1823(timeDelta$1885));
updateOverlay$1754(fps$1892);
return updateScore$1758(score$1864[0]);
};
};
var cycle$1873 = fix$5022.$cycle;
return cycle$1873([0,[null,false]],null);
};
var init$1926 = function(){(function(f){document.onkeydown = function(e) { e = e || window.event; f(e.keyCode); };})(function(v$3610){switch (v$3610) { case 38: {return (player$563[4][0] = 1.0,0);
 break; }case 40: {return (player$563[4][0] = (-1.0),0);
 break; }case 37: {var rotAcc$3613 = player$563[2];
return (rotAcc$3613[0] > (-0.5))?(rotAcc$3613[0] = (rotAcc$3613[0] - 0.1),0):0;
 break; }case 39: {var rotAcc$3615 = player$563[2];
return (rotAcc$3615[0] < 0.5)?(rotAcc$3615[0] = (rotAcc$3615[0] + 0.1),0):0;
 break; }default: {return 0;
} };
});
(function(f){document.onkeyup = function(e) { e = e || window.event; f(e.keyCode); };})(function(v$3619){switch (v$3619) { case 38: {return (player$563[4][0] = 0.0,0);
 break; }case 40: {return (player$563[4][0] = 0.0,0);
 break; }case 37: {(player$563[3][0] = 0.0,0);
return (player$563[2][0] = 0.0,0);
 break; }case 39: {(player$563[3][0] = 0.0,0);
return (player$563[2][0] = 0.0,0);
 break; }default: {return 0;
} };
});
try {var t$5038 = h9AP67nN46MQi5f2NQrocNd$3university$0university$1.loadStaff$60;
var t$5037;
var file$3627;
var t$5036 = "data/staff.json?_=";
var t$5035;
var t$5034 = y1CWDAIcrGTm72MVeo9tyi$3basis$0Real$1.toString$158;
var t$5033;
var v$3630 = SmlPrims.getrealtime();
var v$3631 = v$3630[0];
var v$3632 = v$3630[1];
t$5033 = ((v$3631 - (-2147483648)) + (v$3632 / 1000000.0));
t$5035 = (t$5034(t$5033));
file$3627 = (t$5036 + t$5035);
var r$3633 = SmlPrims.newRequest();
(function(r,m,u,a){return r.open(m,u,a);})(r$3633,"GET",file$3627,false);
z11cymP27JOrM6FBeJkkje$3js$0Js$1.send$652(r$3633,[1]);
var v$3636 = (function(r){return SmlPrims.option(r.responseText);})(r$3633);
switch (v$3636[0]) { case 0: {t$5037 = v$3636[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"serverGet failed on file " + file$3627];
} };
t$5038(t$5037);
} catch(v$5032) {(function(v$1934){var t$5039 = v$1934;
if (t$5039[0] == sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52) {var msg$1931 = v$1934[1];
var s$3638 = "Failed to load data/staff.json file: " + msg$1931;
var log$3639;
var v$3641 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"log");
switch (v$3641[0]) { case 0: {log$3639 = v$3641[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'log' in DOM"];
} };
(function(e,a){return e.appendChild(a);})(log$3639,document.createTextNode(s$3638));
(function(e,a){return e.appendChild(a);})(log$3639,document.createElement("br"));
return null;
} else {throw v$1934;
};
})(v$5032);
};
var v$3666 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"screen");
switch (v$3666[0]) { case 0: {v$3666[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'screen' in DOM"];
} };
var screenStrips$1937;
var xs$3649;
var fix$5040 = {};
fix$5040.$loop = function(i$3670){if (i$3670 >= screenWidth$318) {return null;
} else {var strip$3671 = document.createElement("img");
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(strip$3671,"style"),"position","absolute");
(function(fp,s,v){fp[s] = v;})(strip$3671,"src","walls.png");
var stripdata$3680;
var t$5042 = strip$3671;
var t$5041;
var v$3681 = [-1];
var v$3682 = [-1];
var v$3683 = [-1];
var v$3684 = [-1];
var v$3685 = [""];
var v$3686 = [-1];
t$5041 = [v$3685,v$3682,v$3683,["walls.png"],v$3684,v$3681,v$3686];
stripdata$3680 = [t$5042,t$5041];
var v$4635 = stripdata$3680[1];
var r$4637 = v$4635[1];
if (r$4637[0] == 0) {0;
} else {var v$4638 = (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(0)) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(strip$3671,"style"),"height",v$4638);
(r$4637[0] = 0,0);
};
var v$4642 = stripdata$3680[1];
var r$4644 = v$4642[2];
if (r$4644[0] == 0) {0;
} else {var v$4645 = (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(0)) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(strip$3671,"style"),"left",v$4645);
(r$4644[0] = 0,0);
};
var v$4649 = stripdata$3680[1];
var r$4651 = v$4649[4];
if (r$4651[0] == 0) {0;
} else {var v$4652 = (abSkfeMyxlIKxrMz4NXGul$3basis$0Int32$1.toString$456(0)) + "px";
(function(fp,s,v){fp[s] = v;})((function(fp,s){return fp[s];})(strip$3671,"style"),"top",v$4652);
(r$4651[0] = 0,0);
};
var t$5043;
var v$3689 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(z11cymP27JOrM6FBeJkkje$3js$0Js$1.document$86,"screen");
switch (v$3689[0]) { case 0: {t$5043 = v$3689[1];
 break; }default: {throw [sWBNi829bz3yxJwtxAWd8b$3basis$0Initial$1.en$Fail$52,"no element with id 'screen' in DOM"];
} };
(function(e,a){return e.appendChild(a);})(t$5043,strip$3671);
return [stripdata$3680,fix$5040.$loop(SmlPrims.chk_ovf_i32(i$3670 + 1))];
};
};
var loop$3669 = fix$5040.$loop;
xs$3649 = (loop$3669(0));
var fix$5044 = {};
fix$5044.$init = function(v$4781,v$4782,v$4783){lab$init: while (true) {if (v$4781 == null) {return v$4782;
} else {var v$3654 = v$4781;
var v$3655 = v$3654[0];
var v$3656 = v$3654[1];
(v$4782[v$4783] = v$3655,0);
var t$5045 = v$3656;
var t$5046 = v$4782;
var t$5047 = SmlPrims.chk_ovf_i32(v$4783 + 1);
var v$4781 = t$5045;
var v$4782 = t$5046;
var v$4783 = t$5047;
continue lab$init;
};
};
};
var init$3650 = fix$5044.$init;
var t$5053 = init$3650;
var t$5052 = xs$3649;
var t$5051;
var n$3658;
var fix$5048 = {};
fix$5048.$acc = function(v$3660,v$3661){lab$acc: while (true) {if (v$3660 == null) {return v$3661;
} else {var t$5049 = v$3660[1];
var t$5050 = SmlPrims.chk_ovf_i32(v$3661 + 1);
var v$3660 = t$5049;
var v$3661 = t$5050;
continue lab$acc;
};
};
};
var acc$3659 = fix$5048.$acc;
n$3658 = (acc$3659(xs$3649,0));
if ((0 <= n$3658)?(n$3658 <= 123456789):false) {0;
} else {throw CompilerInitial.exn$Size$51;
};
t$5051 = (Array(n$3658));
screenStrips$1937 = (t$5053(t$5052,t$5051,0));
var spriteMap$1938 = init$503(Y5y0a7l58ITwhpccCWLDEa$3basis$0Array2$1.foldi$383(0,function(v$4828){var v$4829 = v$4828[0];
var v$4830 = v$4828[1];
var v$4831 = v$4828[2];
var v$4832 = v$4828[3];
var v$4833;
switch (v$4831[0]) { case 8: {var v$4834 = v$4831[1];
v$4833 = [0,v$4834];
 break; }default: {v$4833 = [1];
} };
switch (v$4833[0]) { case 0: {return [[v$4833[1],v$4830,v$4829],v$4832];
 break; }default: {return v$4832;
} };
},null,Map$419,0,0,[1],[1]));
drawMiniMap$1042();
gameCycle$1715(spriteMap$1938);
return renderCycle$1865(screenStrips$1937,spriteMap$1938);
};
(function(a){return window.onload=a;})(function(v$4743){return init$1926();
});
return 0;
})();
